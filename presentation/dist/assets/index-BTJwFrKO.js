(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function t(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(i){if(i.ep)return;i.ep=!0;const r=t(i);fetch(i.href,r)}})();var cf={exports:{}},Oa={},df={exports:{}},se={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Qi=Symbol.for("react.element"),a0=Symbol.for("react.portal"),o0=Symbol.for("react.fragment"),l0=Symbol.for("react.strict_mode"),u0=Symbol.for("react.profiler"),c0=Symbol.for("react.provider"),d0=Symbol.for("react.context"),h0=Symbol.for("react.forward_ref"),f0=Symbol.for("react.suspense"),g0=Symbol.for("react.memo"),p0=Symbol.for("react.lazy"),Oc=Symbol.iterator;function m0(n){return n===null||typeof n!="object"?null:(n=Oc&&n[Oc]||n["@@iterator"],typeof n=="function"?n:null)}var hf={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},ff=Object.assign,gf={};function qs(n,e,t){this.props=n,this.context=e,this.refs=gf,this.updater=t||hf}qs.prototype.isReactComponent={};qs.prototype.setState=function(n,e){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,n,e,"setState")};qs.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function pf(){}pf.prototype=qs.prototype;function du(n,e,t){this.props=n,this.context=e,this.refs=gf,this.updater=t||hf}var hu=du.prototype=new pf;hu.constructor=du;ff(hu,qs.prototype);hu.isPureReactComponent=!0;var Mc=Array.isArray,mf=Object.prototype.hasOwnProperty,fu={current:null},yf={key:!0,ref:!0,__self:!0,__source:!0};function vf(n,e,t){var s,i={},r=null,a=null;if(e!=null)for(s in e.ref!==void 0&&(a=e.ref),e.key!==void 0&&(r=""+e.key),e)mf.call(e,s)&&!yf.hasOwnProperty(s)&&(i[s]=e[s]);var o=arguments.length-2;if(o===1)i.children=t;else if(1<o){for(var l=Array(o),u=0;u<o;u++)l[u]=arguments[u+2];i.children=l}if(n&&n.defaultProps)for(s in o=n.defaultProps,o)i[s]===void 0&&(i[s]=o[s]);return{$$typeof:Qi,type:n,key:r,ref:a,props:i,_owner:fu.current}}function y0(n,e){return{$$typeof:Qi,type:n.type,key:e,ref:n.ref,props:n.props,_owner:n._owner}}function gu(n){return typeof n=="object"&&n!==null&&n.$$typeof===Qi}function v0(n){var e={"=":"=0",":":"=2"};return"$"+n.replace(/[=:]/g,function(t){return e[t]})}var Fc=/\/+/g;function no(n,e){return typeof n=="object"&&n!==null&&n.key!=null?v0(""+n.key):e.toString(36)}function Nr(n,e,t,s,i){var r=typeof n;(r==="undefined"||r==="boolean")&&(n=null);var a=!1;if(n===null)a=!0;else switch(r){case"string":case"number":a=!0;break;case"object":switch(n.$$typeof){case Qi:case a0:a=!0}}if(a)return a=n,i=i(a),n=s===""?"."+no(a,0):s,Mc(i)?(t="",n!=null&&(t=n.replace(Fc,"$&/")+"/"),Nr(i,e,t,"",function(u){return u})):i!=null&&(gu(i)&&(i=y0(i,t+(!i.key||a&&a.key===i.key?"":(""+i.key).replace(Fc,"$&/")+"/")+n)),e.push(i)),1;if(a=0,s=s===""?".":s+":",Mc(n))for(var o=0;o<n.length;o++){r=n[o];var l=s+no(r,o);a+=Nr(r,e,t,l,i)}else if(l=m0(n),typeof l=="function")for(n=l.call(n),o=0;!(r=n.next()).done;)r=r.value,l=s+no(r,o++),a+=Nr(r,e,t,l,i);else if(r==="object")throw e=String(n),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return a}function nr(n,e,t){if(n==null)return n;var s=[],i=0;return Nr(n,s,"","",function(r){return e.call(t,r,i++)}),s}function E0(n){if(n._status===-1){var e=n._result;e=e(),e.then(function(t){(n._status===0||n._status===-1)&&(n._status=1,n._result=t)},function(t){(n._status===0||n._status===-1)&&(n._status=2,n._result=t)}),n._status===-1&&(n._status=0,n._result=e)}if(n._status===1)return n._result.default;throw n._result}var Qe={current:null},Or={transition:null},x0={ReactCurrentDispatcher:Qe,ReactCurrentBatchConfig:Or,ReactCurrentOwner:fu};function Ef(){throw Error("act(...) is not supported in production builds of React.")}se.Children={map:nr,forEach:function(n,e,t){nr(n,function(){e.apply(this,arguments)},t)},count:function(n){var e=0;return nr(n,function(){e++}),e},toArray:function(n){return nr(n,function(e){return e})||[]},only:function(n){if(!gu(n))throw Error("React.Children.only expected to receive a single React element child.");return n}};se.Component=qs;se.Fragment=o0;se.Profiler=u0;se.PureComponent=du;se.StrictMode=l0;se.Suspense=f0;se.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=x0;se.act=Ef;se.cloneElement=function(n,e,t){if(n==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+n+".");var s=ff({},n.props),i=n.key,r=n.ref,a=n._owner;if(e!=null){if(e.ref!==void 0&&(r=e.ref,a=fu.current),e.key!==void 0&&(i=""+e.key),n.type&&n.type.defaultProps)var o=n.type.defaultProps;for(l in e)mf.call(e,l)&&!yf.hasOwnProperty(l)&&(s[l]=e[l]===void 0&&o!==void 0?o[l]:e[l])}var l=arguments.length-2;if(l===1)s.children=t;else if(1<l){o=Array(l);for(var u=0;u<l;u++)o[u]=arguments[u+2];s.children=o}return{$$typeof:Qi,type:n.type,key:i,ref:r,props:s,_owner:a}};se.createContext=function(n){return n={$$typeof:d0,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},n.Provider={$$typeof:c0,_context:n},n.Consumer=n};se.createElement=vf;se.createFactory=function(n){var e=vf.bind(null,n);return e.type=n,e};se.createRef=function(){return{current:null}};se.forwardRef=function(n){return{$$typeof:h0,render:n}};se.isValidElement=gu;se.lazy=function(n){return{$$typeof:p0,_payload:{_status:-1,_result:n},_init:E0}};se.memo=function(n,e){return{$$typeof:g0,type:n,compare:e===void 0?null:e}};se.startTransition=function(n){var e=Or.transition;Or.transition={};try{n()}finally{Or.transition=e}};se.unstable_act=Ef;se.useCallback=function(n,e){return Qe.current.useCallback(n,e)};se.useContext=function(n){return Qe.current.useContext(n)};se.useDebugValue=function(){};se.useDeferredValue=function(n){return Qe.current.useDeferredValue(n)};se.useEffect=function(n,e){return Qe.current.useEffect(n,e)};se.useId=function(){return Qe.current.useId()};se.useImperativeHandle=function(n,e,t){return Qe.current.useImperativeHandle(n,e,t)};se.useInsertionEffect=function(n,e){return Qe.current.useInsertionEffect(n,e)};se.useLayoutEffect=function(n,e){return Qe.current.useLayoutEffect(n,e)};se.useMemo=function(n,e){return Qe.current.useMemo(n,e)};se.useReducer=function(n,e,t){return Qe.current.useReducer(n,e,t)};se.useRef=function(n){return Qe.current.useRef(n)};se.useState=function(n){return Qe.current.useState(n)};se.useSyncExternalStore=function(n,e,t){return Qe.current.useSyncExternalStore(n,e,t)};se.useTransition=function(){return Qe.current.useTransition()};se.version="18.3.1";df.exports=se;var Ce=df.exports;/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var S0=Ce,T0=Symbol.for("react.element"),A0=Symbol.for("react.fragment"),L0=Object.prototype.hasOwnProperty,I0=S0.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,R0={key:!0,ref:!0,__self:!0,__source:!0};function xf(n,e,t){var s,i={},r=null,a=null;t!==void 0&&(r=""+t),e.key!==void 0&&(r=""+e.key),e.ref!==void 0&&(a=e.ref);for(s in e)L0.call(e,s)&&!R0.hasOwnProperty(s)&&(i[s]=e[s]);if(n&&n.defaultProps)for(s in e=n.defaultProps,e)i[s]===void 0&&(i[s]=e[s]);return{$$typeof:T0,type:n,key:r,ref:a,props:i,_owner:I0.current}}Oa.Fragment=A0;Oa.jsx=xf;Oa.jsxs=xf;cf.exports=Oa;var x=cf.exports,Sf={exports:{}},gt={},Tf={exports:{}},Af={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){function e(D,N){var U=D.length;D.push(N);e:for(;0<U;){var O=U-1>>>1,M=D[O];if(0<i(M,N))D[O]=N,D[U]=M,U=O;else break e}}function t(D){return D.length===0?null:D[0]}function s(D){if(D.length===0)return null;var N=D[0],U=D.pop();if(U!==N){D[0]=U;e:for(var O=0,M=D.length,Q=M>>>1;O<Q;){var te=2*(O+1)-1,Z=D[te],J=te+1,Ae=D[J];if(0>i(Z,U))J<M&&0>i(Ae,Z)?(D[O]=Ae,D[J]=U,O=J):(D[O]=Z,D[te]=U,O=te);else if(J<M&&0>i(Ae,U))D[O]=Ae,D[J]=U,O=J;else break e}}return N}function i(D,N){var U=D.sortIndex-N.sortIndex;return U!==0?U:D.id-N.id}if(typeof performance=="object"&&typeof performance.now=="function"){var r=performance;n.unstable_now=function(){return r.now()}}else{var a=Date,o=a.now();n.unstable_now=function(){return a.now()-o}}var l=[],u=[],c=1,d=null,h=3,f=!1,g=!1,p=!1,E=typeof setTimeout=="function"?setTimeout:null,y=typeof clearTimeout=="function"?clearTimeout:null,m=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function S(D){for(var N=t(u);N!==null;){if(N.callback===null)s(u);else if(N.startTime<=D)s(u),N.sortIndex=N.expirationTime,e(l,N);else break;N=t(u)}}function T(D){if(p=!1,S(D),!g)if(t(l)!==null)g=!0,B(A);else{var N=t(u);N!==null&&V(T,N.startTime-D)}}function A(D,N){g=!1,p&&(p=!1,y(R),R=-1),f=!0;var U=h;try{for(S(N),d=t(l);d!==null&&(!(d.expirationTime>N)||D&&!P());){var O=d.callback;if(typeof O=="function"){d.callback=null,h=d.priorityLevel;var M=O(d.expirationTime<=N);N=n.unstable_now(),typeof M=="function"?d.callback=M:d===t(l)&&s(l),S(N)}else s(l);d=t(l)}if(d!==null)var Q=!0;else{var te=t(u);te!==null&&V(T,te.startTime-N),Q=!1}return Q}finally{d=null,h=U,f=!1}}var _=!1,L=null,R=-1,C=5,I=-1;function P(){return!(n.unstable_now()-I<C)}function $(){if(L!==null){var D=n.unstable_now();I=D;var N=!0;try{N=L(!0,D)}finally{N?G():(_=!1,L=null)}}else _=!1}var G;if(typeof m=="function")G=function(){m($)};else if(typeof MessageChannel<"u"){var W=new MessageChannel,K=W.port2;W.port1.onmessage=$,G=function(){K.postMessage(null)}}else G=function(){E($,0)};function B(D){L=D,_||(_=!0,G())}function V(D,N){R=E(function(){D(n.unstable_now())},N)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(D){D.callback=null},n.unstable_continueExecution=function(){g||f||(g=!0,B(A))},n.unstable_forceFrameRate=function(D){0>D||125<D?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):C=0<D?Math.floor(1e3/D):5},n.unstable_getCurrentPriorityLevel=function(){return h},n.unstable_getFirstCallbackNode=function(){return t(l)},n.unstable_next=function(D){switch(h){case 1:case 2:case 3:var N=3;break;default:N=h}var U=h;h=N;try{return D()}finally{h=U}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(D,N){switch(D){case 1:case 2:case 3:case 4:case 5:break;default:D=3}var U=h;h=D;try{return N()}finally{h=U}},n.unstable_scheduleCallback=function(D,N,U){var O=n.unstable_now();switch(typeof U=="object"&&U!==null?(U=U.delay,U=typeof U=="number"&&0<U?O+U:O):U=O,D){case 1:var M=-1;break;case 2:M=250;break;case 5:M=1073741823;break;case 4:M=1e4;break;default:M=5e3}return M=U+M,D={id:c++,callback:N,priorityLevel:D,startTime:U,expirationTime:M,sortIndex:-1},U>O?(D.sortIndex=U,e(u,D),t(l)===null&&D===t(u)&&(p?(y(R),R=-1):p=!0,V(T,U-O))):(D.sortIndex=M,e(l,D),g||f||(g=!0,B(A))),D},n.unstable_shouldYield=P,n.unstable_wrapCallback=function(D){var N=h;return function(){var U=h;h=N;try{return D.apply(this,arguments)}finally{h=U}}}})(Af);Tf.exports=Af;var _0=Tf.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var C0=Ce,ft=_0;function F(n){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+n,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+n+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Lf=new Set,Ri={};function os(n,e){$s(n,e),$s(n+"Capture",e)}function $s(n,e){for(Ri[n]=e,n=0;n<e.length;n++)Lf.add(e[n])}var ln=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Jo=Object.prototype.hasOwnProperty,k0=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Bc={},Uc={};function w0(n){return Jo.call(Uc,n)?!0:Jo.call(Bc,n)?!1:k0.test(n)?Uc[n]=!0:(Bc[n]=!0,!1)}function D0(n,e,t,s){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return s?!1:t!==null?!t.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function P0(n,e,t,s){if(e===null||typeof e>"u"||D0(n,e,t,s))return!0;if(s)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Xe(n,e,t,s,i,r,a){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=s,this.attributeNamespace=i,this.mustUseProperty=t,this.propertyName=n,this.type=e,this.sanitizeURL=r,this.removeEmptyString=a}var je={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){je[n]=new Xe(n,0,!1,n,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var e=n[0];je[e]=new Xe(e,1,!1,n[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(n){je[n]=new Xe(n,2,!1,n.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){je[n]=new Xe(n,2,!1,n,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){je[n]=new Xe(n,3,!1,n.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(n){je[n]=new Xe(n,3,!0,n,null,!1,!1)});["capture","download"].forEach(function(n){je[n]=new Xe(n,4,!1,n,null,!1,!1)});["cols","rows","size","span"].forEach(function(n){je[n]=new Xe(n,6,!1,n,null,!1,!1)});["rowSpan","start"].forEach(function(n){je[n]=new Xe(n,5,!1,n.toLowerCase(),null,!1,!1)});var pu=/[\-:]([a-z])/g;function mu(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var e=n.replace(pu,mu);je[e]=new Xe(e,1,!1,n,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var e=n.replace(pu,mu);je[e]=new Xe(e,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(n){var e=n.replace(pu,mu);je[e]=new Xe(e,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(n){je[n]=new Xe(n,1,!1,n.toLowerCase(),null,!1,!1)});je.xlinkHref=new Xe("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(n){je[n]=new Xe(n,1,!1,n.toLowerCase(),null,!0,!0)});function yu(n,e,t,s){var i=je.hasOwnProperty(e)?je[e]:null;(i!==null?i.type!==0:s||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(P0(e,t,i,s)&&(t=null),s||i===null?w0(e)&&(t===null?n.removeAttribute(e):n.setAttribute(e,""+t)):i.mustUseProperty?n[i.propertyName]=t===null?i.type===3?!1:"":t:(e=i.attributeName,s=i.attributeNamespace,t===null?n.removeAttribute(e):(i=i.type,t=i===3||i===4&&t===!0?"":""+t,s?n.setAttributeNS(s,e,t):n.setAttribute(e,t))))}var hn=C0.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,sr=Symbol.for("react.element"),ys=Symbol.for("react.portal"),vs=Symbol.for("react.fragment"),vu=Symbol.for("react.strict_mode"),el=Symbol.for("react.profiler"),If=Symbol.for("react.provider"),Rf=Symbol.for("react.context"),Eu=Symbol.for("react.forward_ref"),tl=Symbol.for("react.suspense"),nl=Symbol.for("react.suspense_list"),xu=Symbol.for("react.memo"),mn=Symbol.for("react.lazy"),_f=Symbol.for("react.offscreen"),$c=Symbol.iterator;function ei(n){return n===null||typeof n!="object"?null:(n=$c&&n[$c]||n["@@iterator"],typeof n=="function"?n:null)}var xe=Object.assign,so;function ui(n){if(so===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);so=e&&e[1]||""}return`
`+so+n}var io=!1;function ro(n,e){if(!n||io)return"";io=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(u){var s=u}Reflect.construct(n,[],e)}else{try{e.call()}catch(u){s=u}n.call(e.prototype)}else{try{throw Error()}catch(u){s=u}n()}}catch(u){if(u&&s&&typeof u.stack=="string"){for(var i=u.stack.split(`
`),r=s.stack.split(`
`),a=i.length-1,o=r.length-1;1<=a&&0<=o&&i[a]!==r[o];)o--;for(;1<=a&&0<=o;a--,o--)if(i[a]!==r[o]){if(a!==1||o!==1)do if(a--,o--,0>o||i[a]!==r[o]){var l=`
`+i[a].replace(" at new "," at ");return n.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",n.displayName)),l}while(1<=a&&0<=o);break}}}finally{io=!1,Error.prepareStackTrace=t}return(n=n?n.displayName||n.name:"")?ui(n):""}function b0(n){switch(n.tag){case 5:return ui(n.type);case 16:return ui("Lazy");case 13:return ui("Suspense");case 19:return ui("SuspenseList");case 0:case 2:case 15:return n=ro(n.type,!1),n;case 11:return n=ro(n.type.render,!1),n;case 1:return n=ro(n.type,!0),n;default:return""}}function sl(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case vs:return"Fragment";case ys:return"Portal";case el:return"Profiler";case vu:return"StrictMode";case tl:return"Suspense";case nl:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case Rf:return(n.displayName||"Context")+".Consumer";case If:return(n._context.displayName||"Context")+".Provider";case Eu:var e=n.render;return n=n.displayName,n||(n=e.displayName||e.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case xu:return e=n.displayName||null,e!==null?e:sl(n.type)||"Memo";case mn:e=n._payload,n=n._init;try{return sl(n(e))}catch{}}return null}function N0(n){var e=n.type;switch(n.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=e.render,n=n.displayName||n.name||"",e.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return sl(e);case 8:return e===vu?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function bn(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function Cf(n){var e=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function O0(n){var e=Cf(n)?"checked":"value",t=Object.getOwnPropertyDescriptor(n.constructor.prototype,e),s=""+n[e];if(!n.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var i=t.get,r=t.set;return Object.defineProperty(n,e,{configurable:!0,get:function(){return i.call(this)},set:function(a){s=""+a,r.call(this,a)}}),Object.defineProperty(n,e,{enumerable:t.enumerable}),{getValue:function(){return s},setValue:function(a){s=""+a},stopTracking:function(){n._valueTracker=null,delete n[e]}}}}function ir(n){n._valueTracker||(n._valueTracker=O0(n))}function kf(n){if(!n)return!1;var e=n._valueTracker;if(!e)return!0;var t=e.getValue(),s="";return n&&(s=Cf(n)?n.checked?"true":"false":n.value),n=s,n!==t?(e.setValue(n),!0):!1}function ea(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function il(n,e){var t=e.checked;return xe({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??n._wrapperState.initialChecked})}function jc(n,e){var t=e.defaultValue==null?"":e.defaultValue,s=e.checked!=null?e.checked:e.defaultChecked;t=bn(e.value!=null?e.value:t),n._wrapperState={initialChecked:s,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function wf(n,e){e=e.checked,e!=null&&yu(n,"checked",e,!1)}function rl(n,e){wf(n,e);var t=bn(e.value),s=e.type;if(t!=null)s==="number"?(t===0&&n.value===""||n.value!=t)&&(n.value=""+t):n.value!==""+t&&(n.value=""+t);else if(s==="submit"||s==="reset"){n.removeAttribute("value");return}e.hasOwnProperty("value")?al(n,e.type,t):e.hasOwnProperty("defaultValue")&&al(n,e.type,bn(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(n.defaultChecked=!!e.defaultChecked)}function Gc(n,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var s=e.type;if(!(s!=="submit"&&s!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+n._wrapperState.initialValue,t||e===n.value||(n.value=e),n.defaultValue=e}t=n.name,t!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,t!==""&&(n.name=t)}function al(n,e,t){(e!=="number"||ea(n.ownerDocument)!==n)&&(t==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+t&&(n.defaultValue=""+t))}var ci=Array.isArray;function ws(n,e,t,s){if(n=n.options,e){e={};for(var i=0;i<t.length;i++)e["$"+t[i]]=!0;for(t=0;t<n.length;t++)i=e.hasOwnProperty("$"+n[t].value),n[t].selected!==i&&(n[t].selected=i),i&&s&&(n[t].defaultSelected=!0)}else{for(t=""+bn(t),e=null,i=0;i<n.length;i++){if(n[i].value===t){n[i].selected=!0,s&&(n[i].defaultSelected=!0);return}e!==null||n[i].disabled||(e=n[i])}e!==null&&(e.selected=!0)}}function ol(n,e){if(e.dangerouslySetInnerHTML!=null)throw Error(F(91));return xe({},e,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function Kc(n,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(F(92));if(ci(t)){if(1<t.length)throw Error(F(93));t=t[0]}e=t}e==null&&(e=""),t=e}n._wrapperState={initialValue:bn(t)}}function Df(n,e){var t=bn(e.value),s=bn(e.defaultValue);t!=null&&(t=""+t,t!==n.value&&(n.value=t),e.defaultValue==null&&n.defaultValue!==t&&(n.defaultValue=t)),s!=null&&(n.defaultValue=""+s)}function Vc(n){var e=n.textContent;e===n._wrapperState.initialValue&&e!==""&&e!==null&&(n.value=e)}function Pf(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ll(n,e){return n==null||n==="http://www.w3.org/1999/xhtml"?Pf(e):n==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var rr,bf=function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,s,i){MSApp.execUnsafeLocalFunction(function(){return n(e,t,s,i)})}:n}(function(n,e){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=e;else{for(rr=rr||document.createElement("div"),rr.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=rr.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;e.firstChild;)n.appendChild(e.firstChild)}});function _i(n,e){if(e){var t=n.firstChild;if(t&&t===n.lastChild&&t.nodeType===3){t.nodeValue=e;return}}n.textContent=e}var gi={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},M0=["Webkit","ms","Moz","O"];Object.keys(gi).forEach(function(n){M0.forEach(function(e){e=e+n.charAt(0).toUpperCase()+n.substring(1),gi[e]=gi[n]})});function Nf(n,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||gi.hasOwnProperty(n)&&gi[n]?(""+e).trim():e+"px"}function Of(n,e){n=n.style;for(var t in e)if(e.hasOwnProperty(t)){var s=t.indexOf("--")===0,i=Nf(t,e[t],s);t==="float"&&(t="cssFloat"),s?n.setProperty(t,i):n[t]=i}}var F0=xe({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ul(n,e){if(e){if(F0[n]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(F(137,n));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(F(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(F(61))}if(e.style!=null&&typeof e.style!="object")throw Error(F(62))}}function cl(n,e){if(n.indexOf("-")===-1)return typeof e.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var dl=null;function Su(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var hl=null,Ds=null,Ps=null;function Hc(n){if(n=Ji(n)){if(typeof hl!="function")throw Error(F(280));var e=n.stateNode;e&&(e=$a(e),hl(n.stateNode,n.type,e))}}function Mf(n){Ds?Ps?Ps.push(n):Ps=[n]:Ds=n}function Ff(){if(Ds){var n=Ds,e=Ps;if(Ps=Ds=null,Hc(n),e)for(n=0;n<e.length;n++)Hc(e[n])}}function Bf(n,e){return n(e)}function Uf(){}var ao=!1;function $f(n,e,t){if(ao)return n(e,t);ao=!0;try{return Bf(n,e,t)}finally{ao=!1,(Ds!==null||Ps!==null)&&(Uf(),Ff())}}function Ci(n,e){var t=n.stateNode;if(t===null)return null;var s=$a(t);if(s===null)return null;t=s[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(s=!s.disabled)||(n=n.type,s=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!s;break e;default:n=!1}if(n)return null;if(t&&typeof t!="function")throw Error(F(231,e,typeof t));return t}var fl=!1;if(ln)try{var ti={};Object.defineProperty(ti,"passive",{get:function(){fl=!0}}),window.addEventListener("test",ti,ti),window.removeEventListener("test",ti,ti)}catch{fl=!1}function B0(n,e,t,s,i,r,a,o,l){var u=Array.prototype.slice.call(arguments,3);try{e.apply(t,u)}catch(c){this.onError(c)}}var pi=!1,ta=null,na=!1,gl=null,U0={onError:function(n){pi=!0,ta=n}};function $0(n,e,t,s,i,r,a,o,l){pi=!1,ta=null,B0.apply(U0,arguments)}function j0(n,e,t,s,i,r,a,o,l){if($0.apply(this,arguments),pi){if(pi){var u=ta;pi=!1,ta=null}else throw Error(F(198));na||(na=!0,gl=u)}}function ls(n){var e=n,t=n;if(n.alternate)for(;e.return;)e=e.return;else{n=e;do e=n,e.flags&4098&&(t=e.return),n=e.return;while(n)}return e.tag===3?t:null}function jf(n){if(n.tag===13){var e=n.memoizedState;if(e===null&&(n=n.alternate,n!==null&&(e=n.memoizedState)),e!==null)return e.dehydrated}return null}function zc(n){if(ls(n)!==n)throw Error(F(188))}function G0(n){var e=n.alternate;if(!e){if(e=ls(n),e===null)throw Error(F(188));return e!==n?null:n}for(var t=n,s=e;;){var i=t.return;if(i===null)break;var r=i.alternate;if(r===null){if(s=i.return,s!==null){t=s;continue}break}if(i.child===r.child){for(r=i.child;r;){if(r===t)return zc(i),n;if(r===s)return zc(i),e;r=r.sibling}throw Error(F(188))}if(t.return!==s.return)t=i,s=r;else{for(var a=!1,o=i.child;o;){if(o===t){a=!0,t=i,s=r;break}if(o===s){a=!0,s=i,t=r;break}o=o.sibling}if(!a){for(o=r.child;o;){if(o===t){a=!0,t=r,s=i;break}if(o===s){a=!0,s=r,t=i;break}o=o.sibling}if(!a)throw Error(F(189))}}if(t.alternate!==s)throw Error(F(190))}if(t.tag!==3)throw Error(F(188));return t.stateNode.current===t?n:e}function Gf(n){return n=G0(n),n!==null?Kf(n):null}function Kf(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var e=Kf(n);if(e!==null)return e;n=n.sibling}return null}var Vf=ft.unstable_scheduleCallback,Wc=ft.unstable_cancelCallback,K0=ft.unstable_shouldYield,V0=ft.unstable_requestPaint,Le=ft.unstable_now,H0=ft.unstable_getCurrentPriorityLevel,Tu=ft.unstable_ImmediatePriority,Hf=ft.unstable_UserBlockingPriority,sa=ft.unstable_NormalPriority,z0=ft.unstable_LowPriority,zf=ft.unstable_IdlePriority,Ma=null,Yt=null;function W0(n){if(Yt&&typeof Yt.onCommitFiberRoot=="function")try{Yt.onCommitFiberRoot(Ma,n,void 0,(n.current.flags&128)===128)}catch{}}var bt=Math.clz32?Math.clz32:Q0,Y0=Math.log,q0=Math.LN2;function Q0(n){return n>>>=0,n===0?32:31-(Y0(n)/q0|0)|0}var ar=64,or=4194304;function di(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function ia(n,e){var t=n.pendingLanes;if(t===0)return 0;var s=0,i=n.suspendedLanes,r=n.pingedLanes,a=t&268435455;if(a!==0){var o=a&~i;o!==0?s=di(o):(r&=a,r!==0&&(s=di(r)))}else a=t&~i,a!==0?s=di(a):r!==0&&(s=di(r));if(s===0)return 0;if(e!==0&&e!==s&&!(e&i)&&(i=s&-s,r=e&-e,i>=r||i===16&&(r&4194240)!==0))return e;if(s&4&&(s|=t&16),e=n.entangledLanes,e!==0)for(n=n.entanglements,e&=s;0<e;)t=31-bt(e),i=1<<t,s|=n[t],e&=~i;return s}function X0(n,e){switch(n){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Z0(n,e){for(var t=n.suspendedLanes,s=n.pingedLanes,i=n.expirationTimes,r=n.pendingLanes;0<r;){var a=31-bt(r),o=1<<a,l=i[a];l===-1?(!(o&t)||o&s)&&(i[a]=X0(o,e)):l<=e&&(n.expiredLanes|=o),r&=~o}}function pl(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function Wf(){var n=ar;return ar<<=1,!(ar&4194240)&&(ar=64),n}function oo(n){for(var e=[],t=0;31>t;t++)e.push(n);return e}function Xi(n,e,t){n.pendingLanes|=e,e!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,e=31-bt(e),n[e]=t}function J0(n,e){var t=n.pendingLanes&~e;n.pendingLanes=e,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=e,n.mutableReadLanes&=e,n.entangledLanes&=e,e=n.entanglements;var s=n.eventTimes;for(n=n.expirationTimes;0<t;){var i=31-bt(t),r=1<<i;e[i]=0,s[i]=-1,n[i]=-1,t&=~r}}function Au(n,e){var t=n.entangledLanes|=e;for(n=n.entanglements;t;){var s=31-bt(t),i=1<<s;i&e|n[s]&e&&(n[s]|=e),t&=~i}}var le=0;function Yf(n){return n&=-n,1<n?4<n?n&268435455?16:536870912:4:1}var qf,Lu,Qf,Xf,Zf,ml=!1,lr=[],Ln=null,In=null,Rn=null,ki=new Map,wi=new Map,xn=[],ey="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Yc(n,e){switch(n){case"focusin":case"focusout":Ln=null;break;case"dragenter":case"dragleave":In=null;break;case"mouseover":case"mouseout":Rn=null;break;case"pointerover":case"pointerout":ki.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":wi.delete(e.pointerId)}}function ni(n,e,t,s,i,r){return n===null||n.nativeEvent!==r?(n={blockedOn:e,domEventName:t,eventSystemFlags:s,nativeEvent:r,targetContainers:[i]},e!==null&&(e=Ji(e),e!==null&&Lu(e)),n):(n.eventSystemFlags|=s,e=n.targetContainers,i!==null&&e.indexOf(i)===-1&&e.push(i),n)}function ty(n,e,t,s,i){switch(e){case"focusin":return Ln=ni(Ln,n,e,t,s,i),!0;case"dragenter":return In=ni(In,n,e,t,s,i),!0;case"mouseover":return Rn=ni(Rn,n,e,t,s,i),!0;case"pointerover":var r=i.pointerId;return ki.set(r,ni(ki.get(r)||null,n,e,t,s,i)),!0;case"gotpointercapture":return r=i.pointerId,wi.set(r,ni(wi.get(r)||null,n,e,t,s,i)),!0}return!1}function Jf(n){var e=Yn(n.target);if(e!==null){var t=ls(e);if(t!==null){if(e=t.tag,e===13){if(e=jf(t),e!==null){n.blockedOn=e,Zf(n.priority,function(){Qf(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){n.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}n.blockedOn=null}function Mr(n){if(n.blockedOn!==null)return!1;for(var e=n.targetContainers;0<e.length;){var t=yl(n.domEventName,n.eventSystemFlags,e[0],n.nativeEvent);if(t===null){t=n.nativeEvent;var s=new t.constructor(t.type,t);dl=s,t.target.dispatchEvent(s),dl=null}else return e=Ji(t),e!==null&&Lu(e),n.blockedOn=t,!1;e.shift()}return!0}function qc(n,e,t){Mr(n)&&t.delete(e)}function ny(){ml=!1,Ln!==null&&Mr(Ln)&&(Ln=null),In!==null&&Mr(In)&&(In=null),Rn!==null&&Mr(Rn)&&(Rn=null),ki.forEach(qc),wi.forEach(qc)}function si(n,e){n.blockedOn===e&&(n.blockedOn=null,ml||(ml=!0,ft.unstable_scheduleCallback(ft.unstable_NormalPriority,ny)))}function Di(n){function e(i){return si(i,n)}if(0<lr.length){si(lr[0],n);for(var t=1;t<lr.length;t++){var s=lr[t];s.blockedOn===n&&(s.blockedOn=null)}}for(Ln!==null&&si(Ln,n),In!==null&&si(In,n),Rn!==null&&si(Rn,n),ki.forEach(e),wi.forEach(e),t=0;t<xn.length;t++)s=xn[t],s.blockedOn===n&&(s.blockedOn=null);for(;0<xn.length&&(t=xn[0],t.blockedOn===null);)Jf(t),t.blockedOn===null&&xn.shift()}var bs=hn.ReactCurrentBatchConfig,ra=!0;function sy(n,e,t,s){var i=le,r=bs.transition;bs.transition=null;try{le=1,Iu(n,e,t,s)}finally{le=i,bs.transition=r}}function iy(n,e,t,s){var i=le,r=bs.transition;bs.transition=null;try{le=4,Iu(n,e,t,s)}finally{le=i,bs.transition=r}}function Iu(n,e,t,s){if(ra){var i=yl(n,e,t,s);if(i===null)vo(n,e,s,aa,t),Yc(n,s);else if(ty(i,n,e,t,s))s.stopPropagation();else if(Yc(n,s),e&4&&-1<ey.indexOf(n)){for(;i!==null;){var r=Ji(i);if(r!==null&&qf(r),r=yl(n,e,t,s),r===null&&vo(n,e,s,aa,t),r===i)break;i=r}i!==null&&s.stopPropagation()}else vo(n,e,s,null,t)}}var aa=null;function yl(n,e,t,s){if(aa=null,n=Su(s),n=Yn(n),n!==null)if(e=ls(n),e===null)n=null;else if(t=e.tag,t===13){if(n=jf(e),n!==null)return n;n=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;n=null}else e!==n&&(n=null);return aa=n,null}function eg(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(H0()){case Tu:return 1;case Hf:return 4;case sa:case z0:return 16;case zf:return 536870912;default:return 16}default:return 16}}var Tn=null,Ru=null,Fr=null;function tg(){if(Fr)return Fr;var n,e=Ru,t=e.length,s,i="value"in Tn?Tn.value:Tn.textContent,r=i.length;for(n=0;n<t&&e[n]===i[n];n++);var a=t-n;for(s=1;s<=a&&e[t-s]===i[r-s];s++);return Fr=i.slice(n,1<s?1-s:void 0)}function Br(n){var e=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&e===13&&(n=13)):n=e,n===10&&(n=13),32<=n||n===13?n:0}function ur(){return!0}function Qc(){return!1}function pt(n){function e(t,s,i,r,a){this._reactName=t,this._targetInst=i,this.type=s,this.nativeEvent=r,this.target=a,this.currentTarget=null;for(var o in n)n.hasOwnProperty(o)&&(t=n[o],this[o]=t?t(r):r[o]);return this.isDefaultPrevented=(r.defaultPrevented!=null?r.defaultPrevented:r.returnValue===!1)?ur:Qc,this.isPropagationStopped=Qc,this}return xe(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=ur)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=ur)},persist:function(){},isPersistent:ur}),e}var Qs={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},_u=pt(Qs),Zi=xe({},Qs,{view:0,detail:0}),ry=pt(Zi),lo,uo,ii,Fa=xe({},Zi,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Cu,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==ii&&(ii&&n.type==="mousemove"?(lo=n.screenX-ii.screenX,uo=n.screenY-ii.screenY):uo=lo=0,ii=n),lo)},movementY:function(n){return"movementY"in n?n.movementY:uo}}),Xc=pt(Fa),ay=xe({},Fa,{dataTransfer:0}),oy=pt(ay),ly=xe({},Zi,{relatedTarget:0}),co=pt(ly),uy=xe({},Qs,{animationName:0,elapsedTime:0,pseudoElement:0}),cy=pt(uy),dy=xe({},Qs,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),hy=pt(dy),fy=xe({},Qs,{data:0}),Zc=pt(fy),gy={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},py={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},my={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function yy(n){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(n):(n=my[n])?!!e[n]:!1}function Cu(){return yy}var vy=xe({},Zi,{key:function(n){if(n.key){var e=gy[n.key]||n.key;if(e!=="Unidentified")return e}return n.type==="keypress"?(n=Br(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?py[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Cu,charCode:function(n){return n.type==="keypress"?Br(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?Br(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),Ey=pt(vy),xy=xe({},Fa,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Jc=pt(xy),Sy=xe({},Zi,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Cu}),Ty=pt(Sy),Ay=xe({},Qs,{propertyName:0,elapsedTime:0,pseudoElement:0}),Ly=pt(Ay),Iy=xe({},Fa,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),Ry=pt(Iy),_y=[9,13,27,32],ku=ln&&"CompositionEvent"in window,mi=null;ln&&"documentMode"in document&&(mi=document.documentMode);var Cy=ln&&"TextEvent"in window&&!mi,ng=ln&&(!ku||mi&&8<mi&&11>=mi),ed=" ",td=!1;function sg(n,e){switch(n){case"keyup":return _y.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function ig(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var Es=!1;function ky(n,e){switch(n){case"compositionend":return ig(e);case"keypress":return e.which!==32?null:(td=!0,ed);case"textInput":return n=e.data,n===ed&&td?null:n;default:return null}}function wy(n,e){if(Es)return n==="compositionend"||!ku&&sg(n,e)?(n=tg(),Fr=Ru=Tn=null,Es=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return ng&&e.locale!=="ko"?null:e.data;default:return null}}var Dy={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function nd(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e==="input"?!!Dy[n.type]:e==="textarea"}function rg(n,e,t,s){Mf(s),e=oa(e,"onChange"),0<e.length&&(t=new _u("onChange","change",null,t,s),n.push({event:t,listeners:e}))}var yi=null,Pi=null;function Py(n){mg(n,0)}function Ba(n){var e=Ts(n);if(kf(e))return n}function by(n,e){if(n==="change")return e}var ag=!1;if(ln){var ho;if(ln){var fo="oninput"in document;if(!fo){var sd=document.createElement("div");sd.setAttribute("oninput","return;"),fo=typeof sd.oninput=="function"}ho=fo}else ho=!1;ag=ho&&(!document.documentMode||9<document.documentMode)}function id(){yi&&(yi.detachEvent("onpropertychange",og),Pi=yi=null)}function og(n){if(n.propertyName==="value"&&Ba(Pi)){var e=[];rg(e,Pi,n,Su(n)),$f(Py,e)}}function Ny(n,e,t){n==="focusin"?(id(),yi=e,Pi=t,yi.attachEvent("onpropertychange",og)):n==="focusout"&&id()}function Oy(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return Ba(Pi)}function My(n,e){if(n==="click")return Ba(e)}function Fy(n,e){if(n==="input"||n==="change")return Ba(e)}function By(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var Ot=typeof Object.is=="function"?Object.is:By;function bi(n,e){if(Ot(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;var t=Object.keys(n),s=Object.keys(e);if(t.length!==s.length)return!1;for(s=0;s<t.length;s++){var i=t[s];if(!Jo.call(e,i)||!Ot(n[i],e[i]))return!1}return!0}function rd(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function ad(n,e){var t=rd(n);n=0;for(var s;t;){if(t.nodeType===3){if(s=n+t.textContent.length,n<=e&&s>=e)return{node:t,offset:e-n};n=s}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=rd(t)}}function lg(n,e){return n&&e?n===e?!0:n&&n.nodeType===3?!1:e&&e.nodeType===3?lg(n,e.parentNode):"contains"in n?n.contains(e):n.compareDocumentPosition?!!(n.compareDocumentPosition(e)&16):!1:!1}function ug(){for(var n=window,e=ea();e instanceof n.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)n=e.contentWindow;else break;e=ea(n.document)}return e}function wu(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e&&(e==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||e==="textarea"||n.contentEditable==="true")}function Uy(n){var e=ug(),t=n.focusedElem,s=n.selectionRange;if(e!==t&&t&&t.ownerDocument&&lg(t.ownerDocument.documentElement,t)){if(s!==null&&wu(t)){if(e=s.start,n=s.end,n===void 0&&(n=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(n,t.value.length);else if(n=(e=t.ownerDocument||document)&&e.defaultView||window,n.getSelection){n=n.getSelection();var i=t.textContent.length,r=Math.min(s.start,i);s=s.end===void 0?r:Math.min(s.end,i),!n.extend&&r>s&&(i=s,s=r,r=i),i=ad(t,r);var a=ad(t,s);i&&a&&(n.rangeCount!==1||n.anchorNode!==i.node||n.anchorOffset!==i.offset||n.focusNode!==a.node||n.focusOffset!==a.offset)&&(e=e.createRange(),e.setStart(i.node,i.offset),n.removeAllRanges(),r>s?(n.addRange(e),n.extend(a.node,a.offset)):(e.setEnd(a.node,a.offset),n.addRange(e)))}}for(e=[],n=t;n=n.parentNode;)n.nodeType===1&&e.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)n=e[t],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var $y=ln&&"documentMode"in document&&11>=document.documentMode,xs=null,vl=null,vi=null,El=!1;function od(n,e,t){var s=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;El||xs==null||xs!==ea(s)||(s=xs,"selectionStart"in s&&wu(s)?s={start:s.selectionStart,end:s.selectionEnd}:(s=(s.ownerDocument&&s.ownerDocument.defaultView||window).getSelection(),s={anchorNode:s.anchorNode,anchorOffset:s.anchorOffset,focusNode:s.focusNode,focusOffset:s.focusOffset}),vi&&bi(vi,s)||(vi=s,s=oa(vl,"onSelect"),0<s.length&&(e=new _u("onSelect","select",null,e,t),n.push({event:e,listeners:s}),e.target=xs)))}function cr(n,e){var t={};return t[n.toLowerCase()]=e.toLowerCase(),t["Webkit"+n]="webkit"+e,t["Moz"+n]="moz"+e,t}var Ss={animationend:cr("Animation","AnimationEnd"),animationiteration:cr("Animation","AnimationIteration"),animationstart:cr("Animation","AnimationStart"),transitionend:cr("Transition","TransitionEnd")},go={},cg={};ln&&(cg=document.createElement("div").style,"AnimationEvent"in window||(delete Ss.animationend.animation,delete Ss.animationiteration.animation,delete Ss.animationstart.animation),"TransitionEvent"in window||delete Ss.transitionend.transition);function Ua(n){if(go[n])return go[n];if(!Ss[n])return n;var e=Ss[n],t;for(t in e)if(e.hasOwnProperty(t)&&t in cg)return go[n]=e[t];return n}var dg=Ua("animationend"),hg=Ua("animationiteration"),fg=Ua("animationstart"),gg=Ua("transitionend"),pg=new Map,ld="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Fn(n,e){pg.set(n,e),os(e,[n])}for(var po=0;po<ld.length;po++){var mo=ld[po],jy=mo.toLowerCase(),Gy=mo[0].toUpperCase()+mo.slice(1);Fn(jy,"on"+Gy)}Fn(dg,"onAnimationEnd");Fn(hg,"onAnimationIteration");Fn(fg,"onAnimationStart");Fn("dblclick","onDoubleClick");Fn("focusin","onFocus");Fn("focusout","onBlur");Fn(gg,"onTransitionEnd");$s("onMouseEnter",["mouseout","mouseover"]);$s("onMouseLeave",["mouseout","mouseover"]);$s("onPointerEnter",["pointerout","pointerover"]);$s("onPointerLeave",["pointerout","pointerover"]);os("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));os("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));os("onBeforeInput",["compositionend","keypress","textInput","paste"]);os("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));os("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));os("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var hi="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Ky=new Set("cancel close invalid load scroll toggle".split(" ").concat(hi));function ud(n,e,t){var s=n.type||"unknown-event";n.currentTarget=t,j0(s,e,void 0,n),n.currentTarget=null}function mg(n,e){e=(e&4)!==0;for(var t=0;t<n.length;t++){var s=n[t],i=s.event;s=s.listeners;e:{var r=void 0;if(e)for(var a=s.length-1;0<=a;a--){var o=s[a],l=o.instance,u=o.currentTarget;if(o=o.listener,l!==r&&i.isPropagationStopped())break e;ud(i,o,u),r=l}else for(a=0;a<s.length;a++){if(o=s[a],l=o.instance,u=o.currentTarget,o=o.listener,l!==r&&i.isPropagationStopped())break e;ud(i,o,u),r=l}}}if(na)throw n=gl,na=!1,gl=null,n}function fe(n,e){var t=e[Ll];t===void 0&&(t=e[Ll]=new Set);var s=n+"__bubble";t.has(s)||(yg(e,n,2,!1),t.add(s))}function yo(n,e,t){var s=0;e&&(s|=4),yg(t,n,s,e)}var dr="_reactListening"+Math.random().toString(36).slice(2);function Ni(n){if(!n[dr]){n[dr]=!0,Lf.forEach(function(t){t!=="selectionchange"&&(Ky.has(t)||yo(t,!1,n),yo(t,!0,n))});var e=n.nodeType===9?n:n.ownerDocument;e===null||e[dr]||(e[dr]=!0,yo("selectionchange",!1,e))}}function yg(n,e,t,s){switch(eg(e)){case 1:var i=sy;break;case 4:i=iy;break;default:i=Iu}t=i.bind(null,e,t,n),i=void 0,!fl||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(i=!0),s?i!==void 0?n.addEventListener(e,t,{capture:!0,passive:i}):n.addEventListener(e,t,!0):i!==void 0?n.addEventListener(e,t,{passive:i}):n.addEventListener(e,t,!1)}function vo(n,e,t,s,i){var r=s;if(!(e&1)&&!(e&2)&&s!==null)e:for(;;){if(s===null)return;var a=s.tag;if(a===3||a===4){var o=s.stateNode.containerInfo;if(o===i||o.nodeType===8&&o.parentNode===i)break;if(a===4)for(a=s.return;a!==null;){var l=a.tag;if((l===3||l===4)&&(l=a.stateNode.containerInfo,l===i||l.nodeType===8&&l.parentNode===i))return;a=a.return}for(;o!==null;){if(a=Yn(o),a===null)return;if(l=a.tag,l===5||l===6){s=r=a;continue e}o=o.parentNode}}s=s.return}$f(function(){var u=r,c=Su(t),d=[];e:{var h=pg.get(n);if(h!==void 0){var f=_u,g=n;switch(n){case"keypress":if(Br(t)===0)break e;case"keydown":case"keyup":f=Ey;break;case"focusin":g="focus",f=co;break;case"focusout":g="blur",f=co;break;case"beforeblur":case"afterblur":f=co;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":f=Xc;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":f=oy;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":f=Ty;break;case dg:case hg:case fg:f=cy;break;case gg:f=Ly;break;case"scroll":f=ry;break;case"wheel":f=Ry;break;case"copy":case"cut":case"paste":f=hy;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":f=Jc}var p=(e&4)!==0,E=!p&&n==="scroll",y=p?h!==null?h+"Capture":null:h;p=[];for(var m=u,S;m!==null;){S=m;var T=S.stateNode;if(S.tag===5&&T!==null&&(S=T,y!==null&&(T=Ci(m,y),T!=null&&p.push(Oi(m,T,S)))),E)break;m=m.return}0<p.length&&(h=new f(h,g,null,t,c),d.push({event:h,listeners:p}))}}if(!(e&7)){e:{if(h=n==="mouseover"||n==="pointerover",f=n==="mouseout"||n==="pointerout",h&&t!==dl&&(g=t.relatedTarget||t.fromElement)&&(Yn(g)||g[un]))break e;if((f||h)&&(h=c.window===c?c:(h=c.ownerDocument)?h.defaultView||h.parentWindow:window,f?(g=t.relatedTarget||t.toElement,f=u,g=g?Yn(g):null,g!==null&&(E=ls(g),g!==E||g.tag!==5&&g.tag!==6)&&(g=null)):(f=null,g=u),f!==g)){if(p=Xc,T="onMouseLeave",y="onMouseEnter",m="mouse",(n==="pointerout"||n==="pointerover")&&(p=Jc,T="onPointerLeave",y="onPointerEnter",m="pointer"),E=f==null?h:Ts(f),S=g==null?h:Ts(g),h=new p(T,m+"leave",f,t,c),h.target=E,h.relatedTarget=S,T=null,Yn(c)===u&&(p=new p(y,m+"enter",g,t,c),p.target=S,p.relatedTarget=E,T=p),E=T,f&&g)t:{for(p=f,y=g,m=0,S=p;S;S=cs(S))m++;for(S=0,T=y;T;T=cs(T))S++;for(;0<m-S;)p=cs(p),m--;for(;0<S-m;)y=cs(y),S--;for(;m--;){if(p===y||y!==null&&p===y.alternate)break t;p=cs(p),y=cs(y)}p=null}else p=null;f!==null&&cd(d,h,f,p,!1),g!==null&&E!==null&&cd(d,E,g,p,!0)}}e:{if(h=u?Ts(u):window,f=h.nodeName&&h.nodeName.toLowerCase(),f==="select"||f==="input"&&h.type==="file")var A=by;else if(nd(h))if(ag)A=Fy;else{A=Oy;var _=Ny}else(f=h.nodeName)&&f.toLowerCase()==="input"&&(h.type==="checkbox"||h.type==="radio")&&(A=My);if(A&&(A=A(n,u))){rg(d,A,t,c);break e}_&&_(n,h,u),n==="focusout"&&(_=h._wrapperState)&&_.controlled&&h.type==="number"&&al(h,"number",h.value)}switch(_=u?Ts(u):window,n){case"focusin":(nd(_)||_.contentEditable==="true")&&(xs=_,vl=u,vi=null);break;case"focusout":vi=vl=xs=null;break;case"mousedown":El=!0;break;case"contextmenu":case"mouseup":case"dragend":El=!1,od(d,t,c);break;case"selectionchange":if($y)break;case"keydown":case"keyup":od(d,t,c)}var L;if(ku)e:{switch(n){case"compositionstart":var R="onCompositionStart";break e;case"compositionend":R="onCompositionEnd";break e;case"compositionupdate":R="onCompositionUpdate";break e}R=void 0}else Es?sg(n,t)&&(R="onCompositionEnd"):n==="keydown"&&t.keyCode===229&&(R="onCompositionStart");R&&(ng&&t.locale!=="ko"&&(Es||R!=="onCompositionStart"?R==="onCompositionEnd"&&Es&&(L=tg()):(Tn=c,Ru="value"in Tn?Tn.value:Tn.textContent,Es=!0)),_=oa(u,R),0<_.length&&(R=new Zc(R,n,null,t,c),d.push({event:R,listeners:_}),L?R.data=L:(L=ig(t),L!==null&&(R.data=L)))),(L=Cy?ky(n,t):wy(n,t))&&(u=oa(u,"onBeforeInput"),0<u.length&&(c=new Zc("onBeforeInput","beforeinput",null,t,c),d.push({event:c,listeners:u}),c.data=L))}mg(d,e)})}function Oi(n,e,t){return{instance:n,listener:e,currentTarget:t}}function oa(n,e){for(var t=e+"Capture",s=[];n!==null;){var i=n,r=i.stateNode;i.tag===5&&r!==null&&(i=r,r=Ci(n,t),r!=null&&s.unshift(Oi(n,r,i)),r=Ci(n,e),r!=null&&s.push(Oi(n,r,i))),n=n.return}return s}function cs(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function cd(n,e,t,s,i){for(var r=e._reactName,a=[];t!==null&&t!==s;){var o=t,l=o.alternate,u=o.stateNode;if(l!==null&&l===s)break;o.tag===5&&u!==null&&(o=u,i?(l=Ci(t,r),l!=null&&a.unshift(Oi(t,l,o))):i||(l=Ci(t,r),l!=null&&a.push(Oi(t,l,o)))),t=t.return}a.length!==0&&n.push({event:e,listeners:a})}var Vy=/\r\n?/g,Hy=/\u0000|\uFFFD/g;function dd(n){return(typeof n=="string"?n:""+n).replace(Vy,`
`).replace(Hy,"")}function hr(n,e,t){if(e=dd(e),dd(n)!==e&&t)throw Error(F(425))}function la(){}var xl=null,Sl=null;function Tl(n,e){return n==="textarea"||n==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Al=typeof setTimeout=="function"?setTimeout:void 0,zy=typeof clearTimeout=="function"?clearTimeout:void 0,hd=typeof Promise=="function"?Promise:void 0,Wy=typeof queueMicrotask=="function"?queueMicrotask:typeof hd<"u"?function(n){return hd.resolve(null).then(n).catch(Yy)}:Al;function Yy(n){setTimeout(function(){throw n})}function Eo(n,e){var t=e,s=0;do{var i=t.nextSibling;if(n.removeChild(t),i&&i.nodeType===8)if(t=i.data,t==="/$"){if(s===0){n.removeChild(i),Di(e);return}s--}else t!=="$"&&t!=="$?"&&t!=="$!"||s++;t=i}while(t);Di(e)}function _n(n){for(;n!=null;n=n.nextSibling){var e=n.nodeType;if(e===1||e===3)break;if(e===8){if(e=n.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return n}function fd(n){n=n.previousSibling;for(var e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return n;e--}else t==="/$"&&e++}n=n.previousSibling}return null}var Xs=Math.random().toString(36).slice(2),Vt="__reactFiber$"+Xs,Mi="__reactProps$"+Xs,un="__reactContainer$"+Xs,Ll="__reactEvents$"+Xs,qy="__reactListeners$"+Xs,Qy="__reactHandles$"+Xs;function Yn(n){var e=n[Vt];if(e)return e;for(var t=n.parentNode;t;){if(e=t[un]||t[Vt]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(n=fd(n);n!==null;){if(t=n[Vt])return t;n=fd(n)}return e}n=t,t=n.parentNode}return null}function Ji(n){return n=n[Vt]||n[un],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function Ts(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(F(33))}function $a(n){return n[Mi]||null}var Il=[],As=-1;function Bn(n){return{current:n}}function ge(n){0>As||(n.current=Il[As],Il[As]=null,As--)}function he(n,e){As++,Il[As]=n.current,n.current=e}var Nn={},ze=Bn(Nn),nt=Bn(!1),es=Nn;function js(n,e){var t=n.type.contextTypes;if(!t)return Nn;var s=n.stateNode;if(s&&s.__reactInternalMemoizedUnmaskedChildContext===e)return s.__reactInternalMemoizedMaskedChildContext;var i={},r;for(r in t)i[r]=e[r];return s&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=e,n.__reactInternalMemoizedMaskedChildContext=i),i}function st(n){return n=n.childContextTypes,n!=null}function ua(){ge(nt),ge(ze)}function gd(n,e,t){if(ze.current!==Nn)throw Error(F(168));he(ze,e),he(nt,t)}function vg(n,e,t){var s=n.stateNode;if(e=e.childContextTypes,typeof s.getChildContext!="function")return t;s=s.getChildContext();for(var i in s)if(!(i in e))throw Error(F(108,N0(n)||"Unknown",i));return xe({},t,s)}function ca(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||Nn,es=ze.current,he(ze,n),he(nt,nt.current),!0}function pd(n,e,t){var s=n.stateNode;if(!s)throw Error(F(169));t?(n=vg(n,e,es),s.__reactInternalMemoizedMergedChildContext=n,ge(nt),ge(ze),he(ze,n)):ge(nt),he(nt,t)}var sn=null,ja=!1,xo=!1;function Eg(n){sn===null?sn=[n]:sn.push(n)}function Xy(n){ja=!0,Eg(n)}function Un(){if(!xo&&sn!==null){xo=!0;var n=0,e=le;try{var t=sn;for(le=1;n<t.length;n++){var s=t[n];do s=s(!0);while(s!==null)}sn=null,ja=!1}catch(i){throw sn!==null&&(sn=sn.slice(n+1)),Vf(Tu,Un),i}finally{le=e,xo=!1}}return null}var Ls=[],Is=0,da=null,ha=0,vt=[],Et=0,ts=null,rn=1,an="";function Hn(n,e){Ls[Is++]=ha,Ls[Is++]=da,da=n,ha=e}function xg(n,e,t){vt[Et++]=rn,vt[Et++]=an,vt[Et++]=ts,ts=n;var s=rn;n=an;var i=32-bt(s)-1;s&=~(1<<i),t+=1;var r=32-bt(e)+i;if(30<r){var a=i-i%5;r=(s&(1<<a)-1).toString(32),s>>=a,i-=a,rn=1<<32-bt(e)+i|t<<i|s,an=r+n}else rn=1<<r|t<<i|s,an=n}function Du(n){n.return!==null&&(Hn(n,1),xg(n,1,0))}function Pu(n){for(;n===da;)da=Ls[--Is],Ls[Is]=null,ha=Ls[--Is],Ls[Is]=null;for(;n===ts;)ts=vt[--Et],vt[Et]=null,an=vt[--Et],vt[Et]=null,rn=vt[--Et],vt[Et]=null}var dt=null,ct=null,pe=!1,Pt=null;function Sg(n,e){var t=xt(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=n,e=n.deletions,e===null?(n.deletions=[t],n.flags|=16):e.push(t)}function md(n,e){switch(n.tag){case 5:var t=n.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(n.stateNode=e,dt=n,ct=_n(e.firstChild),!0):!1;case 6:return e=n.pendingProps===""||e.nodeType!==3?null:e,e!==null?(n.stateNode=e,dt=n,ct=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=ts!==null?{id:rn,overflow:an}:null,n.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=xt(18,null,null,0),t.stateNode=e,t.return=n,n.child=t,dt=n,ct=null,!0):!1;default:return!1}}function Rl(n){return(n.mode&1)!==0&&(n.flags&128)===0}function _l(n){if(pe){var e=ct;if(e){var t=e;if(!md(n,e)){if(Rl(n))throw Error(F(418));e=_n(t.nextSibling);var s=dt;e&&md(n,e)?Sg(s,t):(n.flags=n.flags&-4097|2,pe=!1,dt=n)}}else{if(Rl(n))throw Error(F(418));n.flags=n.flags&-4097|2,pe=!1,dt=n}}}function yd(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;dt=n}function fr(n){if(n!==dt)return!1;if(!pe)return yd(n),pe=!0,!1;var e;if((e=n.tag!==3)&&!(e=n.tag!==5)&&(e=n.type,e=e!=="head"&&e!=="body"&&!Tl(n.type,n.memoizedProps)),e&&(e=ct)){if(Rl(n))throw Tg(),Error(F(418));for(;e;)Sg(n,e),e=_n(e.nextSibling)}if(yd(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(F(317));e:{for(n=n.nextSibling,e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="/$"){if(e===0){ct=_n(n.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}n=n.nextSibling}ct=null}}else ct=dt?_n(n.stateNode.nextSibling):null;return!0}function Tg(){for(var n=ct;n;)n=_n(n.nextSibling)}function Gs(){ct=dt=null,pe=!1}function bu(n){Pt===null?Pt=[n]:Pt.push(n)}var Zy=hn.ReactCurrentBatchConfig;function ri(n,e,t){if(n=t.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(F(309));var s=t.stateNode}if(!s)throw Error(F(147,n));var i=s,r=""+n;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===r?e.ref:(e=function(a){var o=i.refs;a===null?delete o[r]:o[r]=a},e._stringRef=r,e)}if(typeof n!="string")throw Error(F(284));if(!t._owner)throw Error(F(290,n))}return n}function gr(n,e){throw n=Object.prototype.toString.call(e),Error(F(31,n==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":n))}function vd(n){var e=n._init;return e(n._payload)}function Ag(n){function e(y,m){if(n){var S=y.deletions;S===null?(y.deletions=[m],y.flags|=16):S.push(m)}}function t(y,m){if(!n)return null;for(;m!==null;)e(y,m),m=m.sibling;return null}function s(y,m){for(y=new Map;m!==null;)m.key!==null?y.set(m.key,m):y.set(m.index,m),m=m.sibling;return y}function i(y,m){return y=Dn(y,m),y.index=0,y.sibling=null,y}function r(y,m,S){return y.index=S,n?(S=y.alternate,S!==null?(S=S.index,S<m?(y.flags|=2,m):S):(y.flags|=2,m)):(y.flags|=1048576,m)}function a(y){return n&&y.alternate===null&&(y.flags|=2),y}function o(y,m,S,T){return m===null||m.tag!==6?(m=_o(S,y.mode,T),m.return=y,m):(m=i(m,S),m.return=y,m)}function l(y,m,S,T){var A=S.type;return A===vs?c(y,m,S.props.children,T,S.key):m!==null&&(m.elementType===A||typeof A=="object"&&A!==null&&A.$$typeof===mn&&vd(A)===m.type)?(T=i(m,S.props),T.ref=ri(y,m,S),T.return=y,T):(T=Hr(S.type,S.key,S.props,null,y.mode,T),T.ref=ri(y,m,S),T.return=y,T)}function u(y,m,S,T){return m===null||m.tag!==4||m.stateNode.containerInfo!==S.containerInfo||m.stateNode.implementation!==S.implementation?(m=Co(S,y.mode,T),m.return=y,m):(m=i(m,S.children||[]),m.return=y,m)}function c(y,m,S,T,A){return m===null||m.tag!==7?(m=Zn(S,y.mode,T,A),m.return=y,m):(m=i(m,S),m.return=y,m)}function d(y,m,S){if(typeof m=="string"&&m!==""||typeof m=="number")return m=_o(""+m,y.mode,S),m.return=y,m;if(typeof m=="object"&&m!==null){switch(m.$$typeof){case sr:return S=Hr(m.type,m.key,m.props,null,y.mode,S),S.ref=ri(y,null,m),S.return=y,S;case ys:return m=Co(m,y.mode,S),m.return=y,m;case mn:var T=m._init;return d(y,T(m._payload),S)}if(ci(m)||ei(m))return m=Zn(m,y.mode,S,null),m.return=y,m;gr(y,m)}return null}function h(y,m,S,T){var A=m!==null?m.key:null;if(typeof S=="string"&&S!==""||typeof S=="number")return A!==null?null:o(y,m,""+S,T);if(typeof S=="object"&&S!==null){switch(S.$$typeof){case sr:return S.key===A?l(y,m,S,T):null;case ys:return S.key===A?u(y,m,S,T):null;case mn:return A=S._init,h(y,m,A(S._payload),T)}if(ci(S)||ei(S))return A!==null?null:c(y,m,S,T,null);gr(y,S)}return null}function f(y,m,S,T,A){if(typeof T=="string"&&T!==""||typeof T=="number")return y=y.get(S)||null,o(m,y,""+T,A);if(typeof T=="object"&&T!==null){switch(T.$$typeof){case sr:return y=y.get(T.key===null?S:T.key)||null,l(m,y,T,A);case ys:return y=y.get(T.key===null?S:T.key)||null,u(m,y,T,A);case mn:var _=T._init;return f(y,m,S,_(T._payload),A)}if(ci(T)||ei(T))return y=y.get(S)||null,c(m,y,T,A,null);gr(m,T)}return null}function g(y,m,S,T){for(var A=null,_=null,L=m,R=m=0,C=null;L!==null&&R<S.length;R++){L.index>R?(C=L,L=null):C=L.sibling;var I=h(y,L,S[R],T);if(I===null){L===null&&(L=C);break}n&&L&&I.alternate===null&&e(y,L),m=r(I,m,R),_===null?A=I:_.sibling=I,_=I,L=C}if(R===S.length)return t(y,L),pe&&Hn(y,R),A;if(L===null){for(;R<S.length;R++)L=d(y,S[R],T),L!==null&&(m=r(L,m,R),_===null?A=L:_.sibling=L,_=L);return pe&&Hn(y,R),A}for(L=s(y,L);R<S.length;R++)C=f(L,y,R,S[R],T),C!==null&&(n&&C.alternate!==null&&L.delete(C.key===null?R:C.key),m=r(C,m,R),_===null?A=C:_.sibling=C,_=C);return n&&L.forEach(function(P){return e(y,P)}),pe&&Hn(y,R),A}function p(y,m,S,T){var A=ei(S);if(typeof A!="function")throw Error(F(150));if(S=A.call(S),S==null)throw Error(F(151));for(var _=A=null,L=m,R=m=0,C=null,I=S.next();L!==null&&!I.done;R++,I=S.next()){L.index>R?(C=L,L=null):C=L.sibling;var P=h(y,L,I.value,T);if(P===null){L===null&&(L=C);break}n&&L&&P.alternate===null&&e(y,L),m=r(P,m,R),_===null?A=P:_.sibling=P,_=P,L=C}if(I.done)return t(y,L),pe&&Hn(y,R),A;if(L===null){for(;!I.done;R++,I=S.next())I=d(y,I.value,T),I!==null&&(m=r(I,m,R),_===null?A=I:_.sibling=I,_=I);return pe&&Hn(y,R),A}for(L=s(y,L);!I.done;R++,I=S.next())I=f(L,y,R,I.value,T),I!==null&&(n&&I.alternate!==null&&L.delete(I.key===null?R:I.key),m=r(I,m,R),_===null?A=I:_.sibling=I,_=I);return n&&L.forEach(function($){return e(y,$)}),pe&&Hn(y,R),A}function E(y,m,S,T){if(typeof S=="object"&&S!==null&&S.type===vs&&S.key===null&&(S=S.props.children),typeof S=="object"&&S!==null){switch(S.$$typeof){case sr:e:{for(var A=S.key,_=m;_!==null;){if(_.key===A){if(A=S.type,A===vs){if(_.tag===7){t(y,_.sibling),m=i(_,S.props.children),m.return=y,y=m;break e}}else if(_.elementType===A||typeof A=="object"&&A!==null&&A.$$typeof===mn&&vd(A)===_.type){t(y,_.sibling),m=i(_,S.props),m.ref=ri(y,_,S),m.return=y,y=m;break e}t(y,_);break}else e(y,_);_=_.sibling}S.type===vs?(m=Zn(S.props.children,y.mode,T,S.key),m.return=y,y=m):(T=Hr(S.type,S.key,S.props,null,y.mode,T),T.ref=ri(y,m,S),T.return=y,y=T)}return a(y);case ys:e:{for(_=S.key;m!==null;){if(m.key===_)if(m.tag===4&&m.stateNode.containerInfo===S.containerInfo&&m.stateNode.implementation===S.implementation){t(y,m.sibling),m=i(m,S.children||[]),m.return=y,y=m;break e}else{t(y,m);break}else e(y,m);m=m.sibling}m=Co(S,y.mode,T),m.return=y,y=m}return a(y);case mn:return _=S._init,E(y,m,_(S._payload),T)}if(ci(S))return g(y,m,S,T);if(ei(S))return p(y,m,S,T);gr(y,S)}return typeof S=="string"&&S!==""||typeof S=="number"?(S=""+S,m!==null&&m.tag===6?(t(y,m.sibling),m=i(m,S),m.return=y,y=m):(t(y,m),m=_o(S,y.mode,T),m.return=y,y=m),a(y)):t(y,m)}return E}var Ks=Ag(!0),Lg=Ag(!1),fa=Bn(null),ga=null,Rs=null,Nu=null;function Ou(){Nu=Rs=ga=null}function Mu(n){var e=fa.current;ge(fa),n._currentValue=e}function Cl(n,e,t){for(;n!==null;){var s=n.alternate;if((n.childLanes&e)!==e?(n.childLanes|=e,s!==null&&(s.childLanes|=e)):s!==null&&(s.childLanes&e)!==e&&(s.childLanes|=e),n===t)break;n=n.return}}function Ns(n,e){ga=n,Nu=Rs=null,n=n.dependencies,n!==null&&n.firstContext!==null&&(n.lanes&e&&(et=!0),n.firstContext=null)}function Tt(n){var e=n._currentValue;if(Nu!==n)if(n={context:n,memoizedValue:e,next:null},Rs===null){if(ga===null)throw Error(F(308));Rs=n,ga.dependencies={lanes:0,firstContext:n}}else Rs=Rs.next=n;return e}var qn=null;function Fu(n){qn===null?qn=[n]:qn.push(n)}function Ig(n,e,t,s){var i=e.interleaved;return i===null?(t.next=t,Fu(e)):(t.next=i.next,i.next=t),e.interleaved=t,cn(n,s)}function cn(n,e){n.lanes|=e;var t=n.alternate;for(t!==null&&(t.lanes|=e),t=n,n=n.return;n!==null;)n.childLanes|=e,t=n.alternate,t!==null&&(t.childLanes|=e),t=n,n=n.return;return t.tag===3?t.stateNode:null}var yn=!1;function Bu(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Rg(n,e){n=n.updateQueue,e.updateQueue===n&&(e.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function on(n,e){return{eventTime:n,lane:e,tag:0,payload:null,callback:null,next:null}}function Cn(n,e,t){var s=n.updateQueue;if(s===null)return null;if(s=s.shared,ie&2){var i=s.pending;return i===null?e.next=e:(e.next=i.next,i.next=e),s.pending=e,cn(n,t)}return i=s.interleaved,i===null?(e.next=e,Fu(s)):(e.next=i.next,i.next=e),s.interleaved=e,cn(n,t)}function Ur(n,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var s=e.lanes;s&=n.pendingLanes,t|=s,e.lanes=t,Au(n,t)}}function Ed(n,e){var t=n.updateQueue,s=n.alternate;if(s!==null&&(s=s.updateQueue,t===s)){var i=null,r=null;if(t=t.firstBaseUpdate,t!==null){do{var a={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};r===null?i=r=a:r=r.next=a,t=t.next}while(t!==null);r===null?i=r=e:r=r.next=e}else i=r=e;t={baseState:s.baseState,firstBaseUpdate:i,lastBaseUpdate:r,shared:s.shared,effects:s.effects},n.updateQueue=t;return}n=t.lastBaseUpdate,n===null?t.firstBaseUpdate=e:n.next=e,t.lastBaseUpdate=e}function pa(n,e,t,s){var i=n.updateQueue;yn=!1;var r=i.firstBaseUpdate,a=i.lastBaseUpdate,o=i.shared.pending;if(o!==null){i.shared.pending=null;var l=o,u=l.next;l.next=null,a===null?r=u:a.next=u,a=l;var c=n.alternate;c!==null&&(c=c.updateQueue,o=c.lastBaseUpdate,o!==a&&(o===null?c.firstBaseUpdate=u:o.next=u,c.lastBaseUpdate=l))}if(r!==null){var d=i.baseState;a=0,c=u=l=null,o=r;do{var h=o.lane,f=o.eventTime;if((s&h)===h){c!==null&&(c=c.next={eventTime:f,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var g=n,p=o;switch(h=e,f=t,p.tag){case 1:if(g=p.payload,typeof g=="function"){d=g.call(f,d,h);break e}d=g;break e;case 3:g.flags=g.flags&-65537|128;case 0:if(g=p.payload,h=typeof g=="function"?g.call(f,d,h):g,h==null)break e;d=xe({},d,h);break e;case 2:yn=!0}}o.callback!==null&&o.lane!==0&&(n.flags|=64,h=i.effects,h===null?i.effects=[o]:h.push(o))}else f={eventTime:f,lane:h,tag:o.tag,payload:o.payload,callback:o.callback,next:null},c===null?(u=c=f,l=d):c=c.next=f,a|=h;if(o=o.next,o===null){if(o=i.shared.pending,o===null)break;h=o,o=h.next,h.next=null,i.lastBaseUpdate=h,i.shared.pending=null}}while(!0);if(c===null&&(l=d),i.baseState=l,i.firstBaseUpdate=u,i.lastBaseUpdate=c,e=i.shared.interleaved,e!==null){i=e;do a|=i.lane,i=i.next;while(i!==e)}else r===null&&(i.shared.lanes=0);ss|=a,n.lanes=a,n.memoizedState=d}}function xd(n,e,t){if(n=e.effects,e.effects=null,n!==null)for(e=0;e<n.length;e++){var s=n[e],i=s.callback;if(i!==null){if(s.callback=null,s=t,typeof i!="function")throw Error(F(191,i));i.call(s)}}}var er={},qt=Bn(er),Fi=Bn(er),Bi=Bn(er);function Qn(n){if(n===er)throw Error(F(174));return n}function Uu(n,e){switch(he(Bi,e),he(Fi,n),he(qt,er),n=e.nodeType,n){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:ll(null,"");break;default:n=n===8?e.parentNode:e,e=n.namespaceURI||null,n=n.tagName,e=ll(e,n)}ge(qt),he(qt,e)}function Vs(){ge(qt),ge(Fi),ge(Bi)}function _g(n){Qn(Bi.current);var e=Qn(qt.current),t=ll(e,n.type);e!==t&&(he(Fi,n),he(qt,t))}function $u(n){Fi.current===n&&(ge(qt),ge(Fi))}var ye=Bn(0);function ma(n){for(var e=n;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var So=[];function ju(){for(var n=0;n<So.length;n++)So[n]._workInProgressVersionPrimary=null;So.length=0}var $r=hn.ReactCurrentDispatcher,To=hn.ReactCurrentBatchConfig,ns=0,Ee=null,ke=null,be=null,ya=!1,Ei=!1,Ui=0,Jy=0;function Ke(){throw Error(F(321))}function Gu(n,e){if(e===null)return!1;for(var t=0;t<e.length&&t<n.length;t++)if(!Ot(n[t],e[t]))return!1;return!0}function Ku(n,e,t,s,i,r){if(ns=r,Ee=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,$r.current=n===null||n.memoizedState===null?sv:iv,n=t(s,i),Ei){r=0;do{if(Ei=!1,Ui=0,25<=r)throw Error(F(301));r+=1,be=ke=null,e.updateQueue=null,$r.current=rv,n=t(s,i)}while(Ei)}if($r.current=va,e=ke!==null&&ke.next!==null,ns=0,be=ke=Ee=null,ya=!1,e)throw Error(F(300));return n}function Vu(){var n=Ui!==0;return Ui=0,n}function jt(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return be===null?Ee.memoizedState=be=n:be=be.next=n,be}function At(){if(ke===null){var n=Ee.alternate;n=n!==null?n.memoizedState:null}else n=ke.next;var e=be===null?Ee.memoizedState:be.next;if(e!==null)be=e,ke=n;else{if(n===null)throw Error(F(310));ke=n,n={memoizedState:ke.memoizedState,baseState:ke.baseState,baseQueue:ke.baseQueue,queue:ke.queue,next:null},be===null?Ee.memoizedState=be=n:be=be.next=n}return be}function $i(n,e){return typeof e=="function"?e(n):e}function Ao(n){var e=At(),t=e.queue;if(t===null)throw Error(F(311));t.lastRenderedReducer=n;var s=ke,i=s.baseQueue,r=t.pending;if(r!==null){if(i!==null){var a=i.next;i.next=r.next,r.next=a}s.baseQueue=i=r,t.pending=null}if(i!==null){r=i.next,s=s.baseState;var o=a=null,l=null,u=r;do{var c=u.lane;if((ns&c)===c)l!==null&&(l=l.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),s=u.hasEagerState?u.eagerState:n(s,u.action);else{var d={lane:c,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};l===null?(o=l=d,a=s):l=l.next=d,Ee.lanes|=c,ss|=c}u=u.next}while(u!==null&&u!==r);l===null?a=s:l.next=o,Ot(s,e.memoizedState)||(et=!0),e.memoizedState=s,e.baseState=a,e.baseQueue=l,t.lastRenderedState=s}if(n=t.interleaved,n!==null){i=n;do r=i.lane,Ee.lanes|=r,ss|=r,i=i.next;while(i!==n)}else i===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function Lo(n){var e=At(),t=e.queue;if(t===null)throw Error(F(311));t.lastRenderedReducer=n;var s=t.dispatch,i=t.pending,r=e.memoizedState;if(i!==null){t.pending=null;var a=i=i.next;do r=n(r,a.action),a=a.next;while(a!==i);Ot(r,e.memoizedState)||(et=!0),e.memoizedState=r,e.baseQueue===null&&(e.baseState=r),t.lastRenderedState=r}return[r,s]}function Cg(){}function kg(n,e){var t=Ee,s=At(),i=e(),r=!Ot(s.memoizedState,i);if(r&&(s.memoizedState=i,et=!0),s=s.queue,Hu(Pg.bind(null,t,s,n),[n]),s.getSnapshot!==e||r||be!==null&&be.memoizedState.tag&1){if(t.flags|=2048,ji(9,Dg.bind(null,t,s,i,e),void 0,null),Ne===null)throw Error(F(349));ns&30||wg(t,e,i)}return i}function wg(n,e,t){n.flags|=16384,n={getSnapshot:e,value:t},e=Ee.updateQueue,e===null?(e={lastEffect:null,stores:null},Ee.updateQueue=e,e.stores=[n]):(t=e.stores,t===null?e.stores=[n]:t.push(n))}function Dg(n,e,t,s){e.value=t,e.getSnapshot=s,bg(e)&&Ng(n)}function Pg(n,e,t){return t(function(){bg(e)&&Ng(n)})}function bg(n){var e=n.getSnapshot;n=n.value;try{var t=e();return!Ot(n,t)}catch{return!0}}function Ng(n){var e=cn(n,1);e!==null&&Nt(e,n,1,-1)}function Sd(n){var e=jt();return typeof n=="function"&&(n=n()),e.memoizedState=e.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:$i,lastRenderedState:n},e.queue=n,n=n.dispatch=nv.bind(null,Ee,n),[e.memoizedState,n]}function ji(n,e,t,s){return n={tag:n,create:e,destroy:t,deps:s,next:null},e=Ee.updateQueue,e===null?(e={lastEffect:null,stores:null},Ee.updateQueue=e,e.lastEffect=n.next=n):(t=e.lastEffect,t===null?e.lastEffect=n.next=n:(s=t.next,t.next=n,n.next=s,e.lastEffect=n)),n}function Og(){return At().memoizedState}function jr(n,e,t,s){var i=jt();Ee.flags|=n,i.memoizedState=ji(1|e,t,void 0,s===void 0?null:s)}function Ga(n,e,t,s){var i=At();s=s===void 0?null:s;var r=void 0;if(ke!==null){var a=ke.memoizedState;if(r=a.destroy,s!==null&&Gu(s,a.deps)){i.memoizedState=ji(e,t,r,s);return}}Ee.flags|=n,i.memoizedState=ji(1|e,t,r,s)}function Td(n,e){return jr(8390656,8,n,e)}function Hu(n,e){return Ga(2048,8,n,e)}function Mg(n,e){return Ga(4,2,n,e)}function Fg(n,e){return Ga(4,4,n,e)}function Bg(n,e){if(typeof e=="function")return n=n(),e(n),function(){e(null)};if(e!=null)return n=n(),e.current=n,function(){e.current=null}}function Ug(n,e,t){return t=t!=null?t.concat([n]):null,Ga(4,4,Bg.bind(null,e,n),t)}function zu(){}function $g(n,e){var t=At();e=e===void 0?null:e;var s=t.memoizedState;return s!==null&&e!==null&&Gu(e,s[1])?s[0]:(t.memoizedState=[n,e],n)}function jg(n,e){var t=At();e=e===void 0?null:e;var s=t.memoizedState;return s!==null&&e!==null&&Gu(e,s[1])?s[0]:(n=n(),t.memoizedState=[n,e],n)}function Gg(n,e,t){return ns&21?(Ot(t,e)||(t=Wf(),Ee.lanes|=t,ss|=t,n.baseState=!0),e):(n.baseState&&(n.baseState=!1,et=!0),n.memoizedState=t)}function ev(n,e){var t=le;le=t!==0&&4>t?t:4,n(!0);var s=To.transition;To.transition={};try{n(!1),e()}finally{le=t,To.transition=s}}function Kg(){return At().memoizedState}function tv(n,e,t){var s=wn(n);if(t={lane:s,action:t,hasEagerState:!1,eagerState:null,next:null},Vg(n))Hg(e,t);else if(t=Ig(n,e,t,s),t!==null){var i=qe();Nt(t,n,s,i),zg(t,e,s)}}function nv(n,e,t){var s=wn(n),i={lane:s,action:t,hasEagerState:!1,eagerState:null,next:null};if(Vg(n))Hg(e,i);else{var r=n.alternate;if(n.lanes===0&&(r===null||r.lanes===0)&&(r=e.lastRenderedReducer,r!==null))try{var a=e.lastRenderedState,o=r(a,t);if(i.hasEagerState=!0,i.eagerState=o,Ot(o,a)){var l=e.interleaved;l===null?(i.next=i,Fu(e)):(i.next=l.next,l.next=i),e.interleaved=i;return}}catch{}finally{}t=Ig(n,e,i,s),t!==null&&(i=qe(),Nt(t,n,s,i),zg(t,e,s))}}function Vg(n){var e=n.alternate;return n===Ee||e!==null&&e===Ee}function Hg(n,e){Ei=ya=!0;var t=n.pending;t===null?e.next=e:(e.next=t.next,t.next=e),n.pending=e}function zg(n,e,t){if(t&4194240){var s=e.lanes;s&=n.pendingLanes,t|=s,e.lanes=t,Au(n,t)}}var va={readContext:Tt,useCallback:Ke,useContext:Ke,useEffect:Ke,useImperativeHandle:Ke,useInsertionEffect:Ke,useLayoutEffect:Ke,useMemo:Ke,useReducer:Ke,useRef:Ke,useState:Ke,useDebugValue:Ke,useDeferredValue:Ke,useTransition:Ke,useMutableSource:Ke,useSyncExternalStore:Ke,useId:Ke,unstable_isNewReconciler:!1},sv={readContext:Tt,useCallback:function(n,e){return jt().memoizedState=[n,e===void 0?null:e],n},useContext:Tt,useEffect:Td,useImperativeHandle:function(n,e,t){return t=t!=null?t.concat([n]):null,jr(4194308,4,Bg.bind(null,e,n),t)},useLayoutEffect:function(n,e){return jr(4194308,4,n,e)},useInsertionEffect:function(n,e){return jr(4,2,n,e)},useMemo:function(n,e){var t=jt();return e=e===void 0?null:e,n=n(),t.memoizedState=[n,e],n},useReducer:function(n,e,t){var s=jt();return e=t!==void 0?t(e):e,s.memoizedState=s.baseState=e,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:e},s.queue=n,n=n.dispatch=tv.bind(null,Ee,n),[s.memoizedState,n]},useRef:function(n){var e=jt();return n={current:n},e.memoizedState=n},useState:Sd,useDebugValue:zu,useDeferredValue:function(n){return jt().memoizedState=n},useTransition:function(){var n=Sd(!1),e=n[0];return n=ev.bind(null,n[1]),jt().memoizedState=n,[e,n]},useMutableSource:function(){},useSyncExternalStore:function(n,e,t){var s=Ee,i=jt();if(pe){if(t===void 0)throw Error(F(407));t=t()}else{if(t=e(),Ne===null)throw Error(F(349));ns&30||wg(s,e,t)}i.memoizedState=t;var r={value:t,getSnapshot:e};return i.queue=r,Td(Pg.bind(null,s,r,n),[n]),s.flags|=2048,ji(9,Dg.bind(null,s,r,t,e),void 0,null),t},useId:function(){var n=jt(),e=Ne.identifierPrefix;if(pe){var t=an,s=rn;t=(s&~(1<<32-bt(s)-1)).toString(32)+t,e=":"+e+"R"+t,t=Ui++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=Jy++,e=":"+e+"r"+t.toString(32)+":";return n.memoizedState=e},unstable_isNewReconciler:!1},iv={readContext:Tt,useCallback:$g,useContext:Tt,useEffect:Hu,useImperativeHandle:Ug,useInsertionEffect:Mg,useLayoutEffect:Fg,useMemo:jg,useReducer:Ao,useRef:Og,useState:function(){return Ao($i)},useDebugValue:zu,useDeferredValue:function(n){var e=At();return Gg(e,ke.memoizedState,n)},useTransition:function(){var n=Ao($i)[0],e=At().memoizedState;return[n,e]},useMutableSource:Cg,useSyncExternalStore:kg,useId:Kg,unstable_isNewReconciler:!1},rv={readContext:Tt,useCallback:$g,useContext:Tt,useEffect:Hu,useImperativeHandle:Ug,useInsertionEffect:Mg,useLayoutEffect:Fg,useMemo:jg,useReducer:Lo,useRef:Og,useState:function(){return Lo($i)},useDebugValue:zu,useDeferredValue:function(n){var e=At();return ke===null?e.memoizedState=n:Gg(e,ke.memoizedState,n)},useTransition:function(){var n=Lo($i)[0],e=At().memoizedState;return[n,e]},useMutableSource:Cg,useSyncExternalStore:kg,useId:Kg,unstable_isNewReconciler:!1};function wt(n,e){if(n&&n.defaultProps){e=xe({},e),n=n.defaultProps;for(var t in n)e[t]===void 0&&(e[t]=n[t]);return e}return e}function kl(n,e,t,s){e=n.memoizedState,t=t(s,e),t=t==null?e:xe({},e,t),n.memoizedState=t,n.lanes===0&&(n.updateQueue.baseState=t)}var Ka={isMounted:function(n){return(n=n._reactInternals)?ls(n)===n:!1},enqueueSetState:function(n,e,t){n=n._reactInternals;var s=qe(),i=wn(n),r=on(s,i);r.payload=e,t!=null&&(r.callback=t),e=Cn(n,r,i),e!==null&&(Nt(e,n,i,s),Ur(e,n,i))},enqueueReplaceState:function(n,e,t){n=n._reactInternals;var s=qe(),i=wn(n),r=on(s,i);r.tag=1,r.payload=e,t!=null&&(r.callback=t),e=Cn(n,r,i),e!==null&&(Nt(e,n,i,s),Ur(e,n,i))},enqueueForceUpdate:function(n,e){n=n._reactInternals;var t=qe(),s=wn(n),i=on(t,s);i.tag=2,e!=null&&(i.callback=e),e=Cn(n,i,s),e!==null&&(Nt(e,n,s,t),Ur(e,n,s))}};function Ad(n,e,t,s,i,r,a){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(s,r,a):e.prototype&&e.prototype.isPureReactComponent?!bi(t,s)||!bi(i,r):!0}function Wg(n,e,t){var s=!1,i=Nn,r=e.contextType;return typeof r=="object"&&r!==null?r=Tt(r):(i=st(e)?es:ze.current,s=e.contextTypes,r=(s=s!=null)?js(n,i):Nn),e=new e(t,r),n.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Ka,n.stateNode=e,e._reactInternals=n,s&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=i,n.__reactInternalMemoizedMaskedChildContext=r),e}function Ld(n,e,t,s){n=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,s),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,s),e.state!==n&&Ka.enqueueReplaceState(e,e.state,null)}function wl(n,e,t,s){var i=n.stateNode;i.props=t,i.state=n.memoizedState,i.refs={},Bu(n);var r=e.contextType;typeof r=="object"&&r!==null?i.context=Tt(r):(r=st(e)?es:ze.current,i.context=js(n,r)),i.state=n.memoizedState,r=e.getDerivedStateFromProps,typeof r=="function"&&(kl(n,e,r,t),i.state=n.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(e=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),e!==i.state&&Ka.enqueueReplaceState(i,i.state,null),pa(n,t,i,s),i.state=n.memoizedState),typeof i.componentDidMount=="function"&&(n.flags|=4194308)}function Hs(n,e){try{var t="",s=e;do t+=b0(s),s=s.return;while(s);var i=t}catch(r){i=`
Error generating stack: `+r.message+`
`+r.stack}return{value:n,source:e,stack:i,digest:null}}function Io(n,e,t){return{value:n,source:null,stack:t??null,digest:e??null}}function Dl(n,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var av=typeof WeakMap=="function"?WeakMap:Map;function Yg(n,e,t){t=on(-1,t),t.tag=3,t.payload={element:null};var s=e.value;return t.callback=function(){xa||(xa=!0,jl=s),Dl(n,e)},t}function qg(n,e,t){t=on(-1,t),t.tag=3;var s=n.type.getDerivedStateFromError;if(typeof s=="function"){var i=e.value;t.payload=function(){return s(i)},t.callback=function(){Dl(n,e)}}var r=n.stateNode;return r!==null&&typeof r.componentDidCatch=="function"&&(t.callback=function(){Dl(n,e),typeof s!="function"&&(kn===null?kn=new Set([this]):kn.add(this));var a=e.stack;this.componentDidCatch(e.value,{componentStack:a!==null?a:""})}),t}function Id(n,e,t){var s=n.pingCache;if(s===null){s=n.pingCache=new av;var i=new Set;s.set(e,i)}else i=s.get(e),i===void 0&&(i=new Set,s.set(e,i));i.has(t)||(i.add(t),n=xv.bind(null,n,e,t),e.then(n,n))}function Rd(n){do{var e;if((e=n.tag===13)&&(e=n.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return n;n=n.return}while(n!==null);return null}function _d(n,e,t,s,i){return n.mode&1?(n.flags|=65536,n.lanes=i,n):(n===e?n.flags|=65536:(n.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=on(-1,1),e.tag=2,Cn(t,e,1))),t.lanes|=1),n)}var ov=hn.ReactCurrentOwner,et=!1;function We(n,e,t,s){e.child=n===null?Lg(e,null,t,s):Ks(e,n.child,t,s)}function Cd(n,e,t,s,i){t=t.render;var r=e.ref;return Ns(e,i),s=Ku(n,e,t,s,r,i),t=Vu(),n!==null&&!et?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~i,dn(n,e,i)):(pe&&t&&Du(e),e.flags|=1,We(n,e,s,i),e.child)}function kd(n,e,t,s,i){if(n===null){var r=t.type;return typeof r=="function"&&!ec(r)&&r.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=r,Qg(n,e,r,s,i)):(n=Hr(t.type,null,s,e,e.mode,i),n.ref=e.ref,n.return=e,e.child=n)}if(r=n.child,!(n.lanes&i)){var a=r.memoizedProps;if(t=t.compare,t=t!==null?t:bi,t(a,s)&&n.ref===e.ref)return dn(n,e,i)}return e.flags|=1,n=Dn(r,s),n.ref=e.ref,n.return=e,e.child=n}function Qg(n,e,t,s,i){if(n!==null){var r=n.memoizedProps;if(bi(r,s)&&n.ref===e.ref)if(et=!1,e.pendingProps=s=r,(n.lanes&i)!==0)n.flags&131072&&(et=!0);else return e.lanes=n.lanes,dn(n,e,i)}return Pl(n,e,t,s,i)}function Xg(n,e,t){var s=e.pendingProps,i=s.children,r=n!==null?n.memoizedState:null;if(s.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},he(Cs,lt),lt|=t;else{if(!(t&1073741824))return n=r!==null?r.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:n,cachePool:null,transitions:null},e.updateQueue=null,he(Cs,lt),lt|=n,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},s=r!==null?r.baseLanes:t,he(Cs,lt),lt|=s}else r!==null?(s=r.baseLanes|t,e.memoizedState=null):s=t,he(Cs,lt),lt|=s;return We(n,e,i,t),e.child}function Zg(n,e){var t=e.ref;(n===null&&t!==null||n!==null&&n.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function Pl(n,e,t,s,i){var r=st(t)?es:ze.current;return r=js(e,r),Ns(e,i),t=Ku(n,e,t,s,r,i),s=Vu(),n!==null&&!et?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~i,dn(n,e,i)):(pe&&s&&Du(e),e.flags|=1,We(n,e,t,i),e.child)}function wd(n,e,t,s,i){if(st(t)){var r=!0;ca(e)}else r=!1;if(Ns(e,i),e.stateNode===null)Gr(n,e),Wg(e,t,s),wl(e,t,s,i),s=!0;else if(n===null){var a=e.stateNode,o=e.memoizedProps;a.props=o;var l=a.context,u=t.contextType;typeof u=="object"&&u!==null?u=Tt(u):(u=st(t)?es:ze.current,u=js(e,u));var c=t.getDerivedStateFromProps,d=typeof c=="function"||typeof a.getSnapshotBeforeUpdate=="function";d||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(o!==s||l!==u)&&Ld(e,a,s,u),yn=!1;var h=e.memoizedState;a.state=h,pa(e,s,a,i),l=e.memoizedState,o!==s||h!==l||nt.current||yn?(typeof c=="function"&&(kl(e,t,c,s),l=e.memoizedState),(o=yn||Ad(e,t,o,s,h,l,u))?(d||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount()),typeof a.componentDidMount=="function"&&(e.flags|=4194308)):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=s,e.memoizedState=l),a.props=s,a.state=l,a.context=u,s=o):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),s=!1)}else{a=e.stateNode,Rg(n,e),o=e.memoizedProps,u=e.type===e.elementType?o:wt(e.type,o),a.props=u,d=e.pendingProps,h=a.context,l=t.contextType,typeof l=="object"&&l!==null?l=Tt(l):(l=st(t)?es:ze.current,l=js(e,l));var f=t.getDerivedStateFromProps;(c=typeof f=="function"||typeof a.getSnapshotBeforeUpdate=="function")||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(o!==d||h!==l)&&Ld(e,a,s,l),yn=!1,h=e.memoizedState,a.state=h,pa(e,s,a,i);var g=e.memoizedState;o!==d||h!==g||nt.current||yn?(typeof f=="function"&&(kl(e,t,f,s),g=e.memoizedState),(u=yn||Ad(e,t,u,s,h,g,l)||!1)?(c||typeof a.UNSAFE_componentWillUpdate!="function"&&typeof a.componentWillUpdate!="function"||(typeof a.componentWillUpdate=="function"&&a.componentWillUpdate(s,g,l),typeof a.UNSAFE_componentWillUpdate=="function"&&a.UNSAFE_componentWillUpdate(s,g,l)),typeof a.componentDidUpdate=="function"&&(e.flags|=4),typeof a.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof a.componentDidUpdate!="function"||o===n.memoizedProps&&h===n.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||o===n.memoizedProps&&h===n.memoizedState||(e.flags|=1024),e.memoizedProps=s,e.memoizedState=g),a.props=s,a.state=g,a.context=l,s=u):(typeof a.componentDidUpdate!="function"||o===n.memoizedProps&&h===n.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||o===n.memoizedProps&&h===n.memoizedState||(e.flags|=1024),s=!1)}return bl(n,e,t,s,r,i)}function bl(n,e,t,s,i,r){Zg(n,e);var a=(e.flags&128)!==0;if(!s&&!a)return i&&pd(e,t,!1),dn(n,e,r);s=e.stateNode,ov.current=e;var o=a&&typeof t.getDerivedStateFromError!="function"?null:s.render();return e.flags|=1,n!==null&&a?(e.child=Ks(e,n.child,null,r),e.child=Ks(e,null,o,r)):We(n,e,o,r),e.memoizedState=s.state,i&&pd(e,t,!0),e.child}function Jg(n){var e=n.stateNode;e.pendingContext?gd(n,e.pendingContext,e.pendingContext!==e.context):e.context&&gd(n,e.context,!1),Uu(n,e.containerInfo)}function Dd(n,e,t,s,i){return Gs(),bu(i),e.flags|=256,We(n,e,t,s),e.child}var Nl={dehydrated:null,treeContext:null,retryLane:0};function Ol(n){return{baseLanes:n,cachePool:null,transitions:null}}function ep(n,e,t){var s=e.pendingProps,i=ye.current,r=!1,a=(e.flags&128)!==0,o;if((o=a)||(o=n!==null&&n.memoizedState===null?!1:(i&2)!==0),o?(r=!0,e.flags&=-129):(n===null||n.memoizedState!==null)&&(i|=1),he(ye,i&1),n===null)return _l(e),n=e.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?(e.mode&1?n.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(a=s.children,n=s.fallback,r?(s=e.mode,r=e.child,a={mode:"hidden",children:a},!(s&1)&&r!==null?(r.childLanes=0,r.pendingProps=a):r=za(a,s,0,null),n=Zn(n,s,t,null),r.return=e,n.return=e,r.sibling=n,e.child=r,e.child.memoizedState=Ol(t),e.memoizedState=Nl,n):Wu(e,a));if(i=n.memoizedState,i!==null&&(o=i.dehydrated,o!==null))return lv(n,e,a,s,o,i,t);if(r){r=s.fallback,a=e.mode,i=n.child,o=i.sibling;var l={mode:"hidden",children:s.children};return!(a&1)&&e.child!==i?(s=e.child,s.childLanes=0,s.pendingProps=l,e.deletions=null):(s=Dn(i,l),s.subtreeFlags=i.subtreeFlags&14680064),o!==null?r=Dn(o,r):(r=Zn(r,a,t,null),r.flags|=2),r.return=e,s.return=e,s.sibling=r,e.child=s,s=r,r=e.child,a=n.child.memoizedState,a=a===null?Ol(t):{baseLanes:a.baseLanes|t,cachePool:null,transitions:a.transitions},r.memoizedState=a,r.childLanes=n.childLanes&~t,e.memoizedState=Nl,s}return r=n.child,n=r.sibling,s=Dn(r,{mode:"visible",children:s.children}),!(e.mode&1)&&(s.lanes=t),s.return=e,s.sibling=null,n!==null&&(t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)),e.child=s,e.memoizedState=null,s}function Wu(n,e){return e=za({mode:"visible",children:e},n.mode,0,null),e.return=n,n.child=e}function pr(n,e,t,s){return s!==null&&bu(s),Ks(e,n.child,null,t),n=Wu(e,e.pendingProps.children),n.flags|=2,e.memoizedState=null,n}function lv(n,e,t,s,i,r,a){if(t)return e.flags&256?(e.flags&=-257,s=Io(Error(F(422))),pr(n,e,a,s)):e.memoizedState!==null?(e.child=n.child,e.flags|=128,null):(r=s.fallback,i=e.mode,s=za({mode:"visible",children:s.children},i,0,null),r=Zn(r,i,a,null),r.flags|=2,s.return=e,r.return=e,s.sibling=r,e.child=s,e.mode&1&&Ks(e,n.child,null,a),e.child.memoizedState=Ol(a),e.memoizedState=Nl,r);if(!(e.mode&1))return pr(n,e,a,null);if(i.data==="$!"){if(s=i.nextSibling&&i.nextSibling.dataset,s)var o=s.dgst;return s=o,r=Error(F(419)),s=Io(r,s,void 0),pr(n,e,a,s)}if(o=(a&n.childLanes)!==0,et||o){if(s=Ne,s!==null){switch(a&-a){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(s.suspendedLanes|a)?0:i,i!==0&&i!==r.retryLane&&(r.retryLane=i,cn(n,i),Nt(s,n,i,-1))}return Ju(),s=Io(Error(F(421))),pr(n,e,a,s)}return i.data==="$?"?(e.flags|=128,e.child=n.child,e=Sv.bind(null,n),i._reactRetry=e,null):(n=r.treeContext,ct=_n(i.nextSibling),dt=e,pe=!0,Pt=null,n!==null&&(vt[Et++]=rn,vt[Et++]=an,vt[Et++]=ts,rn=n.id,an=n.overflow,ts=e),e=Wu(e,s.children),e.flags|=4096,e)}function Pd(n,e,t){n.lanes|=e;var s=n.alternate;s!==null&&(s.lanes|=e),Cl(n.return,e,t)}function Ro(n,e,t,s,i){var r=n.memoizedState;r===null?n.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:s,tail:t,tailMode:i}:(r.isBackwards=e,r.rendering=null,r.renderingStartTime=0,r.last=s,r.tail=t,r.tailMode=i)}function tp(n,e,t){var s=e.pendingProps,i=s.revealOrder,r=s.tail;if(We(n,e,s.children,t),s=ye.current,s&2)s=s&1|2,e.flags|=128;else{if(n!==null&&n.flags&128)e:for(n=e.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&Pd(n,t,e);else if(n.tag===19)Pd(n,t,e);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break e;for(;n.sibling===null;){if(n.return===null||n.return===e)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}s&=1}if(he(ye,s),!(e.mode&1))e.memoizedState=null;else switch(i){case"forwards":for(t=e.child,i=null;t!==null;)n=t.alternate,n!==null&&ma(n)===null&&(i=t),t=t.sibling;t=i,t===null?(i=e.child,e.child=null):(i=t.sibling,t.sibling=null),Ro(e,!1,i,t,r);break;case"backwards":for(t=null,i=e.child,e.child=null;i!==null;){if(n=i.alternate,n!==null&&ma(n)===null){e.child=i;break}n=i.sibling,i.sibling=t,t=i,i=n}Ro(e,!0,t,null,r);break;case"together":Ro(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Gr(n,e){!(e.mode&1)&&n!==null&&(n.alternate=null,e.alternate=null,e.flags|=2)}function dn(n,e,t){if(n!==null&&(e.dependencies=n.dependencies),ss|=e.lanes,!(t&e.childLanes))return null;if(n!==null&&e.child!==n.child)throw Error(F(153));if(e.child!==null){for(n=e.child,t=Dn(n,n.pendingProps),e.child=t,t.return=e;n.sibling!==null;)n=n.sibling,t=t.sibling=Dn(n,n.pendingProps),t.return=e;t.sibling=null}return e.child}function uv(n,e,t){switch(e.tag){case 3:Jg(e),Gs();break;case 5:_g(e);break;case 1:st(e.type)&&ca(e);break;case 4:Uu(e,e.stateNode.containerInfo);break;case 10:var s=e.type._context,i=e.memoizedProps.value;he(fa,s._currentValue),s._currentValue=i;break;case 13:if(s=e.memoizedState,s!==null)return s.dehydrated!==null?(he(ye,ye.current&1),e.flags|=128,null):t&e.child.childLanes?ep(n,e,t):(he(ye,ye.current&1),n=dn(n,e,t),n!==null?n.sibling:null);he(ye,ye.current&1);break;case 19:if(s=(t&e.childLanes)!==0,n.flags&128){if(s)return tp(n,e,t);e.flags|=128}if(i=e.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),he(ye,ye.current),s)break;return null;case 22:case 23:return e.lanes=0,Xg(n,e,t)}return dn(n,e,t)}var np,Ml,sp,ip;np=function(n,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)n.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};Ml=function(){};sp=function(n,e,t,s){var i=n.memoizedProps;if(i!==s){n=e.stateNode,Qn(qt.current);var r=null;switch(t){case"input":i=il(n,i),s=il(n,s),r=[];break;case"select":i=xe({},i,{value:void 0}),s=xe({},s,{value:void 0}),r=[];break;case"textarea":i=ol(n,i),s=ol(n,s),r=[];break;default:typeof i.onClick!="function"&&typeof s.onClick=="function"&&(n.onclick=la)}ul(t,s);var a;t=null;for(u in i)if(!s.hasOwnProperty(u)&&i.hasOwnProperty(u)&&i[u]!=null)if(u==="style"){var o=i[u];for(a in o)o.hasOwnProperty(a)&&(t||(t={}),t[a]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(Ri.hasOwnProperty(u)?r||(r=[]):(r=r||[]).push(u,null));for(u in s){var l=s[u];if(o=i!=null?i[u]:void 0,s.hasOwnProperty(u)&&l!==o&&(l!=null||o!=null))if(u==="style")if(o){for(a in o)!o.hasOwnProperty(a)||l&&l.hasOwnProperty(a)||(t||(t={}),t[a]="");for(a in l)l.hasOwnProperty(a)&&o[a]!==l[a]&&(t||(t={}),t[a]=l[a])}else t||(r||(r=[]),r.push(u,t)),t=l;else u==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,o=o?o.__html:void 0,l!=null&&o!==l&&(r=r||[]).push(u,l)):u==="children"?typeof l!="string"&&typeof l!="number"||(r=r||[]).push(u,""+l):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(Ri.hasOwnProperty(u)?(l!=null&&u==="onScroll"&&fe("scroll",n),r||o===l||(r=[])):(r=r||[]).push(u,l))}t&&(r=r||[]).push("style",t);var u=r;(e.updateQueue=u)&&(e.flags|=4)}};ip=function(n,e,t,s){t!==s&&(e.flags|=4)};function ai(n,e){if(!pe)switch(n.tailMode){case"hidden":e=n.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?n.tail=null:t.sibling=null;break;case"collapsed":t=n.tail;for(var s=null;t!==null;)t.alternate!==null&&(s=t),t=t.sibling;s===null?e||n.tail===null?n.tail=null:n.tail.sibling=null:s.sibling=null}}function Ve(n){var e=n.alternate!==null&&n.alternate.child===n.child,t=0,s=0;if(e)for(var i=n.child;i!==null;)t|=i.lanes|i.childLanes,s|=i.subtreeFlags&14680064,s|=i.flags&14680064,i.return=n,i=i.sibling;else for(i=n.child;i!==null;)t|=i.lanes|i.childLanes,s|=i.subtreeFlags,s|=i.flags,i.return=n,i=i.sibling;return n.subtreeFlags|=s,n.childLanes=t,e}function cv(n,e,t){var s=e.pendingProps;switch(Pu(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ve(e),null;case 1:return st(e.type)&&ua(),Ve(e),null;case 3:return s=e.stateNode,Vs(),ge(nt),ge(ze),ju(),s.pendingContext&&(s.context=s.pendingContext,s.pendingContext=null),(n===null||n.child===null)&&(fr(e)?e.flags|=4:n===null||n.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Pt!==null&&(Vl(Pt),Pt=null))),Ml(n,e),Ve(e),null;case 5:$u(e);var i=Qn(Bi.current);if(t=e.type,n!==null&&e.stateNode!=null)sp(n,e,t,s,i),n.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!s){if(e.stateNode===null)throw Error(F(166));return Ve(e),null}if(n=Qn(qt.current),fr(e)){s=e.stateNode,t=e.type;var r=e.memoizedProps;switch(s[Vt]=e,s[Mi]=r,n=(e.mode&1)!==0,t){case"dialog":fe("cancel",s),fe("close",s);break;case"iframe":case"object":case"embed":fe("load",s);break;case"video":case"audio":for(i=0;i<hi.length;i++)fe(hi[i],s);break;case"source":fe("error",s);break;case"img":case"image":case"link":fe("error",s),fe("load",s);break;case"details":fe("toggle",s);break;case"input":jc(s,r),fe("invalid",s);break;case"select":s._wrapperState={wasMultiple:!!r.multiple},fe("invalid",s);break;case"textarea":Kc(s,r),fe("invalid",s)}ul(t,r),i=null;for(var a in r)if(r.hasOwnProperty(a)){var o=r[a];a==="children"?typeof o=="string"?s.textContent!==o&&(r.suppressHydrationWarning!==!0&&hr(s.textContent,o,n),i=["children",o]):typeof o=="number"&&s.textContent!==""+o&&(r.suppressHydrationWarning!==!0&&hr(s.textContent,o,n),i=["children",""+o]):Ri.hasOwnProperty(a)&&o!=null&&a==="onScroll"&&fe("scroll",s)}switch(t){case"input":ir(s),Gc(s,r,!0);break;case"textarea":ir(s),Vc(s);break;case"select":case"option":break;default:typeof r.onClick=="function"&&(s.onclick=la)}s=i,e.updateQueue=s,s!==null&&(e.flags|=4)}else{a=i.nodeType===9?i:i.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=Pf(t)),n==="http://www.w3.org/1999/xhtml"?t==="script"?(n=a.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof s.is=="string"?n=a.createElement(t,{is:s.is}):(n=a.createElement(t),t==="select"&&(a=n,s.multiple?a.multiple=!0:s.size&&(a.size=s.size))):n=a.createElementNS(n,t),n[Vt]=e,n[Mi]=s,np(n,e,!1,!1),e.stateNode=n;e:{switch(a=cl(t,s),t){case"dialog":fe("cancel",n),fe("close",n),i=s;break;case"iframe":case"object":case"embed":fe("load",n),i=s;break;case"video":case"audio":for(i=0;i<hi.length;i++)fe(hi[i],n);i=s;break;case"source":fe("error",n),i=s;break;case"img":case"image":case"link":fe("error",n),fe("load",n),i=s;break;case"details":fe("toggle",n),i=s;break;case"input":jc(n,s),i=il(n,s),fe("invalid",n);break;case"option":i=s;break;case"select":n._wrapperState={wasMultiple:!!s.multiple},i=xe({},s,{value:void 0}),fe("invalid",n);break;case"textarea":Kc(n,s),i=ol(n,s),fe("invalid",n);break;default:i=s}ul(t,i),o=i;for(r in o)if(o.hasOwnProperty(r)){var l=o[r];r==="style"?Of(n,l):r==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&bf(n,l)):r==="children"?typeof l=="string"?(t!=="textarea"||l!=="")&&_i(n,l):typeof l=="number"&&_i(n,""+l):r!=="suppressContentEditableWarning"&&r!=="suppressHydrationWarning"&&r!=="autoFocus"&&(Ri.hasOwnProperty(r)?l!=null&&r==="onScroll"&&fe("scroll",n):l!=null&&yu(n,r,l,a))}switch(t){case"input":ir(n),Gc(n,s,!1);break;case"textarea":ir(n),Vc(n);break;case"option":s.value!=null&&n.setAttribute("value",""+bn(s.value));break;case"select":n.multiple=!!s.multiple,r=s.value,r!=null?ws(n,!!s.multiple,r,!1):s.defaultValue!=null&&ws(n,!!s.multiple,s.defaultValue,!0);break;default:typeof i.onClick=="function"&&(n.onclick=la)}switch(t){case"button":case"input":case"select":case"textarea":s=!!s.autoFocus;break e;case"img":s=!0;break e;default:s=!1}}s&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Ve(e),null;case 6:if(n&&e.stateNode!=null)ip(n,e,n.memoizedProps,s);else{if(typeof s!="string"&&e.stateNode===null)throw Error(F(166));if(t=Qn(Bi.current),Qn(qt.current),fr(e)){if(s=e.stateNode,t=e.memoizedProps,s[Vt]=e,(r=s.nodeValue!==t)&&(n=dt,n!==null))switch(n.tag){case 3:hr(s.nodeValue,t,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&hr(s.nodeValue,t,(n.mode&1)!==0)}r&&(e.flags|=4)}else s=(t.nodeType===9?t:t.ownerDocument).createTextNode(s),s[Vt]=e,e.stateNode=s}return Ve(e),null;case 13:if(ge(ye),s=e.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(pe&&ct!==null&&e.mode&1&&!(e.flags&128))Tg(),Gs(),e.flags|=98560,r=!1;else if(r=fr(e),s!==null&&s.dehydrated!==null){if(n===null){if(!r)throw Error(F(318));if(r=e.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(F(317));r[Vt]=e}else Gs(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Ve(e),r=!1}else Pt!==null&&(Vl(Pt),Pt=null),r=!0;if(!r)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(s=s!==null,s!==(n!==null&&n.memoizedState!==null)&&s&&(e.child.flags|=8192,e.mode&1&&(n===null||ye.current&1?De===0&&(De=3):Ju())),e.updateQueue!==null&&(e.flags|=4),Ve(e),null);case 4:return Vs(),Ml(n,e),n===null&&Ni(e.stateNode.containerInfo),Ve(e),null;case 10:return Mu(e.type._context),Ve(e),null;case 17:return st(e.type)&&ua(),Ve(e),null;case 19:if(ge(ye),r=e.memoizedState,r===null)return Ve(e),null;if(s=(e.flags&128)!==0,a=r.rendering,a===null)if(s)ai(r,!1);else{if(De!==0||n!==null&&n.flags&128)for(n=e.child;n!==null;){if(a=ma(n),a!==null){for(e.flags|=128,ai(r,!1),s=a.updateQueue,s!==null&&(e.updateQueue=s,e.flags|=4),e.subtreeFlags=0,s=t,t=e.child;t!==null;)r=t,n=s,r.flags&=14680066,a=r.alternate,a===null?(r.childLanes=0,r.lanes=n,r.child=null,r.subtreeFlags=0,r.memoizedProps=null,r.memoizedState=null,r.updateQueue=null,r.dependencies=null,r.stateNode=null):(r.childLanes=a.childLanes,r.lanes=a.lanes,r.child=a.child,r.subtreeFlags=0,r.deletions=null,r.memoizedProps=a.memoizedProps,r.memoizedState=a.memoizedState,r.updateQueue=a.updateQueue,r.type=a.type,n=a.dependencies,r.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),t=t.sibling;return he(ye,ye.current&1|2),e.child}n=n.sibling}r.tail!==null&&Le()>zs&&(e.flags|=128,s=!0,ai(r,!1),e.lanes=4194304)}else{if(!s)if(n=ma(a),n!==null){if(e.flags|=128,s=!0,t=n.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),ai(r,!0),r.tail===null&&r.tailMode==="hidden"&&!a.alternate&&!pe)return Ve(e),null}else 2*Le()-r.renderingStartTime>zs&&t!==1073741824&&(e.flags|=128,s=!0,ai(r,!1),e.lanes=4194304);r.isBackwards?(a.sibling=e.child,e.child=a):(t=r.last,t!==null?t.sibling=a:e.child=a,r.last=a)}return r.tail!==null?(e=r.tail,r.rendering=e,r.tail=e.sibling,r.renderingStartTime=Le(),e.sibling=null,t=ye.current,he(ye,s?t&1|2:t&1),e):(Ve(e),null);case 22:case 23:return Zu(),s=e.memoizedState!==null,n!==null&&n.memoizedState!==null!==s&&(e.flags|=8192),s&&e.mode&1?lt&1073741824&&(Ve(e),e.subtreeFlags&6&&(e.flags|=8192)):Ve(e),null;case 24:return null;case 25:return null}throw Error(F(156,e.tag))}function dv(n,e){switch(Pu(e),e.tag){case 1:return st(e.type)&&ua(),n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 3:return Vs(),ge(nt),ge(ze),ju(),n=e.flags,n&65536&&!(n&128)?(e.flags=n&-65537|128,e):null;case 5:return $u(e),null;case 13:if(ge(ye),n=e.memoizedState,n!==null&&n.dehydrated!==null){if(e.alternate===null)throw Error(F(340));Gs()}return n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 19:return ge(ye),null;case 4:return Vs(),null;case 10:return Mu(e.type._context),null;case 22:case 23:return Zu(),null;case 24:return null;default:return null}}var mr=!1,He=!1,hv=typeof WeakSet=="function"?WeakSet:Set,z=null;function _s(n,e){var t=n.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(s){Te(n,e,s)}else t.current=null}function Fl(n,e,t){try{t()}catch(s){Te(n,e,s)}}var bd=!1;function fv(n,e){if(xl=ra,n=ug(),wu(n)){if("selectionStart"in n)var t={start:n.selectionStart,end:n.selectionEnd};else e:{t=(t=n.ownerDocument)&&t.defaultView||window;var s=t.getSelection&&t.getSelection();if(s&&s.rangeCount!==0){t=s.anchorNode;var i=s.anchorOffset,r=s.focusNode;s=s.focusOffset;try{t.nodeType,r.nodeType}catch{t=null;break e}var a=0,o=-1,l=-1,u=0,c=0,d=n,h=null;t:for(;;){for(var f;d!==t||i!==0&&d.nodeType!==3||(o=a+i),d!==r||s!==0&&d.nodeType!==3||(l=a+s),d.nodeType===3&&(a+=d.nodeValue.length),(f=d.firstChild)!==null;)h=d,d=f;for(;;){if(d===n)break t;if(h===t&&++u===i&&(o=a),h===r&&++c===s&&(l=a),(f=d.nextSibling)!==null)break;d=h,h=d.parentNode}d=f}t=o===-1||l===-1?null:{start:o,end:l}}else t=null}t=t||{start:0,end:0}}else t=null;for(Sl={focusedElem:n,selectionRange:t},ra=!1,z=e;z!==null;)if(e=z,n=e.child,(e.subtreeFlags&1028)!==0&&n!==null)n.return=e,z=n;else for(;z!==null;){e=z;try{var g=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(g!==null){var p=g.memoizedProps,E=g.memoizedState,y=e.stateNode,m=y.getSnapshotBeforeUpdate(e.elementType===e.type?p:wt(e.type,p),E);y.__reactInternalSnapshotBeforeUpdate=m}break;case 3:var S=e.stateNode.containerInfo;S.nodeType===1?S.textContent="":S.nodeType===9&&S.documentElement&&S.removeChild(S.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(F(163))}}catch(T){Te(e,e.return,T)}if(n=e.sibling,n!==null){n.return=e.return,z=n;break}z=e.return}return g=bd,bd=!1,g}function xi(n,e,t){var s=e.updateQueue;if(s=s!==null?s.lastEffect:null,s!==null){var i=s=s.next;do{if((i.tag&n)===n){var r=i.destroy;i.destroy=void 0,r!==void 0&&Fl(e,t,r)}i=i.next}while(i!==s)}}function Va(n,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&n)===n){var s=t.create;t.destroy=s()}t=t.next}while(t!==e)}}function Bl(n){var e=n.ref;if(e!==null){var t=n.stateNode;switch(n.tag){case 5:n=t;break;default:n=t}typeof e=="function"?e(n):e.current=n}}function rp(n){var e=n.alternate;e!==null&&(n.alternate=null,rp(e)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(e=n.stateNode,e!==null&&(delete e[Vt],delete e[Mi],delete e[Ll],delete e[qy],delete e[Qy])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function ap(n){return n.tag===5||n.tag===3||n.tag===4}function Nd(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||ap(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function Ul(n,e,t){var s=n.tag;if(s===5||s===6)n=n.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(n,e):t.insertBefore(n,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(n,t)):(e=t,e.appendChild(n)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=la));else if(s!==4&&(n=n.child,n!==null))for(Ul(n,e,t),n=n.sibling;n!==null;)Ul(n,e,t),n=n.sibling}function $l(n,e,t){var s=n.tag;if(s===5||s===6)n=n.stateNode,e?t.insertBefore(n,e):t.appendChild(n);else if(s!==4&&(n=n.child,n!==null))for($l(n,e,t),n=n.sibling;n!==null;)$l(n,e,t),n=n.sibling}var Me=null,Dt=!1;function fn(n,e,t){for(t=t.child;t!==null;)op(n,e,t),t=t.sibling}function op(n,e,t){if(Yt&&typeof Yt.onCommitFiberUnmount=="function")try{Yt.onCommitFiberUnmount(Ma,t)}catch{}switch(t.tag){case 5:He||_s(t,e);case 6:var s=Me,i=Dt;Me=null,fn(n,e,t),Me=s,Dt=i,Me!==null&&(Dt?(n=Me,t=t.stateNode,n.nodeType===8?n.parentNode.removeChild(t):n.removeChild(t)):Me.removeChild(t.stateNode));break;case 18:Me!==null&&(Dt?(n=Me,t=t.stateNode,n.nodeType===8?Eo(n.parentNode,t):n.nodeType===1&&Eo(n,t),Di(n)):Eo(Me,t.stateNode));break;case 4:s=Me,i=Dt,Me=t.stateNode.containerInfo,Dt=!0,fn(n,e,t),Me=s,Dt=i;break;case 0:case 11:case 14:case 15:if(!He&&(s=t.updateQueue,s!==null&&(s=s.lastEffect,s!==null))){i=s=s.next;do{var r=i,a=r.destroy;r=r.tag,a!==void 0&&(r&2||r&4)&&Fl(t,e,a),i=i.next}while(i!==s)}fn(n,e,t);break;case 1:if(!He&&(_s(t,e),s=t.stateNode,typeof s.componentWillUnmount=="function"))try{s.props=t.memoizedProps,s.state=t.memoizedState,s.componentWillUnmount()}catch(o){Te(t,e,o)}fn(n,e,t);break;case 21:fn(n,e,t);break;case 22:t.mode&1?(He=(s=He)||t.memoizedState!==null,fn(n,e,t),He=s):fn(n,e,t);break;default:fn(n,e,t)}}function Od(n){var e=n.updateQueue;if(e!==null){n.updateQueue=null;var t=n.stateNode;t===null&&(t=n.stateNode=new hv),e.forEach(function(s){var i=Tv.bind(null,n,s);t.has(s)||(t.add(s),s.then(i,i))})}}function _t(n,e){var t=e.deletions;if(t!==null)for(var s=0;s<t.length;s++){var i=t[s];try{var r=n,a=e,o=a;e:for(;o!==null;){switch(o.tag){case 5:Me=o.stateNode,Dt=!1;break e;case 3:Me=o.stateNode.containerInfo,Dt=!0;break e;case 4:Me=o.stateNode.containerInfo,Dt=!0;break e}o=o.return}if(Me===null)throw Error(F(160));op(r,a,i),Me=null,Dt=!1;var l=i.alternate;l!==null&&(l.return=null),i.return=null}catch(u){Te(i,e,u)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)lp(e,n),e=e.sibling}function lp(n,e){var t=n.alternate,s=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if(_t(e,n),Bt(n),s&4){try{xi(3,n,n.return),Va(3,n)}catch(p){Te(n,n.return,p)}try{xi(5,n,n.return)}catch(p){Te(n,n.return,p)}}break;case 1:_t(e,n),Bt(n),s&512&&t!==null&&_s(t,t.return);break;case 5:if(_t(e,n),Bt(n),s&512&&t!==null&&_s(t,t.return),n.flags&32){var i=n.stateNode;try{_i(i,"")}catch(p){Te(n,n.return,p)}}if(s&4&&(i=n.stateNode,i!=null)){var r=n.memoizedProps,a=t!==null?t.memoizedProps:r,o=n.type,l=n.updateQueue;if(n.updateQueue=null,l!==null)try{o==="input"&&r.type==="radio"&&r.name!=null&&wf(i,r),cl(o,a);var u=cl(o,r);for(a=0;a<l.length;a+=2){var c=l[a],d=l[a+1];c==="style"?Of(i,d):c==="dangerouslySetInnerHTML"?bf(i,d):c==="children"?_i(i,d):yu(i,c,d,u)}switch(o){case"input":rl(i,r);break;case"textarea":Df(i,r);break;case"select":var h=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!r.multiple;var f=r.value;f!=null?ws(i,!!r.multiple,f,!1):h!==!!r.multiple&&(r.defaultValue!=null?ws(i,!!r.multiple,r.defaultValue,!0):ws(i,!!r.multiple,r.multiple?[]:"",!1))}i[Mi]=r}catch(p){Te(n,n.return,p)}}break;case 6:if(_t(e,n),Bt(n),s&4){if(n.stateNode===null)throw Error(F(162));i=n.stateNode,r=n.memoizedProps;try{i.nodeValue=r}catch(p){Te(n,n.return,p)}}break;case 3:if(_t(e,n),Bt(n),s&4&&t!==null&&t.memoizedState.isDehydrated)try{Di(e.containerInfo)}catch(p){Te(n,n.return,p)}break;case 4:_t(e,n),Bt(n);break;case 13:_t(e,n),Bt(n),i=n.child,i.flags&8192&&(r=i.memoizedState!==null,i.stateNode.isHidden=r,!r||i.alternate!==null&&i.alternate.memoizedState!==null||(Qu=Le())),s&4&&Od(n);break;case 22:if(c=t!==null&&t.memoizedState!==null,n.mode&1?(He=(u=He)||c,_t(e,n),He=u):_t(e,n),Bt(n),s&8192){if(u=n.memoizedState!==null,(n.stateNode.isHidden=u)&&!c&&n.mode&1)for(z=n,c=n.child;c!==null;){for(d=z=c;z!==null;){switch(h=z,f=h.child,h.tag){case 0:case 11:case 14:case 15:xi(4,h,h.return);break;case 1:_s(h,h.return);var g=h.stateNode;if(typeof g.componentWillUnmount=="function"){s=h,t=h.return;try{e=s,g.props=e.memoizedProps,g.state=e.memoizedState,g.componentWillUnmount()}catch(p){Te(s,t,p)}}break;case 5:_s(h,h.return);break;case 22:if(h.memoizedState!==null){Fd(d);continue}}f!==null?(f.return=h,z=f):Fd(d)}c=c.sibling}e:for(c=null,d=n;;){if(d.tag===5){if(c===null){c=d;try{i=d.stateNode,u?(r=i.style,typeof r.setProperty=="function"?r.setProperty("display","none","important"):r.display="none"):(o=d.stateNode,l=d.memoizedProps.style,a=l!=null&&l.hasOwnProperty("display")?l.display:null,o.style.display=Nf("display",a))}catch(p){Te(n,n.return,p)}}}else if(d.tag===6){if(c===null)try{d.stateNode.nodeValue=u?"":d.memoizedProps}catch(p){Te(n,n.return,p)}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===n)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===n)break e;for(;d.sibling===null;){if(d.return===null||d.return===n)break e;c===d&&(c=null),d=d.return}c===d&&(c=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:_t(e,n),Bt(n),s&4&&Od(n);break;case 21:break;default:_t(e,n),Bt(n)}}function Bt(n){var e=n.flags;if(e&2){try{e:{for(var t=n.return;t!==null;){if(ap(t)){var s=t;break e}t=t.return}throw Error(F(160))}switch(s.tag){case 5:var i=s.stateNode;s.flags&32&&(_i(i,""),s.flags&=-33);var r=Nd(n);$l(n,r,i);break;case 3:case 4:var a=s.stateNode.containerInfo,o=Nd(n);Ul(n,o,a);break;default:throw Error(F(161))}}catch(l){Te(n,n.return,l)}n.flags&=-3}e&4096&&(n.flags&=-4097)}function gv(n,e,t){z=n,up(n)}function up(n,e,t){for(var s=(n.mode&1)!==0;z!==null;){var i=z,r=i.child;if(i.tag===22&&s){var a=i.memoizedState!==null||mr;if(!a){var o=i.alternate,l=o!==null&&o.memoizedState!==null||He;o=mr;var u=He;if(mr=a,(He=l)&&!u)for(z=i;z!==null;)a=z,l=a.child,a.tag===22&&a.memoizedState!==null?Bd(i):l!==null?(l.return=a,z=l):Bd(i);for(;r!==null;)z=r,up(r),r=r.sibling;z=i,mr=o,He=u}Md(n)}else i.subtreeFlags&8772&&r!==null?(r.return=i,z=r):Md(n)}}function Md(n){for(;z!==null;){var e=z;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:He||Va(5,e);break;case 1:var s=e.stateNode;if(e.flags&4&&!He)if(t===null)s.componentDidMount();else{var i=e.elementType===e.type?t.memoizedProps:wt(e.type,t.memoizedProps);s.componentDidUpdate(i,t.memoizedState,s.__reactInternalSnapshotBeforeUpdate)}var r=e.updateQueue;r!==null&&xd(e,r,s);break;case 3:var a=e.updateQueue;if(a!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}xd(e,a,t)}break;case 5:var o=e.stateNode;if(t===null&&e.flags&4){t=o;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&t.focus();break;case"img":l.src&&(t.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var u=e.alternate;if(u!==null){var c=u.memoizedState;if(c!==null){var d=c.dehydrated;d!==null&&Di(d)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(F(163))}He||e.flags&512&&Bl(e)}catch(h){Te(e,e.return,h)}}if(e===n){z=null;break}if(t=e.sibling,t!==null){t.return=e.return,z=t;break}z=e.return}}function Fd(n){for(;z!==null;){var e=z;if(e===n){z=null;break}var t=e.sibling;if(t!==null){t.return=e.return,z=t;break}z=e.return}}function Bd(n){for(;z!==null;){var e=z;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{Va(4,e)}catch(l){Te(e,t,l)}break;case 1:var s=e.stateNode;if(typeof s.componentDidMount=="function"){var i=e.return;try{s.componentDidMount()}catch(l){Te(e,i,l)}}var r=e.return;try{Bl(e)}catch(l){Te(e,r,l)}break;case 5:var a=e.return;try{Bl(e)}catch(l){Te(e,a,l)}}}catch(l){Te(e,e.return,l)}if(e===n){z=null;break}var o=e.sibling;if(o!==null){o.return=e.return,z=o;break}z=e.return}}var pv=Math.ceil,Ea=hn.ReactCurrentDispatcher,Yu=hn.ReactCurrentOwner,St=hn.ReactCurrentBatchConfig,ie=0,Ne=null,Re=null,$e=0,lt=0,Cs=Bn(0),De=0,Gi=null,ss=0,Ha=0,qu=0,Si=null,Je=null,Qu=0,zs=1/0,en=null,xa=!1,jl=null,kn=null,yr=!1,An=null,Sa=0,Ti=0,Gl=null,Kr=-1,Vr=0;function qe(){return ie&6?Le():Kr!==-1?Kr:Kr=Le()}function wn(n){return n.mode&1?ie&2&&$e!==0?$e&-$e:Zy.transition!==null?(Vr===0&&(Vr=Wf()),Vr):(n=le,n!==0||(n=window.event,n=n===void 0?16:eg(n.type)),n):1}function Nt(n,e,t,s){if(50<Ti)throw Ti=0,Gl=null,Error(F(185));Xi(n,t,s),(!(ie&2)||n!==Ne)&&(n===Ne&&(!(ie&2)&&(Ha|=t),De===4&&Sn(n,$e)),it(n,s),t===1&&ie===0&&!(e.mode&1)&&(zs=Le()+500,ja&&Un()))}function it(n,e){var t=n.callbackNode;Z0(n,e);var s=ia(n,n===Ne?$e:0);if(s===0)t!==null&&Wc(t),n.callbackNode=null,n.callbackPriority=0;else if(e=s&-s,n.callbackPriority!==e){if(t!=null&&Wc(t),e===1)n.tag===0?Xy(Ud.bind(null,n)):Eg(Ud.bind(null,n)),Wy(function(){!(ie&6)&&Un()}),t=null;else{switch(Yf(s)){case 1:t=Tu;break;case 4:t=Hf;break;case 16:t=sa;break;case 536870912:t=zf;break;default:t=sa}t=yp(t,cp.bind(null,n))}n.callbackPriority=e,n.callbackNode=t}}function cp(n,e){if(Kr=-1,Vr=0,ie&6)throw Error(F(327));var t=n.callbackNode;if(Os()&&n.callbackNode!==t)return null;var s=ia(n,n===Ne?$e:0);if(s===0)return null;if(s&30||s&n.expiredLanes||e)e=Ta(n,s);else{e=s;var i=ie;ie|=2;var r=hp();(Ne!==n||$e!==e)&&(en=null,zs=Le()+500,Xn(n,e));do try{vv();break}catch(o){dp(n,o)}while(!0);Ou(),Ea.current=r,ie=i,Re!==null?e=0:(Ne=null,$e=0,e=De)}if(e!==0){if(e===2&&(i=pl(n),i!==0&&(s=i,e=Kl(n,i))),e===1)throw t=Gi,Xn(n,0),Sn(n,s),it(n,Le()),t;if(e===6)Sn(n,s);else{if(i=n.current.alternate,!(s&30)&&!mv(i)&&(e=Ta(n,s),e===2&&(r=pl(n),r!==0&&(s=r,e=Kl(n,r))),e===1))throw t=Gi,Xn(n,0),Sn(n,s),it(n,Le()),t;switch(n.finishedWork=i,n.finishedLanes=s,e){case 0:case 1:throw Error(F(345));case 2:zn(n,Je,en);break;case 3:if(Sn(n,s),(s&130023424)===s&&(e=Qu+500-Le(),10<e)){if(ia(n,0)!==0)break;if(i=n.suspendedLanes,(i&s)!==s){qe(),n.pingedLanes|=n.suspendedLanes&i;break}n.timeoutHandle=Al(zn.bind(null,n,Je,en),e);break}zn(n,Je,en);break;case 4:if(Sn(n,s),(s&4194240)===s)break;for(e=n.eventTimes,i=-1;0<s;){var a=31-bt(s);r=1<<a,a=e[a],a>i&&(i=a),s&=~r}if(s=i,s=Le()-s,s=(120>s?120:480>s?480:1080>s?1080:1920>s?1920:3e3>s?3e3:4320>s?4320:1960*pv(s/1960))-s,10<s){n.timeoutHandle=Al(zn.bind(null,n,Je,en),s);break}zn(n,Je,en);break;case 5:zn(n,Je,en);break;default:throw Error(F(329))}}}return it(n,Le()),n.callbackNode===t?cp.bind(null,n):null}function Kl(n,e){var t=Si;return n.current.memoizedState.isDehydrated&&(Xn(n,e).flags|=256),n=Ta(n,e),n!==2&&(e=Je,Je=t,e!==null&&Vl(e)),n}function Vl(n){Je===null?Je=n:Je.push.apply(Je,n)}function mv(n){for(var e=n;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var s=0;s<t.length;s++){var i=t[s],r=i.getSnapshot;i=i.value;try{if(!Ot(r(),i))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Sn(n,e){for(e&=~qu,e&=~Ha,n.suspendedLanes|=e,n.pingedLanes&=~e,n=n.expirationTimes;0<e;){var t=31-bt(e),s=1<<t;n[t]=-1,e&=~s}}function Ud(n){if(ie&6)throw Error(F(327));Os();var e=ia(n,0);if(!(e&1))return it(n,Le()),null;var t=Ta(n,e);if(n.tag!==0&&t===2){var s=pl(n);s!==0&&(e=s,t=Kl(n,s))}if(t===1)throw t=Gi,Xn(n,0),Sn(n,e),it(n,Le()),t;if(t===6)throw Error(F(345));return n.finishedWork=n.current.alternate,n.finishedLanes=e,zn(n,Je,en),it(n,Le()),null}function Xu(n,e){var t=ie;ie|=1;try{return n(e)}finally{ie=t,ie===0&&(zs=Le()+500,ja&&Un())}}function is(n){An!==null&&An.tag===0&&!(ie&6)&&Os();var e=ie;ie|=1;var t=St.transition,s=le;try{if(St.transition=null,le=1,n)return n()}finally{le=s,St.transition=t,ie=e,!(ie&6)&&Un()}}function Zu(){lt=Cs.current,ge(Cs)}function Xn(n,e){n.finishedWork=null,n.finishedLanes=0;var t=n.timeoutHandle;if(t!==-1&&(n.timeoutHandle=-1,zy(t)),Re!==null)for(t=Re.return;t!==null;){var s=t;switch(Pu(s),s.tag){case 1:s=s.type.childContextTypes,s!=null&&ua();break;case 3:Vs(),ge(nt),ge(ze),ju();break;case 5:$u(s);break;case 4:Vs();break;case 13:ge(ye);break;case 19:ge(ye);break;case 10:Mu(s.type._context);break;case 22:case 23:Zu()}t=t.return}if(Ne=n,Re=n=Dn(n.current,null),$e=lt=e,De=0,Gi=null,qu=Ha=ss=0,Je=Si=null,qn!==null){for(e=0;e<qn.length;e++)if(t=qn[e],s=t.interleaved,s!==null){t.interleaved=null;var i=s.next,r=t.pending;if(r!==null){var a=r.next;r.next=i,s.next=a}t.pending=s}qn=null}return n}function dp(n,e){do{var t=Re;try{if(Ou(),$r.current=va,ya){for(var s=Ee.memoizedState;s!==null;){var i=s.queue;i!==null&&(i.pending=null),s=s.next}ya=!1}if(ns=0,be=ke=Ee=null,Ei=!1,Ui=0,Yu.current=null,t===null||t.return===null){De=1,Gi=e,Re=null;break}e:{var r=n,a=t.return,o=t,l=e;if(e=$e,o.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var u=l,c=o,d=c.tag;if(!(c.mode&1)&&(d===0||d===11||d===15)){var h=c.alternate;h?(c.updateQueue=h.updateQueue,c.memoizedState=h.memoizedState,c.lanes=h.lanes):(c.updateQueue=null,c.memoizedState=null)}var f=Rd(a);if(f!==null){f.flags&=-257,_d(f,a,o,r,e),f.mode&1&&Id(r,u,e),e=f,l=u;var g=e.updateQueue;if(g===null){var p=new Set;p.add(l),e.updateQueue=p}else g.add(l);break e}else{if(!(e&1)){Id(r,u,e),Ju();break e}l=Error(F(426))}}else if(pe&&o.mode&1){var E=Rd(a);if(E!==null){!(E.flags&65536)&&(E.flags|=256),_d(E,a,o,r,e),bu(Hs(l,o));break e}}r=l=Hs(l,o),De!==4&&(De=2),Si===null?Si=[r]:Si.push(r),r=a;do{switch(r.tag){case 3:r.flags|=65536,e&=-e,r.lanes|=e;var y=Yg(r,l,e);Ed(r,y);break e;case 1:o=l;var m=r.type,S=r.stateNode;if(!(r.flags&128)&&(typeof m.getDerivedStateFromError=="function"||S!==null&&typeof S.componentDidCatch=="function"&&(kn===null||!kn.has(S)))){r.flags|=65536,e&=-e,r.lanes|=e;var T=qg(r,o,e);Ed(r,T);break e}}r=r.return}while(r!==null)}gp(t)}catch(A){e=A,Re===t&&t!==null&&(Re=t=t.return);continue}break}while(!0)}function hp(){var n=Ea.current;return Ea.current=va,n===null?va:n}function Ju(){(De===0||De===3||De===2)&&(De=4),Ne===null||!(ss&268435455)&&!(Ha&268435455)||Sn(Ne,$e)}function Ta(n,e){var t=ie;ie|=2;var s=hp();(Ne!==n||$e!==e)&&(en=null,Xn(n,e));do try{yv();break}catch(i){dp(n,i)}while(!0);if(Ou(),ie=t,Ea.current=s,Re!==null)throw Error(F(261));return Ne=null,$e=0,De}function yv(){for(;Re!==null;)fp(Re)}function vv(){for(;Re!==null&&!K0();)fp(Re)}function fp(n){var e=mp(n.alternate,n,lt);n.memoizedProps=n.pendingProps,e===null?gp(n):Re=e,Yu.current=null}function gp(n){var e=n;do{var t=e.alternate;if(n=e.return,e.flags&32768){if(t=dv(t,e),t!==null){t.flags&=32767,Re=t;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{De=6,Re=null;return}}else if(t=cv(t,e,lt),t!==null){Re=t;return}if(e=e.sibling,e!==null){Re=e;return}Re=e=n}while(e!==null);De===0&&(De=5)}function zn(n,e,t){var s=le,i=St.transition;try{St.transition=null,le=1,Ev(n,e,t,s)}finally{St.transition=i,le=s}return null}function Ev(n,e,t,s){do Os();while(An!==null);if(ie&6)throw Error(F(327));t=n.finishedWork;var i=n.finishedLanes;if(t===null)return null;if(n.finishedWork=null,n.finishedLanes=0,t===n.current)throw Error(F(177));n.callbackNode=null,n.callbackPriority=0;var r=t.lanes|t.childLanes;if(J0(n,r),n===Ne&&(Re=Ne=null,$e=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||yr||(yr=!0,yp(sa,function(){return Os(),null})),r=(t.flags&15990)!==0,t.subtreeFlags&15990||r){r=St.transition,St.transition=null;var a=le;le=1;var o=ie;ie|=4,Yu.current=null,fv(n,t),lp(t,n),Uy(Sl),ra=!!xl,Sl=xl=null,n.current=t,gv(t),V0(),ie=o,le=a,St.transition=r}else n.current=t;if(yr&&(yr=!1,An=n,Sa=i),r=n.pendingLanes,r===0&&(kn=null),W0(t.stateNode),it(n,Le()),e!==null)for(s=n.onRecoverableError,t=0;t<e.length;t++)i=e[t],s(i.value,{componentStack:i.stack,digest:i.digest});if(xa)throw xa=!1,n=jl,jl=null,n;return Sa&1&&n.tag!==0&&Os(),r=n.pendingLanes,r&1?n===Gl?Ti++:(Ti=0,Gl=n):Ti=0,Un(),null}function Os(){if(An!==null){var n=Yf(Sa),e=St.transition,t=le;try{if(St.transition=null,le=16>n?16:n,An===null)var s=!1;else{if(n=An,An=null,Sa=0,ie&6)throw Error(F(331));var i=ie;for(ie|=4,z=n.current;z!==null;){var r=z,a=r.child;if(z.flags&16){var o=r.deletions;if(o!==null){for(var l=0;l<o.length;l++){var u=o[l];for(z=u;z!==null;){var c=z;switch(c.tag){case 0:case 11:case 15:xi(8,c,r)}var d=c.child;if(d!==null)d.return=c,z=d;else for(;z!==null;){c=z;var h=c.sibling,f=c.return;if(rp(c),c===u){z=null;break}if(h!==null){h.return=f,z=h;break}z=f}}}var g=r.alternate;if(g!==null){var p=g.child;if(p!==null){g.child=null;do{var E=p.sibling;p.sibling=null,p=E}while(p!==null)}}z=r}}if(r.subtreeFlags&2064&&a!==null)a.return=r,z=a;else e:for(;z!==null;){if(r=z,r.flags&2048)switch(r.tag){case 0:case 11:case 15:xi(9,r,r.return)}var y=r.sibling;if(y!==null){y.return=r.return,z=y;break e}z=r.return}}var m=n.current;for(z=m;z!==null;){a=z;var S=a.child;if(a.subtreeFlags&2064&&S!==null)S.return=a,z=S;else e:for(a=m;z!==null;){if(o=z,o.flags&2048)try{switch(o.tag){case 0:case 11:case 15:Va(9,o)}}catch(A){Te(o,o.return,A)}if(o===a){z=null;break e}var T=o.sibling;if(T!==null){T.return=o.return,z=T;break e}z=o.return}}if(ie=i,Un(),Yt&&typeof Yt.onPostCommitFiberRoot=="function")try{Yt.onPostCommitFiberRoot(Ma,n)}catch{}s=!0}return s}finally{le=t,St.transition=e}}return!1}function $d(n,e,t){e=Hs(t,e),e=Yg(n,e,1),n=Cn(n,e,1),e=qe(),n!==null&&(Xi(n,1,e),it(n,e))}function Te(n,e,t){if(n.tag===3)$d(n,n,t);else for(;e!==null;){if(e.tag===3){$d(e,n,t);break}else if(e.tag===1){var s=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof s.componentDidCatch=="function"&&(kn===null||!kn.has(s))){n=Hs(t,n),n=qg(e,n,1),e=Cn(e,n,1),n=qe(),e!==null&&(Xi(e,1,n),it(e,n));break}}e=e.return}}function xv(n,e,t){var s=n.pingCache;s!==null&&s.delete(e),e=qe(),n.pingedLanes|=n.suspendedLanes&t,Ne===n&&($e&t)===t&&(De===4||De===3&&($e&130023424)===$e&&500>Le()-Qu?Xn(n,0):qu|=t),it(n,e)}function pp(n,e){e===0&&(n.mode&1?(e=or,or<<=1,!(or&130023424)&&(or=4194304)):e=1);var t=qe();n=cn(n,e),n!==null&&(Xi(n,e,t),it(n,t))}function Sv(n){var e=n.memoizedState,t=0;e!==null&&(t=e.retryLane),pp(n,t)}function Tv(n,e){var t=0;switch(n.tag){case 13:var s=n.stateNode,i=n.memoizedState;i!==null&&(t=i.retryLane);break;case 19:s=n.stateNode;break;default:throw Error(F(314))}s!==null&&s.delete(e),pp(n,t)}var mp;mp=function(n,e,t){if(n!==null)if(n.memoizedProps!==e.pendingProps||nt.current)et=!0;else{if(!(n.lanes&t)&&!(e.flags&128))return et=!1,uv(n,e,t);et=!!(n.flags&131072)}else et=!1,pe&&e.flags&1048576&&xg(e,ha,e.index);switch(e.lanes=0,e.tag){case 2:var s=e.type;Gr(n,e),n=e.pendingProps;var i=js(e,ze.current);Ns(e,t),i=Ku(null,e,s,n,i,t);var r=Vu();return e.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,st(s)?(r=!0,ca(e)):r=!1,e.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,Bu(e),i.updater=Ka,e.stateNode=i,i._reactInternals=e,wl(e,s,n,t),e=bl(null,e,s,!0,r,t)):(e.tag=0,pe&&r&&Du(e),We(null,e,i,t),e=e.child),e;case 16:s=e.elementType;e:{switch(Gr(n,e),n=e.pendingProps,i=s._init,s=i(s._payload),e.type=s,i=e.tag=Lv(s),n=wt(s,n),i){case 0:e=Pl(null,e,s,n,t);break e;case 1:e=wd(null,e,s,n,t);break e;case 11:e=Cd(null,e,s,n,t);break e;case 14:e=kd(null,e,s,wt(s.type,n),t);break e}throw Error(F(306,s,""))}return e;case 0:return s=e.type,i=e.pendingProps,i=e.elementType===s?i:wt(s,i),Pl(n,e,s,i,t);case 1:return s=e.type,i=e.pendingProps,i=e.elementType===s?i:wt(s,i),wd(n,e,s,i,t);case 3:e:{if(Jg(e),n===null)throw Error(F(387));s=e.pendingProps,r=e.memoizedState,i=r.element,Rg(n,e),pa(e,s,null,t);var a=e.memoizedState;if(s=a.element,r.isDehydrated)if(r={element:s,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},e.updateQueue.baseState=r,e.memoizedState=r,e.flags&256){i=Hs(Error(F(423)),e),e=Dd(n,e,s,t,i);break e}else if(s!==i){i=Hs(Error(F(424)),e),e=Dd(n,e,s,t,i);break e}else for(ct=_n(e.stateNode.containerInfo.firstChild),dt=e,pe=!0,Pt=null,t=Lg(e,null,s,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(Gs(),s===i){e=dn(n,e,t);break e}We(n,e,s,t)}e=e.child}return e;case 5:return _g(e),n===null&&_l(e),s=e.type,i=e.pendingProps,r=n!==null?n.memoizedProps:null,a=i.children,Tl(s,i)?a=null:r!==null&&Tl(s,r)&&(e.flags|=32),Zg(n,e),We(n,e,a,t),e.child;case 6:return n===null&&_l(e),null;case 13:return ep(n,e,t);case 4:return Uu(e,e.stateNode.containerInfo),s=e.pendingProps,n===null?e.child=Ks(e,null,s,t):We(n,e,s,t),e.child;case 11:return s=e.type,i=e.pendingProps,i=e.elementType===s?i:wt(s,i),Cd(n,e,s,i,t);case 7:return We(n,e,e.pendingProps,t),e.child;case 8:return We(n,e,e.pendingProps.children,t),e.child;case 12:return We(n,e,e.pendingProps.children,t),e.child;case 10:e:{if(s=e.type._context,i=e.pendingProps,r=e.memoizedProps,a=i.value,he(fa,s._currentValue),s._currentValue=a,r!==null)if(Ot(r.value,a)){if(r.children===i.children&&!nt.current){e=dn(n,e,t);break e}}else for(r=e.child,r!==null&&(r.return=e);r!==null;){var o=r.dependencies;if(o!==null){a=r.child;for(var l=o.firstContext;l!==null;){if(l.context===s){if(r.tag===1){l=on(-1,t&-t),l.tag=2;var u=r.updateQueue;if(u!==null){u=u.shared;var c=u.pending;c===null?l.next=l:(l.next=c.next,c.next=l),u.pending=l}}r.lanes|=t,l=r.alternate,l!==null&&(l.lanes|=t),Cl(r.return,t,e),o.lanes|=t;break}l=l.next}}else if(r.tag===10)a=r.type===e.type?null:r.child;else if(r.tag===18){if(a=r.return,a===null)throw Error(F(341));a.lanes|=t,o=a.alternate,o!==null&&(o.lanes|=t),Cl(a,t,e),a=r.sibling}else a=r.child;if(a!==null)a.return=r;else for(a=r;a!==null;){if(a===e){a=null;break}if(r=a.sibling,r!==null){r.return=a.return,a=r;break}a=a.return}r=a}We(n,e,i.children,t),e=e.child}return e;case 9:return i=e.type,s=e.pendingProps.children,Ns(e,t),i=Tt(i),s=s(i),e.flags|=1,We(n,e,s,t),e.child;case 14:return s=e.type,i=wt(s,e.pendingProps),i=wt(s.type,i),kd(n,e,s,i,t);case 15:return Qg(n,e,e.type,e.pendingProps,t);case 17:return s=e.type,i=e.pendingProps,i=e.elementType===s?i:wt(s,i),Gr(n,e),e.tag=1,st(s)?(n=!0,ca(e)):n=!1,Ns(e,t),Wg(e,s,i),wl(e,s,i,t),bl(null,e,s,!0,n,t);case 19:return tp(n,e,t);case 22:return Xg(n,e,t)}throw Error(F(156,e.tag))};function yp(n,e){return Vf(n,e)}function Av(n,e,t,s){this.tag=n,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=s,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function xt(n,e,t,s){return new Av(n,e,t,s)}function ec(n){return n=n.prototype,!(!n||!n.isReactComponent)}function Lv(n){if(typeof n=="function")return ec(n)?1:0;if(n!=null){if(n=n.$$typeof,n===Eu)return 11;if(n===xu)return 14}return 2}function Dn(n,e){var t=n.alternate;return t===null?(t=xt(n.tag,e,n.key,n.mode),t.elementType=n.elementType,t.type=n.type,t.stateNode=n.stateNode,t.alternate=n,n.alternate=t):(t.pendingProps=e,t.type=n.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=n.flags&14680064,t.childLanes=n.childLanes,t.lanes=n.lanes,t.child=n.child,t.memoizedProps=n.memoizedProps,t.memoizedState=n.memoizedState,t.updateQueue=n.updateQueue,e=n.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=n.sibling,t.index=n.index,t.ref=n.ref,t}function Hr(n,e,t,s,i,r){var a=2;if(s=n,typeof n=="function")ec(n)&&(a=1);else if(typeof n=="string")a=5;else e:switch(n){case vs:return Zn(t.children,i,r,e);case vu:a=8,i|=8;break;case el:return n=xt(12,t,e,i|2),n.elementType=el,n.lanes=r,n;case tl:return n=xt(13,t,e,i),n.elementType=tl,n.lanes=r,n;case nl:return n=xt(19,t,e,i),n.elementType=nl,n.lanes=r,n;case _f:return za(t,i,r,e);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case If:a=10;break e;case Rf:a=9;break e;case Eu:a=11;break e;case xu:a=14;break e;case mn:a=16,s=null;break e}throw Error(F(130,n==null?n:typeof n,""))}return e=xt(a,t,e,i),e.elementType=n,e.type=s,e.lanes=r,e}function Zn(n,e,t,s){return n=xt(7,n,s,e),n.lanes=t,n}function za(n,e,t,s){return n=xt(22,n,s,e),n.elementType=_f,n.lanes=t,n.stateNode={isHidden:!1},n}function _o(n,e,t){return n=xt(6,n,null,e),n.lanes=t,n}function Co(n,e,t){return e=xt(4,n.children!==null?n.children:[],n.key,e),e.lanes=t,e.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},e}function Iv(n,e,t,s,i){this.tag=e,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=oo(0),this.expirationTimes=oo(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=oo(0),this.identifierPrefix=s,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function tc(n,e,t,s,i,r,a,o,l){return n=new Iv(n,e,t,o,l),e===1?(e=1,r===!0&&(e|=8)):e=0,r=xt(3,null,null,e),n.current=r,r.stateNode=n,r.memoizedState={element:s,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},Bu(r),n}function Rv(n,e,t){var s=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:ys,key:s==null?null:""+s,children:n,containerInfo:e,implementation:t}}function vp(n){if(!n)return Nn;n=n._reactInternals;e:{if(ls(n)!==n||n.tag!==1)throw Error(F(170));var e=n;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(st(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(F(171))}if(n.tag===1){var t=n.type;if(st(t))return vg(n,t,e)}return e}function Ep(n,e,t,s,i,r,a,o,l){return n=tc(t,s,!0,n,i,r,a,o,l),n.context=vp(null),t=n.current,s=qe(),i=wn(t),r=on(s,i),r.callback=e??null,Cn(t,r,i),n.current.lanes=i,Xi(n,i,s),it(n,s),n}function Wa(n,e,t,s){var i=e.current,r=qe(),a=wn(i);return t=vp(t),e.context===null?e.context=t:e.pendingContext=t,e=on(r,a),e.payload={element:n},s=s===void 0?null:s,s!==null&&(e.callback=s),n=Cn(i,e,a),n!==null&&(Nt(n,i,a,r),Ur(n,i,a)),a}function Aa(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function jd(n,e){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var t=n.retryLane;n.retryLane=t!==0&&t<e?t:e}}function nc(n,e){jd(n,e),(n=n.alternate)&&jd(n,e)}function _v(){return null}var xp=typeof reportError=="function"?reportError:function(n){console.error(n)};function sc(n){this._internalRoot=n}Ya.prototype.render=sc.prototype.render=function(n){var e=this._internalRoot;if(e===null)throw Error(F(409));Wa(n,e,null,null)};Ya.prototype.unmount=sc.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var e=n.containerInfo;is(function(){Wa(null,n,null,null)}),e[un]=null}};function Ya(n){this._internalRoot=n}Ya.prototype.unstable_scheduleHydration=function(n){if(n){var e=Xf();n={blockedOn:null,target:n,priority:e};for(var t=0;t<xn.length&&e!==0&&e<xn[t].priority;t++);xn.splice(t,0,n),t===0&&Jf(n)}};function ic(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function qa(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function Gd(){}function Cv(n,e,t,s,i){if(i){if(typeof s=="function"){var r=s;s=function(){var u=Aa(a);r.call(u)}}var a=Ep(e,s,n,0,null,!1,!1,"",Gd);return n._reactRootContainer=a,n[un]=a.current,Ni(n.nodeType===8?n.parentNode:n),is(),a}for(;i=n.lastChild;)n.removeChild(i);if(typeof s=="function"){var o=s;s=function(){var u=Aa(l);o.call(u)}}var l=tc(n,0,!1,null,null,!1,!1,"",Gd);return n._reactRootContainer=l,n[un]=l.current,Ni(n.nodeType===8?n.parentNode:n),is(function(){Wa(e,l,t,s)}),l}function Qa(n,e,t,s,i){var r=t._reactRootContainer;if(r){var a=r;if(typeof i=="function"){var o=i;i=function(){var l=Aa(a);o.call(l)}}Wa(e,a,n,i)}else a=Cv(t,e,n,i,s);return Aa(a)}qf=function(n){switch(n.tag){case 3:var e=n.stateNode;if(e.current.memoizedState.isDehydrated){var t=di(e.pendingLanes);t!==0&&(Au(e,t|1),it(e,Le()),!(ie&6)&&(zs=Le()+500,Un()))}break;case 13:is(function(){var s=cn(n,1);if(s!==null){var i=qe();Nt(s,n,1,i)}}),nc(n,1)}};Lu=function(n){if(n.tag===13){var e=cn(n,134217728);if(e!==null){var t=qe();Nt(e,n,134217728,t)}nc(n,134217728)}};Qf=function(n){if(n.tag===13){var e=wn(n),t=cn(n,e);if(t!==null){var s=qe();Nt(t,n,e,s)}nc(n,e)}};Xf=function(){return le};Zf=function(n,e){var t=le;try{return le=n,e()}finally{le=t}};hl=function(n,e,t){switch(e){case"input":if(rl(n,t),e=t.name,t.type==="radio"&&e!=null){for(t=n;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var s=t[e];if(s!==n&&s.form===n.form){var i=$a(s);if(!i)throw Error(F(90));kf(s),rl(s,i)}}}break;case"textarea":Df(n,t);break;case"select":e=t.value,e!=null&&ws(n,!!t.multiple,e,!1)}};Bf=Xu;Uf=is;var kv={usingClientEntryPoint:!1,Events:[Ji,Ts,$a,Mf,Ff,Xu]},oi={findFiberByHostInstance:Yn,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},wv={bundleType:oi.bundleType,version:oi.version,rendererPackageName:oi.rendererPackageName,rendererConfig:oi.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:hn.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=Gf(n),n===null?null:n.stateNode},findFiberByHostInstance:oi.findFiberByHostInstance||_v,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var vr=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!vr.isDisabled&&vr.supportsFiber)try{Ma=vr.inject(wv),Yt=vr}catch{}}gt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=kv;gt.createPortal=function(n,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!ic(e))throw Error(F(200));return Rv(n,e,null,t)};gt.createRoot=function(n,e){if(!ic(n))throw Error(F(299));var t=!1,s="",i=xp;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(s=e.identifierPrefix),e.onRecoverableError!==void 0&&(i=e.onRecoverableError)),e=tc(n,1,!1,null,null,t,!1,s,i),n[un]=e.current,Ni(n.nodeType===8?n.parentNode:n),new sc(e)};gt.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var e=n._reactInternals;if(e===void 0)throw typeof n.render=="function"?Error(F(188)):(n=Object.keys(n).join(","),Error(F(268,n)));return n=Gf(e),n=n===null?null:n.stateNode,n};gt.flushSync=function(n){return is(n)};gt.hydrate=function(n,e,t){if(!qa(e))throw Error(F(200));return Qa(null,n,e,!0,t)};gt.hydrateRoot=function(n,e,t){if(!ic(n))throw Error(F(405));var s=t!=null&&t.hydratedSources||null,i=!1,r="",a=xp;if(t!=null&&(t.unstable_strictMode===!0&&(i=!0),t.identifierPrefix!==void 0&&(r=t.identifierPrefix),t.onRecoverableError!==void 0&&(a=t.onRecoverableError)),e=Ep(e,null,n,1,t??null,i,!1,r,a),n[un]=e.current,Ni(n),s)for(n=0;n<s.length;n++)t=s[n],i=t._getVersion,i=i(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,i]:e.mutableSourceEagerHydrationData.push(t,i);return new Ya(e)};gt.render=function(n,e,t){if(!qa(e))throw Error(F(200));return Qa(null,n,e,!1,t)};gt.unmountComponentAtNode=function(n){if(!qa(n))throw Error(F(40));return n._reactRootContainer?(is(function(){Qa(null,null,n,!1,function(){n._reactRootContainer=null,n[un]=null})}),!0):!1};gt.unstable_batchedUpdates=Xu;gt.unstable_renderSubtreeIntoContainer=function(n,e,t,s){if(!qa(t))throw Error(F(200));if(n==null||n._reactInternals===void 0)throw Error(F(38));return Qa(n,e,t,!1,s)};gt.version="18.3.1-next-f1338f8080-20240426";function Sp(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(Sp)}catch(n){console.error(n)}}Sp(),Sf.exports=gt;var Dv=Sf.exports,Tp,Kd=Dv;Tp=Kd.createRoot,Kd.hydrateRoot;/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pv=n=>n.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),Ap=(...n)=>n.filter((e,t,s)=>!!e&&e.trim()!==""&&s.indexOf(e)===t).join(" ").trim();/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var bv={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nv=Ce.forwardRef(({color:n="currentColor",size:e=24,strokeWidth:t=2,absoluteStrokeWidth:s,className:i="",children:r,iconNode:a,...o},l)=>Ce.createElement("svg",{ref:l,...bv,width:e,height:e,stroke:n,strokeWidth:s?Number(t)*24/Number(e):t,className:Ap("lucide",i),...o},[...a.map(([u,c])=>Ce.createElement(u,c)),...Array.isArray(r)?r:[r]]));/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rc=(n,e)=>{const t=Ce.forwardRef(({className:s,...i},r)=>Ce.createElement(Nv,{ref:r,iconNode:e,className:Ap(`lucide-${Pv(n)}`,s),...i}));return t.displayName=`${n}`,t};/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ov=rc("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mv=rc("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fv=rc("Maximize",[["path",{d:"M8 3H5a2 2 0 0 0-2 2v3",key:"1dcmit"}],["path",{d:"M21 8V5a2 2 0 0 0-2-2h-3",key:"1e4gt3"}],["path",{d:"M3 16v3a2 2 0 0 0 2 2h3",key:"wsl5sc"}],["path",{d:"M16 21h3a2 2 0 0 0 2-2v-3",key:"18trek"}]]);function Bv({slides:n}){const[e,t]=Ce.useState(0),[s,i]=Ce.useState(!0),r=Ce.useRef(null),a=n.length,o=Ce.useCallback(()=>{t(d=>d<a-1?d+1:d)},[a]),l=Ce.useCallback(()=>{t(d=>d>0?d-1:d)},[]),u=Ce.useCallback(()=>{document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen()},[]);Ce.useEffect(()=>{const d=h=>{h.key==="ArrowRight"||h.key==="ArrowDown"||h.key===" "?(h.preventDefault(),o()):h.key==="ArrowLeft"||h.key==="ArrowUp"?(h.preventDefault(),l()):h.key==="f"||h.key==="F"?(h.preventDefault(),u()):h.key==="Escape"&&document.fullscreenElement&&document.exitFullscreen()};return document.addEventListener("keydown",d),()=>document.removeEventListener("keydown",d)},[o,l,u]);const c=Ce.useCallback(()=>{i(!0),r.current&&clearTimeout(r.current),r.current=setTimeout(()=>i(!1),3e3)},[]);return Ce.useEffect(()=>(c(),()=>{r.current&&clearTimeout(r.current)}),[c]),x.jsxs("div",{className:"relative w-full h-screen bg-black overflow-hidden",onMouseMove:c,children:[n.map((d,h)=>x.jsx("div",{className:"absolute inset-0 transition-all duration-500 ease-in-out",style:{opacity:h===e?1:0,pointerEvents:h===e?"auto":"none",transform:h<e?"scale(0.95)":h>e?"scale(1.05)":"scale(1)",zIndex:h===e?10:h<e?1:2},children:d},h)),x.jsxs("div",{className:"fixed bottom-0 left-0 right-0 z-50 flex items-center justify-between px-[5.2%] py-[1.5%] transition-opacity duration-300",style:{opacity:s?1:0},children:[x.jsxs("span",{className:"text-white/50 tabular-nums",style:{fontSize:"clamp(12px, 1.05vw, 13px)"},children:[e+1," / ",a]}),x.jsx("div",{className:"flex items-center gap-1",children:n.map((d,h)=>x.jsx("div",{className:"rounded-full bg-white/30 transition-all duration-200",style:{width:h===e?24:6,height:6,backgroundColor:h===e?"rgba(255,255,255,0.9)":"rgba(255,255,255,0.3)"}},h))}),x.jsxs("div",{className:"flex items-center gap-2",children:[x.jsx("button",{onClick:l,disabled:e===0,className:"p-2 text-white/50 hover:text-white/90 hover:bg-white/10 rounded transition-colors disabled:opacity-30",children:x.jsx(Ov,{size:20})}),x.jsx("button",{onClick:o,disabled:e===a-1,className:"p-2 text-white/50 hover:text-white/90 hover:bg-white/10 rounded transition-colors disabled:opacity-30",children:x.jsx(Mv,{size:20})}),x.jsx("span",{className:"w-px h-4 bg-white/20"}),x.jsx("button",{onClick:u,className:"p-2 text-white/50 hover:text-white/90 hover:bg-white/10 rounded transition-colors",children:x.jsx(Fv,{size:18})})]})]}),x.jsx("div",{className:"fixed top-4 right-[5.2%] z-50 transition-opacity duration-300",style:{opacity:s?1:0,fontSize:"11px",color:"rgba(255,255,255,0.4)"},children:"  i slide  F Ton mn hnh"})]})}const j=Number.isFinite||function(n){return typeof n=="number"&&isFinite(n)},Uv=Number.isSafeInteger||function(n){return typeof n=="number"&&Math.abs(n)<=$v},$v=Number.MAX_SAFE_INTEGER||9007199254740991;let Y=function(n){return n.NETWORK_ERROR="networkError",n.MEDIA_ERROR="mediaError",n.KEY_SYSTEM_ERROR="keySystemError",n.MUX_ERROR="muxError",n.OTHER_ERROR="otherError",n}({}),w=function(n){return n.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",n.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",n.KEY_SYSTEM_NO_SESSION="keySystemNoSession",n.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",n.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",n.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",n.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",n.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",n.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",n.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",n.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",n.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",n.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",n.MANIFEST_LOAD_ERROR="manifestLoadError",n.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",n.MANIFEST_PARSING_ERROR="manifestParsingError",n.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",n.LEVEL_EMPTY_ERROR="levelEmptyError",n.LEVEL_LOAD_ERROR="levelLoadError",n.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",n.LEVEL_PARSING_ERROR="levelParsingError",n.LEVEL_SWITCH_ERROR="levelSwitchError",n.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",n.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",n.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",n.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",n.FRAG_LOAD_ERROR="fragLoadError",n.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",n.FRAG_DECRYPT_ERROR="fragDecryptError",n.FRAG_PARSING_ERROR="fragParsingError",n.FRAG_GAP="fragGap",n.REMUX_ALLOC_ERROR="remuxAllocError",n.KEY_LOAD_ERROR="keyLoadError",n.KEY_LOAD_TIMEOUT="keyLoadTimeOut",n.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",n.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",n.BUFFER_APPEND_ERROR="bufferAppendError",n.BUFFER_APPENDING_ERROR="bufferAppendingError",n.BUFFER_STALLED_ERROR="bufferStalledError",n.BUFFER_FULL_ERROR="bufferFullError",n.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",n.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",n.ASSET_LIST_LOAD_ERROR="assetListLoadError",n.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",n.ASSET_LIST_PARSING_ERROR="assetListParsingError",n.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",n.INTERNAL_EXCEPTION="internalException",n.INTERNAL_ABORTED="aborted",n.ATTACH_MEDIA_ERROR="attachMediaError",n.UNKNOWN="unknown",n}({}),v=function(n){return n.MEDIA_ATTACHING="hlsMediaAttaching",n.MEDIA_ATTACHED="hlsMediaAttached",n.MEDIA_DETACHING="hlsMediaDetaching",n.MEDIA_DETACHED="hlsMediaDetached",n.MEDIA_ENDED="hlsMediaEnded",n.STALL_RESOLVED="hlsStallResolved",n.BUFFER_RESET="hlsBufferReset",n.BUFFER_CODECS="hlsBufferCodecs",n.BUFFER_CREATED="hlsBufferCreated",n.BUFFER_APPENDING="hlsBufferAppending",n.BUFFER_APPENDED="hlsBufferAppended",n.BUFFER_EOS="hlsBufferEos",n.BUFFERED_TO_END="hlsBufferedToEnd",n.BUFFER_FLUSHING="hlsBufferFlushing",n.BUFFER_FLUSHED="hlsBufferFlushed",n.MANIFEST_LOADING="hlsManifestLoading",n.MANIFEST_LOADED="hlsManifestLoaded",n.MANIFEST_PARSED="hlsManifestParsed",n.LEVEL_SWITCHING="hlsLevelSwitching",n.LEVEL_SWITCHED="hlsLevelSwitched",n.LEVEL_LOADING="hlsLevelLoading",n.LEVEL_LOADED="hlsLevelLoaded",n.LEVEL_UPDATED="hlsLevelUpdated",n.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",n.LEVELS_UPDATED="hlsLevelsUpdated",n.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",n.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",n.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",n.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",n.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",n.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",n.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",n.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",n.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",n.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",n.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",n.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",n.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",n.CUES_PARSED="hlsCuesParsed",n.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",n.INIT_PTS_FOUND="hlsInitPtsFound",n.FRAG_LOADING="hlsFragLoading",n.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",n.FRAG_LOADED="hlsFragLoaded",n.FRAG_DECRYPTED="hlsFragDecrypted",n.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",n.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",n.FRAG_PARSING_METADATA="hlsFragParsingMetadata",n.FRAG_PARSED="hlsFragParsed",n.FRAG_BUFFERED="hlsFragBuffered",n.FRAG_CHANGED="hlsFragChanged",n.FPS_DROP="hlsFpsDrop",n.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",n.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",n.ERROR="hlsError",n.DESTROYING="hlsDestroying",n.KEY_LOADING="hlsKeyLoading",n.KEY_LOADED="hlsKeyLoaded",n.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",n.BACK_BUFFER_REACHED="hlsBackBufferReached",n.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",n.ASSET_LIST_LOADING="hlsAssetListLoading",n.ASSET_LIST_LOADED="hlsAssetListLoaded",n.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",n.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",n.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",n.INTERSTITIAL_STARTED="hlsInterstitialStarted",n.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",n.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",n.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",n.INTERSTITIAL_ENDED="hlsInterstitialEnded",n.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",n.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",n.EVENT_CUE_ENTER="hlsEventCueEnter",n}({});var ne={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},H={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};class ds{constructor(e,t=0,s=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=s}sample(e,t){const s=Math.pow(this.alpha_,e);this.estimate_=t*(1-s)+s*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class jv{constructor(e,t,s,i=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=s,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new ds(e),this.fast_=new ds(t),this.defaultTTFB_=i,this.ttfb_=new ds(e)}update(e,t){const{slow_:s,fast_:i,ttfb_:r}=this;s.halfLife!==e&&(this.slow_=new ds(e,s.getEstimate(),s.getTotalWeight())),i.halfLife!==t&&(this.fast_=new ds(t,i.getEstimate(),i.getTotalWeight())),r.halfLife!==e&&(this.ttfb_=new ds(e,r.getEstimate(),r.getTotalWeight()))}sample(e,t){e=Math.max(e,this.minDelayMs_);const s=8*t,i=e/1e3,r=s/i;this.fast_.sample(i,r),this.slow_.sample(i,r)}sampleTTFB(e){const t=e/1e3,s=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(s,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}get defaultEstimate(){return this.defaultEstimate_}destroy(){}}function Gv(n,e,t){return(e=Vv(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function ue(){return ue=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var s in t)({}).hasOwnProperty.call(t,s)&&(n[s]=t[s])}return n},ue.apply(null,arguments)}function Vd(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);e&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,s)}return t}function ae(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Vd(Object(t),!0).forEach(function(s){Gv(n,s,t[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Vd(Object(t)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(t,s))})}return n}function Kv(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var s=t.call(n,e);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function Vv(n){var e=Kv(n,"string");return typeof e=="symbol"?e:e+""}class It{constructor(e,t){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;const s=`[${e}]:`;this.trace=vn,this.debug=t.debug.bind(null,s),this.log=t.log.bind(null,s),this.warn=t.warn.bind(null,s),this.info=t.info.bind(null,s),this.error=t.error.bind(null,s)}}const vn=function(){},Hv={trace:vn,debug:vn,log:vn,warn:vn,info:vn,error:vn};function Hl(){return ue({},Hv)}function zv(n,e){const t=self.console[n];return t?t.bind(self.console,`${e?"["+e+"] ":""}[${n}] >`):vn}function Hd(n,e,t){return e[n]?e[n].bind(e):zv(n,t)}const zl=Hl();function Wv(n,e,t){const s=Hl();if(typeof console=="object"&&n===!0||typeof n=="object"){const i=["debug","log","info","warn","error"];i.forEach(r=>{s[r]=Hd(r,n,t)});try{s.log(`Debug logs enabled for "${e}" in hls.js version 1.6.15`)}catch{return Hl()}i.forEach(r=>{zl[r]=Hd(r,n)})}else ue(zl,s);return s}const oe=zl;function On(n=!0){return typeof self>"u"?void 0:(n||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function Yv(n){return typeof self<"u"&&n===self.ManagedMediaSource}function Lp(n,e){const t=Object.keys(n),s=Object.keys(e),i=t.length,r=s.length;return!i||!r||i===r&&!t.some(a=>s.indexOf(a)===-1)}function ht(n,e=!1){if(typeof TextDecoder<"u"){const u=new TextDecoder("utf-8").decode(n);if(e){const c=u.indexOf("\0");return c!==-1?u.substring(0,c):u}return u.replace(/\0/g,"")}const t=n.length;let s,i,r,a="",o=0;for(;o<t;){if(s=n[o++],s===0&&e)return a;if(s===0||s===3)continue;switch(s>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:a+=String.fromCharCode(s);break;case 12:case 13:i=n[o++],a+=String.fromCharCode((s&31)<<6|i&63);break;case 14:i=n[o++],r=n[o++],a+=String.fromCharCode((s&15)<<12|(i&63)<<6|(r&63)<<0);break}}return a}function Be(n){let e="";for(let t=0;t<n.length;t++){let s=n[t].toString(16);s.length<2&&(s="0"+s),e+=s}return e}function Ip(n){return Uint8Array.from(n.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}function qv(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var ko={exports:{}},zd;function Qv(){return zd||(zd=1,function(n,e){(function(t){var s=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,i=/^(?=([^\/?#]*))\1([^]*)$/,r=/(?:\/|^)\.(?=\/)/g,a=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,o={buildAbsoluteURL:function(l,u,c){if(c=c||{},l=l.trim(),u=u.trim(),!u){if(!c.alwaysNormalize)return l;var d=o.parseURL(l);if(!d)throw new Error("Error trying to parse base URL.");return d.path=o.normalizePath(d.path),o.buildURLFromParts(d)}var h=o.parseURL(u);if(!h)throw new Error("Error trying to parse relative URL.");if(h.scheme)return c.alwaysNormalize?(h.path=o.normalizePath(h.path),o.buildURLFromParts(h)):u;var f=o.parseURL(l);if(!f)throw new Error("Error trying to parse base URL.");if(!f.netLoc&&f.path&&f.path[0]!=="/"){var g=i.exec(f.path);f.netLoc=g[1],f.path=g[2]}f.netLoc&&!f.path&&(f.path="/");var p={scheme:f.scheme,netLoc:h.netLoc,path:null,params:h.params,query:h.query,fragment:h.fragment};if(!h.netLoc&&(p.netLoc=f.netLoc,h.path[0]!=="/"))if(!h.path)p.path=f.path,h.params||(p.params=f.params,h.query||(p.query=f.query));else{var E=f.path,y=E.substring(0,E.lastIndexOf("/")+1)+h.path;p.path=o.normalizePath(y)}return p.path===null&&(p.path=c.alwaysNormalize?o.normalizePath(h.path):h.path),o.buildURLFromParts(p)},parseURL:function(l){var u=s.exec(l);return u?{scheme:u[1]||"",netLoc:u[2]||"",path:u[3]||"",params:u[4]||"",query:u[5]||"",fragment:u[6]||""}:null},normalizePath:function(l){for(l=l.split("").reverse().join("").replace(r,"");l.length!==(l=l.replace(a,"")).length;);return l.split("").reverse().join("")},buildURLFromParts:function(l){return l.scheme+l.netLoc+l.path+l.params+l.query+l.fragment}};n.exports=o})()}(ko)),ko.exports}var ac=Qv();class oc{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var ce={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class Rp{constructor(e){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,typeof e=="string"&&(e={url:e}),this.base=e,Zv(this,"stats")}setByteRange(e,t){const s=e.split("@",2);let i;s.length===1?i=(t==null?void 0:t.byteRangeEndOffset)||0:i=parseInt(s[1]),this._byteRange=[i,parseInt(s[0])+i]}get baseurl(){return this.base.url}get byteRange(){return this._byteRange===null?[]:this._byteRange}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get elementaryStreams(){return this._streams===null&&(this._streams={[ce.AUDIO]:null,[ce.VIDEO]:null,[ce.AUDIOVIDEO]:null}),this._streams}set elementaryStreams(e){this._streams=e}get hasStats(){return this._stats!==null}get hasStreams(){return this._streams!==null}get stats(){return this._stats===null&&(this._stats=new oc),this._stats}set stats(e){this._stats=e}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=ac.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[ce.AUDIO]=null,e[ce.VIDEO]=null,e[ce.AUDIOVIDEO]=null}}function Ie(n){return n.sn!=="initSegment"}class wo extends Rp{constructor(e,t){super(t),this._decryptdata=null,this._programDateTime=null,this._ref=null,this._bitrate=void 0,this.rawProgramDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.playlistOffset=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get byteLength(){if(this.hasStats){const e=this.stats.total;if(e)return e}if(this.byteRange.length){const e=this.byteRange[0],t=this.byteRange[1];if(j(e)&&j(t))return t-e}return null}get bitrate(){return this.byteLength?this.byteLength*8/this.duration:this._bitrate?this._bitrate:null}set bitrate(e){this._bitrate=e}get decryptdata(){var e;const{levelkeys:t}=this;if(!t||t.NONE)return null;if(t.identity)this._decryptdata||(this._decryptdata=t.identity.getDecryptData(this.sn));else if(!((e=this._decryptdata)!=null&&e.keyId)){const s=Object.keys(t);if(s.length===1){const i=this._decryptdata=t[s[0]]||null;i&&(this._decryptdata=i.getDecryptData(this.sn,t))}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null)return null;const e=j(this.duration)?this.duration:0;return this.programDateTime+e*1e3}get encrypted(){var e;if((e=this._decryptdata)!=null&&e.encrypted)return!0;if(this.levelkeys){var t;const s=Object.keys(this.levelkeys),i=s.length;if(i>1||i===1&&(t=this.levelkeys[s[0]])!=null&&t.encrypted)return!0}return!1}get programDateTime(){return this._programDateTime===null&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime}set programDateTime(e){if(!j(e)){this._programDateTime=this.rawProgramDateTime=null;return}this._programDateTime=e}get ref(){return Ie(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}addStart(e){this.setStart(this.start+e)}setStart(e){this.start=e,this._ref&&(this._ref.start=e)}setDuration(e){this.duration=e,this._ref&&(this._ref.duration=e)}setKeyFormat(e){const t=this.levelkeys;if(t){var s;const i=t[e];i&&!((s=this._decryptdata)!=null&&s.keyId)&&(this._decryptdata=i.getDecryptData(this.sn,t))}}abortRequests(){var e,t;(e=this.loader)==null||e.abort(),(t=this.keyLoader)==null||t.abort()}setElementaryStreamInfo(e,t,s,i,r,a=!1){const{elementaryStreams:o}=this,l=o[e];if(!l){o[e]={startPTS:t,endPTS:s,startDTS:i,endDTS:r,partial:a};return}l.startPTS=Math.min(l.startPTS,t),l.endPTS=Math.max(l.endPTS,s),l.startDTS=Math.min(l.startDTS,i),l.endDTS=Math.max(l.endDTS,r)}}class Xv extends Rp{constructor(e,t,s,i,r){super(s),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=i;const a=e.enumeratedString("BYTERANGE");a&&this.setByteRange(a,r),r&&(this.fragOffset=r.fragOffset+r.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}function _p(n,e){const t=Object.getPrototypeOf(n);if(t){const s=Object.getOwnPropertyDescriptor(t,e);return s||_p(t,e)}}function Zv(n,e){const t=_p(n,e);t&&(t.enumerable=!0,Object.defineProperty(n,e,t))}const Wd=Math.pow(2,32)-1,Jv=[].push,Cp={video:1,audio:2,id3:3,text:4};function _e(n){return String.fromCharCode.apply(null,n)}function kp(n,e){const t=n[e]<<8|n[e+1];return t<0?65536+t:t}function q(n,e){const t=wp(n,e);return t<0?4294967296+t:t}function Yd(n,e){let t=q(n,e);return t*=Math.pow(2,32),t+=q(n,e+4),t}function wp(n,e){return n[e]<<24|n[e+1]<<16|n[e+2]<<8|n[e+3]}function eE(n){const e=n.byteLength;for(let t=0;t<e;){const s=q(n,t);if(s>8&&n[t+4]===109&&n[t+5]===111&&n[t+6]===111&&n[t+7]===102)return!0;t=s>1?t+s:e}return!1}function ee(n,e){const t=[];if(!e.length)return t;const s=n.byteLength;for(let i=0;i<s;){const r=q(n,i),a=_e(n.subarray(i+4,i+8)),o=r>1?i+r:s;if(a===e[0])if(e.length===1)t.push(n.subarray(i+8,o));else{const l=ee(n.subarray(i+8,o),e.slice(1));l.length&&Jv.apply(t,l)}i=o}return t}function tE(n){const e=[],t=n[0];let s=8;const i=q(n,s);s+=4;let r=0,a=0;t===0?(r=q(n,s),a=q(n,s+4),s+=8):(r=Yd(n,s),a=Yd(n,s+8),s+=16),s+=2;let o=n.length+a;const l=kp(n,s);s+=2;for(let u=0;u<l;u++){let c=s;const d=q(n,c);c+=4;const h=d&2147483647;if((d&2147483648)>>>31===1)return oe.warn("SIDX has hierarchical references (not supported)"),null;const g=q(n,c);c+=4,e.push({referenceSize:h,subsegmentDuration:g,info:{duration:g/i,start:o,end:o+h-1}}),o+=h,c+=4,s=c}return{earliestPresentationTime:r,timescale:i,version:t,referencesCount:l,references:e}}function Dp(n){const e=[],t=ee(n,["moov","trak"]);for(let i=0;i<t.length;i++){const r=t[i],a=ee(r,["tkhd"])[0];if(a){let o=a[0];const l=q(a,o===0?12:20),u=ee(r,["mdia","mdhd"])[0];if(u){o=u[0];const c=q(u,o===0?12:20),d=ee(r,["mdia","hdlr"])[0];if(d){const h=_e(d.subarray(8,12)),f={soun:ce.AUDIO,vide:ce.VIDEO}[h],g=ee(r,["mdia","minf","stbl","stsd"])[0],p=nE(g);f?(e[l]={timescale:c,type:f,stsd:p},e[f]=ae({timescale:c,id:l},p)):e[l]={timescale:c,type:h,stsd:p}}}}}return ee(n,["moov","mvex","trex"]).forEach(i=>{const r=q(i,4),a=e[r];a&&(a.default={duration:q(i,12),flags:q(i,20)})}),e}function nE(n){const e=n.subarray(8),t=e.subarray(86),s=_e(e.subarray(4,8));let i=s,r;const a=s==="enca"||s==="encv";if(a){const u=ee(e,[s])[0].subarray(s==="enca"?28:78);ee(u,["sinf"]).forEach(d=>{const h=ee(d,["schm"])[0];if(h){const f=_e(h.subarray(4,8));if(f==="cbcs"||f==="cenc"){const g=ee(d,["frma"])[0];g&&(i=_e(g))}}})}const o=i;switch(i){case"avc1":case"avc2":case"avc3":case"avc4":{const l=ee(t,["avcC"])[0];l&&l.length>3&&(i+="."+xr(l[1])+xr(l[2])+xr(l[3]),r=Er(o==="avc1"?"dva1":"dvav",t));break}case"mp4a":{const l=ee(e,[s])[0],u=ee(l.subarray(28),["esds"])[0];if(u&&u.length>7){let c=4;if(u[c++]!==3)break;c=Do(u,c),c+=2;const d=u[c++];if(d&128&&(c+=2),d&64&&(c+=u[c++]),u[c++]!==4)break;c=Do(u,c);const h=u[c++];if(h===64)i+="."+xr(h);else break;if(c+=12,u[c++]!==5)break;c=Do(u,c);const f=u[c++];let g=(f&248)>>3;g===31&&(g+=1+((f&7)<<3)+((u[c]&224)>>5)),i+="."+g}break}case"hvc1":case"hev1":{const l=ee(t,["hvcC"])[0];if(l&&l.length>12){const u=l[1],c=["","A","B","C"][u>>6],d=u&31,h=q(l,2),f=(u&32)>>5?"H":"L",g=l[12],p=l.subarray(6,12);i+="."+c+d,i+="."+sE(h).toString(16).toUpperCase(),i+="."+f+g;let E="";for(let y=p.length;y--;){const m=p[y];(m||E)&&(E="."+m.toString(16).toUpperCase()+E)}i+=E}r=Er(o=="hev1"?"dvhe":"dvh1",t);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":{i=Er(i,t)||i;break}case"vp09":{const l=ee(t,["vpcC"])[0];if(l&&l.length>6){const u=l[4],c=l[5],d=l[6]>>4&15;i+="."+Gt(u)+"."+Gt(c)+"."+Gt(d)}break}case"av01":{const l=ee(t,["av1C"])[0];if(l&&l.length>2){const u=l[1]>>>5,c=l[1]&31,d=l[2]>>>7?"H":"M",h=(l[2]&64)>>6,f=(l[2]&32)>>5,g=u===2&&h?f?12:10:h?10:8,p=(l[2]&16)>>4,E=(l[2]&8)>>3,y=(l[2]&4)>>2,m=l[2]&3;i+="."+u+"."+Gt(c)+d+"."+Gt(g)+"."+p+"."+E+y+m+"."+Gt(1)+"."+Gt(1)+"."+Gt(1)+"."+0,r=Er("dav1",t)}break}}return{codec:i,encrypted:a,supplemental:r}}function Er(n,e){const t=ee(e,["dvvC"]),s=t.length?t[0]:ee(e,["dvcC"])[0];if(s){const i=s[2]>>1&127,r=s[2]<<5&32|s[3]>>3&31;return n+"."+Gt(i)+"."+Gt(r)}}function sE(n){let e=0;for(let t=0;t<32;t++)e|=(n>>t&1)<<31-t;return e>>>0}function Do(n,e){const t=e+5;for(;n[e++]&128&&e<t;);return e}function xr(n){return("0"+n.toString(16).toUpperCase()).slice(-2)}function Gt(n){return(n<10?"0":"")+n}function iE(n,e){if(!n||!e)return;const t=e.keyId;t&&e.isCommonEncryption&&Pp(n,(s,i)=>{const r=s.subarray(8,24);r.some(a=>a!==0)||(oe.log(`[eme] Patching keyId in 'enc${i?"a":"v"}>sinf>>tenc' box: ${Be(r)} -> ${Be(t)}`),s.set(t,8))})}function rE(n){const e=[];return Pp(n,t=>e.push(t.subarray(8,24))),e}function Pp(n,e){ee(n,["moov","trak"]).forEach(s=>{const i=ee(s,["mdia","minf","stbl","stsd"])[0];if(!i)return;const r=i.subarray(8);let a=ee(r,["enca"]);const o=a.length>0;o||(a=ee(r,["encv"])),a.forEach(l=>{const u=o?l.subarray(28):l.subarray(78);ee(u,["sinf"]).forEach(d=>{const h=bp(d);h&&e(h,o)})})})}function bp(n){const e=ee(n,["schm"])[0];if(e){const t=_e(e.subarray(4,8));if(t==="cbcs"||t==="cenc"){const s=ee(n,["schi","tenc"])[0];if(s)return s}}}function aE(n,e,t){const s={},i=ee(n,["moof","traf"]);for(let r=0;r<i.length;r++){const a=i[r],o=ee(a,["tfhd"])[0],l=q(o,4),u=e[l];if(!u)continue;s[l]||(s[l]={start:NaN,duration:0,sampleCount:0,timescale:u.timescale,type:u.type});const c=s[l],d=ee(a,["tfdt"])[0];if(d){const S=d[0];let T=q(d,4);S===1&&(T===Wd?t.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"):(T*=Wd+1,T+=q(d,8))),j(T)&&(!j(c.start)||T<c.start)&&(c.start=T)}const h=u.default,f=q(o,0)|(h==null?void 0:h.flags);let g=(h==null?void 0:h.duration)||0;f&8&&(f&2?g=q(o,12):g=q(o,8));const p=ee(a,["trun"]);let E=c.start||0,y=0,m=g;for(let S=0;S<p.length;S++){const T=p[S],A=q(T,4),_=c.sampleCount;c.sampleCount+=A;const L=T[3]&1,R=T[3]&4,C=T[2]&1,I=T[2]&2,P=T[2]&4,$=T[2]&8;let G=8,W=A;for(L&&(G+=4),R&&A&&(!(T[G+1]&1)&&c.keyFrameIndex===void 0&&(c.keyFrameIndex=_),G+=4,C?(m=q(T,G),G+=4):m=g,I&&(G+=4),$&&(G+=4),E+=m,y+=m,W--);W--;)C?(m=q(T,G),G+=4):m=g,I&&(G+=4),P&&(T[G+1]&1||c.keyFrameIndex===void 0&&(c.keyFrameIndex=c.sampleCount-(W+1),c.keyFrameStart=E),G+=4),$&&(G+=4),E+=m,y+=m;!y&&g&&(y+=g*A)}c.duration+=y}if(!Object.keys(s).some(r=>s[r].duration)){let r=1/0,a=0;const o=ee(n,["sidx"]);for(let l=0;l<o.length;l++){const u=tE(o[l]);if(u!=null&&u.references){r=Math.min(r,u.earliestPresentationTime/u.timescale);const c=u.references.reduce((d,h)=>d+h.info.duration||0,0);a=Math.max(a,c+u.earliestPresentationTime/u.timescale)}}a&&j(a)&&Object.keys(s).forEach(l=>{s[l].duration||(s[l].duration=a*s[l].timescale-s[l].start)})}return s}function oE(n){const e={valid:null,remainder:null},t=ee(n,["moof"]);if(t.length<2)return e.remainder=n,e;const s=t[t.length-1];return e.valid=n.slice(0,s.byteOffset-8),e.remainder=n.slice(s.byteOffset-8),e}function Lt(n,e){const t=new Uint8Array(n.length+e.length);return t.set(n),t.set(e,n.length),t}function qd(n,e){const t=[],s=e.samples,i=e.timescale,r=e.id;let a=!1;return ee(s,["moof"]).map(l=>{const u=l.byteOffset-8;ee(l,["traf"]).map(d=>{const h=ee(d,["tfdt"]).map(f=>{const g=f[0];let p=q(f,4);return g===1&&(p*=Math.pow(2,32),p+=q(f,8)),p/i})[0];return h!==void 0&&(n=h),ee(d,["tfhd"]).map(f=>{const g=q(f,4),p=q(f,0)&16777215,E=(p&1)!==0,y=(p&2)!==0,m=(p&8)!==0;let S=0;const T=(p&16)!==0;let A=0;const _=(p&32)!==0;let L=8;g===r&&(E&&(L+=8),y&&(L+=4),m&&(S=q(f,L),L+=4),T&&(A=q(f,L),L+=4),_&&(L+=4),e.type==="video"&&(a=Xa(e.codec)),ee(d,["trun"]).map(R=>{const C=R[0],I=q(R,0)&16777215,P=(I&1)!==0;let $=0;const G=(I&4)!==0,W=(I&256)!==0;let K=0;const B=(I&512)!==0;let V=0;const D=(I&1024)!==0,N=(I&2048)!==0;let U=0;const O=q(R,4);let M=8;P&&($=q(R,M),M+=4),G&&(M+=4);let Q=$+u;for(let te=0;te<O;te++){if(W?(K=q(R,M),M+=4):K=S,B?(V=q(R,M),M+=4):V=A,D&&(M+=4),N&&(C===0?U=q(R,M):U=wp(R,M),M+=4),e.type===ce.VIDEO){let Z=0;for(;Z<V;){const J=q(s,Q);if(Q+=4,lE(a,s[Q])){const Ae=s.subarray(Q,Q+J);lc(Ae,a?2:1,n+U/i,t)}Q+=J,Z+=J+4}}n+=K/i}}))})})}),t}function Xa(n){if(!n)return!1;const e=n.substring(0,4);return e==="hvc1"||e==="hev1"||e==="dvh1"||e==="dvhe"}function lE(n,e){if(n){const t=e>>1&63;return t===39||t===40}else return(e&31)===6}function lc(n,e,t,s){const i=Np(n);let r=0;r+=e;let a=0,o=0,l=0;for(;r<i.length;){a=0;do{if(r>=i.length)break;l=i[r++],a+=l}while(l===255);o=0;do{if(r>=i.length)break;l=i[r++],o+=l}while(l===255);const u=i.length-r;let c=r;if(o<u)r+=o;else if(o>u){oe.error(`Malformed SEI payload. ${o} is too small, only ${u} bytes left to parse.`);break}if(a===4){if(i[c++]===181){const h=kp(i,c);if(c+=2,h===49){const f=q(i,c);if(c+=4,f===1195456820){const g=i[c++];if(g===3){const p=i[c++],E=31&p,y=64&p,m=y?2+E*3:0,S=new Uint8Array(m);if(y){S[0]=p;for(let T=1;T<m;T++)S[T]=i[c++]}s.push({type:g,payloadType:a,pts:t,bytes:S})}}}}}else if(a===5&&o>16){const d=[];for(let g=0;g<16;g++){const p=i[c++].toString(16);d.push(p.length==1?"0"+p:p),(g===3||g===5||g===7||g===9)&&d.push("-")}const h=o-16,f=new Uint8Array(h);for(let g=0;g<h;g++)f[g]=i[c++];s.push({payloadType:a,pts:t,uuid:d.join(""),userData:ht(f),userDataBytes:f})}}}function Np(n){const e=n.byteLength,t=[];let s=1;for(;s<e-2;)n[s]===0&&n[s+1]===0&&n[s+2]===3?(t.push(s+2),s+=2):s++;if(t.length===0)return n;const i=e-t.length,r=new Uint8Array(i);let a=0;for(s=0;s<i;a++,s++)a===t[0]&&(a++,t.shift()),r[s]=n[a];return r}function uE(n){const e=n[0];let t="",s="",i=0,r=0,a=0,o=0,l=0,u=0;if(e===0){for(;_e(n.subarray(u,u+1))!=="\0";)t+=_e(n.subarray(u,u+1)),u+=1;for(t+=_e(n.subarray(u,u+1)),u+=1;_e(n.subarray(u,u+1))!=="\0";)s+=_e(n.subarray(u,u+1)),u+=1;s+=_e(n.subarray(u,u+1)),u+=1,i=q(n,12),r=q(n,16),o=q(n,20),l=q(n,24),u=28}else if(e===1){u+=4,i=q(n,u),u+=4;const d=q(n,u);u+=4;const h=q(n,u);for(u+=4,a=2**32*d+h,Uv(a)||(a=Number.MAX_SAFE_INTEGER,oe.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),o=q(n,u),u+=4,l=q(n,u),u+=4;_e(n.subarray(u,u+1))!=="\0";)t+=_e(n.subarray(u,u+1)),u+=1;for(t+=_e(n.subarray(u,u+1)),u+=1;_e(n.subarray(u,u+1))!=="\0";)s+=_e(n.subarray(u,u+1)),u+=1;s+=_e(n.subarray(u,u+1)),u+=1}const c=n.subarray(u,n.byteLength);return{schemeIdUri:t,value:s,timeScale:i,presentationTime:a,presentationTimeDelta:r,eventDuration:o,id:l,payload:c}}function cE(n,...e){const t=e.length;let s=8,i=t;for(;i--;)s+=e[i].byteLength;const r=new Uint8Array(s);for(r[0]=s>>24&255,r[1]=s>>16&255,r[2]=s>>8&255,r[3]=s&255,r.set(n,4),i=0,s=8;i<t;i++)r.set(e[i],s),s+=e[i].byteLength;return r}function dE(n,e,t){if(n.byteLength!==16)throw new RangeError("Invalid system id");let s,i;s=0,i=new Uint8Array;let r;s>0?(r=new Uint8Array(4),e.length>0&&new DataView(r.buffer).setUint32(0,e.length,!1)):r=new Uint8Array;const a=new Uint8Array(4);return t.byteLength>0&&new DataView(a.buffer).setUint32(0,t.byteLength,!1),cE([112,115,115,104],new Uint8Array([s,0,0,0]),n,r,i,a,t)}function hE(n){const e=[];if(n instanceof ArrayBuffer){const t=n.byteLength;let s=0;for(;s+32<t;){const i=new DataView(n,s),r=fE(i);e.push(r),s+=r.size}}return e}function fE(n){const e=n.getUint32(0),t=n.byteOffset,s=n.byteLength;if(s<e)return{offset:t,size:s};if(n.getUint32(4)!==1886614376)return{offset:t,size:e};const r=n.getUint32(8)>>>24;if(r!==0&&r!==1)return{offset:t,size:e};const a=n.buffer,o=Be(new Uint8Array(a,t+12,16));let l=null,u=null,c=0;if(r===0)c=28;else{const h=n.getUint32(28);if(!h||s<32+h*16)return{offset:t,size:e};l=[];for(let f=0;f<h;f++)l.push(new Uint8Array(a,t+32+f*16,16));c=32+h*16}if(!c)return{offset:t,size:e};const d=n.getUint32(c);return e-32<d?{offset:t,size:e}:(u=new Uint8Array(a,t+c+4,d),{version:r,systemId:o,kids:l,data:u,offset:t,size:e})}const Op=()=>/\(Windows.+Firefox\//i.test(navigator.userAgent),Ws={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function uc(n,e){const t=Ws[e];return!!t&&!!t[n.slice(0,4)]}function Ki(n,e,t=!0){return!n.split(",").some(s=>!cc(s,e,t))}function cc(n,e,t=!0){var s;const i=On(t);return(s=i==null?void 0:i.isTypeSupported(Vi(n,e)))!=null?s:!1}function Vi(n,e){return`${e}/mp4;codecs=${n}`}function Qd(n){if(n){const e=n.substring(0,4);return Ws.video[e]}return 2}function La(n){const e=Op();return n.split(",").reduce((t,s)=>{const r=e&&Xa(s)?9:Ws.video[s];return r?(r*2+t)/(t?3:2):(Ws.audio[s]+t)/(t?2:1)},0)}const Po={};function gE(n,e=!0){if(Po[n])return Po[n];const t={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[n];for(let i=0;i<t.length;i++){var s;if(cc(t[i],"audio",e))return Po[n]=t[i],t[i];if(t[i]==="mp3"&&(s=On(e))!=null&&s.isTypeSupported("audio/mpeg"))return""}return n}const pE=/flac|opus|mp4a\.40\.34/i;function Ia(n,e=!0){return n.replace(pE,t=>gE(t.toLowerCase(),e))}function mE(n,e){const t=[];if(n){const s=n.split(",");for(let i=0;i<s.length;i++)uc(s[i],"video")||t.push(s[i])}return e&&t.push(e),t.join(",")}function zr(n,e){if(n&&(n.length>4||["ac-3","ec-3","alac","fLaC","Opus"].indexOf(n)!==-1)&&(Xd(n,"audio")||Xd(n,"video")))return n;if(e){const t=e.split(",");if(t.length>1){if(n){for(let s=t.length;s--;)if(t[s].substring(0,4)===n.substring(0,4))return t[s]}return t[0]}}return e||n}function Xd(n,e){return uc(n,e)&&cc(n,e)}function yE(n){const e=n.split(",");for(let t=0;t<e.length;t++){const s=e[t].split(".");s.length>2&&s[0]==="avc1"&&(e[t]=`avc1.${parseInt(s[1]).toString(16)}${("000"+parseInt(s[2]).toString(16)).slice(-4)}`)}return e.join(",")}function vE(n){if(n.startsWith("av01.")){const e=n.split("."),t=["0","111","01","01","01","0"];for(let s=e.length;s>4&&s<10;s++)e[s]=t[s-4];return e.join(".")}return n}function Zd(n){const e=On(n)||{isTypeSupported:()=>!1};return{mpeg:e.isTypeSupported("audio/mpeg"),mp3:e.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:e.isTypeSupported('audio/mp4; codecs="ac-3"')}}function Wl(n){return n.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}const EE={supported:!0,powerEfficient:!0,smooth:!0},xE={supported:!1,smooth:!1,powerEfficient:!1},Mp={supported:!0,configurations:[],decodingInfoResults:[EE]};function Fp(n,e){return{supported:!1,configurations:e,decodingInfoResults:[xE],error:n}}function SE(n,e,t,s,i,r){const a=n.videoCodec,o=n.audioCodec?n.audioGroups:null,l=r==null?void 0:r.audioCodec,u=r==null?void 0:r.channels,c=u?parseInt(u):l?1/0:2;let d=null;if(o!=null&&o.length)try{o.length===1&&o[0]?d=e.groups[o[0]].channels:d=o.reduce((h,f)=>{if(f){const g=e.groups[f];if(!g)throw new Error(`Audio track group ${f} not found`);Object.keys(g.channels).forEach(p=>{h[p]=(h[p]||0)+g.channels[p]})}return h},{2:0})}catch{return!0}return a!==void 0&&(a.split(",").some(h=>Xa(h))||n.width>1920&&n.height>1088||n.height>1920&&n.width>1088||n.frameRate>Math.max(s,30)||n.videoRange!=="SDR"&&n.videoRange!==t||n.bitrate>Math.max(i,8e6))||!!d&&j(c)&&Object.keys(d).some(h=>parseInt(h)>c)}function Bp(n,e,t,s={}){const i=n.videoCodec;if(!i&&!n.audioCodec||!t)return Promise.resolve(Mp);const r=[],a=TE(n),o=a.length,l=AE(n,e,o>0),u=l.length;for(let c=o||1*u||1;c--;){const d={type:"media-source"};if(o&&(d.video=a[c%o]),u){d.audio=l[c%u];const h=d.audio.bitrate;d.video&&h&&(d.video.bitrate-=h)}r.push(d)}if(i){const c=navigator.userAgent;if(i.split(",").some(d=>Xa(d))&&Op())return Promise.resolve(Fp(new Error(`Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent string: (${c})`),r))}return Promise.all(r.map(c=>{const d=IE(c);return s[d]||(s[d]=t.decodingInfo(c))})).then(c=>({supported:!c.some(d=>!d.supported),configurations:r,decodingInfoResults:c})).catch(c=>({supported:!1,configurations:r,decodingInfoResults:[],error:c}))}function TE(n){var e;const t=(e=n.videoCodec)==null?void 0:e.split(","),s=Up(n),i=n.width||640,r=n.height||480,a=n.frameRate||30,o=n.videoRange.toLowerCase();return t?t.map(l=>{const u={contentType:Vi(vE(l),"video"),width:i,height:r,bitrate:s,framerate:a};return o!=="sdr"&&(u.transferFunction=o),u}):[]}function AE(n,e,t){var s;const i=(s=n.audioCodec)==null?void 0:s.split(","),r=Up(n);return i&&n.audioGroups?n.audioGroups.reduce((a,o)=>{var l;const u=o?(l=e.groups[o])==null?void 0:l.tracks:null;return u?u.reduce((c,d)=>{if(d.groupId===o){const h=parseFloat(d.channels||"");i.forEach(f=>{const g={contentType:Vi(f,"audio"),bitrate:t?LE(f,r):r};h&&(g.channels=""+h),c.push(g)})}return c},a):a},[]):[]}function LE(n,e){if(e<=1)return 1;let t=128e3;return n==="ec-3"?t=768e3:n==="ac-3"&&(t=64e4),Math.min(e/2,t)}function Up(n){return Math.ceil(Math.max(n.bitrate*.9,n.averageBitrate)/1e3)*1e3||1}function IE(n){let e="";const{audio:t,video:s}=n;if(s){const i=Wl(s.contentType);e+=`${i}_r${s.height}x${s.width}f${Math.ceil(s.framerate)}${s.transferFunction||"sd"}_${Math.ceil(s.bitrate/1e5)}`}if(t){const i=Wl(t.contentType);e+=`${s?"_":""}${i}_c${t.channels}`}return e}const Yl=["NONE","TYPE-0","TYPE-1",null];function RE(n){return Yl.indexOf(n)>-1}const Ra=["SDR","PQ","HLG"];function _E(n){return!!n&&Ra.indexOf(n)>-1}var Wr={No:"",Yes:"YES",v2:"v2"};function Jd(n){const{canSkipUntil:e,canSkipDateRanges:t,age:s}=n,i=s<e/2;return e&&i?t?Wr.v2:Wr.Yes:Wr.No}class eh{constructor(e,t,s){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=s}addDirectives(e){const t=new self.URL(e);return this.msn!==void 0&&t.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class Hi{constructor(e){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter(s=>!!s).map(s=>s.substring(0,4)).join(","),"supplemental"in e){var t;this.supplemental=e.supplemental;const s=(t=e.supplemental)==null?void 0:t.videoCodec;s&&s!==e.videoCodec&&(this.codecSet+=`,${s.substring(0,4)}`)}this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return th(this._audioGroups,e)}hasSubtitleGroup(e){return th(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,t){if(t){if(e==="audio"){let s=this._audioGroups;s||(s=this._audioGroups=[]),s.indexOf(t)===-1&&s.push(t)}else if(e==="text"){let s=this._subtitleGroups;s||(s=this._subtitleGroups=[]),s.indexOf(t)===-1&&s.push(t)}}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return(e=this.audioGroups)==null?void 0:e[0]}get textGroupId(){var e;return(e=this.subtitleGroups)==null?void 0:e[0]}addFallback(){}}function th(n,e){return!e||!n?!1:n.indexOf(e)!==-1}function CE(){if(typeof matchMedia=="function"){const n=matchMedia("(dynamic-range: high)"),e=matchMedia("bad query");if(n.media!==e.media)return n.matches===!0}return!1}function kE(n,e){let t=!1,s=[];if(n&&(t=n!=="SDR",s=[n]),e){s=e.allowedVideoRanges||Ra.slice(0);const i=s.join("")!=="SDR"&&!e.videoCodec;t=e.preferHDR!==void 0?e.preferHDR:i&&CE(),t||(s=["SDR"])}return{preferHDR:t,allowedVideoRanges:s}}const wE=n=>{const e=new WeakSet;return(t,s)=>{if(n&&(s=n(t,s)),typeof s=="object"&&s!==null){if(e.has(s))return;e.add(s)}return s}},de=(n,e)=>JSON.stringify(n,wE(e));function DE(n,e,t,s,i){const r=Object.keys(n),a=s==null?void 0:s.channels,o=s==null?void 0:s.audioCodec,l=i==null?void 0:i.videoCodec,u=a&&parseInt(a)===2;let c=!1,d=!1,h=1/0,f=1/0,g=1/0,p=1/0,E=0,y=[];const{preferHDR:m,allowedVideoRanges:S}=kE(e,i);for(let R=r.length;R--;){const C=n[r[R]];c||(c=C.channels[2]>0),h=Math.min(h,C.minHeight),f=Math.min(f,C.minFramerate),g=Math.min(g,C.minBitrate),S.filter(P=>C.videoRanges[P]>0).length>0&&(d=!0)}h=j(h)?h:0,f=j(f)?f:0;const T=Math.max(1080,h),A=Math.max(30,f);g=j(g)?g:t,t=Math.max(g,t),d||(e=void 0);const _=r.length>1;return{codecSet:r.reduce((R,C)=>{const I=n[C];if(C===R)return R;if(y=d?S.filter(P=>I.videoRanges[P]>0):[],_){if(I.minBitrate>t)return Ut(C,`min bitrate of ${I.minBitrate} > current estimate of ${t}`),R;if(!I.hasDefaultAudio)return Ut(C,"no renditions with default or auto-select sound found"),R;if(o&&C.indexOf(o.substring(0,4))%5!==0)return Ut(C,`audio codec preference "${o}" not found`),R;if(a&&!u){if(!I.channels[a])return Ut(C,`no renditions with ${a} channel sound found (channels options: ${Object.keys(I.channels)})`),R}else if((!o||u)&&c&&I.channels[2]===0)return Ut(C,"no renditions with stereo sound found"),R;if(I.minHeight>T)return Ut(C,`min resolution of ${I.minHeight} > maximum of ${T}`),R;if(I.minFramerate>A)return Ut(C,`min framerate of ${I.minFramerate} > maximum of ${A}`),R;if(!y.some(P=>I.videoRanges[P]>0))return Ut(C,`no variants with VIDEO-RANGE of ${de(y)} found`),R;if(l&&C.indexOf(l.substring(0,4))%5!==0)return Ut(C,`video codec preference "${l}" not found`),R;if(I.maxScore<E)return Ut(C,`max score of ${I.maxScore} < selected max of ${E}`),R}return R&&(La(C)>=La(R)||I.fragmentError>n[R].fragmentError)?R:(p=I.minIndex,E=I.maxScore,C)},void 0),videoRanges:y,preferHDR:m,minFramerate:f,minBitrate:g,minIndex:p}}function Ut(n,e){oe.log(`[abr] start candidates with "${n}" ignored because ${e}`)}function $p(n){return n.reduce((e,t)=>{let s=e.groups[t.groupId];s||(s=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),s.tracks.push(t);const i=t.channels||"2";return s.channels[i]=(s.channels[i]||0)+1,s.hasDefault=s.hasDefault||t.default,s.hasAutoSelect=s.hasAutoSelect||t.autoselect,s.hasDefault&&(e.hasDefaultAudio=!0),s.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function PE(n,e,t,s){return n.slice(t,s+1).reduce((i,r,a)=>{if(!r.codecSet)return i;const o=r.audioGroups;let l=i[r.codecSet];l||(i[r.codecSet]=l={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:a,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!o,fragmentError:0}),l.minBitrate=Math.min(l.minBitrate,r.bitrate);const u=Math.min(r.height,r.width);return l.minHeight=Math.min(l.minHeight,u),l.minFramerate=Math.min(l.minFramerate,r.frameRate),l.minIndex=Math.min(l.minIndex,a),l.maxScore=Math.max(l.maxScore,r.score),l.fragmentError+=r.fragmentError,l.videoRanges[r.videoRange]=(l.videoRanges[r.videoRange]||0)+1,o&&o.forEach(c=>{if(!c)return;const d=e.groups[c];d&&(l.hasDefaultAudio=l.hasDefaultAudio||e.hasDefaultAudio?d.hasDefault:d.hasAutoSelect||!e.hasDefaultAudio&&!e.hasAutoSelectAudio,Object.keys(d.channels).forEach(h=>{l.channels[h]=(l.channels[h]||0)+d.channels[h]}))}),i},{})}function nh(n){if(!n)return n;const{lang:e,assocLang:t,characteristics:s,channels:i,audioCodec:r}=n;return{lang:e,assocLang:t,characteristics:s,channels:i,audioCodec:r}}function zt(n,e,t){if("attrs"in n){const s=e.indexOf(n);if(s!==-1)return s}for(let s=0;s<e.length;s++){const i=e[s];if(Jn(n,i,t))return s}return-1}function Jn(n,e,t){const{groupId:s,name:i,lang:r,assocLang:a,default:o}=n,l=n.forced;return(s===void 0||e.groupId===s)&&(i===void 0||e.name===i)&&(r===void 0||bE(r,e.lang))&&(r===void 0||e.assocLang===a)&&(o===void 0||e.default===o)&&(l===void 0||e.forced===l)&&(!("characteristics"in n)||NE(n.characteristics||"",e.characteristics))&&(t===void 0||t(n,e))}function bE(n,e="--"){return n.length===e.length?n===e:n.startsWith(e)||e.startsWith(n)}function NE(n,e=""){const t=n.split(","),s=e.split(",");return t.length===s.length&&!t.some(i=>s.indexOf(i)===-1)}function Wn(n,e){const{audioCodec:t,channels:s}=n;return(t===void 0||(e.audioCodec||"").substring(0,4)===t.substring(0,4))&&(s===void 0||s===(e.channels||"2"))}function OE(n,e,t,s,i){const r=e[s],o=e.reduce((h,f,g)=>{const p=f.uri;return(h[p]||(h[p]=[])).push(g),h},{})[r.uri];o.length>1&&(s=Math.max.apply(Math,o));const l=r.videoRange,u=r.frameRate,c=r.codecSet.substring(0,4),d=sh(e,s,h=>{if(h.videoRange!==l||h.frameRate!==u||h.codecSet.substring(0,4)!==c)return!1;const f=h.audioGroups,g=t.filter(p=>!f||f.indexOf(p.groupId)!==-1);return zt(n,g,i)>-1});return d>-1?d:sh(e,s,h=>{const f=h.audioGroups,g=t.filter(p=>!f||f.indexOf(p.groupId)!==-1);return zt(n,g,i)>-1})}function sh(n,e,t){for(let s=e;s>-1;s--)if(t(n[s]))return s;for(let s=e+1;s<n.length;s++)if(t(n[s]))return s;return-1}function _a(n,e){var t;return!!n&&n!==((t=e.loadLevelObj)==null?void 0:t.uri)}class ME extends It{constructor(e){super("abr",e.logger),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.rebufferNotice=-1,this.supportedCache={},this.bwEstimator=void 0,this._abandonRulesCheck=t=>{var s;const{fragCurrent:i,partCurrent:r,hls:a}=this,{autoLevelEnabled:o,media:l}=a;if(!i||!l)return;const u=performance.now(),c=r?r.stats:i.stats,d=r?r.duration:i.duration,h=u-c.loading.start,f=a.minAutoLevel,g=i.level,p=this._nextAutoLevel;if(c.aborted||c.loaded&&c.loaded===c.total||g<=f){this.clearTimer(),this._nextAutoLevel=-1;return}if(!o)return;const E=p>-1&&p!==g,y=!!t||E;if(!y&&(l.paused||!l.playbackRate||!l.readyState))return;const m=a.mainForwardBufferInfo;if(!y&&m===null)return;const S=this.bwEstimator.getEstimateTTFB(),T=Math.abs(l.playbackRate);if(h<=Math.max(S,1e3*(d/(T*2))))return;const A=m?m.len/T:0,_=c.loading.first?c.loading.first-c.loading.start:-1,L=c.loaded&&_>-1,R=this.getBwEstimate(),C=a.levels,I=C[g],P=Math.max(c.loaded,Math.round(d*(i.bitrate||I.averageBitrate)/8));let $=L?h-_:h;$<1&&L&&($=Math.min(h,c.loaded*8/R));const G=L?c.loaded*1e3/$:0,W=S/1e3,K=G?(P-c.loaded)/G:P*8/R+W;if(K<=A)return;const B=G?G*8:R,V=((s=(t==null?void 0:t.details)||this.hls.latestLevelDetails)==null?void 0:s.live)===!0,D=this.hls.config.abrBandWidthUpFactor;let N=Number.POSITIVE_INFINITY,U;for(U=g-1;U>f;U--){const te=C[U].maxBitrate,Z=!C[U].details||V;if(N=this.getTimeToLoadFrag(W,B,d*te,Z),N<Math.min(A,d+W))break}if(N>=K||N>d*10)return;L?this.bwEstimator.sample(h-Math.min(S,_),c.loaded):this.bwEstimator.sampleTTFB(h);const O=C[U].maxBitrate;this.getBwEstimate()*D>O&&this.resetEstimator(O);const M=this.findBestLevel(O,f,U,0,A,1,1);M>-1&&(U=M),this.warn(`Fragment ${i.sn}${r?" part "+r.index:""} of level ${g} is loading too slowly;
      Fragment duration: ${i.duration.toFixed(3)}
      Time to underbuffer: ${A.toFixed(3)} s
      Estimated load time for current fragment: ${K.toFixed(3)} s
      Estimated load time for down switch fragment: ${N.toFixed(3)} s
      TTFB estimate: ${_|0} ms
      Current BW estimate: ${j(R)?R|0:"Unknown"} bps
      New BW estimate: ${this.getBwEstimate()|0} bps
      Switching to level ${U} @ ${O|0} bps`),a.nextLoadLevel=a.nextAutoLevel=U,this.clearTimer();const Q=()=>{if(this.clearTimer(),this.fragCurrent===i&&this.hls.loadLevel===U&&U>0){const te=this.getStarvationDelay();if(this.warn(`Aborting inflight request ${U>0?"and switching down":""}
      Fragment duration: ${i.duration.toFixed(3)} s
      Time to underbuffer: ${te.toFixed(3)} s`),i.abortRequests(),this.fragCurrent=this.partCurrent=null,U>f){let Z=this.findBestLevel(this.hls.levels[f].bitrate,f,U,0,te,1,1);Z===-1&&(Z=f),this.hls.nextLoadLevel=this.hls.nextAutoLevel=Z,this.resetEstimator(this.hls.levels[Z].bitrate)}}};E||K>N*2?Q():this.timer=self.setInterval(Q,N*1e3),a.trigger(v.FRAG_LOAD_EMERGENCY_ABORTED,{frag:i,part:r,stats:c})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(this.log(`setting initial bwe to ${e}`),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const e=this.hls.config;return new jv(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){const{hls:e}=this;e.on(v.MANIFEST_LOADING,this.onManifestLoading,this),e.on(v.FRAG_LOADING,this.onFragLoading,this),e.on(v.FRAG_LOADED,this.onFragLoaded,this),e.on(v.FRAG_BUFFERED,this.onFragBuffered,this),e.on(v.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(v.LEVEL_LOADED,this.onLevelLoaded,this),e.on(v.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(v.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(v.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e&&(e.off(v.MANIFEST_LOADING,this.onManifestLoading,this),e.off(v.FRAG_LOADING,this.onFragLoading,this),e.off(v.FRAG_LOADED,this.onFragLoaded,this),e.off(v.FRAG_BUFFERED,this.onFragBuffered,this),e.off(v.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(v.LEVEL_LOADED,this.onLevelLoaded,this),e.off(v.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(v.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(v.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=this.supportedCache=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.supportedCache={},this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,t){const s=t.frag;if(!this.ignoreFragment(s)){if(!s.bitrateTest){var i;this.fragCurrent=s,this.partCurrent=(i=t.part)!=null?i:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,t){this.clearTimer()}onError(e,t){if(!t.fatal)switch(t.details){case w.BUFFER_ADD_CODEC_ERROR:case w.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case w.FRAG_LOAD_TIMEOUT:{const s=t.frag,{fragCurrent:i,partCurrent:r}=this;if(s&&i&&s.sn===i.sn&&s.level===i.level){const a=performance.now(),o=r?r.stats:s.stats,l=a-o.loading.start,u=o.loading.first?o.loading.first-o.loading.start:-1;if(o.loaded&&u>-1){const d=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(l-Math.min(d,u),o.loaded)}else this.bwEstimator.sampleTTFB(l)}break}}}getTimeToLoadFrag(e,t,s,i){const r=e+s/t,a=i?e+this.lastLevelLoadSec:0;return r+a}onLevelLoaded(e,t){const s=this.hls.config,{loading:i}=t.stats,r=i.end-i.first;j(r)&&(this.lastLevelLoadSec=r/1e3),t.details.live?this.bwEstimator.update(s.abrEwmaSlowLive,s.abrEwmaFastLive):this.bwEstimator.update(s.abrEwmaSlowVoD,s.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(t.levelInfo)}onFragLoaded(e,{frag:t,part:s}){const i=s?s.stats:t.stats;if(t.type===H.MAIN&&this.bwEstimator.sampleTTFB(i.loading.first-i.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),t.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const r=s?s.duration:t.duration,a=this.hls.levels[t.level],o=(a.loaded?a.loaded.bytes:0)+i.loaded,l=(a.loaded?a.loaded.duration:0)+r;a.loaded={bytes:o,duration:l},a.realBitrate=Math.round(8*o/l)}if(t.bitrateTest){const r={stats:i,frag:t,part:s,id:t.type};this.onFragBuffered(v.FRAG_BUFFERED,r),t.bitrateTest=!1}else this.lastLoadedFragLevel=t.level}}onFragBuffered(e,t){const{frag:s,part:i}=t,r=i!=null&&i.stats.loaded?i.stats:s.stats;if(r.aborted||this.ignoreFragment(s))return;const a=r.parsing.end-r.loading.start-Math.min(r.loading.first-r.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(a,r.loaded),r.bwEstimate=this.getBwEstimate(),s.bitrateTest?this.bitrateTestDelay=a/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==H.MAIN||e.sn==="initSegment"}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:e,minAutoLevel:t}=this.hls,s=this.getBwEstimate(),i=this.hls.config.maxStarvationDelay,r=this.findBestLevel(s,t,e,0,i,1,1);if(r>-1)return r;const a=this.hls.firstLevel,o=Math.min(Math.max(a,t),e);return this.warn(`Could not find best starting auto level. Defaulting to first in playlist ${a} clamped to ${o}`),o}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const e=this.forcedAutoLevel,s=this.bwEstimator.canEstimate(),i=this.lastLoadedFragLevel>-1;if(e!==-1&&(!s||!i||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;const r=s&&i?this.getNextABRAutoLevel():this.firstAutoLevel;if(e!==-1){const a=this.hls.levels;if(a.length>Math.max(e,r)&&a[e].loadError<=a[r].loadError)return e}return this._nextAutoLevel=r,this.nextAutoLevelKey=this.getAutoLevelKey(),r}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:s}=this;if(s.levels.length<=1)return s.loadLevel;const{maxAutoLevel:i,config:r,minAutoLevel:a}=s,o=t?t.duration:e?e.duration:0,l=this.getBwEstimate(),u=this.getStarvationDelay();let c=r.abrBandWidthFactor,d=r.abrBandWidthUpFactor;if(u){const E=this.findBestLevel(l,a,i,u,0,c,d);if(E>=0)return this.rebufferNotice=-1,E}let h=o?Math.min(o,r.maxStarvationDelay):r.maxStarvationDelay;if(!u){const E=this.bitrateTestDelay;E&&(h=(o?Math.min(o,r.maxLoadingDelay):r.maxLoadingDelay)-E,this.info(`bitrate test took ${Math.round(1e3*E)}ms, set first fragment max fetchDuration to ${Math.round(1e3*h)} ms`),c=d=1)}const f=this.findBestLevel(l,a,i,u,h,c,d);if(this.rebufferNotice!==f&&(this.rebufferNotice=f,this.info(`${u?"rebuffering expected":"buffer is empty"}, optimal quality level ${f}`)),f>-1)return f;const g=s.levels[a],p=s.loadLevelObj;return p&&(g==null?void 0:g.bitrate)<p.bitrate?a:s.loadLevel}getStarvationDelay(){const e=this.hls,t=e.media;if(!t)return 1/0;const s=t&&t.playbackRate!==0?Math.abs(t.playbackRate):1,i=e.mainForwardBufferInfo;return(i?i.len:0)/s}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,t,s,i,r,a,o){var l;const u=i+r,c=this.lastLoadedFragLevel,d=c===-1?this.hls.firstLevel:c,{fragCurrent:h,partCurrent:f}=this,{levels:g,allAudioTracks:p,loadLevel:E,config:y}=this.hls;if(g.length===1)return 0;const m=g[d],S=!!((l=this.hls.latestLevelDetails)!=null&&l.live),T=E===-1||c===-1;let A,_="SDR",L=(m==null?void 0:m.frameRate)||0;const{audioPreference:R,videoPreference:C}=y,I=this.audioTracksByGroup||(this.audioTracksByGroup=$p(p));let P=-1;if(T){if(this.firstSelection!==-1)return this.firstSelection;const B=this.codecTiers||(this.codecTiers=PE(g,I,t,s)),V=DE(B,_,e,R,C),{codecSet:D,videoRanges:N,minFramerate:U,minBitrate:O,minIndex:M,preferHDR:Q}=V;P=M,A=D,_=Q?N[N.length-1]:N[0],L=U,e=Math.max(e,O),this.log(`picked start tier ${de(V)}`)}else A=m==null?void 0:m.codecSet,_=m==null?void 0:m.videoRange;const $=f?f.duration:h?h.duration:0,G=this.bwEstimator.getEstimateTTFB()/1e3,W=[];for(let B=s;B>=t;B--){var K;const V=g[B],D=B>d;if(!V)continue;if(y.useMediaCapabilities&&!V.supportedResult&&!V.supportedPromise){const Z=navigator.mediaCapabilities;typeof(Z==null?void 0:Z.decodingInfo)=="function"&&SE(V,I,_,L,e,R)?(V.supportedPromise=Bp(V,I,Z,this.supportedCache),V.supportedPromise.then(J=>{if(!this.hls)return;V.supportedResult=J;const Ae=this.hls.levels,Oe=Ae.indexOf(V);J.error?this.warn(`MediaCapabilities decodingInfo error: "${J.error}" for level ${Oe} ${de(J)}`):J.supported?J.decodingInfoResults.some(mt=>mt.smooth===!1||mt.powerEfficient===!1)&&this.log(`MediaCapabilities decodingInfo for level ${Oe} not smooth or powerEfficient: ${de(J)}`):(this.warn(`Unsupported MediaCapabilities decodingInfo result for level ${Oe} ${de(J)}`),Oe>-1&&Ae.length>1&&(this.log(`Removing unsupported level ${Oe}`),this.hls.removeLevel(Oe),this.hls.loadLevel===-1&&(this.hls.nextLoadLevel=0)))}).catch(J=>{this.warn(`Error handling MediaCapabilities decodingInfo: ${J}`)})):V.supportedResult=Mp}if((A&&V.codecSet!==A||_&&V.videoRange!==_||D&&L>V.frameRate||!D&&L>0&&L<V.frameRate||(K=V.supportedResult)!=null&&(K=K.decodingInfoResults)!=null&&K.some(Z=>Z.smooth===!1))&&(!T||B!==P)){W.push(B);continue}const N=V.details,U=(f?N==null?void 0:N.partTarget:N==null?void 0:N.averagetargetduration)||$;let O;D?O=o*e:O=a*e;const M=$&&i>=$*2&&r===0?V.averageBitrate:V.maxBitrate,Q=this.getTimeToLoadFrag(G,O,M*U,N===void 0);if(O>=M&&(B===c||V.loadError===0&&V.fragmentError===0)&&(Q<=G||!j(Q)||S&&!this.bitrateTestDelay||Q<u)){const Z=this.forcedAutoLevel;return B!==E&&(Z===-1||Z!==E)&&(W.length&&this.trace(`Skipped level(s) ${W.join(",")} of ${s} max with CODECS and VIDEO-RANGE:"${g[W[0]].codecs}" ${g[W[0]].videoRange}; not compatible with "${A}" ${_}`),this.info(`switch candidate:${d}->${B} adjustedbw(${Math.round(O)})-bitrate=${Math.round(O-M)} ttfb:${G.toFixed(1)} avgDuration:${U.toFixed(1)} maxFetchDuration:${u.toFixed(1)} fetchDuration:${Q.toFixed(1)} firstSelection:${T} codecSet:${V.codecSet} videoRange:${V.videoRange} hls.loadLevel:${E}`)),T&&(this.firstSelection=B),B}}return-1}set nextAutoLevel(e){const t=this.deriveNextAutoLevel(e);this._nextAutoLevel!==t&&(this.nextAutoLevelKey="",this._nextAutoLevel=t)}deriveNextAutoLevel(e){const{maxAutoLevel:t,minAutoLevel:s}=this.hls;return Math.min(Math.max(e,s),t)}}const jp={search:function(n,e){let t=0,s=n.length-1,i=null,r=null;for(;t<=s;){i=(t+s)/2|0,r=n[i];const a=e(r);if(a>0)t=i+1;else if(a<0)s=i-1;else return r}return null}};function FE(n,e,t){if(e===null||!Array.isArray(n)||!n.length||!j(e))return null;const s=n[0].programDateTime;if(e<(s||0))return null;const i=n[n.length-1].endProgramDateTime;if(e>=(i||0))return null;for(let r=0;r<n.length;++r){const a=n[r];if(UE(e,t,a))return a}return null}function rs(n,e,t=0,s=0,i=.005){let r=null;if(n){r=e[1+n.sn-e[0].sn]||null;const o=n.endDTS-t;o>0&&o<15e-7&&(t+=15e-7),r&&n.level!==r.level&&r.end<=n.end&&(r=e[2+n.sn-e[0].sn]||null)}else t===0&&e[0].start===0&&(r=e[0]);if(r&&((!n||n.level===r.level)&&ih(t,s,r)===0||BE(r,n,Math.min(i,s))))return r;const a=jp.search(e,ih.bind(null,t,s));return a&&(a!==n||!r)?a:r}function BE(n,e,t){if(e&&e.start===0&&e.level<n.level&&(e.endPTS||0)>0){const s=e.tagList.reduce((i,r)=>(r[0]==="INF"&&(i+=parseFloat(r[1])),i),t);return n.start<=s}return!1}function ih(n=0,e=0,t){if(t.start<=n&&t.start+t.duration>n)return 0;const s=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0));return t.start+t.duration-s<=n?1:t.start-s>n&&t.start?-1:0}function UE(n,e,t){const s=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0))*1e3;return(t.endProgramDateTime||0)-s>n}function Gp(n,e,t){if(n&&n.startCC<=e&&n.endCC>=e){let s=n.fragments;const{fragmentHint:i}=n;i&&(s=s.concat(i));let r;return jp.search(s,a=>a.cc<e?1:a.cc>e?-1:(r=a,a.end<=t?1:a.start>t?-1:0)),r||null}return null}function Ca(n){switch(n.details){case w.FRAG_LOAD_TIMEOUT:case w.KEY_LOAD_TIMEOUT:case w.LEVEL_LOAD_TIMEOUT:case w.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function Kp(n){return n.details.startsWith("key")}function Vp(n){return Kp(n)&&!!n.frag&&!n.frag.decryptdata}function rh(n,e){const t=Ca(e);return n.default[`${t?"timeout":"error"}Retry`]}function dc(n,e){const t=n.backoff==="linear"?1:Math.pow(2,e);return Math.min(t*n.retryDelayMs,n.maxRetryDelayMs)}function ah(n){return ae(ae({},n),{errorRetry:null,timeoutRetry:null})}function ka(n,e,t,s){if(!n)return!1;const i=s==null?void 0:s.code,r=e<n.maxNumRetry&&($E(i)||!!t);return n.shouldRetry?n.shouldRetry(n,e,t,s,r):r}function $E(n){return ql(n)||!!n&&(n<400||n>499)}function ql(n){return n===0&&navigator.onLine===!1}var Fe={DoNothing:0,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,RetryRequest:5},at={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,MoveAllAlternatesMatchingKey:4};class jE extends It{constructor(e){super("error-controller",e.logger),this.hls=void 0,this.playlistError=0,this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(v.ERROR,this.onError,this),e.on(v.MANIFEST_LOADING,this.onManifestLoading,this),e.on(v.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off(v.ERROR,this.onError,this),e.off(v.ERROR,this.onErrorOut,this),e.off(v.MANIFEST_LOADING,this.onManifestLoading,this),e.off(v.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return(e==null?void 0:e.type)===H.MAIN?e.level:this.getVariantIndex()}getVariantIndex(){var e;const t=this.hls,s=t.currentLevel;return(e=t.loadLevelObj)!=null&&e.details||s===-1?t.loadLevel:s}variantHasKey(e,t){if(e){var s;if((s=e.details)!=null&&s.hasKey(t))return!0;const i=e.audioGroups;if(i)return this.hls.allAudioTracks.filter(a=>i.indexOf(a.groupId)>=0).some(a=>{var o;return(o=a.details)==null?void 0:o.hasKey(t)})}return!1}onManifestLoading(){this.playlistError=0}onLevelUpdated(){this.playlistError=0}onError(e,t){var s;if(t.fatal)return;const i=this.hls,r=t.context;switch(t.details){case w.FRAG_LOAD_ERROR:case w.FRAG_LOAD_TIMEOUT:case w.KEY_LOAD_ERROR:case w.KEY_LOAD_TIMEOUT:t.errorAction=this.getFragRetryOrSwitchAction(t);return;case w.FRAG_PARSING_ERROR:if((s=t.frag)!=null&&s.gap){t.errorAction=Ms();return}case w.FRAG_GAP:case w.FRAG_DECRYPT_ERROR:{t.errorAction=this.getFragRetryOrSwitchAction(t),t.errorAction.action=Fe.SendAlternateToPenaltyBox;return}case w.LEVEL_EMPTY_ERROR:case w.LEVEL_PARSING_ERROR:{var a;const l=t.parent===H.MAIN?t.level:i.loadLevel;t.details===w.LEVEL_EMPTY_ERROR&&((a=t.context)!=null&&(a=a.levelDetails)!=null&&a.live)?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,l):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,l))}return;case w.LEVEL_LOAD_ERROR:case w.LEVEL_LOAD_TIMEOUT:typeof(r==null?void 0:r.level)=="number"&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,r.level));return;case w.AUDIO_TRACK_LOAD_ERROR:case w.AUDIO_TRACK_LOAD_TIMEOUT:case w.SUBTITLE_LOAD_ERROR:case w.SUBTITLE_TRACK_LOAD_TIMEOUT:if(r){const l=i.loadLevelObj;if(l&&(r.type===ne.AUDIO_TRACK&&l.hasAudioGroup(r.groupId)||r.type===ne.SUBTITLE_TRACK&&l.hasSubtitleGroup(r.groupId))){t.errorAction=this.getPlaylistRetryOrSwitchAction(t,i.loadLevel),t.errorAction.action=Fe.SendAlternateToPenaltyBox,t.errorAction.flags=at.MoveAllAlternatesMatchingHost;return}}return;case w.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:t.errorAction={action:Fe.SendAlternateToPenaltyBox,flags:at.MoveAllAlternatesMatchingHDCP};return;case w.KEY_SYSTEM_SESSION_UPDATE_FAILED:case w.KEY_SYSTEM_STATUS_INTERNAL_ERROR:case w.KEY_SYSTEM_NO_SESSION:t.errorAction={action:Fe.SendAlternateToPenaltyBox,flags:at.MoveAllAlternatesMatchingKey};return;case w.BUFFER_ADD_CODEC_ERROR:case w.REMUX_ALLOC_ERROR:case w.BUFFER_APPEND_ERROR:if(!t.errorAction){var o;t.errorAction=this.getLevelSwitchAction(t,(o=t.level)!=null?o:i.loadLevel)}return;case w.INTERNAL_EXCEPTION:case w.BUFFER_APPENDING_ERROR:case w.BUFFER_FULL_ERROR:case w.LEVEL_SWITCH_ERROR:case w.BUFFER_STALLED_ERROR:case w.BUFFER_SEEK_OVER_HOLE:case w.BUFFER_NUDGE_ON_STALL:t.errorAction=Ms();return}t.type===Y.KEY_SYSTEM_ERROR&&(t.levelRetry=!1,t.errorAction=Ms())}getPlaylistRetryOrSwitchAction(e,t){const s=this.hls,i=rh(s.config.playlistLoadPolicy,e),r=this.playlistError++;if(ka(i,r,Ca(e),e.response))return{action:Fe.RetryRequest,flags:at.None,retryConfig:i,retryCount:r};const o=this.getLevelSwitchAction(e,t);return i&&(o.retryConfig=i,o.retryCount=r),o}getFragRetryOrSwitchAction(e){const t=this.hls,s=this.getVariantLevelIndex(e.frag),i=t.levels[s],{fragLoadPolicy:r,keyLoadPolicy:a}=t.config,o=rh(Kp(e)?a:r,e),l=t.levels.reduce((c,d)=>c+d.fragmentError,0);if(i&&(e.details!==w.FRAG_GAP&&i.fragmentError++,!Vp(e)&&ka(o,l,Ca(e),e.response)))return{action:Fe.RetryRequest,flags:at.None,retryConfig:o,retryCount:l};const u=this.getLevelSwitchAction(e,s);return o&&(u.retryConfig=o,u.retryCount=l),u}getLevelSwitchAction(e,t){const s=this.hls;t==null&&(t=s.loadLevel);const i=this.hls.levels[t];if(i){var r,a;const u=e.details;i.loadError++,u===w.BUFFER_APPEND_ERROR&&i.fragmentError++;let c=-1;const{levels:d,loadLevel:h,minAutoLevel:f,maxAutoLevel:g}=s;!s.autoLevelEnabled&&!s.config.preserveManualLevelOnError&&(s.loadLevel=-1);const p=(r=e.frag)==null?void 0:r.type,y=(p===H.AUDIO&&u===w.FRAG_PARSING_ERROR||e.sourceBufferName==="audio"&&(u===w.BUFFER_ADD_CODEC_ERROR||u===w.BUFFER_APPEND_ERROR))&&d.some(({audioCodec:_})=>i.audioCodec!==_),S=e.sourceBufferName==="video"&&(u===w.BUFFER_ADD_CODEC_ERROR||u===w.BUFFER_APPEND_ERROR)&&d.some(({codecSet:_,audioCodec:L})=>i.codecSet!==_&&i.audioCodec===L),{type:T,groupId:A}=(a=e.context)!=null?a:{};for(let _=d.length;_--;){const L=(_+h)%d.length;if(L!==h&&L>=f&&L<=g&&d[L].loadError===0){var o,l;const R=d[L];if(u===w.FRAG_GAP&&p===H.MAIN&&e.frag){const C=d[L].details;if(C){const I=rs(e.frag,C.fragments,e.frag.start);if(I!=null&&I.gap)continue}}else{if(T===ne.AUDIO_TRACK&&R.hasAudioGroup(A)||T===ne.SUBTITLE_TRACK&&R.hasSubtitleGroup(A))continue;if(p===H.AUDIO&&(o=i.audioGroups)!=null&&o.some(C=>R.hasAudioGroup(C))||p===H.SUBTITLE&&(l=i.subtitleGroups)!=null&&l.some(C=>R.hasSubtitleGroup(C))||y&&i.audioCodec===R.audioCodec||S&&i.codecSet===R.codecSet||!y&&i.codecSet!==R.codecSet)continue}c=L;break}}if(c>-1&&s.loadLevel!==c)return e.levelRetry=!0,this.playlistError=0,{action:Fe.SendAlternateToPenaltyBox,flags:at.None,nextAutoLevel:c}}return{action:Fe.SendAlternateToPenaltyBox,flags:at.MoveAllAlternatesMatchingHost}}onErrorOut(e,t){var s;switch((s=t.errorAction)==null?void 0:s.action){case Fe.DoNothing:break;case Fe.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(t),!t.errorAction.resolved&&t.details!==w.FRAG_GAP?t.fatal=!0:/MediaSource readyState: ended/.test(t.error.message)&&(this.warn(`MediaSource ended after "${t.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError());break}if(t.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(e){const t=this.hls,s=e.errorAction;if(!s)return;const{flags:i}=s,r=s.nextAutoLevel;switch(i){case at.None:this.switchLevel(e,r);break;case at.MoveAllAlternatesMatchingHDCP:{const l=this.getVariantLevelIndex(e.frag),u=t.levels[l],c=u==null?void 0:u.attrs["HDCP-LEVEL"];if(s.hdcpLevel=c,c==="NONE")this.warn("HDCP policy resticted output with HDCP-LEVEL=NONE");else if(c){t.maxHdcpLevel=Yl[Yl.indexOf(c)-1],s.resolved=!0,this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`);break}}case at.MoveAllAlternatesMatchingKey:{const l=e.decryptdata;if(l){const u=this.hls.levels,c=u.length;for(let h=c;h--;)if(this.variantHasKey(u[h],l)){var a,o;this.log(`Banned key found in level ${h} (${u[h].bitrate}bps) or audio group "${(a=u[h].audioGroups)==null?void 0:a.join(",")}" (${(o=e.frag)==null?void 0:o.type} fragment) ${Be(l.keyId||[])}`),u[h].fragmentError++,u[h].loadError++,this.log(`Removing level ${h} with key error (${e.error})`),this.hls.removeLevel(h)}const d=e.frag;if(this.hls.levels.length<c)s.resolved=!0;else if(d&&d.type!==H.MAIN){const h=d.decryptdata;h&&!l.matches(h)&&(s.resolved=!0)}}break}}s.resolved||this.switchLevel(e,r)}switchLevel(e,t){if(t!==void 0&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,e.details===w.BUFFER_ADD_CODEC_ERROR&&e.mimeType&&e.sourceBufferName!=="audiovideo")){const s=Wl(e.mimeType),i=this.hls.levels;for(let r=i.length;r--;)i[r][`${e.sourceBufferName}Codec`]===s&&(this.log(`Removing level ${r} for ${e.details} ("${s}" not supported)`),this.hls.removeLevel(r))}}}function Ms(n){const e={action:Fe.DoNothing,flags:at.None};return n&&(e.resolved=!0),e}var we={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class GE{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e&&(e.on(v.MANIFEST_LOADING,this.onManifestLoading,this),e.on(v.BUFFER_APPENDED,this.onBufferAppended,this),e.on(v.FRAG_BUFFERED,this.onFragBuffered,this),e.on(v.FRAG_LOADED,this.onFragLoaded,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(v.MANIFEST_LOADING,this.onManifestLoading,this),e.off(v.BUFFER_APPENDED,this.onBufferAppended,this),e.off(v.FRAG_BUFFERED,this.onFragBuffered,this),e.off(v.FRAG_LOADED,this.onFragLoaded,this))}destroy(){this._unregisterListeners(),this.hls=this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){const s=this.activePartLists[t];if(s)for(let i=s.length;i--;){const r=s[i];if(!r)break;if(r.start<=e&&e<=r.end&&r.loaded)return r}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){return this.getFragAtPos(e,t,!0)}getFragAtPos(e,t,s){const{fragments:i}=this,r=Object.keys(i);for(let a=r.length;a--;){const o=i[r[a]];if((o==null?void 0:o.body.type)===t&&(!s||o.buffered)){const l=o.body;if(l.start<=e&&e<=l.end)return l}}return null}detectEvictedFragments(e,t,s,i,r){this.timeRanges&&(this.timeRanges[e]=t);const a=(i==null?void 0:i.fragment.sn)||-1;Object.keys(this.fragments).forEach(o=>{const l=this.fragments[o];if(!l||a>=l.body.sn)return;if(!l.buffered&&(!l.loaded||r)){l.body.type===s&&this.removeFragment(l.body);return}const u=l.range[e];if(u){if(u.time.length===0){this.removeFragment(l.body);return}u.time.some(c=>{const d=!this.isTimeBuffered(c.startPTS,c.endPTS,t);return d&&this.removeFragment(l.body),d})}})}detectPartialFragments(e){const t=this.timeRanges;if(!t||e.frag.sn==="initSegment")return;const s=e.frag,i=hs(s),r=this.fragments[i];if(!r||r.buffered&&s.gap)return;const a=!s.relurl;Object.keys(t).forEach(o=>{const l=s.elementaryStreams[o];if(!l)return;const u=t[o],c=a||l.partial===!0;r.range[o]=this.getBufferedTimes(s,e.part,c,u)}),r.loaded=null,Object.keys(r.range).length?(this.bufferedEnd(r,s),Sr(r)||this.removeParts(s.sn-1,s.type)):this.removeFragment(r.body)}bufferedEnd(e,t){e.buffered=!0,(e.body.endList=t.endList||e.body.endList)&&(this.endListFragments[e.body.type]=e)}removeParts(e,t){const s=this.activePartLists[t];s&&(this.activePartLists[t]=oh(s,i=>i.fragment.sn>=e))}fragBuffered(e,t){const s=hs(e);let i=this.fragments[s];!i&&t&&(i=this.fragments[s]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),i&&(i.loaded=null,this.bufferedEnd(i,e))}getBufferedTimes(e,t,s,i){const r={time:[],partial:s},a=e.start,o=e.end,l=e.minEndPTS||o,u=e.maxStartPTS||a;for(let c=0;c<i.length;c++){const d=i.start(c)-this.bufferPadding,h=i.end(c)+this.bufferPadding;if(u>=d&&l<=h){r.time.push({startPTS:Math.max(a,i.start(c)),endPTS:Math.min(o,i.end(c))});break}else if(a<h&&o>d){const f=Math.max(a,i.start(c)),g=Math.min(o,i.end(c));g>f&&(r.partial=!0,r.time.push({startPTS:f,endPTS:g}))}else if(o<=d)break}return r}getPartialFragment(e){let t=null,s,i,r,a=0;const{bufferPadding:o,fragments:l}=this;return Object.keys(l).forEach(u=>{const c=l[u];c&&Sr(c)&&(i=c.body.start-o,r=c.body.end+o,e>=i&&e<=r&&(s=Math.min(e-i,r-e),a<=s&&(t=c.body,a=s)))}),t}isEndListAppended(e){const t=this.endListFragments[e];return t!==void 0&&(t.buffered||Sr(t))}getState(e){const t=hs(e),s=this.fragments[t];return s?s.buffered?Sr(s)?we.PARTIAL:we.OK:we.APPENDING:we.NOT_LOADED}isTimeBuffered(e,t,s){let i,r;for(let a=0;a<s.length;a++){if(i=s.start(a)-this.bufferPadding,r=s.end(a)+this.bufferPadding,e>=i&&t<=r)return!0;if(t<=i)return!1}return!1}onManifestLoading(){this.removeAllFragments()}onFragLoaded(e,t){if(t.frag.sn==="initSegment"||t.frag.bitrateTest)return;const s=t.frag,i=t.part?null:t,r=hs(s);this.fragments[r]={body:s,appendedPTS:null,loaded:i,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:s,part:i,timeRanges:r,type:a}=t;if(s.sn==="initSegment")return;const o=s.type;if(i){let u=this.activePartLists[o];u||(this.activePartLists[o]=u=[]),u.push(i)}this.timeRanges=r;const l=r[a];this.detectEvictedFragments(a,l,o,i)}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=hs(e);return!!this.fragments[t]}hasFragments(e){const{fragments:t}=this,s=Object.keys(t);if(!e)return s.length>0;for(let i=s.length;i--;){const r=t[s[i]];if((r==null?void 0:r.body.type)===e)return!0}return!1}hasParts(e){var t;return!!((t=this.activePartLists[e])!=null&&t.length)}removeFragmentsInRange(e,t,s,i,r){i&&!this.hasGaps||Object.keys(this.fragments).forEach(a=>{const o=this.fragments[a];if(!o)return;const l=o.body;l.type!==s||i&&!l.gap||l.start<t&&l.end>e&&(o.buffered||r)&&this.removeFragment(l)})}removeFragment(e){const t=hs(e);e.clearElementaryStreamInfo();const s=this.activePartLists[e.type];if(s){const i=e.sn;this.activePartLists[e.type]=oh(s,r=>r.fragment.sn!==i)}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){var e;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;const t=(e=this.hls)==null||(e=e.latestLevelDetails)==null?void 0:e.partList;t&&t.forEach(s=>s.clearElementaryStreamInfo())}}function Sr(n){var e,t,s;return n.buffered&&!!(n.body.gap||(e=n.range.video)!=null&&e.partial||(t=n.range.audio)!=null&&t.partial||(s=n.range.audiovideo)!=null&&s.partial)}function hs(n){return`${n.type}_${n.level}_${n.sn}`}function oh(n,e){return n.filter(t=>{const s=e(t);return s||t.clearElementaryStreamInfo(),s})}var Mn={cbc:0,ctr:1};class KE{constructor(e,t,s){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=e,this.aesIV=t,this.aesMode=s}decrypt(e,t){switch(this.aesMode){case Mn.cbc:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e);case Mn.ctr:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},t,e);default:throw new Error(`[AESCrypto] invalid aes mode ${this.aesMode}`)}}}function VE(n){const e=n.byteLength,t=e&&new DataView(n.buffer).getUint8(e-1);return t?n.slice(0,e-t):n}class HE{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),s=new Uint32Array(4);for(let i=0;i<4;i++)s[i]=t.getUint32(i*4);return s}initTable(){const e=this.sBox,t=this.invSBox,s=this.subMix,i=s[0],r=s[1],a=s[2],o=s[3],l=this.invSubMix,u=l[0],c=l[1],d=l[2],h=l[3],f=new Uint32Array(256);let g=0,p=0,E=0;for(E=0;E<256;E++)E<128?f[E]=E<<1:f[E]=E<<1^283;for(E=0;E<256;E++){let y=p^p<<1^p<<2^p<<3^p<<4;y=y>>>8^y&255^99,e[g]=y,t[y]=g;const m=f[g],S=f[m],T=f[S];let A=f[y]*257^y*16843008;i[g]=A<<24|A>>>8,r[g]=A<<16|A>>>16,a[g]=A<<8|A>>>24,o[g]=A,A=T*16843009^S*65537^m*257^g*16843008,u[y]=A<<24|A>>>8,c[y]=A<<16|A>>>16,d[y]=A<<8|A>>>24,h[y]=A,g?(g=m^f[f[f[T^m]]],p^=f[f[p]]):g=p=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let s=!0,i=0;for(;i<t.length&&s;)s=t[i]===this.key[i],i++;if(s)return;this.key=t;const r=this.keySize=t.length;if(r!==4&&r!==6&&r!==8)throw new Error("Invalid aes key size="+r);const a=this.ksRows=(r+6+1)*4;let o,l;const u=this.keySchedule=new Uint32Array(a),c=this.invKeySchedule=new Uint32Array(a),d=this.sBox,h=this.rcon,f=this.invSubMix,g=f[0],p=f[1],E=f[2],y=f[3];let m,S;for(o=0;o<a;o++){if(o<r){m=u[o]=t[o];continue}S=m,o%r===0?(S=S<<8|S>>>24,S=d[S>>>24]<<24|d[S>>>16&255]<<16|d[S>>>8&255]<<8|d[S&255],S^=h[o/r|0]<<24):r>6&&o%r===4&&(S=d[S>>>24]<<24|d[S>>>16&255]<<16|d[S>>>8&255]<<8|d[S&255]),u[o]=m=(u[o-r]^S)>>>0}for(l=0;l<a;l++)o=a-l,l&3?S=u[o]:S=u[o-4],l<4||o<=4?c[l]=S:c[l]=g[d[S>>>24]]^p[d[S>>>16&255]]^E[d[S>>>8&255]]^y[d[S&255]],c[l]=c[l]>>>0}networkToHostOrderSwap(e){return e<<24|(e&65280)<<8|(e&16711680)>>8|e>>>24}decrypt(e,t,s){const i=this.keySize+6,r=this.invKeySchedule,a=this.invSBox,o=this.invSubMix,l=o[0],u=o[1],c=o[2],d=o[3],h=this.uint8ArrayToUint32Array_(s);let f=h[0],g=h[1],p=h[2],E=h[3];const y=new Int32Array(e),m=new Int32Array(y.length);let S,T,A,_,L,R,C,I,P,$,G,W,K,B;const V=this.networkToHostOrderSwap;for(;t<y.length;){for(P=V(y[t]),$=V(y[t+1]),G=V(y[t+2]),W=V(y[t+3]),L=P^r[0],R=W^r[1],C=G^r[2],I=$^r[3],K=4,B=1;B<i;B++)S=l[L>>>24]^u[R>>16&255]^c[C>>8&255]^d[I&255]^r[K],T=l[R>>>24]^u[C>>16&255]^c[I>>8&255]^d[L&255]^r[K+1],A=l[C>>>24]^u[I>>16&255]^c[L>>8&255]^d[R&255]^r[K+2],_=l[I>>>24]^u[L>>16&255]^c[R>>8&255]^d[C&255]^r[K+3],L=S,R=T,C=A,I=_,K=K+4;S=a[L>>>24]<<24^a[R>>16&255]<<16^a[C>>8&255]<<8^a[I&255]^r[K],T=a[R>>>24]<<24^a[C>>16&255]<<16^a[I>>8&255]<<8^a[L&255]^r[K+1],A=a[C>>>24]<<24^a[I>>16&255]<<16^a[L>>8&255]<<8^a[R&255]^r[K+2],_=a[I>>>24]<<24^a[L>>16&255]<<16^a[R>>8&255]<<8^a[C&255]^r[K+3],m[t]=V(S^f),m[t+1]=V(_^g),m[t+2]=V(A^p),m[t+3]=V(T^E),f=P,g=$,p=G,E=W,t=t+4}return m.buffer}}class zE{constructor(e,t,s){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=e,this.key=t,this.aesMode=s}expandKey(){const e=WE(this.aesMode);return this.subtle.importKey("raw",this.key,{name:e},!1,["encrypt","decrypt"])}}function WE(n){switch(n){case Mn.cbc:return"AES-CBC";case Mn.ctr:return"AES-CTR";default:throw new Error(`[FastAESKey] invalid aes mode ${n}`)}}const YE=16;class hc{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const s=self.crypto;s&&(this.subtle=s.subtle||s.webkitSubtle)}catch{}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const s=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?VE(s):s}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,s,i){return this.useSoftware?new Promise((r,a)=>{const o=ArrayBuffer.isView(e)?e:new Uint8Array(e);this.softwareDecrypt(o,t,s,i);const l=this.flush();l?r(l.buffer):a(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,s,i)}softwareDecrypt(e,t,s,i){const{currentIV:r,currentResult:a,remainderData:o}=this;if(i!==Mn.cbc||t.byteLength!==16)return oe.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),o&&(e=Lt(o,e),this.remainderData=null);const l=this.getValidChunk(e);if(!l.length)return null;r&&(s=r);let u=this.softwareDecrypter;u||(u=this.softwareDecrypter=new HE),u.expandKey(t);const c=a;return this.currentResult=u.decrypt(l.buffer,0,s),this.currentIV=l.slice(-16).buffer,c||null}webCryptoDecrypt(e,t,s,i){if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,t,s,i));this.key=t,this.fastAesKey=new zE(this.subtle,t,i)}return this.fastAesKey.expandKey().then(r=>this.subtle?(this.logOnce("WebCrypto AES decrypt"),new KE(this.subtle,new Uint8Array(s),i).decrypt(e.buffer,r)):Promise.reject(new Error("web crypto not initialized"))).catch(r=>(oe.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${r.name}: ${r.message}`),this.onWebCryptoError(e,t,s,i)))}onWebCryptoError(e,t,s,i){const r=this.enableSoftwareAES;if(r){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,s,i);const a=this.flush();if(a)return a.buffer}throw new Error("WebCrypto"+(r?" and softwareDecrypt":"")+": failed to decrypt data")}getValidChunk(e){let t=e;const s=e.length-e.length%YE;return s!==e.length&&(t=e.slice(0,s),this.remainderData=e.slice(s)),t}logOnce(e){this.logEnabled&&(oe.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}const lh=Math.pow(2,17);class qE{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const s=e.url;if(!s)return Promise.reject(new tn({type:Y.NETWORK_ERROR,details:w.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error(`Fragment does not have a ${s?"part list":"url"}`),networkDetails:null}));this.abort();const i=this.config,r=i.fLoader,a=i.loader;return new Promise((o,l)=>{if(this.loader&&this.loader.destroy(),e.gap)if(e.tagList.some(g=>g[0]==="GAP")){l(ch(e));return}else e.gap=!1;const u=this.loader=r?new r(i):new a(i),c=uh(e);e.loader=u;const d=ah(i.fragLoadPolicy.default),h={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:e.sn==="initSegment"?1/0:lh};e.stats=u.stats;const f={onSuccess:(g,p,E,y)=>{this.resetLoader(e,u);let m=g.data;E.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(m.slice(0,16)),m=m.slice(16)),o({frag:e,part:null,payload:m,networkDetails:y})},onError:(g,p,E,y)=>{this.resetLoader(e,u),l(new tn({type:Y.NETWORK_ERROR,details:w.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:ae({url:s,data:void 0},g),error:new Error(`HTTP Error ${g.code} ${g.text}`),networkDetails:E,stats:y}))},onAbort:(g,p,E)=>{this.resetLoader(e,u),l(new tn({type:Y.NETWORK_ERROR,details:w.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:E,stats:g}))},onTimeout:(g,p,E)=>{this.resetLoader(e,u),l(new tn({type:Y.NETWORK_ERROR,details:w.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${h.timeout}ms`),networkDetails:E,stats:g}))}};t&&(f.onProgress=(g,p,E,y)=>t({frag:e,part:null,payload:E,networkDetails:y})),u.load(c,h,f)})}loadPart(e,t,s){this.abort();const i=this.config,r=i.fLoader,a=i.loader;return new Promise((o,l)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap){l(ch(e,t));return}const u=this.loader=r?new r(i):new a(i),c=uh(e,t);e.loader=u;const d=ah(i.fragLoadPolicy.default),h={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:lh};t.stats=u.stats,u.load(c,h,{onSuccess:(f,g,p,E)=>{this.resetLoader(e,u),this.updateStatsFromPart(e,t);const y={frag:e,part:t,payload:f.data,networkDetails:E};s(y),o(y)},onError:(f,g,p,E)=>{this.resetLoader(e,u),l(new tn({type:Y.NETWORK_ERROR,details:w.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:ae({url:c.url,data:void 0},f),error:new Error(`HTTP Error ${f.code} ${f.text}`),networkDetails:p,stats:E}))},onAbort:(f,g,p)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,u),l(new tn({type:Y.NETWORK_ERROR,details:w.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:p,stats:f}))},onTimeout:(f,g,p)=>{this.resetLoader(e,u),l(new tn({type:Y.NETWORK_ERROR,details:w.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${h.timeout}ms`),networkDetails:p,stats:f}))}})})}updateStatsFromPart(e,t){const s=e.stats,i=t.stats,r=i.total;if(s.loaded+=i.loaded,r){const l=Math.round(e.duration/t.duration),u=Math.min(Math.round(s.loaded/r),l),d=(l-u)*Math.round(s.loaded/u);s.total=s.loaded+d}else s.total=Math.max(s.loaded,s.total);const a=s.loading,o=i.loading;a.start?a.first+=o.first-o.start:(a.start=o.start,a.first=o.first),a.end=o.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function uh(n,e=null){const t=e||n,s={frag:n,part:e,responseType:"arraybuffer",url:t.url,headers:{},rangeStart:0,rangeEnd:0},i=t.byteRangeStartOffset,r=t.byteRangeEndOffset;if(j(i)&&j(r)){var a;let o=i,l=r;if(n.sn==="initSegment"&&QE((a=n.decryptdata)==null?void 0:a.method)){const u=r-i;u%16&&(l=r+(16-u%16)),i!==0&&(s.resetIV=!0,o=i-16)}s.rangeStart=o,s.rangeEnd=l}return s}function ch(n,e){const t=new Error(`GAP ${n.gap?"tag":"attribute"} found`),s={type:Y.MEDIA_ERROR,details:w.FRAG_GAP,fatal:!1,frag:n,error:t,networkDetails:null};return e&&(s.part=e),(e||n).stats.aborted=!0,new tn(s)}function QE(n){return n==="AES-128"||n==="AES-256"}class tn extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class Hp extends It{constructor(e,t){super(e,t),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}class fc{constructor(e,t,s,i=0,r=-1,a=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=Tr(),this.buffering={audio:Tr(),video:Tr(),audiovideo:Tr()},this.level=e,this.sn=t,this.id=s,this.size=i,this.part=r,this.partial=a}}function Tr(){return{start:0,executeStart:0,executeEnd:0,end:0}}const dh={length:0,start:()=>0,end:()=>0};class X{static isBuffered(e,t){if(e){const s=X.getBuffered(e);for(let i=s.length;i--;)if(t>=s.start(i)&&t<=s.end(i))return!0}return!1}static bufferedRanges(e){if(e){const t=X.getBuffered(e);return X.timeRangesToArray(t)}return[]}static timeRangesToArray(e){const t=[];for(let s=0;s<e.length;s++)t.push({start:e.start(s),end:e.end(s)});return t}static bufferInfo(e,t,s){if(e){const i=X.bufferedRanges(e);if(i.length)return X.bufferedInfo(i,t,s)}return{len:0,start:t,end:t,bufferedIndex:-1}}static bufferedInfo(e,t,s){t=Math.max(0,t),e.length>1&&e.sort((c,d)=>c.start-d.start||d.end-c.end);let i=-1,r=[];if(s)for(let c=0;c<e.length;c++){t>=e[c].start&&t<=e[c].end&&(i=c);const d=r.length;if(d){const h=r[d-1].end;e[c].start-h<s?e[c].end>h&&(r[d-1].end=e[c].end):r.push(e[c])}else r.push(e[c])}else r=e;let a=0,o,l=t,u=t;for(let c=0;c<r.length;c++){const d=r[c].start,h=r[c].end;if(i===-1&&t>=d&&t<=h&&(i=c),t+s>=d&&t<h)l=d,u=h,a=u-t;else if(t+s<d){o=d;break}}return{len:a,start:l||0,end:u||0,nextStart:o,buffered:e,bufferedIndex:i}}static getBuffered(e){try{return e.buffered||dh}catch(t){return oe.log("failed to get media.buffered",t),dh}}}const zp=/\{\$([a-zA-Z0-9-_]+)\}/g;function hh(n){return zp.test(n)}function Ql(n,e){if(n.variableList!==null||n.hasVariableRefs){const t=n.variableList;return e.replace(zp,s=>{const i=s.substring(2,s.length-1),r=t==null?void 0:t[i];return r===void 0?(n.playlistParsingError||(n.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${i}"`)),s):r})}return e}function fh(n,e,t){let s=n.variableList;s||(n.variableList=s={});let i,r;if("QUERYPARAM"in e){i=e.QUERYPARAM;try{const a=new self.URL(t).searchParams;if(a.has(i))r=a.get(i);else throw new Error(`"${i}" does not match any query parameter in URI: "${t}"`)}catch(a){n.playlistParsingError||(n.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${a.message}`))}}else i=e.NAME,r=e.VALUE;i in s?n.playlistParsingError||(n.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${i}"`)):s[i]=r||""}function XE(n,e,t){const s=e.IMPORT;if(t&&s in t){let i=n.variableList;i||(n.variableList=i={}),i[s]=t[s]}else n.playlistParsingError||(n.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${s}"`))}const ZE=/^(\d+)x(\d+)$/,gh=/(.+?)=(".*?"|.*?)(?:,|$)/g;class me{constructor(e,t){typeof e=="string"&&(e=me.parseAttrList(e,t)),ue(this,e)}get clientAttrs(){return Object.keys(this).filter(e=>e.substring(0,2)==="X-")}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(t.length&1?"0":"")+t;const s=new Uint8Array(t.length/2);for(let i=0;i<t.length/2;i++)s[i]=parseInt(t.slice(i*2,i*2+2),16);return s}return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const s=this[e];return s?parseFloat(s):t}enumeratedString(e){return this[e]}enumeratedStringList(e,t){const s=this[e];return(s?s.split(/[ ,]+/):[]).reduce((i,r)=>(i[r.toLowerCase()]=!0,i),t)}bool(e){return this[e]==="YES"}decimalResolution(e){const t=ZE.exec(this[e]);if(t!==null)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e,t){let s;const i={},r='"';for(gh.lastIndex=0;(s=gh.exec(e))!==null;){const a=s[1].trim();let o=s[2];const l=o.indexOf(r)===0&&o.lastIndexOf(r)===o.length-1;let u=!1;if(l)o=o.slice(1,-1);else switch(a){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":u=!0}if(t&&(l||u))o=Ql(t,o);else if(!u&&!l)switch(a){case"CLOSED-CAPTIONS":if(o==="NONE")break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":oe.warn(`${e}: attribute ${a} is missing quotes`)}i[a]=o}return i}}const JE="com.apple.hls.interstitial";function ex(n){return n!=="ID"&&n!=="CLASS"&&n!=="CUE"&&n!=="START-DATE"&&n!=="DURATION"&&n!=="END-DATE"&&n!=="END-ON-NEXT"}function tx(n){return n==="SCTE35-OUT"||n==="SCTE35-IN"||n==="SCTE35-CMD"}class Wp{constructor(e,t,s=0){var i;if(this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=(t==null?void 0:t.tagAnchor)||null,this.tagOrder=(i=t==null?void 0:t.tagOrder)!=null?i:s,t){const r=t.attr;for(const a in r)if(Object.prototype.hasOwnProperty.call(e,a)&&e[a]!==r[a]){oe.warn(`DATERANGE tag attribute: "${a}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=a;break}e=ue(new me({}),r,e)}if(this.attr=e,t?(this._startDate=t._startDate,this._cue=t._cue,this._endDate=t._endDate,this._dateAtEnd=t._dateAtEnd):this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const r=(t==null?void 0:t.endDate)||new Date(this.attr["END-DATE"]);j(r.getTime())&&(this._endDate=r)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get cue(){const e=this._cue;return e===void 0?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):e}get startTime(){const{tagAnchor:e}=this;return e===null||e.programDateTime===null?(oe.warn(`Expected tagAnchor Fragment with PDT set for DateRange "${this.id}": ${e}`),NaN):e.start+(this.startDate.getTime()-e.programDateTime)/1e3}get startDate(){return this._startDate}get endDate(){const e=this._endDate||this._dateAtEnd;if(e)return e;const t=this.duration;return t!==null?this._dateAtEnd=new Date(this._startDate.getTime()+t*1e3):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(j(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isInterstitial(){return this.class===JE}get isValid(){return!!this.id&&!this._badValueForSameId&&j(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}const nx=10;class sx{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e){this.advanced=!0,this.updated=!0;return}const t=this.lastPartSn-e.lastPartSn,s=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!s||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||t===0&&s>0,this.updated||this.advanced?this.misses=Math.floor(e.misses*.6):this.misses=e.misses+1}hasKey(e){return this.encryptedFragments.some(t=>{let s=t.decryptdata;return s||(t.setKeyFormat(e.keyFormat),s=t.decryptdata),!!s&&e.matches(s)})}get hasProgramDateTime(){return this.fragments.length?j(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||nx}get drift(){const e=this.driftEndTime-this.driftStartTime;return e>0?(this.driftEnd-this.driftStart)*1e3/e:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){return this.fragments.length?this.fragments[this.fragments.length-1].end:0}get fragmentStart(){return this.fragments.length?this.fragments[0].start:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].index:-1}get maxPartIndex(){const e=this.partList;if(e){const t=this.lastPartIndex;if(t!==-1){for(let s=e.length;s--;)if(e[s].index>t)return e[s].index;return t}}return 0}get lastPartSn(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}get expired(){if(this.live&&this.age&&this.misses<3){const e=this.partEnd-this.fragmentStart;return this.age>Math.max(e,this.totalduration)+this.levelTargetDuration}return!1}}function wa(n,e){return n.length===e.length?!n.some((t,s)=>t!==e[s]):!1}function ph(n,e){return!n&&!e?!0:!n||!e?!1:wa(n,e)}function Fs(n){return n==="AES-128"||n==="AES-256"||n==="AES-256-CTR"}function gc(n){switch(n){case"AES-128":case"AES-256":return Mn.cbc;case"AES-256-CTR":return Mn.ctr;default:throw new Error(`invalid full segment method ${n}`)}}function pc(n){return Uint8Array.from(atob(n),e=>e.charCodeAt(0))}function Xl(n){return Uint8Array.from(unescape(encodeURIComponent(n)),e=>e.charCodeAt(0))}function ix(n){const e=Xl(n).subarray(0,16),t=new Uint8Array(16);return t.set(e,16-e.length),t}function Yp(n){const e=function(s,i,r){const a=s[i];s[i]=s[r],s[r]=a};e(n,0,3),e(n,1,2),e(n,4,5),e(n,6,7)}function qp(n){const e=n.split(":");let t=null;if(e[0]==="data"&&e.length===2){const s=e[1].split(";"),i=s[s.length-1].split(",");if(i.length===2){const r=i[0]==="base64",a=i[1];r?(s.splice(-1,1),t=pc(a)):t=ix(a)}}return t}const Da=typeof self<"u"?self:void 0;var ve={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},Ue={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function Yr(n){switch(n){case Ue.FAIRPLAY:return ve.FAIRPLAY;case Ue.PLAYREADY:return ve.PLAYREADY;case Ue.WIDEVINE:return ve.WIDEVINE;case Ue.CLEARKEY:return ve.CLEARKEY}}function bo(n){switch(n){case ve.FAIRPLAY:return Ue.FAIRPLAY;case ve.PLAYREADY:return Ue.PLAYREADY;case ve.WIDEVINE:return Ue.WIDEVINE;case ve.CLEARKEY:return Ue.CLEARKEY}}function fi(n){const{drmSystems:e,widevineLicenseUrl:t}=n,s=e?[ve.FAIRPLAY,ve.WIDEVINE,ve.PLAYREADY,ve.CLEARKEY].filter(i=>!!e[i]):[];return!s[ve.WIDEVINE]&&t&&s.push(ve.WIDEVINE),s}const Qp=function(n){return Da!=null&&(n=Da.navigator)!=null&&n.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}();function rx(n,e,t,s){let i;switch(n){case ve.FAIRPLAY:i=["cenc","sinf"];break;case ve.WIDEVINE:case ve.PLAYREADY:i=["cenc"];break;case ve.CLEARKEY:i=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${n}`)}return ax(i,e,t,s)}function ax(n,e,t,s){return[{initDataTypes:n,persistentState:s.persistentState||"optional",distinctiveIdentifier:s.distinctiveIdentifier||"optional",sessionTypes:s.sessionTypes||[s.sessionType||"temporary"],audioCapabilities:e.map(r=>({contentType:`audio/mp4; codecs=${r}`,robustness:s.audioRobustness||"",encryptionScheme:s.audioEncryptionScheme||null})),videoCapabilities:t.map(r=>({contentType:`video/mp4; codecs=${r}`,robustness:s.videoRobustness||"",encryptionScheme:s.videoEncryptionScheme||null}))}]}function ox(n){var e;return!!n&&(n.sessionType==="persistent-license"||!!((e=n.sessionTypes)!=null&&e.some(t=>t==="persistent-license")))}function Xp(n){const e=new Uint16Array(n.buffer,n.byteOffset,n.byteLength/2),t=String.fromCharCode.apply(null,Array.from(e)),s=t.substring(t.indexOf("<"),t.length),a=new DOMParser().parseFromString(s,"text/xml").getElementsByTagName("KID")[0];if(a){const o=a.childNodes[0]?a.childNodes[0].nodeValue:a.getAttribute("VALUE");if(o){const l=pc(o).subarray(0,16);return Yp(l),l}}return null}let fs={};class Pn{static clearKeyUriToKeyIdMap(){fs={}}static setKeyIdForUri(e,t){fs[e]=t}static addKeyIdForUri(e){const t=Object.keys(fs).length%Number.MAX_SAFE_INTEGER,s=new Uint8Array(16);return new DataView(s.buffer,12,4).setUint32(0,t),fs[e]=s,s}constructor(e,t,s,i=[1],r=null,a){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=s,this.keyFormatVersions=i,this.iv=r,this.encrypted=e?e!=="NONE":!1,this.isCommonEncryption=this.encrypted&&!Fs(e),a!=null&&a.startsWith("0x")&&(this.keyId=new Uint8Array(Ip(a)))}matches(e){return e.uri===this.uri&&e.method===this.method&&e.encrypted===this.encrypted&&e.keyFormat===this.keyFormat&&wa(e.keyFormatVersions,this.keyFormatVersions)&&ph(e.iv,this.iv)&&ph(e.keyId,this.keyId)}isSupported(){if(this.method){if(Fs(this.method)||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case Ue.FAIRPLAY:case Ue.WIDEVINE:case Ue.PLAYREADY:case Ue.CLEARKEY:return["SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(e,t){if(!this.encrypted||!this.uri)return null;if(Fs(this.method)){let r=this.iv;return r||(typeof e!="number"&&(oe.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0),r=ux(e)),new Pn(this.method,this.uri,"identity",this.keyFormatVersions,r)}if(this.keyId){const r=fs[this.uri];if(r&&!wa(this.keyId,r)&&Pn.setKeyIdForUri(this.uri,this.keyId),this.pssh)return this}const s=qp(this.uri);if(s)switch(this.keyFormat){case Ue.WIDEVINE:if(this.pssh=s,!this.keyId){const r=hE(s.buffer);if(r.length){var i;const a=r[0];this.keyId=(i=a.kids)!=null&&i.length?a.kids[0]:null}}this.keyId||(this.keyId=mh(t));break;case Ue.PLAYREADY:{const r=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=dE(r,null,s),this.keyId=Xp(s);break}default:{let r=s.subarray(0,16);if(r.length!==16){const a=new Uint8Array(16);a.set(r,16-r.length),r=a}this.keyId=r;break}}if(!this.keyId||this.keyId.byteLength!==16){let r;r=lx(t),r||(r=mh(t),r||(r=fs[this.uri])),r&&(this.keyId=r,Pn.setKeyIdForUri(this.uri,r))}return this}}function lx(n){const e=n==null?void 0:n[Ue.WIDEVINE];return e?e.keyId:null}function mh(n){const e=n==null?void 0:n[Ue.PLAYREADY];if(e){const t=qp(e.uri);if(t)return Xp(t)}return null}function ux(n){const e=new Uint8Array(16);for(let t=12;t<16;t++)e[t]=n>>8*(15-t)&255;return e}const yh=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,vh=/#EXT-X-MEDIA:(.*)/g,cx=/^#EXT(?:INF|-X-TARGETDURATION):/m,No=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),dx=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class Wt{static findGroup(e,t){for(let s=0;s<e.length;s++){const i=e[s];if(i.id===t)return i}}static resolve(e,t){return ac.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return cx.test(e)}static parseMasterPlaylist(e,t){const s=hh(e),i={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:s},r=[];if(yh.lastIndex=0,!e.startsWith("#EXTM3U"))return i.playlistParsingError=new Error("no EXTM3U delimiter"),i;let a;for(;(a=yh.exec(e))!=null;)if(a[1]){var o;const u=new me(a[1],i),c=Ql(i,a[2]),d={attrs:u,bitrate:u.decimalInteger("BANDWIDTH")||u.decimalInteger("AVERAGE-BANDWIDTH"),name:u.NAME,url:Wt.resolve(c,t)},h=u.decimalResolution("RESOLUTION");h&&(d.width=h.width,d.height=h.height),Sh(u.CODECS,d);const f=u["SUPPLEMENTAL-CODECS"];f&&(d.supplemental={},Sh(f,d.supplemental)),(o=d.unknownCodecs)!=null&&o.length||r.push(d),i.levels.push(d)}else if(a[3]){const u=a[3],c=a[4];switch(u){case"SESSION-DATA":{const d=new me(c,i),h=d["DATA-ID"];h&&(i.sessionData===null&&(i.sessionData={}),i.sessionData[h]=d);break}case"SESSION-KEY":{const d=Eh(c,t,i);d.encrypted&&d.isSupported()?(i.sessionKeys===null&&(i.sessionKeys=[]),i.sessionKeys.push(d)):oe.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${c}"`);break}case"DEFINE":{{const d=new me(c,i);fh(i,d,t)}break}case"CONTENT-STEERING":{const d=new me(c,i);i.contentSteering={uri:Wt.resolve(d["SERVER-URI"],t),pathwayId:d["PATHWAY-ID"]||"."};break}case"START":{i.startTimeOffset=xh(c);break}}}const l=r.length>0&&r.length<i.levels.length;return i.levels=l?r:i.levels,i.levels.length===0&&(i.playlistParsingError=new Error("no levels found in manifest")),i}static parseMasterPlaylistMedia(e,t,s){let i;const r={},a=s.levels,o={AUDIO:a.map(u=>({id:u.attrs.AUDIO,audioCodec:u.audioCodec})),SUBTITLES:a.map(u=>({id:u.attrs.SUBTITLES,textCodec:u.textCodec})),"CLOSED-CAPTIONS":[]};let l=0;for(vh.lastIndex=0;(i=vh.exec(e))!==null;){const u=new me(i[1],s),c=u.TYPE;if(c){const d=o[c],h=r[c]||[];r[c]=h;const f=u.LANGUAGE,g=u["ASSOC-LANGUAGE"],p=u.CHANNELS,E=u.CHARACTERISTICS,y=u["INSTREAM-ID"],m={attrs:u,bitrate:0,id:l++,groupId:u["GROUP-ID"]||"",name:u.NAME||f||"",type:c,default:u.bool("DEFAULT"),autoselect:u.bool("AUTOSELECT"),forced:u.bool("FORCED"),lang:f,url:u.URI?Wt.resolve(u.URI,t):""};if(g&&(m.assocLang=g),p&&(m.channels=p),E&&(m.characteristics=E),y&&(m.instreamId=y),d!=null&&d.length){const S=Wt.findGroup(d,m.groupId)||d[0];Th(m,S,"audioCodec"),Th(m,S,"textCodec")}h.push(m)}}return r}static parseLevelPlaylist(e,t,s,i,r,a){var o;const l={url:t},u=new sx(t),c=u.fragments,d=[];let h=null,f=0,g=0,p=0,E=0,y=0,m=null,S=new wo(i,l),T,A,_,L=-1,R=!1,C=null,I;if(No.lastIndex=0,u.m3u8=e,u.hasVariableRefs=hh(e),((o=No.exec(e))==null?void 0:o[0])!=="#EXTM3U")return u.playlistParsingError=new Error("Missing format identifier #EXTM3U"),u;for(;(T=No.exec(e))!==null;){R&&(R=!1,S=new wo(i,l),S.playlistOffset=p,S.setStart(p),S.sn=f,S.cc=E,y&&(S.bitrate=y),S.level=s,h&&(S.initSegment=h,h.rawProgramDateTime&&(S.rawProgramDateTime=h.rawProgramDateTime,h.rawProgramDateTime=null),C&&(S.setByteRange(C),C=null)));const W=T[1];if(W){S.duration=parseFloat(W);const K=(" "+T[2]).slice(1);S.title=K||null,S.tagList.push(K?["INF",W,K]:["INF",W])}else if(T[3]){if(j(S.duration)){S.playlistOffset=p,S.setStart(p),_&&Lh(S,_,u),S.sn=f,S.level=s,S.cc=E,c.push(S);const K=(" "+T[3]).slice(1);S.relurl=Ql(u,K),Zl(S,m,d),m=S,p+=S.duration,f++,g=0,R=!0}}else{if(T=T[0].match(dx),!T){oe.warn("No matches on slow regex match for level playlist!");continue}for(A=1;A<T.length&&T[A]===void 0;A++);const K=(" "+T[A]).slice(1),B=(" "+T[A+1]).slice(1),V=T[A+2]?(" "+T[A+2]).slice(1):null;switch(K){case"BYTERANGE":m?S.setByteRange(B,m):S.setByteRange(B);break;case"PROGRAM-DATE-TIME":S.rawProgramDateTime=B,S.tagList.push(["PROGRAM-DATE-TIME",B]),L===-1&&(L=c.length);break;case"PLAYLIST-TYPE":u.type&&Zt(u,K,T),u.type=B.toUpperCase();break;case"MEDIA-SEQUENCE":u.startSN!==0?Zt(u,K,T):c.length>0&&Ih(u,K,T),f=u.startSN=parseInt(B);break;case"SKIP":{u.skippedSegments&&Zt(u,K,T);const D=new me(B,u),N=D.decimalInteger("SKIPPED-SEGMENTS");if(j(N)){u.skippedSegments+=N;for(let O=N;O--;)c.push(null);f+=N}const U=D.enumeratedString("RECENTLY-REMOVED-DATERANGES");U&&(u.recentlyRemovedDateranges=(u.recentlyRemovedDateranges||[]).concat(U.split("	")));break}case"TARGETDURATION":u.targetduration!==0&&Zt(u,K,T),u.targetduration=Math.max(parseInt(B),1);break;case"VERSION":u.version!==null&&Zt(u,K,T),u.version=parseInt(B);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":u.live||Zt(u,K,T),u.live=!1;break;case"#":(B||V)&&S.tagList.push(V?[B,V]:[B]);break;case"DISCONTINUITY":E++,S.tagList.push(["DIS"]);break;case"GAP":S.gap=!0,S.tagList.push([K]);break;case"BITRATE":S.tagList.push([K,B]),y=parseInt(B)*1e3,j(y)?S.bitrate=y:y=0;break;case"DATERANGE":{const D=new me(B,u),N=new Wp(D,u.dateRanges[D.ID],u.dateRangeTagCount);u.dateRangeTagCount++,N.isValid||u.skippedSegments?u.dateRanges[N.id]=N:oe.warn(`Ignoring invalid DATERANGE tag: "${B}"`),S.tagList.push(["EXT-X-DATERANGE",B]);break}case"DEFINE":{{const D=new me(B,u);"IMPORT"in D?XE(u,D,a):fh(u,D,t)}break}case"DISCONTINUITY-SEQUENCE":u.startCC!==0?Zt(u,K,T):c.length>0&&Ih(u,K,T),u.startCC=E=parseInt(B);break;case"KEY":{const D=Eh(B,t,u);if(D.isSupported()){if(D.method==="NONE"){_=void 0;break}_||(_={});const N=_[D.keyFormat];N!=null&&N.matches(D)||(N&&(_=ue({},_)),_[D.keyFormat]=D)}else oe.warn(`[Keys] Ignoring unsupported EXT-X-KEY tag: "${B}"`);break}case"START":u.startTimeOffset=xh(B);break;case"MAP":{const D=new me(B,u);if(S.duration){const N=new wo(i,l);Ah(N,D,s,_),h=N,S.initSegment=h,h.rawProgramDateTime&&!S.rawProgramDateTime&&(S.rawProgramDateTime=h.rawProgramDateTime)}else{const N=S.byteRangeEndOffset;if(N){const U=S.byteRangeStartOffset;C=`${N-U}@${U}`}else C=null;Ah(S,D,s,_),h=S,R=!0}h.cc=E;break}case"SERVER-CONTROL":{I&&Zt(u,K,T),I=new me(B),u.canBlockReload=I.bool("CAN-BLOCK-RELOAD"),u.canSkipUntil=I.optionalFloat("CAN-SKIP-UNTIL",0),u.canSkipDateRanges=u.canSkipUntil>0&&I.bool("CAN-SKIP-DATERANGES"),u.partHoldBack=I.optionalFloat("PART-HOLD-BACK",0),u.holdBack=I.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{u.partTarget&&Zt(u,K,T);const D=new me(B);u.partTarget=D.decimalFloatingPoint("PART-TARGET");break}case"PART":{let D=u.partList;D||(D=u.partList=[]);const N=g>0?D[D.length-1]:void 0,U=g++,O=new me(B,u),M=new Xv(O,S,l,U,N);D.push(M),S.duration+=M.duration;break}case"PRELOAD-HINT":{const D=new me(B,u);u.preloadHint=D;break}case"RENDITION-REPORT":{const D=new me(B,u);u.renditionReports=u.renditionReports||[],u.renditionReports.push(D);break}default:oe.warn(`line parsed but not handled: ${T}`);break}}}m&&!m.relurl?(c.pop(),p-=m.duration,u.partList&&(u.fragmentHint=m)):u.partList&&(Zl(S,m,d),S.cc=E,u.fragmentHint=S,_&&Lh(S,_,u)),u.targetduration||(u.playlistParsingError=new Error("Missing Target Duration"));const P=c.length,$=c[0],G=c[P-1];if(p+=u.skippedSegments*u.targetduration,p>0&&P&&G){u.averagetargetduration=p/P;const W=G.sn;u.endSN=W!=="initSegment"?W:0,u.live||(G.endList=!0),L>0&&(fx(c,L),$&&d.unshift($))}return u.fragmentHint&&(p+=u.fragmentHint.duration),u.totalduration=p,d.length&&u.dateRangeTagCount&&$&&Zp(d,u),u.endCC=E,u}}function Zp(n,e){let t=n.length;if(!t)if(e.hasProgramDateTime){const o=e.fragments[e.fragments.length-1];n.push(o),t++}else return;const s=n[t-1],i=e.live?1/0:e.totalduration,r=Object.keys(e.dateRanges);for(let o=r.length;o--;){const l=e.dateRanges[r[o]],u=l.startDate.getTime();l.tagAnchor=s.ref;for(let c=t;c--;){var a;if(((a=n[c])==null?void 0:a.sn)<e.startSN)break;const d=hx(e,u,n,c,i);if(d!==-1){l.tagAnchor=e.fragments[d].ref;break}}}}function hx(n,e,t,s,i){const r=t[s];if(r){const o=r.programDateTime;if(e>=o||s===0){var a;const l=(((a=t[s+1])==null?void 0:a.start)||i)-r.start;if(e<=o+l*1e3){const u=t[s].sn-n.startSN;if(u<0)return-1;const c=n.fragments;if(c.length>t.length){const h=(t[s+1]||c[c.length-1]).sn-n.startSN;for(let f=h;f>u;f--){const g=c[f].programDateTime;if(e>=g&&e<g+c[f].duration*1e3)return f}}return u}}}return-1}function Eh(n,e,t){var s,i;const r=new me(n,t),a=(s=r.METHOD)!=null?s:"",o=r.URI,l=r.hexadecimalInteger("IV"),u=r.KEYFORMATVERSIONS,c=(i=r.KEYFORMAT)!=null?i:"identity";o&&r.IV&&!l&&oe.error(`Invalid IV: ${r.IV}`);const d=o?Wt.resolve(o,e):"",h=(u||"1").split("/").map(Number).filter(Number.isFinite);return new Pn(a,d,c,h,l,r.KEYID)}function xh(n){const t=new me(n).decimalFloatingPoint("TIME-OFFSET");return j(t)?t:null}function Sh(n,e){let t=(n||"").split(/[ ,]+/).filter(s=>s);["video","audio","text"].forEach(s=>{const i=t.filter(r=>uc(r,s));i.length&&(e[`${s}Codec`]=i.map(r=>r.split("/")[0]).join(","),t=t.filter(r=>i.indexOf(r)===-1))}),e.unknownCodecs=t}function Th(n,e,t){const s=e[t];s&&(n[t]=s)}function fx(n,e){let t=n[e];for(let s=e;s--;){const i=n[s];if(!i)return;i.programDateTime=t.programDateTime-i.duration*1e3,t=i}}function Zl(n,e,t){n.rawProgramDateTime?t.push(n):e!=null&&e.programDateTime&&(n.programDateTime=e.endProgramDateTime)}function Ah(n,e,t,s){n.relurl=e.URI,e.BYTERANGE&&n.setByteRange(e.BYTERANGE),n.level=t,n.sn="initSegment",s&&(n.levelkeys=s),n.initSegment=null}function Lh(n,e,t){n.levelkeys=e;const{encryptedFragments:s}=t;(!s.length||s[s.length-1].levelkeys!==e)&&Object.keys(e).some(i=>e[i].isCommonEncryption)&&s.push(n)}function Zt(n,e,t){n.playlistParsingError=new Error(`#EXT-X-${e} must not appear more than once (${t[0]})`)}function Ih(n,e,t){n.playlistParsingError=new Error(`#EXT-X-${e} must appear before the first Media Segment (${t[0]})`)}function Oo(n,e){const t=e.startPTS;if(j(t)){let s=0,i;e.sn>n.sn?(s=t-n.start,i=n):(s=n.start-t,i=e),i.duration!==s&&i.setDuration(s)}else e.sn>n.sn?n.cc===e.cc&&n.minEndPTS?e.setStart(n.start+(n.minEndPTS-n.start)):e.setStart(n.start+n.duration):e.setStart(Math.max(n.start-e.duration,0))}function Jp(n,e,t,s,i,r,a){s-t<=0&&(a.warn("Fragment should have a positive duration",e),s=t+e.duration,r=i+e.duration);let l=t,u=s;const c=e.startPTS,d=e.endPTS;if(j(c)){const y=Math.abs(c-t);n&&y>n.totalduration?a.warn(`media timestamps and playlist times differ by ${y}s for level ${e.level} ${n.url}`):j(e.deltaPTS)?e.deltaPTS=Math.max(y,e.deltaPTS):e.deltaPTS=y,l=Math.max(t,c),t=Math.min(t,c),i=e.startDTS!==void 0?Math.min(i,e.startDTS):i,u=Math.min(s,d),s=Math.max(s,d),r=e.endDTS!==void 0?Math.max(r,e.endDTS):r}const h=t-e.start;e.start!==0&&e.setStart(t),e.setDuration(s-e.start),e.startPTS=t,e.maxStartPTS=l,e.startDTS=i,e.endPTS=s,e.minEndPTS=u,e.endDTS=r;const f=e.sn;if(!n||f<n.startSN||f>n.endSN)return 0;let g;const p=f-n.startSN,E=n.fragments;for(E[p]=e,g=p;g>0;g--)Oo(E[g],E[g-1]);for(g=p;g<E.length-1;g++)Oo(E[g],E[g+1]);return n.fragmentHint&&Oo(E[E.length-1],n.fragmentHint),n.PTSKnown=n.alignedSliding=!0,h}function gx(n,e,t){if(n===e)return;let s=null;const i=n.fragments;for(let c=i.length-1;c>=0;c--){const d=i[c].initSegment;if(d){s=d;break}}n.fragmentHint&&delete n.fragmentHint.endPTS;let r;yx(n,e,(c,d,h,f)=>{if((!e.startCC||e.skippedSegments)&&d.cc!==c.cc){const g=c.cc-d.cc;for(let p=h;p<f.length;p++)f[p].cc+=g;e.endCC=f[f.length-1].cc}j(c.startPTS)&&j(c.endPTS)&&(d.setStart(d.startPTS=c.startPTS),d.startDTS=c.startDTS,d.maxStartPTS=c.maxStartPTS,d.endPTS=c.endPTS,d.endDTS=c.endDTS,d.minEndPTS=c.minEndPTS,d.setDuration(c.endPTS-c.startPTS),d.duration&&(r=d),e.PTSKnown=e.alignedSliding=!0),c.hasStreams&&(d.elementaryStreams=c.elementaryStreams),d.loader=c.loader,c.hasStats&&(d.stats=c.stats),c.initSegment&&(d.initSegment=c.initSegment,s=c.initSegment)});const a=e.fragments,o=e.fragmentHint?a.concat(e.fragmentHint):a;if(s&&o.forEach(c=>{var d;c&&(!c.initSegment||c.initSegment.relurl===((d=s)==null?void 0:d.relurl))&&(c.initSegment=s)}),e.skippedSegments){if(e.deltaUpdateFailed=a.some(c=>!c),e.deltaUpdateFailed){t.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let c=e.skippedSegments;c--;)a.shift();e.startSN=a[0].sn}else{e.canSkipDateRanges&&(e.dateRanges=px(n.dateRanges,e,t));const c=n.fragments.filter(d=>d.rawProgramDateTime);if(n.hasProgramDateTime&&!e.hasProgramDateTime)for(let d=1;d<o.length;d++)o[d].programDateTime===null&&Zl(o[d],o[d-1],c);Zp(c,e)}e.endCC=a[a.length-1].cc}if(!e.startCC){var l;const c=nm(n,e.startSN-1);e.startCC=(l=c==null?void 0:c.cc)!=null?l:a[0].cc}mx(n.partList,e.partList,(c,d)=>{d.elementaryStreams=c.elementaryStreams,d.stats=c.stats}),r?Jp(e,r,r.startPTS,r.endPTS,r.startDTS,r.endDTS,t):em(n,e),a.length&&(e.totalduration=e.edge-a[0].start),e.driftStartTime=n.driftStartTime,e.driftStart=n.driftStart;const u=e.advancedDateTime;if(e.advanced&&u){const c=e.edge;e.driftStart||(e.driftStartTime=u,e.driftStart=c),e.driftEndTime=u,e.driftEnd=c}else e.driftEndTime=n.driftEndTime,e.driftEnd=n.driftEnd,e.advancedDateTime=n.advancedDateTime;e.requestScheduled===-1&&(e.requestScheduled=n.requestScheduled)}function px(n,e,t){const{dateRanges:s,recentlyRemovedDateranges:i}=e,r=ue({},n);i&&i.forEach(l=>{delete r[l]});const o=Object.keys(r).length;return o?(Object.keys(s).forEach(l=>{const u=r[l],c=new Wp(s[l].attr,u);c.isValid?(r[l]=c,u||(c.tagOrder+=o)):t.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${de(s[l].attr)}"`)}),r):s}function mx(n,e,t){if(n&&e){let s=0;for(let i=0,r=n.length;i<=r;i++){const a=n[i],o=e[i+s];a&&o&&a.index===o.index&&a.fragment.sn===o.fragment.sn?t(a,o):s--}}}function yx(n,e,t){const s=e.skippedSegments,i=Math.max(n.startSN,e.startSN)-e.startSN,r=(n.fragmentHint?1:0)+(s?e.endSN:Math.min(n.endSN,e.endSN))-e.startSN,a=e.startSN-n.startSN,o=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,l=n.fragmentHint?n.fragments.concat(n.fragmentHint):n.fragments;for(let u=i;u<=r;u++){const c=l[a+u];let d=o[u];if(s&&!d&&c&&(d=e.fragments[u]=c),c&&d){t(c,d,u,o);const h=c.relurl,f=d.relurl;if(h&&vx(h,f)){e.playlistParsingError=Rh(`media sequence mismatch ${d.sn}:`,n,e,c,d);return}else if(c.cc!==d.cc){e.playlistParsingError=Rh(`discontinuity sequence mismatch (${c.cc}!=${d.cc})`,n,e,c,d);return}}}}function Rh(n,e,t,s,i){return new Error(`${n} ${i.url}
Playlist starting @${e.startSN}
${e.m3u8}

Playlist starting @${t.startSN}
${t.m3u8}`)}function em(n,e,t=!0){const s=e.startSN+e.skippedSegments-n.startSN,i=n.fragments,r=s>=0;let a=0;if(r&&s<i.length)a=i[s].start;else if(r&&e.startSN===n.endSN+1)a=n.fragmentEnd;else if(r&&t)a=n.fragmentStart+s*e.levelTargetDuration;else if(!e.skippedSegments&&e.fragmentStart===0)a=n.fragmentStart;else return;Jl(e,a)}function Jl(n,e){if(e){const t=n.fragments;for(let s=n.skippedSegments;s<t.length;s++)t[s].addStart(e);n.fragmentHint&&n.fragmentHint.addStart(e)}}function tm(n,e=1/0){let t=1e3*n.targetduration;if(n.updated){const s=n.fragments;if(s.length&&t*4>e){const r=s[s.length-1].duration*1e3;r<t&&(t=r)}}else t/=2;return Math.round(t)}function nm(n,e,t){if(!n)return null;let s=n.fragments[e-n.startSN];return s||(s=n.fragmentHint,s&&s.sn===e)?s:e<n.startSN&&t&&t.sn===e?t:null}function _h(n,e,t){return n?sm(n.partList,e,t):null}function sm(n,e,t){if(n)for(let s=n.length;s--;){const i=n[s];if(i.index===t&&i.fragment.sn===e)return i}return null}function im(n){n.forEach((e,t)=>{var s;(s=e.details)==null||s.fragments.forEach(i=>{i.level=t,i.initSegment&&(i.initSegment.level=t)})})}function vx(n,e){return n!==e&&e?Ch(n)!==Ch(e):!1}function Ch(n){return n.replace(/\?[^?]*$/,"")}function Ai(n,e){for(let s=0,i=n.length;s<i;s++){var t;if(((t=n[s])==null?void 0:t.cc)===e)return n[s]}return null}function Ex(n,e){return!!(n&&e.startCC<n.endCC&&e.endCC>n.startCC)}function kh(n,e){const t=n.start+e;n.startPTS=t,n.setStart(t),n.endPTS=t+n.duration}function rm(n,e){const t=e.fragments;for(let s=0,i=t.length;s<i;s++)kh(t[s],n);e.fragmentHint&&kh(e.fragmentHint,n),e.alignedSliding=!0}function xx(n,e){n&&(am(e,n),e.alignedSliding||Pa(e,n),!e.alignedSliding&&!e.skippedSegments&&em(n,e,!1))}function am(n,e){if(!Ex(e,n))return;const t=Math.min(e.endCC,n.endCC),s=Ai(e.fragments,t),i=Ai(n.fragments,t);if(!s||!i)return;oe.log(`Aligning playlist at start of dicontinuity sequence ${t}`);const r=s.start-i.start;rm(r,n)}function Pa(n,e){if(!n.hasProgramDateTime||!e.hasProgramDateTime)return;const t=n.fragments,s=e.fragments;if(!t.length||!s.length)return;let i,r;const a=Math.min(e.endCC,n.endCC);e.startCC<a&&n.startCC<a&&(i=Ai(s,a),r=Ai(t,a)),(!i||!r)&&(i=s[Math.floor(s.length/2)],r=Ai(t,i.cc)||t[Math.floor(t.length/2)]);const o=i.programDateTime,l=r.programDateTime;if(!o||!l)return;const u=(l-o)/1e3-(r.start-i.start);rm(u,n)}function Ye(n,e,t){tt(n,e,t),n.addEventListener(e,t)}function tt(n,e,t){n.removeEventListener(e,t)}const Sx={toString:function(n){let e="";const t=n.length;for(let s=0;s<t;s++)e+=`[${n.start(s).toFixed(3)}-${n.end(s).toFixed(3)}]`;return e}},b={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class mc extends Hp{constructor(e,t,s,i,r){super(i,e.logger),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=b.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.loadingParts=!1,this.loopSn=void 0,this.onMediaSeeking=()=>{const{config:a,fragCurrent:o,media:l,mediaBuffer:u,state:c}=this,d=l?l.currentTime:0,h=X.bufferInfo(u||l,d,a.maxBufferHole),f=!h.len;if(this.log(`Media seeking to ${j(d)?d.toFixed(3):d}, state: ${c}, ${f?"out of":"in"} buffer`),this.state===b.ENDED)this.resetLoadingState();else if(o){const g=a.maxFragLookUpTolerance,p=o.start-g,E=o.start+o.duration+g;if(f||E<h.start||p>h.end){const y=d>E;(d<p||y)&&(y&&o.loader&&(this.log(`Cancelling fragment load for seek (sn: ${o.sn})`),o.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}if(l){this.fragmentTracker.removeFragmentsInRange(d,1/0,this.playlistType,!0);const g=this.lastCurrentTime;if(d>g&&(this.lastCurrentTime=d),!this.loadingParts){const p=Math.max(h.end,d),E=this.shouldLoadParts(this.getLevelDetails(),p);E&&(this.log(`LL-Part loading ON after seeking to ${d.toFixed(2)} with buffer @${p.toFixed(2)}`),this.loadingParts=E)}}this.hls.hasEnoughToStart||(this.log(`Setting ${f?"startPosition":"nextLoadPosition"} to ${d} for seek without enough to start`),this.nextLoadPosition=d,f&&(this.startPosition=d)),f&&this.state===b.IDLE&&this.tickImmediate()},this.onMediaEnded=()=>{this.log("setting startPosition to 0 because media ended"),this.startPosition=this.lastCurrentTime=0},this.playlistType=r,this.hls=e,this.fragmentLoader=new qE(e.config),this.keyLoader=s,this.fragmentTracker=t,this.config=e.config,this.decrypter=new hc(e.config)}registerListeners(){const{hls:e}=this;e.on(v.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(v.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(v.MANIFEST_LOADING,this.onManifestLoading,this),e.on(v.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(v.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(v.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(v.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(v.MANIFEST_LOADING,this.onManifestLoading,this),e.off(v.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(v.ERROR,this.onError,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){if(this.state===b.STOPPED)return;this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;e!=null&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=b.STOPPED}get startPositionValue(){const{nextLoadPosition:e,startPosition:t}=this;return t===-1&&e?e:t}get bufferingEnabled(){return this.buffering}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}get inFlightFrag(){return{frag:this.fragCurrent,state:this.state}}_streamEnded(e,t){if(t.live||!this.media)return!1;const s=e.end||0,i=this.config.timelineOffset||0;if(s<=i)return!1;const r=e.buffered;this.config.maxBufferHole&&r&&r.length>1&&(e=X.bufferedInfo(r,e.start,0));const a=e.nextStart;if(a&&a>i&&a<t.edge||this.media.currentTime<e.start)return!1;const l=t.partList;if(l!=null&&l.length){const c=l[l.length-1];return X.isBuffered(this.media,c.start+c.duration/2)}const u=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(u)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null)return this.levelLastLoaded.details}get timelineOffset(){const e=this.config.timelineOffset;if(e){var t;return((t=this.getLevelDetails())==null?void 0:t.appliedTimelineOffset)||e}return 0}onMediaAttached(e,t){const s=this.media=this.mediaBuffer=t.media;Ye(s,"seeking",this.onMediaSeeking),Ye(s,"ended",this.onMediaEnded);const i=this.config;this.levels&&i.autoStartLoad&&this.state===b.STOPPED&&this.startLoad(i.startPosition)}onMediaDetaching(e,t){const s=!!t.transferMedia,i=this.media;if(i!==null){if(i.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),tt(i,"seeking",this.onMediaSeeking),tt(i,"ended",this.onMediaEnded),this.keyLoader&&!s&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,s){this.resetLoadingState(),this.resetTransmuxer();return}this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}}onManifestLoading(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1}onError(e,t){}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset}onHandlerDestroying(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),super.onHandlerDestroying(),this.hls=this.onMediaSeeking=this.onMediaEnded=null}onHandlerDestroyed(){this.state=b.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,s){this.startFragRequested=!0,this._loadFragForPlayback(e,t,s)}_loadFragForPlayback(e,t,s){const i=r=>{const a=r.frag;if(this.fragContextChanged(a)){this.warn(`${a.type} sn: ${a.sn}${r.part?" part: "+r.part.index:""} of ${this.fragInfo(a,!1,r.part)}) was dropped during download.`),this.fragmentTracker.removeFragment(a);return}a.stats.chunkCount++,this._handleFragmentLoadProgress(r)};this._doFragLoad(e,t,s,i).then(r=>{if(!r)return;const a=this.state,o=r.frag;if(this.fragContextChanged(o)){(a===b.FRAG_LOADING||!this.fragCurrent&&a===b.PARSING)&&(this.fragmentTracker.removeFragment(o),this.state=b.IDLE);return}"payload"in r&&(this.log(`Loaded ${o.type} sn: ${o.sn} of ${this.playlistLabel()} ${o.level}`),this.hls.trigger(v.FRAG_LOADED,r)),this._handleFragmentLoadComplete(r)}).catch(r=>{this.state===b.STOPPED||this.state===b.ERROR||(this.warn(`Frag error: ${(r==null?void 0:r.message)||r}`),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;const{fragmentTracker:s}=this;if(s.getState(e)===we.APPENDING){const r=e.type,a=this.getFwdBufferInfo(this.mediaBuffer,r),o=Math.max(e.duration,a?a.len:this.config.maxBufferLength),l=this.backtrackFragment;((l?e.sn-l.sn:0)===1||this.reduceMaxBufferLength(o,e.duration))&&s.removeFragment(e)}else((t=this.mediaBuffer)==null?void 0:t.buffered.length)===0?s.removeAllFragments():s.hasParts(e.type)&&(s.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),s.getState(e)===we.PARTIAL&&s.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}waitForLive(e){const t=e.details;return(t==null?void 0:t.live)&&t.type!=="EVENT"&&(this.levelLastLoaded!==e||t.expired)}flushMainBuffer(e,t,s=null){if(!(e-t))return;const i={startOffset:e,endOffset:t,type:s};this.hls.trigger(v.BUFFER_FLUSHING,i)}_loadInitSegment(e,t){this._doFragLoad(e,t).then(s=>{const i=s==null?void 0:s.frag;if(!i||this.fragContextChanged(i)||!this.levels)throw new Error("init load aborted");return s}).then(s=>{const{hls:i}=this,{frag:r,payload:a}=s,o=r.decryptdata;if(a&&a.byteLength>0&&o!=null&&o.key&&o.iv&&Fs(o.method)){const l=self.performance.now();return this.decrypter.decrypt(new Uint8Array(a),o.key.buffer,o.iv.buffer,gc(o.method)).catch(u=>{throw i.trigger(v.ERROR,{type:Y.MEDIA_ERROR,details:w.FRAG_DECRYPT_ERROR,fatal:!1,error:u,reason:u.message,frag:r}),u}).then(u=>{const c=self.performance.now();return i.trigger(v.FRAG_DECRYPTED,{frag:r,payload:u,stats:{tstart:l,tdecrypt:c}}),s.payload=u,this.completeInitSegmentLoad(s)})}return this.completeInitSegmentLoad(s)}).catch(s=>{this.state===b.STOPPED||this.state===b.ERROR||(this.warn(s),this.resetFragmentLoading(e))})}completeInitSegmentLoad(e){const{levels:t}=this;if(!t)throw new Error("init load aborted, missing levels");const s=e.frag.stats;this.state!==b.STOPPED&&(this.state=b.IDLE),e.frag.data=new Uint8Array(e.payload),s.parsing.start=s.buffering.start=self.performance.now(),s.parsing.end=s.buffering.end=self.performance.now(),this.tick()}unhandledEncryptionError(e,t){var s,i;const r=e.tracks;if(r&&!t.encrypted&&((s=r.audio)!=null&&s.encrypted||(i=r.video)!=null&&i.encrypted)&&(!this.config.emeEnabled||!this.keyLoader.emeController)){const a=this.media,o=new Error(`Encrypted track with no key in ${this.fragInfo(t)} (media ${a?"attached mediaKeys: "+a.mediaKeys:"detached"})`);return this.warn(o.message),!a||a.mediaKeys?!1:(this.hls.trigger(v.ERROR,{type:Y.KEY_SYSTEM_ERROR,details:w.KEY_SYSTEM_NO_KEYS,fatal:!1,error:o,frag:t}),this.resetTransmuxer(),!0)}return!1}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.sn!==t.sn||e.level!==t.level}fragBufferedComplete(e,t){const s=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)} > buffer:${s?Sx.toString(X.getBuffered(s)):"(detached)"})`),Ie(e)){var i;if(e.type!==H.SUBTITLE){const a=e.elementaryStreams;if(!Object.keys(a).some(o=>!!a[o])){this.state=b.IDLE;return}}const r=(i=this.levels)==null?void 0:i[e.level];r!=null&&r.fragmentError&&(this.log(`Resetting level fragment error count of ${r.fragmentError} on frag buffered`),r.fragmentError=0)}this.state=b.IDLE}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:s,part:i,partsLoaded:r}=e,a=!r||r.length===0||r.some(l=>!l),o=new fc(s.level,s.sn,s.stats.chunkCount+1,0,i?i.index:-1,!a);t.flush(o)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,s=null,i){var r;this.fragCurrent=e;const a=t.details;if(!this.levels||!a)throw new Error(`frag load aborted, missing level${a?"":" detail"}s`);let o=null;if(e.encrypted&&!((r=e.decryptdata)!=null&&r.key)){if(this.log(`Loading key for ${e.sn} of [${a.startSN}-${a.endSN}], ${this.playlistLabel()} ${e.level}`),this.state=b.KEY_LOADING,this.fragCurrent=e,o=this.keyLoader.load(e).then(h=>{if(!this.fragContextChanged(h.frag))return this.hls.trigger(v.KEY_LOADED,h),this.state===b.KEY_LOADING&&(this.state=b.IDLE),h}),this.hls.trigger(v.KEY_LOADING,{frag:e}),this.fragCurrent===null)return this.log("context changed in KEY_LOADING"),Promise.resolve(null)}else e.encrypted||(o=this.keyLoader.loadClear(e,a.encryptedFragments,this.startFragRequested),o&&this.log("[eme] blocking frag load until media-keys acquired"));const l=this.fragPrevious;if(Ie(e)&&(!l||e.sn!==l.sn)){const h=this.shouldLoadParts(t.details,e.end);h!==this.loadingParts&&(this.log(`LL-Part loading ${h?"ON":"OFF"} loading sn ${l==null?void 0:l.sn}->${e.sn}`),this.loadingParts=h)}if(s=Math.max(e.start,s||0),this.loadingParts&&Ie(e)){const h=a.partList;if(h&&i){s>a.fragmentEnd&&a.fragmentHint&&(e=a.fragmentHint);const f=this.getNextPart(h,e,s);if(f>-1){const g=h[f];e=this.fragCurrent=g.fragment,this.log(`Loading ${e.type} sn: ${e.sn} part: ${g.index} (${f}/${h.length-1}) of ${this.fragInfo(e,!1,g)}) cc: ${e.cc} [${a.startSN}-${a.endSN}], target: ${parseFloat(s.toFixed(3))}`),this.nextLoadPosition=g.start+g.duration,this.state=b.FRAG_LOADING;let p;return o?p=o.then(E=>!E||this.fragContextChanged(E.frag)?null:this.doFragPartsLoad(e,g,t,i)).catch(E=>this.handleFragLoadError(E)):p=this.doFragPartsLoad(e,g,t,i).catch(E=>this.handleFragLoadError(E)),this.hls.trigger(v.FRAG_LOADING,{frag:e,part:g,targetBufferTime:s}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):p}else if(!e.url||this.loadedEndOfParts(h,s))return Promise.resolve(null)}}if(Ie(e)&&this.loadingParts){var u;this.log(`LL-Part loading OFF after next part miss @${s.toFixed(2)} Check buffer at sn: ${e.sn} loaded parts: ${(u=a.partList)==null?void 0:u.filter(h=>h.loaded).map(h=>`[${h.start}-${h.end}]`)}`),this.loadingParts=!1}else if(!e.url)return Promise.resolve(null);this.log(`Loading ${e.type} sn: ${e.sn} of ${this.fragInfo(e,!1)}) cc: ${e.cc} ${"["+a.startSN+"-"+a.endSN+"]"}, target: ${parseFloat(s.toFixed(3))}`),j(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=b.FRAG_LOADING;const c=this.config.progressive&&e.type!==H.SUBTITLE;let d;return c&&o?d=o.then(h=>!h||this.fragContextChanged(h.frag)?null:this.fragmentLoader.load(e,i)).catch(h=>this.handleFragLoadError(h)):d=Promise.all([this.fragmentLoader.load(e,c?i:void 0),o]).then(([h])=>(!c&&i&&i(h),h)).catch(h=>this.handleFragLoadError(h)),this.hls.trigger(v.FRAG_LOADING,{frag:e,targetBufferTime:s}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):d}doFragPartsLoad(e,t,s,i){return new Promise((r,a)=>{var o;const l=[],u=(o=s.details)==null?void 0:o.partList,c=d=>{this.fragmentLoader.loadPart(e,d,i).then(h=>{l[d.index]=h;const f=h.part;this.hls.trigger(v.FRAG_LOADED,h);const g=_h(s.details,e.sn,d.index+1)||sm(u,e.sn,d.index+1);if(g)c(g);else return r({frag:e,part:f,partsLoaded:l})}).catch(a)};c(t)})}handleFragLoadError(e){if("data"in e){const t=e.data;t.frag&&t.details===w.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):t.frag&&t.type===Y.KEY_SYSTEM_ERROR?(t.frag.abortRequests(),this.resetStartWhenNotLoaded(),this.resetFragmentLoading(t.frag)):this.hls.trigger(v.ERROR,t)}else this.hls.trigger(v.ERROR,{type:Y.OTHER_ERROR,details:w.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||this.state!==b.PARSING){!this.fragCurrent&&this.state!==b.STOPPED&&this.state!==b.ERROR&&(this.state=b.IDLE);return}const{frag:s,part:i,level:r}=t,a=self.performance.now();s.stats.parsing.end=a,i&&(i.stats.parsing.end=a);const o=this.getLevelDetails(),u=o&&s.sn>o.endSN||this.shouldLoadParts(o,s.end);u!==this.loadingParts&&(this.log(`LL-Part loading ${u?"ON":"OFF"} after parsing segment ending @${s.end.toFixed(2)}`),this.loadingParts=u),this.updateLevelTiming(s,i,r,e.partial)}shouldLoadParts(e,t){if(this.config.lowLatencyMode){if(!e)return this.loadingParts;if(e.partList){var s;const r=e.partList[0];if(r.fragment.type===H.SUBTITLE)return!1;const a=r.end+(((s=e.fragmentHint)==null?void 0:s.duration)||0);if(t>=a){var i;if((this.hls.hasEnoughToStart?((i=this.media)==null?void 0:i.currentTime)||this.lastCurrentTime:this.getLoadPosition())>r.start-r.fragment.duration)return!0}}}return!1}getCurrentContext(e){const{levels:t,fragCurrent:s}=this,{level:i,sn:r,part:a}=e;if(!(t!=null&&t[i]))return this.warn(`Levels object was unset while buffering fragment ${r} of ${this.playlistLabel()} ${i}. The current chunk will not be buffered.`),null;const o=t[i],l=o.details,u=a>-1?_h(l,r,a):null,c=u?u.fragment:nm(l,r,s);return c?(s&&s!==c&&(c.stats=s.stats),{frag:c,part:u,level:o}):null}bufferFragmentData(e,t,s,i,r){if(this.state!==b.PARSING)return;const{data1:a,data2:o}=e;let l=a;if(o&&(l=Lt(a,o)),!l.length)return;const u=this.initPTS[t.cc],c=u?-u.baseTime/u.timescale:void 0,d={type:e.type,frag:t,part:s,chunkMeta:i,offset:c,parent:t.type,data:l};if(this.hls.trigger(v.BUFFER_APPENDING,d),e.dropped&&e.independent&&!s){if(r)return;this.flushBufferGap(t)}}flushBufferGap(e){const t=this.media;if(!t)return;if(!X.isBuffered(t,t.currentTime)){this.flushMainBuffer(0,e.start);return}const s=t.currentTime,i=X.bufferInfo(t,s,0),r=e.duration,a=Math.min(this.config.maxFragLookUpTolerance*2,r*.25),o=Math.max(Math.min(e.start-a,i.end-a),s+a);e.start-o>a&&this.flushMainBuffer(o,e.start)}getFwdBufferInfo(e,t){var s;const i=this.getLoadPosition();if(!j(i))return null;const a=this.lastCurrentTime>i||(s=this.media)!=null&&s.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(e,i,t,a)}getFwdBufferInfoAtPos(e,t,s,i){const r=X.bufferInfo(e,t,i);if(r.len===0&&r.nextStart!==void 0){const a=this.fragmentTracker.getBufferedFrag(t,s);if(a&&(r.nextStart<=a.end||a.gap)){const o=Math.max(Math.min(r.nextStart,a.end)-t,i);return X.bufferInfo(e,t,o)}}return r}getMaxBufferLength(e){const{config:t}=this;let s;return e?s=Math.max(8*t.maxBufferSize/e,t.maxBufferLength):s=t.maxBufferLength,Math.min(s,t.maxMaxBufferLength)}reduceMaxBufferLength(e,t){const s=this.config,i=Math.max(Math.min(e-t,s.maxBufferLength),t),r=Math.max(e-t*3,s.maxMaxBufferLength/2,i);return r>=i?(s.maxMaxBufferLength=r,this.warn(`Reduce max buffer length to ${r}s`),!0):!1}getAppendedFrag(e,t=H.MAIN){const s=this.fragmentTracker?this.fragmentTracker.getAppendedFrag(e,t):null;return s&&"fragment"in s?s.fragment:s}getNextFragment(e,t){const s=t.fragments,i=s.length;if(!i)return null;const{config:r}=this,a=s[0].start,o=r.lowLatencyMode&&!!t.partList;let l=null;if(t.live){const d=r.initialLiveManifestSize;if(i<d)return this.warn(`Not enough fragments to start playback (have: ${i}, need: ${d})`),null;if(!t.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||e<a){var u;o&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),l=this.getInitialLiveFragment(t);const h=this.hls.startPosition,f=this.hls.liveSyncPosition,g=l?(h!==-1&&h>=a?h:f)||l.start:e;this.log(`Setting startPosition to ${g} to match start frag at live edge. mainStart: ${h} liveSyncPosition: ${f} frag.start: ${(u=l)==null?void 0:u.start}`),this.startPosition=this.nextLoadPosition=g}}else e<=a&&(l=s[0]);if(!l){const d=this.loadingParts?t.partEnd:t.fragmentEnd;l=this.getFragmentAtPosition(e,d,t)}let c=this.filterReplacedPrimary(l,t);if(!c&&l){const d=l.sn-t.startSN;c=this.filterReplacedPrimary(s[d+1]||null,t)}return this.mapToInitFragWhenRequired(c)}isLoopLoading(e,t){const s=this.fragmentTracker.getState(e);return(s===we.OK||s===we.PARTIAL&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,s,i,r){let a=null;if(e.gap&&(a=this.getNextFragment(this.nextLoadPosition,t),a&&!a.gap&&s.nextStart)){const o=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,s.nextStart,i,0);if(o!==null&&s.len+o.len>=r){const l=a.sn;return this.loopSn!==l&&(this.log(`buffer full after gaps in "${i}" playlist starting at sn: ${l}`),this.loopSn=l),null}}return this.loopSn=void 0,a}get primaryPrefetch(){if(wh(this.config)){var e;if((e=this.hls.interstitialsManager)==null||(e=e.playingItem)==null?void 0:e.event)return!0}return!1}filterReplacedPrimary(e,t){if(!e)return e;if(wh(this.config)&&e.type!==H.SUBTITLE){const s=this.hls.interstitialsManager,i=s==null?void 0:s.bufferingItem;if(i){const a=i.event;if(a){if(a.appendInPlace||Math.abs(e.start-i.start)>1||i.start===0)return null}else if(e.end<=i.start&&(t==null?void 0:t.live)===!1||e.start>i.end&&i.nextEvent&&(i.nextEvent.appendInPlace||e.start-i.end>1))return null}const r=s==null?void 0:s.playerQueue;if(r)for(let a=r.length;a--;){const o=r[a].interstitial;if(o.appendInPlace&&e.start>=o.startTime&&e.end<=o.resumeTime)return null}}return e}mapToInitFragWhenRequired(e){return e!=null&&e.initSegment&&!e.initSegment.data&&!this.bitrateTest?e.initSegment:e}getNextPart(e,t,s){let i=-1,r=!1,a=!0;for(let o=0,l=e.length;o<l;o++){const u=e[o];if(a=a&&!u.independent,i>-1&&s<u.start)break;const c=u.loaded;c?i=-1:(r||(u.independent||a)&&u.fragment===t)&&(u.fragment!==t&&this.warn(`Need buffer at ${s} but next unloaded part starts at ${u.start}`),i=o),r=c}return i}loadedEndOfParts(e,t){let s;for(let i=e.length;i--;){if(s=e[i],!s.loaded)return!1;if(t>s.start)return!0}return!1}getInitialLiveFragment(e){const t=e.fragments,s=this.fragPrevious;let i=null;if(s){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${s.programDateTime}`),i=FE(t,s.endProgramDateTime,this.config.maxFragLookUpTolerance)),!i){const r=s.sn+1;if(r>=e.startSN&&r<=e.endSN){const a=t[r-e.startSN];s.cc===a.cc&&(i=a,this.log(`Live playlist, switching playlist, load frag with next SN: ${i.sn}`))}i||(i=Gp(e,s.cc,s.end),i&&this.log(`Live playlist, switching playlist, load frag with same CC: ${i.sn}`))}}else{const r=this.hls.liveSyncPosition;r!==null&&(i=this.getFragmentAtPosition(r,this.bitrateTest?e.fragmentEnd:e.edge,e))}return i}getFragmentAtPosition(e,t,s){const{config:i}=this;let{fragPrevious:r}=this,{fragments:a,endSN:o}=s;const{fragmentHint:l}=s,{maxFragLookUpTolerance:u}=i,c=s.partList,d=!!(this.loadingParts&&c!=null&&c.length&&l);d&&!this.bitrateTest&&c[c.length-1].fragment.sn===l.sn&&(a=a.concat(l),o=l.sn);let h;if(e<t){var f;const p=e<this.lastCurrentTime||e>t-u||(f=this.media)!=null&&f.paused||!this.startFragRequested?0:u;h=rs(r,a,e,p)}else h=a[a.length-1];if(h){const g=h.sn-s.startSN,p=this.fragmentTracker.getState(h);if((p===we.OK||p===we.PARTIAL&&h.gap)&&(r=h),r&&h.sn===r.sn&&(!d||c[0].fragment.sn>h.sn||!s.live)&&h.level===r.level){const y=a[g+1];h.sn<o&&this.fragmentTracker.getState(y)!==we.OK?h=y:h=null}}return h}alignPlaylists(e,t,s){const i=e.fragments.length;if(!i)return this.warn("No fragments in live playlist"),0;const r=e.fragmentStart,a=!t,o=e.alignedSliding&&j(r);if(a||!o&&!r){xx(s,e);const l=e.fragmentStart;return this.log(`Live playlist sliding: ${l.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} fragments: ${i}`),l}return r}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,e.partTarget*3)}setStartPosition(e,t){let s=this.startPosition;s<t&&(s=-1);const i=this.timelineOffset;if(s===-1){const r=this.startTimeOffset!==null,a=r?this.startTimeOffset:e.startTimeOffset;a!==null&&j(a)?(s=t+a,a<0&&(s+=e.edge),s=Math.min(Math.max(t,s),t+e.totalduration),this.log(`Setting startPosition to ${s} for start time offset ${a} found in ${r?"multivariant":"media"} playlist`),this.startPosition=s):e.live?(s=this.hls.liveSyncPosition||t,this.log(`Setting startPosition to -1 to start at live edge ${s}`),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=s=0),this.lastCurrentTime=s+i}this.nextLoadPosition=s+i}getLoadPosition(){var e;const{media:t}=this;let s=0;return(e=this.hls)!=null&&e.hasEnoughToStart&&t?s=t.currentTime:this.nextLoadPosition>=0&&(s=this.nextLoadPosition),s}handleFragLoadAborted(e,t){this.transmuxer&&e.type===this.playlistType&&Ie(e)&&e.stats.aborted&&(this.log(`Fragment ${e.sn}${t?" part "+t.index:""} of ${this.playlistLabel()} ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){(!this.fragCurrent||!this.fragContextChanged(e)&&this.state!==b.FRAG_LOADING_WAITING_RETRY)&&(this.state=b.IDLE)}onFragmentOrKeyLoadError(e,t){var s;if(t.chunkMeta&&!t.frag){const y=this.getCurrentContext(t.chunkMeta);y&&(t.frag=y.frag)}const i=t.frag;if(!i||i.type!==e||!this.levels)return;if(this.fragContextChanged(i)){var r;this.warn(`Frag load error must match current frag to retry ${i.url} > ${(r=this.fragCurrent)==null?void 0:r.url}`);return}const a=t.details===w.FRAG_GAP;a&&this.fragmentTracker.fragBuffered(i,!0);const o=t.errorAction;if(!o){this.state=b.ERROR;return}const{action:l,flags:u,retryCount:c=0,retryConfig:d}=o,h=!!d,f=h&&l===Fe.RetryRequest,g=h&&!o.resolved&&u===at.MoveAllAlternatesMatchingHost,p=(s=this.hls.latestLevelDetails)==null?void 0:s.live;if(!f&&g&&Ie(i)&&!i.endList&&p&&!Vp(t))this.resetFragmentErrors(e),this.treatAsGap(i),o.resolved=!0;else if((f||g)&&c<d.maxNumRetry){var E;const y=ql((E=t.response)==null?void 0:E.code),m=dc(d,c);if(this.resetStartWhenNotLoaded(),this.retryDate=self.performance.now()+m,this.state=b.FRAG_LOADING_WAITING_RETRY,o.resolved=!0,y){this.log("Waiting for connection (offline)"),this.retryDate=1/0,t.reason="offline";return}this.warn(`Fragment ${i.sn} of ${e} ${i.level} errored with ${t.details}, retrying loading ${c+1}/${d.maxNumRetry} in ${m}ms`)}else if(d)if(this.resetFragmentErrors(e),c<d.maxNumRetry)!a&&l!==Fe.RemoveAlternatePermanently&&(o.resolved=!0);else{this.warn(`${t.details} reached or exceeded max retry (${c})`);return}else l===Fe.SendAlternateToPenaltyBox?this.state=b.WAITING_LEVEL:this.state=b.ERROR;this.tickImmediate()}checkRetryDate(){const e=self.performance.now(),t=this.retryDate,s=t===1/0;(!t||e>=t||s&&!ql(0))&&(s&&this.log("Connection restored (online)"),this.resetStartWhenNotLoaded(),this.state=b.IDLE)}reduceLengthAndFlushBuffer(e){if(this.state===b.PARSING||this.state===b.PARSED){const t=e.frag,s=e.parent,i=this.getFwdBufferInfo(this.mediaBuffer,s),r=i&&i.len>.5;r&&this.reduceMaxBufferLength(i.len,(t==null?void 0:t.duration)||10);const a=!r;return a&&this.warn(`Buffer full error while media.currentTime (${this.getLoadPosition()}) is not buffered, flush ${s} buffer`),t&&(this.fragmentTracker.removeFragment(t),this.nextLoadPosition=t.start),this.resetLoadingState(),a}return!1}resetFragmentErrors(e){e===H.AUDIO&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==b.STOPPED&&(this.state=b.IDLE)}afterBufferFlushed(e,t,s){if(!e)return;const i=X.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,i,s),this.state===b.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==b.STOPPED&&(this.state=b.IDLE)}resetStartWhenNotLoaded(){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;const e=this.levelLastLoaded,t=e?e.details:null;t!=null&&t.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(t,t.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.log(`Loading context changed while buffering sn ${e.sn} of ${this.playlistLabel()} ${e.level===-1?"<removed>":e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,s,i){const r=s.details;if(!r){this.warn("level.details undefined");return}if(!Object.keys(e.elementaryStreams).reduce((l,u)=>{const c=e.elementaryStreams[u];if(c){const d=c.endPTS-c.startPTS;if(d<=0)return this.warn(`Could not parse fragment ${e.sn} ${u} duration reliably (${d})`),l||!1;const h=i?0:Jp(r,e,c.startPTS,c.endPTS,c.startDTS,c.endDTS,this);return this.hls.trigger(v.LEVEL_PTS_UPDATED,{details:r,level:s,drift:h,type:u,frag:e,start:c.startPTS,end:c.endPTS}),!0}return l},!1)){var o;const l=((o=this.transmuxer)==null?void 0:o.error)===null;if((s.fragmentError===0||l&&(s.fragmentError<2||e.endList))&&this.treatAsGap(e,s),l){const u=new Error(`Found no media in fragment ${e.sn} of ${this.playlistLabel()} ${e.level} resetting transmuxer to fallback to playlist timing`);if(this.warn(u.message),this.hls.trigger(v.ERROR,{type:Y.MEDIA_ERROR,details:w.FRAG_PARSING_ERROR,fatal:!1,error:u,frag:e,reason:`Found no media in msn ${e.sn} of ${this.playlistLabel()} "${s.url}"`}),!this.hls)return;this.resetTransmuxer()}}this.state=b.PARSED,this.log(`Parsed ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)})`),this.hls.trigger(v.FRAG_PARSED,{frag:e,part:t})}playlistLabel(){return this.playlistType===H.MAIN?"level":"track"}fragInfo(e,t=!0,s){var i,r;return`${this.playlistLabel()} ${e.level} (${s?"part":"frag"}:[${((i=t&&!s?e.startPTS:(s||e).start)!=null?i:NaN).toFixed(3)}-${((r=t&&!s?e.endPTS:(s||e).end)!=null?r:NaN).toFixed(3)}]${s&&e.type==="main"?"INDEPENDENT="+(s.independent?"YES":"NO"):""}`}treatAsGap(e,t){t&&t.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)}resetTransmuxer(){var e;(e=this.transmuxer)==null||e.reset()}recoverWorkerError(e){e.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}}function wh(n){return!!n.interstitialsController&&n.enableInterstitialPlayback!==!1}class om{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let s;if(e.length)e.length===1?s=e[0]:s=Tx(e,t);else return new Uint8Array(0);return this.reset(),s}reset(){this.chunks.length=0,this.dataLength=0}}function Tx(n,e){const t=new Uint8Array(e);let s=0;for(let i=0;i<n.length;i++){const r=n[i];t.set(r,s),s+=r.length}return t}var Mo={exports:{}},Dh;function Ax(){return Dh||(Dh=1,function(n){var e=Object.prototype.hasOwnProperty,t="~";function s(){}Object.create&&(s.prototype=Object.create(null),new s().__proto__||(t=!1));function i(l,u,c){this.fn=l,this.context=u,this.once=c||!1}function r(l,u,c,d,h){if(typeof c!="function")throw new TypeError("The listener must be a function");var f=new i(c,d||l,h),g=t?t+u:u;return l._events[g]?l._events[g].fn?l._events[g]=[l._events[g],f]:l._events[g].push(f):(l._events[g]=f,l._eventsCount++),l}function a(l,u){--l._eventsCount===0?l._events=new s:delete l._events[u]}function o(){this._events=new s,this._eventsCount=0}o.prototype.eventNames=function(){var u=[],c,d;if(this._eventsCount===0)return u;for(d in c=this._events)e.call(c,d)&&u.push(t?d.slice(1):d);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(c)):u},o.prototype.listeners=function(u){var c=t?t+u:u,d=this._events[c];if(!d)return[];if(d.fn)return[d.fn];for(var h=0,f=d.length,g=new Array(f);h<f;h++)g[h]=d[h].fn;return g},o.prototype.listenerCount=function(u){var c=t?t+u:u,d=this._events[c];return d?d.fn?1:d.length:0},o.prototype.emit=function(u,c,d,h,f,g){var p=t?t+u:u;if(!this._events[p])return!1;var E=this._events[p],y=arguments.length,m,S;if(E.fn){switch(E.once&&this.removeListener(u,E.fn,void 0,!0),y){case 1:return E.fn.call(E.context),!0;case 2:return E.fn.call(E.context,c),!0;case 3:return E.fn.call(E.context,c,d),!0;case 4:return E.fn.call(E.context,c,d,h),!0;case 5:return E.fn.call(E.context,c,d,h,f),!0;case 6:return E.fn.call(E.context,c,d,h,f,g),!0}for(S=1,m=new Array(y-1);S<y;S++)m[S-1]=arguments[S];E.fn.apply(E.context,m)}else{var T=E.length,A;for(S=0;S<T;S++)switch(E[S].once&&this.removeListener(u,E[S].fn,void 0,!0),y){case 1:E[S].fn.call(E[S].context);break;case 2:E[S].fn.call(E[S].context,c);break;case 3:E[S].fn.call(E[S].context,c,d);break;case 4:E[S].fn.call(E[S].context,c,d,h);break;default:if(!m)for(A=1,m=new Array(y-1);A<y;A++)m[A-1]=arguments[A];E[S].fn.apply(E[S].context,m)}}return!0},o.prototype.on=function(u,c,d){return r(this,u,c,d,!1)},o.prototype.once=function(u,c,d){return r(this,u,c,d,!0)},o.prototype.removeListener=function(u,c,d,h){var f=t?t+u:u;if(!this._events[f])return this;if(!c)return a(this,f),this;var g=this._events[f];if(g.fn)g.fn===c&&(!h||g.once)&&(!d||g.context===d)&&a(this,f);else{for(var p=0,E=[],y=g.length;p<y;p++)(g[p].fn!==c||h&&!g[p].once||d&&g[p].context!==d)&&E.push(g[p]);E.length?this._events[f]=E.length===1?E[0]:E:a(this,f)}return this},o.prototype.removeAllListeners=function(u){var c;return u?(c=t?t+u:u,this._events[c]&&a(this,c)):(this._events=new s,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=t,o.EventEmitter=o,n.exports=o}(Mo)),Mo.exports}var Lx=Ax(),yc=qv(Lx);const zi="1.6.15",Ys={};function Ix(){return typeof __HLS_WORKER_BUNDLE__=="function"}function Rx(){const n=Ys[zi];if(n)return n.clientCount++,n;const e=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),t=self.URL.createObjectURL(e),i={worker:new self.Worker(t),objectURL:t,clientCount:1};return Ys[zi]=i,i}function _x(n){const e=Ys[n];if(e)return e.clientCount++,e;const t=new self.URL(n,self.location.href).href,i={worker:new self.Worker(t),scriptURL:t,clientCount:1};return Ys[n]=i,i}function Cx(n){const e=Ys[n||zi];if(e&&e.clientCount--===1){const{worker:s,objectURL:i}=e;delete Ys[n||zi],i&&self.URL.revokeObjectURL(i),s.terminate()}}function lm(n,e){return e+10<=n.length&&n[e]===51&&n[e+1]===68&&n[e+2]===73&&n[e+3]<255&&n[e+4]<255&&n[e+6]<128&&n[e+7]<128&&n[e+8]<128&&n[e+9]<128}function vc(n,e){return e+10<=n.length&&n[e]===73&&n[e+1]===68&&n[e+2]===51&&n[e+3]<255&&n[e+4]<255&&n[e+6]<128&&n[e+7]<128&&n[e+8]<128&&n[e+9]<128}function Za(n,e){let t=0;return t=(n[e]&127)<<21,t|=(n[e+1]&127)<<14,t|=(n[e+2]&127)<<7,t|=n[e+3]&127,t}function Wi(n,e){const t=e;let s=0;for(;vc(n,e);){s+=10;const i=Za(n,e+6);s+=i,lm(n,e+10)&&(s+=10),e+=s}if(s>0)return n.subarray(t,t+s)}function kx(n,e,t,s){const i=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],r=e[t+2],a=r>>2&15;if(a>12){const f=new Error(`invalid ADTS sampling index:${a}`);n.emit(v.ERROR,v.ERROR,{type:Y.MEDIA_ERROR,details:w.FRAG_PARSING_ERROR,fatal:!0,error:f,reason:f.message});return}const o=(r>>6&3)+1,l=e[t+3]>>6&3|(r&1)<<2,u="mp4a.40."+o,c=i[a];let d=a;(o===5||o===29)&&(d-=3);const h=[o<<3|(d&14)>>1,(d&1)<<7|l<<3];return oe.log(`manifest codec:${s}, parsed codec:${u}, channels:${l}, rate:${c} (ADTS object type:${o} sampling index:${a})`),{config:h,samplerate:c,channelCount:l,codec:u,parsedCodec:u,manifestCodec:s}}function um(n,e){return n[e]===255&&(n[e+1]&246)===240}function cm(n,e){return n[e+1]&1?7:9}function Ec(n,e){return(n[e+3]&3)<<11|n[e+4]<<3|(n[e+5]&224)>>>5}function wx(n,e){return e+5<n.length}function ba(n,e){return e+1<n.length&&um(n,e)}function Dx(n,e){return wx(n,e)&&um(n,e)&&Ec(n,e)<=n.length-e}function Px(n,e){if(ba(n,e)){const t=cm(n,e);if(e+t>=n.length)return!1;const s=Ec(n,e);if(s<=t)return!1;const i=e+s;return i===n.length||ba(n,i)}return!1}function dm(n,e,t,s,i){if(!n.samplerate){const r=kx(e,t,s,i);if(!r)return;ue(n,r)}}function hm(n){return 1024*9e4/n}function bx(n,e){const t=cm(n,e);if(e+t<=n.length){const s=Ec(n,e)-t;if(s>0)return{headerLength:t,frameLength:s}}}function fm(n,e,t,s,i){const r=hm(n.samplerate),a=s+i*r,o=bx(e,t);let l;if(o){const{frameLength:d,headerLength:h}=o,f=h+d,g=Math.max(0,t+f-e.length);g?(l=new Uint8Array(f-h),l.set(e.subarray(t+h,e.length),0)):l=e.subarray(t+h,t+f);const p={unit:l,pts:a};return g||n.samples.push(p),{sample:p,length:f,missing:g}}const u=e.length-t;return l=new Uint8Array(u),l.set(e.subarray(t,e.length),0),{sample:{unit:l,pts:a},length:u,missing:-1}}function Nx(n,e){return vc(n,e)&&Za(n,e+6)+10<=n.length-e}function Ox(n){return n instanceof ArrayBuffer?n:n.byteOffset==0&&n.byteLength==n.buffer.byteLength?n.buffer:new Uint8Array(n).buffer}function Fo(n,e=0,t=1/0){return Mx(n,e,t,Uint8Array)}function Mx(n,e,t,s){const i=Fx(n);let r=1;"BYTES_PER_ELEMENT"in s&&(r=s.BYTES_PER_ELEMENT);const a=Bx(n)?n.byteOffset:0,o=(a+n.byteLength)/r,l=(a+e)/r,u=Math.floor(Math.max(0,Math.min(l,o))),c=Math.floor(Math.min(u+Math.max(t,0),o));return new s(i,u,c-u)}function Fx(n){return n instanceof ArrayBuffer?n:n.buffer}function Bx(n){return n&&n.buffer instanceof ArrayBuffer&&n.byteLength!==void 0&&n.byteOffset!==void 0}function Ux(n){const e={key:n.type,description:"",data:"",mimeType:null,pictureType:null},t=3;if(n.size<2)return;if(n.data[0]!==t){console.log("Ignore frame with unrecognized character encoding");return}const s=n.data.subarray(1).indexOf(0);if(s===-1)return;const i=ht(Fo(n.data,1,s)),r=n.data[2+s],a=n.data.subarray(3+s).indexOf(0);if(a===-1)return;const o=ht(Fo(n.data,3+s,a));let l;return i==="-->"?l=ht(Fo(n.data,4+s+a)):l=Ox(n.data.subarray(4+s+a)),e.mimeType=i,e.pictureType=r,e.description=o,e.data=l,e}function $x(n){if(n.size<2)return;const e=ht(n.data,!0),t=new Uint8Array(n.data.subarray(e.length+1));return{key:n.type,info:e,data:t.buffer}}function jx(n){if(n.size<2)return;if(n.type==="TXXX"){let t=1;const s=ht(n.data.subarray(t),!0);t+=s.length+1;const i=ht(n.data.subarray(t));return{key:n.type,info:s,data:i}}const e=ht(n.data.subarray(1));return{key:n.type,info:"",data:e}}function Gx(n){if(n.type==="WXXX"){if(n.size<2)return;let t=1;const s=ht(n.data.subarray(t),!0);t+=s.length+1;const i=ht(n.data.subarray(t));return{key:n.type,info:s,data:i}}const e=ht(n.data);return{key:n.type,info:"",data:e}}function Kx(n){return n.type==="PRIV"?$x(n):n.type[0]==="W"?Gx(n):n.type==="APIC"?Ux(n):jx(n)}function Vx(n){const e=String.fromCharCode(n[0],n[1],n[2],n[3]),t=Za(n,4),s=10;return{type:e,size:t,data:n.subarray(s,s+t)}}const Ar=10,Hx=10;function gm(n){let e=0;const t=[];for(;vc(n,e);){const s=Za(n,e+6);n[e+5]>>6&1&&(e+=Ar),e+=Ar;const i=e+s;for(;e+Hx<i;){const r=Vx(n.subarray(e)),a=Kx(r);a&&t.push(a),e+=r.size+Ar}lm(n,e)&&(e+=Ar)}return t}function pm(n){return n&&n.key==="PRIV"&&n.info==="com.apple.streaming.transportStreamTimestamp"}function zx(n){if(n.data.byteLength===8){const e=new Uint8Array(n.data),t=e[3]&1;let s=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return s/=45,t&&(s+=4772185884e-2),Math.round(s)}}function xc(n){const e=gm(n);for(let t=0;t<e.length;t++){const s=e[t];if(pm(s))return zx(s)}}let ut=function(n){return n.audioId3="org.id3",n.dateRange="com.apple.quicktime.HLS",n.emsg="https://aomedia.org/emsg/ID3",n.misbklv="urn:misb:KLV:bin:1910.1",n}({});function Kt(n="",e=9e4){return{type:n,id:-1,pid:-1,inputTimeScale:e,sequenceNumber:-1,samples:[],dropped:0}}class Sc{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,s,i){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,s){}demux(e,t){this.cachedData&&(e=Lt(this.cachedData,e),this.cachedData=null);let s=Wi(e,0),i=s?s.length:0,r;const a=this._audioTrack,o=this._id3Track,l=s?xc(s):void 0,u=e.length;for((this.basePTS===null||this.frameIndex===0&&j(l))&&(this.basePTS=Wx(l,t,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),s&&s.length>0&&o.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:s,type:ut.audioId3,duration:Number.POSITIVE_INFINITY});i<u;){if(this.canParse(e,i)){const c=this.appendFrame(a,e,i);c?(this.frameIndex++,this.lastPTS=c.sample.pts,i+=c.length,r=i):i=u}else Nx(e,i)?(s=Wi(e,i),o.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:s,type:ut.audioId3,duration:Number.POSITIVE_INFINITY}),i+=s.length,r=i):i++;if(i===u&&r!==u){const c=e.slice(r);this.cachedData?this.cachedData=Lt(this.cachedData,c):this.cachedData=c}}return{audioTrack:a,videoTrack:Kt(),id3Track:o,textTrack:Kt()}}demuxSampleAes(e,t,s){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:Kt(),id3Track:this._id3Track,textTrack:Kt()}}destroy(){this.cachedData=null,this._audioTrack=this._id3Track=void 0}}const Wx=(n,e,t)=>{if(j(n))return n*90;const s=t?t.baseTime*9e4/t.timescale:0;return e*9e4+s};let Lr=null;const Yx=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],qx=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],Qx=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],Xx=[0,1,1,4];function mm(n,e,t,s,i){if(t+24>e.length)return;const r=ym(e,t);if(r&&t+r.frameLength<=e.length){const a=r.samplesPerFrame*9e4/r.sampleRate,o=s+i*a,l={unit:e.subarray(t,t+r.frameLength),pts:o,dts:o};return n.config=[],n.channelCount=r.channelCount,n.samplerate=r.sampleRate,n.samples.push(l),{sample:l,length:r.frameLength,missing:0}}}function ym(n,e){const t=n[e+1]>>3&3,s=n[e+1]>>1&3,i=n[e+2]>>4&15,r=n[e+2]>>2&3;if(t!==1&&i!==0&&i!==15&&r!==3){const a=n[e+2]>>1&1,o=n[e+3]>>6,l=t===3?3-s:s===3?3:4,u=Yx[l*14+i-1]*1e3,d=qx[(t===3?0:t===2?1:2)*3+r],h=o===3?1:2,f=Qx[t][s],g=Xx[s],p=f*8*g,E=Math.floor(f*u/d+a)*g;if(Lr===null){const S=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Lr=S?parseInt(S[1]):0}return!!Lr&&Lr<=87&&s===2&&u>=224e3&&o===0&&(n[e+3]=n[e+3]|128),{sampleRate:d,channelCount:h,frameLength:E,samplesPerFrame:p}}}function Tc(n,e){return n[e]===255&&(n[e+1]&224)===224&&(n[e+1]&6)!==0}function vm(n,e){return e+1<n.length&&Tc(n,e)}function Zx(n,e){return Tc(n,e)&&4<=n.length-e}function Em(n,e){if(e+1<n.length&&Tc(n,e)){const s=ym(n,e);let i=4;s!=null&&s.frameLength&&(i=s.frameLength);const r=e+i;return r===n.length||vm(n,r)}return!1}class Jx extends Sc{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,s,i){super.resetInitSegment(e,t,s,i),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:i,inputTimeScale:9e4,dropped:0}}static probe(e,t){if(!e)return!1;const s=Wi(e,0);let i=(s==null?void 0:s.length)||0;if(Em(e,i))return!1;for(let r=e.length;i<r;i++)if(Px(e,i))return t.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return Dx(e,t)}appendFrame(e,t,s){dm(e,this.observer,t,s,e.manifestCodec);const i=fm(e,t,s,this.basePTS,this.frameIndex);if(i&&i.missing===0)return i}}const xm=(n,e)=>{let t=0,s=5;e+=s;const i=new Uint32Array(1),r=new Uint32Array(1),a=new Uint8Array(1);for(;s>0;){a[0]=n[e];const o=Math.min(s,8),l=8-o;r[0]=4278190080>>>24+l<<l,i[0]=(a[0]&r[0])>>l,t=t?t<<o|i[0]:i[0],e+=1,s-=o}return t};class eS extends Sc{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,t,s,i){super.resetInitSegment(e,t,s,i),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:i,inputTimeScale:9e4,dropped:0}}canParse(e,t){return t+64<e.length}appendFrame(e,t,s){const i=Sm(e,t,s,this.basePTS,this.frameIndex);if(i!==-1)return{sample:e.samples[e.samples.length-1],length:i,missing:0}}static probe(e){if(!e)return!1;const t=Wi(e,0);if(!t)return!1;const s=t.length;return e[s]===11&&e[s+1]===119&&xc(t)!==void 0&&xm(e,s)<16}}function Sm(n,e,t,s,i){if(t+8>e.length||e[t]!==11||e[t+1]!==119)return-1;const r=e[t+4]>>6;if(r>=3)return-1;const o=[48e3,44100,32e3][r],l=e[t+4]&63,c=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][l*3+r]*2;if(t+c>e.length)return-1;const d=e[t+6]>>5;let h=0;d===2?h+=2:(d&1&&d!==1&&(h+=2),d&4&&(h+=2));const f=(e[t+6]<<8|e[t+7])>>12-h&1,p=[2,1,2,3,3,4,4,5][d]+f,E=e[t+5]>>3,y=e[t+5]&7,m=new Uint8Array([r<<6|E<<1|y>>2,(y&3)<<6|d<<3|f<<2|l>>4,l<<4&224]),S=1536/o*9e4,T=s+i*S,A=e.subarray(t,t+c);return n.config=m,n.channelCount=p,n.samplerate=o,n.samples.push({unit:A,pts:T}),c}class tS extends Sc{resetInitSegment(e,t,s,i){super.resetInitSegment(e,t,s,i),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:i,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=Wi(e,0);let s=(t==null?void 0:t.length)||0;if(t&&e[s]===11&&e[s+1]===119&&xc(t)!==void 0&&xm(e,s)<=16)return!1;for(let i=e.length;s<i;s++)if(Em(e,s))return oe.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return Zx(e,t)}appendFrame(e,t,s){if(this.basePTS!==null)return mm(e,t,s,this.basePTS,this.frameIndex)}}const nS=/\/emsg[-/]ID3/i;class sS{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,s,i){const r=this.videoTrack=Kt("video",1),a=this.audioTrack=Kt("audio",1),o=this.txtTrack=Kt("text",1);if(this.id3Track=Kt("id3",1),this.timeOffset=0,!(e!=null&&e.byteLength))return;const l=Dp(e);if(l.video){const{id:u,timescale:c,codec:d,supplemental:h}=l.video;r.id=u,r.timescale=o.timescale=c,r.codec=d,r.supplemental=h}if(l.audio){const{id:u,timescale:c,codec:d}=l.audio;a.id=u,a.timescale=c,a.codec=d}o.id=Cp.text,r.sampleDuration=0,r.duration=a.duration=i}resetContiguity(){this.remainderData=null}static probe(e){return eE(e)}demux(e,t){this.timeOffset=t;let s=e;const i=this.videoTrack,r=this.txtTrack;if(this.config.progressive){this.remainderData&&(s=Lt(this.remainderData,e));const o=oE(s);this.remainderData=o.remainder,i.samples=o.valid||new Uint8Array}else i.samples=s;const a=this.extractID3Track(i,t);return r.samples=qd(t,i),{videoTrack:i,audioTrack:this.audioTrack,id3Track:a,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,s=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const i=this.extractID3Track(t,this.timeOffset);return s.samples=qd(e,t),{videoTrack:t,audioTrack:Kt(),id3Track:i,textTrack:Kt()}}extractID3Track(e,t){const s=this.id3Track;if(e.samples.length){const i=ee(e.samples,["emsg"]);i&&i.forEach(r=>{const a=uE(r);if(nS.test(a.schemeIdUri)){const o=Ph(a,t);let l=a.eventDuration===4294967295?Number.POSITIVE_INFINITY:a.eventDuration/a.timeScale;l<=.001&&(l=Number.POSITIVE_INFINITY);const u=a.payload;s.samples.push({data:u,len:u.byteLength,dts:o,pts:o,type:ut.emsg,duration:l})}else if(this.config.enableEmsgKLVMetadata&&a.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){const o=Ph(a,t);s.samples.push({data:a.payload,len:a.payload.byteLength,dts:o,pts:o,type:ut.misbklv,duration:Number.POSITIVE_INFINITY})}})}return s}demuxSampleAes(e,t,s){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0}}function Ph(n,e){return j(n.presentationTime)?n.presentationTime/n.timeScale:e+n.presentationTimeDelta/n.timeScale}class iS{constructor(e,t,s){this.keyData=void 0,this.decrypter=void 0,this.keyData=s,this.decrypter=new hc(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer,Mn.cbc)}decryptAacSample(e,t,s){const i=e[t].unit;if(i.length<=16)return;const r=i.subarray(16,i.length-i.length%16),a=r.buffer.slice(r.byteOffset,r.byteOffset+r.length);this.decryptBuffer(a).then(o=>{const l=new Uint8Array(o);i.set(l,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,s)}).catch(s)}decryptAacSamples(e,t,s){for(;;t++){if(t>=e.length){s();return}if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,s),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const t=Math.floor((e.length-48)/160)*16+16,s=new Int8Array(t);let i=0;for(let r=32;r<e.length-16;r+=160,i+=16)s.set(e.subarray(r,r+16),i);return s}getAvcDecryptedUnit(e,t){const s=new Uint8Array(t);let i=0;for(let r=32;r<e.length-16;r+=160,i+=16)e.set(s.subarray(i,i+16),r);return e}decryptAvcSample(e,t,s,i,r){const a=Np(r.data),o=this.getAvcEncryptedData(a);this.decryptBuffer(o.buffer).then(l=>{r.data=this.getAvcDecryptedUnit(a,l),this.decrypter.isSync()||this.decryptAvcSamples(e,t,s+1,i)}).catch(i)}decryptAvcSamples(e,t,s,i){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,s=0){if(t>=e.length){i();return}const r=e[t].units;for(;!(s>=r.length);s++){const a=r[s];if(!(a.data.length<=48||a.type!==1&&a.type!==5)&&(this.decryptAvcSample(e,t,s,i,a),!this.decrypter.isSync()))return}}}}class Tm{constructor(){this.VideoSample=null}createVideoSample(e,t,s){return{key:e,frame:!1,pts:t,dts:s,units:[],length:0}}getLastNalUnit(e){var t;let s=this.VideoSample,i;if((!s||s.units.length===0)&&(s=e[e.length-1]),(t=s)!=null&&t.units){const r=s.units;i=r[r.length-1]}return i}pushAccessUnit(e,t){if(e.units.length&&e.frame){if(e.pts===void 0){const s=t.samples,i=s.length;if(i){const r=s[i-1];e.pts=r.pts,e.dts=r.dts}else{t.dropped++;return}}t.samples.push(e)}}parseNALu(e,t,s){const i=t.byteLength;let r=e.naluState||0;const a=r,o=[];let l=0,u,c,d,h=-1,f=0;for(r===-1&&(h=0,f=this.getNALuType(t,0),r=0,l=1);l<i;){if(u=t[l++],!r){r=u?0:1;continue}if(r===1){r=u?0:2;continue}if(!u)r=3;else if(u===1){if(c=l-r-1,h>=0){const g={data:t.subarray(h,c),type:f};o.push(g)}else{const g=this.getLastNalUnit(e.samples);g&&(a&&l<=4-a&&g.state&&(g.data=g.data.subarray(0,g.data.byteLength-a)),c>0&&(g.data=Lt(g.data,t.subarray(0,c)),g.state=0))}l<i?(d=this.getNALuType(t,l),h=l,f=d,r=0):r=-1}else r=0}if(h>=0&&r>=0){const g={data:t.subarray(h,i),type:f,state:r};o.push(g)}if(o.length===0){const g=this.getLastNalUnit(e.samples);g&&(g.data=Lt(g.data,t))}return e.naluState=r,o}}class Li{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,s=e.byteLength-t,i=new Uint8Array(4),r=Math.min(4,t);if(r===0)throw new Error("no bytes available");i.set(e.subarray(s,s+r)),this.word=new DataView(i.buffer).getUint32(0),this.bitsAvailable=r*8,this.bytesAvailable-=r}skipBits(e){let t;e=Math.min(e,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const s=this.word>>>32-t;if(e>32&&oe.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return t=e-t,t>0&&this.bitsAvailable?s<<t|this.readBits(t):s}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if(this.word&2147483648>>>e)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}}class rS extends Tm{parsePES(e,t,s,i){const r=this.parseNALu(e,s.data,i);let a=this.VideoSample,o,l=!1;s.data=null,a&&r.length&&!e.audFound&&(this.pushAccessUnit(a,e),a=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts)),r.forEach(u=>{var c,d;switch(u.type){case 1:{let p=!1;o=!0;const E=u.data;if(l&&E.length>4){const y=this.readSliceType(E);(y===2||y===4||y===7||y===9)&&(p=!0)}if(p){var h;(h=a)!=null&&h.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null)}a||(a=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),a.frame=!0,a.key=p;break}case 5:o=!0,(c=a)!=null&&c.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null),a||(a=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),a.key=!0,a.frame=!0;break;case 6:{o=!0,lc(u.data,1,s.pts,t.samples);break}case 7:{var f,g;o=!0,l=!0;const p=u.data,E=this.readSPS(p);if(!e.sps||e.width!==E.width||e.height!==E.height||((f=e.pixelRatio)==null?void 0:f[0])!==E.pixelRatio[0]||((g=e.pixelRatio)==null?void 0:g[1])!==E.pixelRatio[1]){e.width=E.width,e.height=E.height,e.pixelRatio=E.pixelRatio,e.sps=[p];const y=p.subarray(1,4);let m="avc1.";for(let S=0;S<3;S++){let T=y[S].toString(16);T.length<2&&(T="0"+T),m+=T}e.codec=m}break}case 8:o=!0,e.pps=[u.data];break;case 9:o=!0,e.audFound=!0,(d=a)!=null&&d.frame&&(this.pushAccessUnit(a,e),a=null),a||(a=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts));break;case 12:o=!0;break;default:o=!1;break}a&&o&&a.units.push(u)}),i&&a&&(this.pushAccessUnit(a,e),this.VideoSample=null)}getNALuType(e,t){return e[t]&31}readSliceType(e){const t=new Li(e);return t.readUByte(),t.readUEG(),t.readUEG()}skipScalingList(e,t){let s=8,i=8,r;for(let a=0;a<e;a++)i!==0&&(r=t.readEG(),i=(s+r+256)%256),s=i===0?s:i}readSPS(e){const t=new Li(e);let s=0,i=0,r=0,a=0,o,l,u;const c=t.readUByte.bind(t),d=t.readBits.bind(t),h=t.readUEG.bind(t),f=t.readBoolean.bind(t),g=t.skipBits.bind(t),p=t.skipEG.bind(t),E=t.skipUEG.bind(t),y=this.skipScalingList.bind(this);c();const m=c();if(d(5),g(3),c(),E(),m===100||m===110||m===122||m===244||m===44||m===83||m===86||m===118||m===128){const R=h();if(R===3&&g(1),E(),E(),g(1),f())for(l=R!==3?8:12,u=0;u<l;u++)f()&&(u<6?y(16,t):y(64,t))}E();const S=h();if(S===0)h();else if(S===1)for(g(1),p(),p(),o=h(),u=0;u<o;u++)p();E(),g(1);const T=h(),A=h(),_=d(1);_===0&&g(1),g(1),f()&&(s=h(),i=h(),r=h(),a=h());let L=[1,1];if(f()&&f())switch(c()){case 1:L=[1,1];break;case 2:L=[12,11];break;case 3:L=[10,11];break;case 4:L=[16,11];break;case 5:L=[40,33];break;case 6:L=[24,11];break;case 7:L=[20,11];break;case 8:L=[32,11];break;case 9:L=[80,33];break;case 10:L=[18,11];break;case 11:L=[15,11];break;case 12:L=[64,33];break;case 13:L=[160,99];break;case 14:L=[4,3];break;case 15:L=[3,2];break;case 16:L=[2,1];break;case 255:{L=[c()<<8|c(),c()<<8|c()];break}}return{width:Math.ceil((T+1)*16-s*2-i*2),height:(2-_)*(A+1)*16-(_?2:4)*(r+a),pixelRatio:L}}}class aS extends Tm{constructor(...e){super(...e),this.initVPS=null}parsePES(e,t,s,i){const r=this.parseNALu(e,s.data,i);let a=this.VideoSample,o,l=!1;s.data=null,a&&r.length&&!e.audFound&&(this.pushAccessUnit(a,e),a=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts)),r.forEach(u=>{var c,d;switch(u.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:a||(a=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts)),a.frame=!0,o=!0;break;case 16:case 17:case 18:case 21:if(o=!0,l){var h;(h=a)!=null&&h.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null)}a||(a=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),a.key=!0,a.frame=!0;break;case 19:case 20:o=!0,(c=a)!=null&&c.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null),a||(a=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),a.key=!0,a.frame=!0;break;case 39:o=!0,lc(u.data,2,s.pts,t.samples);break;case 32:o=!0,e.vps||(typeof e.params!="object"&&(e.params={}),e.params=ue(e.params,this.readVPS(u.data)),this.initVPS=u.data),e.vps=[u.data];break;case 33:if(o=!0,l=!0,e.vps!==void 0&&e.vps[0]!==this.initVPS&&e.sps!==void 0&&!this.matchSPS(e.sps[0],u.data)&&(this.initVPS=e.vps[0],e.sps=e.pps=void 0),!e.sps){const f=this.readSPS(u.data);e.width=f.width,e.height=f.height,e.pixelRatio=f.pixelRatio,e.codec=f.codecString,e.sps=[],typeof e.params!="object"&&(e.params={});for(const g in f.params)e.params[g]=f.params[g]}this.pushParameterSet(e.sps,u.data,e.vps),a||(a=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),a.key=!0;break;case 34:if(o=!0,typeof e.params=="object"){if(!e.pps){e.pps=[];const f=this.readPPS(u.data);for(const g in f)e.params[g]=f[g]}this.pushParameterSet(e.pps,u.data,e.vps)}break;case 35:o=!0,e.audFound=!0,(d=a)!=null&&d.frame&&(this.pushAccessUnit(a,e),a=null),a||(a=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts));break;default:o=!1;break}a&&o&&a.units.push(u)}),i&&a&&(this.pushAccessUnit(a,e),this.VideoSample=null)}pushParameterSet(e,t,s){(s&&s[0]===this.initVPS||!s&&!e.length)&&e.push(t)}getNALuType(e,t){return(e[t]&126)>>>1}ebsp2rbsp(e){const t=new Uint8Array(e.byteLength);let s=0;for(let i=0;i<e.byteLength;i++)i>=2&&e[i]===3&&e[i-1]===0&&e[i-2]===0||(t[s]=e[i],s++);return new Uint8Array(t.buffer,0,s)}pushAccessUnit(e,t){super.pushAccessUnit(e,t),this.initVPS&&(this.initVPS=null)}readVPS(e){const t=new Li(e);t.readUByte(),t.readUByte(),t.readBits(4),t.skipBits(2),t.readBits(6);const s=t.readBits(3),i=t.readBoolean();return{numTemporalLayers:s+1,temporalIdNested:i}}readSPS(e){const t=new Li(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.readBits(4);const s=t.readBits(3);t.readBoolean();const i=t.readBits(2),r=t.readBoolean(),a=t.readBits(5),o=t.readUByte(),l=t.readUByte(),u=t.readUByte(),c=t.readUByte(),d=t.readUByte(),h=t.readUByte(),f=t.readUByte(),g=t.readUByte(),p=t.readUByte(),E=t.readUByte(),y=t.readUByte(),m=[],S=[];for(let re=0;re<s;re++)m.push(t.readBoolean()),S.push(t.readBoolean());if(s>0)for(let re=s;re<8;re++)t.readBits(2);for(let re=0;re<s;re++)m[re]&&(t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte()),S[re]&&t.readUByte();t.readUEG();const T=t.readUEG();T==3&&t.skipBits(1);const A=t.readUEG(),_=t.readUEG(),L=t.readBoolean();let R=0,C=0,I=0,P=0;L&&(R+=t.readUEG(),C+=t.readUEG(),I+=t.readUEG(),P+=t.readUEG());const $=t.readUEG(),G=t.readUEG(),W=t.readUEG(),K=t.readBoolean();for(let re=K?0:s;re<=s;re++)t.skipUEG(),t.skipUEG(),t.skipUEG();if(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.readBoolean()&&t.readBoolean())for(let Ge=0;Ge<4;Ge++)for(let yt=0;yt<(Ge===3?2:6);yt++)if(!t.readBoolean())t.readUEG();else{const Rt=Math.min(64,1<<4+(Ge<<1));Ge>1&&t.readEG();for(let us=0;us<Rt;us++)t.readEG()}t.readBoolean(),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.skipUEG(),t.skipUEG(),t.readBoolean());const D=t.readUEG();let N=0;for(let re=0;re<D;re++){let Ge=!1;if(re!==0&&(Ge=t.readBoolean()),Ge){re===D&&t.readUEG(),t.readBoolean(),t.readUEG();let yt=0;for(let jn=0;jn<=N;jn++){const Rt=t.readBoolean();let us=!1;Rt||(us=t.readBoolean()),(Rt||us)&&yt++}N=yt}else{const yt=t.readUEG(),jn=t.readUEG();N=yt+jn;for(let Rt=0;Rt<yt;Rt++)t.readUEG(),t.readBoolean();for(let Rt=0;Rt<jn;Rt++)t.readUEG(),t.readBoolean()}}if(t.readBoolean()){const re=t.readUEG();for(let Ge=0;Ge<re;Ge++){for(let yt=0;yt<W+4;yt++)t.readBits(1);t.readBits(1)}}let O=0,M=1,Q=1,te=!0,Z=1,J=0;t.readBoolean(),t.readBoolean();let Ae=!1;if(t.readBoolean()){if(t.readBoolean()){const Gn=t.readUByte(),wc=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],tr=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];Gn>0&&Gn<16?(M=wc[Gn-1],Q=tr[Gn-1]):Gn===255&&(M=t.readBits(16),Q=t.readBits(16))}if(t.readBoolean()&&t.readBoolean(),t.readBoolean()&&(t.readBits(3),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.readUByte(),t.readUByte())),t.readBoolean()&&(t.readUEG(),t.readUEG()),t.readBoolean(),t.readBoolean(),t.readBoolean(),Ae=t.readBoolean(),Ae&&(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG()),t.readBoolean()&&(Z=t.readBits(32),J=t.readBits(32),t.readBoolean()&&t.readUEG(),t.readBoolean())){const tr=t.readBoolean(),Dc=t.readBoolean();let Zs=!1;(tr||Dc)&&(Zs=t.readBoolean(),Zs&&(t.readUByte(),t.readBits(5),t.readBoolean(),t.readBits(5)),t.readBits(4),t.readBits(4),Zs&&t.readBits(4),t.readBits(5),t.readBits(5),t.readBits(5));for(let Pc=0;Pc<=s;Pc++){te=t.readBoolean();const r0=te||t.readBoolean();let bc=!1;r0?t.readEG():bc=t.readBoolean();const Nc=bc?1:t.readUEG()+1;if(tr)for(let Js=0;Js<Nc;Js++)t.readUEG(),t.readUEG(),Zs&&(t.readUEG(),t.readUEG()),t.skipBits(1);if(Dc)for(let Js=0;Js<Nc;Js++)t.readUEG(),t.readUEG(),Zs&&(t.readUEG(),t.readUEG()),t.skipBits(1)}}t.readBoolean()&&(t.readBoolean(),t.readBoolean(),t.readBoolean(),O=t.readUEG())}let mt=A,Ft=_;if(L){let re=1,Ge=1;T===1?re=Ge=2:T==2&&(re=2),mt=A-re*C-re*R,Ft=_-Ge*P-Ge*I}const $n=i?["A","B","C"][i]:"",i0=o<<24|l<<16|u<<8|c;let eo=0;for(let re=0;re<32;re++)eo=(eo|(i0>>re&1)<<31-re)>>>0;let to=eo.toString(16);return a===1&&to==="2"&&(to="6"),{codecString:`hvc1.${$n}${a}.${to}.${r?"H":"L"}${y}.B0`,params:{general_tier_flag:r,general_profile_idc:a,general_profile_space:i,general_profile_compatibility_flags:[o,l,u,c],general_constraint_indicator_flags:[d,h,f,g,p,E],general_level_idc:y,bit_depth:$+8,bit_depth_luma_minus8:$,bit_depth_chroma_minus8:G,min_spatial_segmentation_idc:O,chroma_format_idc:T,frame_rate:{fixed:te,fps:J/Z}},width:mt,height:Ft,pixelRatio:[M,Q]}}readPPS(e){const t=new Li(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.skipUEG(),t.skipUEG(),t.skipBits(2),t.skipBits(3),t.skipBits(2),t.skipUEG(),t.skipUEG(),t.skipEG(),t.skipBits(2),t.readBoolean()&&t.skipUEG(),t.skipEG(),t.skipEG(),t.skipBits(4);const i=t.readBoolean(),r=t.readBoolean();let a=1;return r&&i?a=0:r?a=3:i&&(a=2),{parallelismType:a}}matchSPS(e,t){return String.fromCharCode.apply(null,e).substr(3)===String.fromCharCode.apply(null,t).substr(3)}}const Pe=188;class En{constructor(e,t,s,i){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=s,this.logger=i,this.videoParser=null}static probe(e,t){const s=En.syncOffset(e);return s>0&&t.warn(`MPEG2-TS detected but first sync word found @ offset ${s}`),s!==-1}static syncOffset(e){const t=e.length;let s=Math.min(Pe*5,t-Pe)+1,i=0;for(;i<s;){let r=!1,a=-1,o=0;for(let l=i;l<t;l+=Pe)if(e[l]===71&&(t-l===Pe||e[l+Pe]===71)){if(o++,a===-1&&(a=l,a!==0&&(s=Math.min(a+Pe*99,e.length-Pe)+1)),r||(r=eu(e,l)===0),r&&o>1&&(a===0&&o>2||l+Pe>s))return a}else{if(o)return-1;break}i++}return-1}static createTrack(e,t){return{container:e==="video"||e==="audio"?"video/mp2t":void 0,type:e,id:Cp[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:e==="audio"?t:void 0}}resetInitSegment(e,t,s,i){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=En.createTrack("video"),this._videoTrack.duration=i,this._audioTrack=En.createTrack("audio",i),this._id3Track=En.createTrack("id3"),this._txtTrack=En.createTrack("text"),this._audioTrack.segmentCodec="aac",this.videoParser=null,this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=s}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_videoTrack:t,_id3Track:s}=this;e&&(e.pesData=null),t&&(t.pesData=null),s&&(s.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,t,s=!1,i=!1){s||(this.sampleAes=null);let r;const a=this._videoTrack,o=this._audioTrack,l=this._id3Track,u=this._txtTrack;let c=a.pid,d=a.pesData,h=o.pid,f=l.pid,g=o.pesData,p=l.pesData,E=null,y=this.pmtParsed,m=this._pmtId,S=e.length;if(this.remainderData&&(e=Lt(this.remainderData,e),S=e.length,this.remainderData=null),S<Pe&&!i)return this.remainderData=e,{audioTrack:o,videoTrack:a,id3Track:l,textTrack:u};const T=Math.max(0,En.syncOffset(e));S-=(S-T)%Pe,S<e.byteLength&&!i&&(this.remainderData=new Uint8Array(e.buffer,S,e.buffer.byteLength-S));let A=0;for(let L=T;L<S;L+=Pe)if(e[L]===71){const R=!!(e[L+1]&64),C=eu(e,L),I=(e[L+3]&48)>>4;let P;if(I>1){if(P=L+5+e[L+4],P===L+Pe)continue}else P=L+4;switch(C){case c:R&&(d&&(r=gs(d,this.logger))&&(this.readyVideoParser(a.segmentCodec),this.videoParser!==null&&this.videoParser.parsePES(a,u,r,!1)),d={data:[],size:0}),d&&(d.data.push(e.subarray(P,L+Pe)),d.size+=L+Pe-P);break;case h:if(R){if(g&&(r=gs(g,this.logger)))switch(o.segmentCodec){case"aac":this.parseAACPES(o,r);break;case"mp3":this.parseMPEGPES(o,r);break;case"ac3":this.parseAC3PES(o,r);break}g={data:[],size:0}}g&&(g.data.push(e.subarray(P,L+Pe)),g.size+=L+Pe-P);break;case f:R&&(p&&(r=gs(p,this.logger))&&this.parseID3PES(l,r),p={data:[],size:0}),p&&(p.data.push(e.subarray(P,L+Pe)),p.size+=L+Pe-P);break;case 0:R&&(P+=e[P]+1),m=this._pmtId=oS(e,P);break;case m:{R&&(P+=e[P]+1);const $=lS(e,P,this.typeSupported,s,this.observer,this.logger);c=$.videoPid,c>0&&(a.pid=c,a.segmentCodec=$.segmentVideoCodec),h=$.audioPid,h>0&&(o.pid=h,o.segmentCodec=$.segmentAudioCodec),f=$.id3Pid,f>0&&(l.pid=f),E!==null&&!y&&(this.logger.warn(`MPEG-TS PMT found at ${L} after unknown PID '${E}'. Backtracking to sync byte @${T} to parse all TS packets.`),E=null,L=T-188),y=this.pmtParsed=!0;break}case 17:case 8191:break;default:E=C;break}}else A++;A>0&&tu(this.observer,new Error(`Found ${A} TS packet/s that do not start with 0x47`),void 0,this.logger),a.pesData=d,o.pesData=g,l.pesData=p;const _={audioTrack:o,videoTrack:a,id3Track:l,textTrack:u};return i&&this.extractRemainingSamples(_),_}flush(){const{remainderData:e}=this;this.remainderData=null;let t;return e?t=this.demux(e,-1,!1,!0):t={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:s,id3Track:i,textTrack:r}=e,a=s.pesData,o=t.pesData,l=i.pesData;let u;if(a&&(u=gs(a,this.logger))?(this.readyVideoParser(s.segmentCodec),this.videoParser!==null&&(this.videoParser.parsePES(s,r,u,!0),s.pesData=null)):s.pesData=a,o&&(u=gs(o,this.logger))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,u);break;case"mp3":this.parseMPEGPES(t,u);break;case"ac3":this.parseAC3PES(t,u);break}t.pesData=null}else o!=null&&o.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=o;l&&(u=gs(l,this.logger))?(this.parseID3PES(i,u),i.pesData=null):i.pesData=l}demuxSampleAes(e,t,s){const i=this.demux(e,s,!0,!this.config.progressive),r=this.sampleAes=new iS(this.observer,this.config,t);return this.decrypt(i,r)}readyVideoParser(e){this.videoParser===null&&(e==="avc"?this.videoParser=new rS:e==="hevc"&&(this.videoParser=new aS))}decrypt(e,t){return new Promise(s=>{const{audioTrack:i,videoTrack:r}=e;i.samples&&i.segmentCodec==="aac"?t.decryptAacSamples(i.samples,0,()=>{r.samples?t.decryptAvcSamples(r.samples,0,0,()=>{s(e)}):s(e)}):r.samples&&t.decryptAvcSamples(r.samples,0,0,()=>{s(e)})})}destroy(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0}parseAACPES(e,t){let s=0;const i=this.aacOverFlow;let r=t.data;if(i){this.aacOverFlow=null;const d=i.missing,h=i.sample.unit.byteLength;if(d===-1)r=Lt(i.sample.unit,r);else{const f=h-d;i.sample.unit.set(r.subarray(0,d),f),e.samples.push(i.sample),s=i.missing}}let a,o;for(a=s,o=r.length;a<o-1&&!ba(r,a);a++);if(a!==s){let d;const h=a<o-1;if(h?d=`AAC PES did not start with ADTS header,offset:${a}`:d="No ADTS header found in AAC PES",tu(this.observer,new Error(d),h,this.logger),!h)return}dm(e,this.observer,r,a,this.audioCodec);let l;if(t.pts!==void 0)l=t.pts;else if(i){const d=hm(e.samplerate);l=i.sample.pts+d}else{this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}let u=0,c;for(;a<o;)if(c=fm(e,r,a,l,u),a+=c.length,c.missing){this.aacOverFlow=c;break}else for(u++;a<o-1&&!ba(r,a);a++);}parseMPEGPES(e,t){const s=t.data,i=s.length;let r=0,a=0;const o=t.pts;if(o===void 0){this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;a<i;)if(vm(s,a)){const l=mm(e,s,a,o,r);if(l)a+=l.length,r++;else break}else a++}parseAC3PES(e,t){{const s=t.data,i=t.pts;if(i===void 0){this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");return}const r=s.length;let a=0,o=0,l;for(;o<r&&(l=Sm(e,s,o,i,a++))>0;)o+=l}}parseID3PES(e,t){if(t.pts===void 0){this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const s=ue({},t,{type:this._videoTrack?ut.emsg:ut.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(s)}}function eu(n,e){return((n[e+1]&31)<<8)+n[e+2]}function oS(n,e){return(n[e+10]&31)<<8|n[e+11]}function lS(n,e,t,s,i,r){const a={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},o=(n[e+1]&15)<<8|n[e+2],l=e+3+o-4,u=(n[e+10]&15)<<8|n[e+11];for(e+=12+u;e<l;){const c=eu(n,e),d=(n[e+3]&15)<<8|n[e+4];switch(n[e]){case 207:if(!s){Bo("ADTS AAC",r);break}case 15:a.audioPid===-1&&(a.audioPid=c);break;case 21:a.id3Pid===-1&&(a.id3Pid=c);break;case 219:if(!s){Bo("H.264",r);break}case 27:a.videoPid===-1&&(a.videoPid=c);break;case 3:case 4:!t.mpeg&&!t.mp3?r.log("MPEG audio found, not supported in this browser"):a.audioPid===-1&&(a.audioPid=c,a.segmentAudioCodec="mp3");break;case 193:if(!s){Bo("AC-3",r);break}case 129:t.ac3?a.audioPid===-1&&(a.audioPid=c,a.segmentAudioCodec="ac3"):r.log("AC-3 audio found, not supported in this browser");break;case 6:if(a.audioPid===-1&&d>0){let h=e+5,f=d;for(;f>2;){switch(n[h]){case 106:t.ac3!==!0?r.log("AC-3 audio found, not supported in this browser for now"):(a.audioPid=c,a.segmentAudioCodec="ac3");break}const p=n[h+1]+2;h+=p,f-=p}}break;case 194:case 135:return tu(i,new Error("Unsupported EC-3 in M2TS found"),void 0,r),a;case 36:a.videoPid===-1&&(a.videoPid=c,a.segmentVideoCodec="hevc",r.log("HEVC in M2TS found"));break}e+=d+5}return a}function tu(n,e,t,s){s.warn(`parsing error: ${e.message}`),n.emit(v.ERROR,v.ERROR,{type:Y.MEDIA_ERROR,details:w.FRAG_PARSING_ERROR,fatal:!1,levelRetry:t,error:e,reason:e.message})}function Bo(n,e){e.log(`${n} with AES-128-CBC encryption found in unencrypted stream`)}function gs(n,e){let t=0,s,i,r,a,o;const l=n.data;if(!n||n.size===0)return null;for(;l[0].length<19&&l.length>1;)l[0]=Lt(l[0],l[1]),l.splice(1,1);if(s=l[0],(s[0]<<16)+(s[1]<<8)+s[2]===1){if(i=(s[4]<<8)+s[5],i&&i>n.size-6)return null;const c=s[7];c&192&&(a=(s[9]&14)*536870912+(s[10]&255)*4194304+(s[11]&254)*16384+(s[12]&255)*128+(s[13]&254)/2,c&64?(o=(s[14]&14)*536870912+(s[15]&255)*4194304+(s[16]&254)*16384+(s[17]&255)*128+(s[18]&254)/2,a-o>60*9e4&&(e.warn(`${Math.round((a-o)/9e4)}s delta between PTS and DTS, align them`),a=o)):o=a),r=s[8];let d=r+9;if(n.size<=d)return null;n.size-=d;const h=new Uint8Array(n.size);for(let f=0,g=l.length;f<g;f++){s=l[f];let p=s.byteLength;if(d)if(d>p){d-=p;continue}else s=s.subarray(d),p-=d,d=0;h.set(s,t),t+=p}return i&&(i-=r+3),{data:h,pts:a,dts:o,len:i}}return null}class uS{static getSilentFrame(e,t){switch(e){case"mp4a.40.2":if(t===1)return new Uint8Array([0,200,0,128,35,128]);if(t===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(t===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(t===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(t===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(t===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(t===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const gn=Math.pow(2,32)-1;class k{static init(){k.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let e;for(e in k.types)k.types.hasOwnProperty(e)&&(k.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),s=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);k.HDLR_TYPES={video:t,audio:s};const i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),r=new Uint8Array([0,0,0,0,0,0,0,0]);k.STTS=k.STSC=k.STCO=r,k.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),k.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),k.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),k.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const a=new Uint8Array([105,115,111,109]),o=new Uint8Array([97,118,99,49]),l=new Uint8Array([0,0,0,1]);k.FTYP=k.box(k.types.ftyp,a,l,a,o),k.DINF=k.box(k.types.dinf,k.box(k.types.dref,i))}static box(e,...t){let s=8,i=t.length;const r=i;for(;i--;)s+=t[i].byteLength;const a=new Uint8Array(s);for(a[0]=s>>24&255,a[1]=s>>16&255,a[2]=s>>8&255,a[3]=s&255,a.set(e,4),i=0,s=8;i<r;i++)a.set(t[i],s),s+=t[i].byteLength;return a}static hdlr(e){return k.box(k.types.hdlr,k.HDLR_TYPES[e])}static mdat(e){return k.box(k.types.mdat,e)}static mdhd(e,t){t*=e;const s=Math.floor(t/(gn+1)),i=Math.floor(t%(gn+1));return k.box(k.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,s>>24,s>>16&255,s>>8&255,s&255,i>>24,i>>16&255,i>>8&255,i&255,85,196,0,0]))}static mdia(e){return k.box(k.types.mdia,k.mdhd(e.timescale||0,e.duration||0),k.hdlr(e.type),k.minf(e))}static mfhd(e){return k.box(k.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255]))}static minf(e){return e.type==="audio"?k.box(k.types.minf,k.box(k.types.smhd,k.SMHD),k.DINF,k.stbl(e)):k.box(k.types.minf,k.box(k.types.vmhd,k.VMHD),k.DINF,k.stbl(e))}static moof(e,t,s){return k.box(k.types.moof,k.mfhd(e),k.traf(s,t))}static moov(e){let t=e.length;const s=[];for(;t--;)s[t]=k.trak(e[t]);return k.box.apply(null,[k.types.moov,k.mvhd(e[0].timescale||0,e[0].duration||0)].concat(s).concat(k.mvex(e)))}static mvex(e){let t=e.length;const s=[];for(;t--;)s[t]=k.trex(e[t]);return k.box.apply(null,[k.types.mvex,...s])}static mvhd(e,t){t*=e;const s=Math.floor(t/(gn+1)),i=Math.floor(t%(gn+1)),r=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,s>>24,s>>16&255,s>>8&255,s&255,i>>24,i>>16&255,i>>8&255,i&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return k.box(k.types.mvhd,r)}static sdtp(e){const t=e.samples||[],s=new Uint8Array(4+t.length);let i,r;for(i=0;i<t.length;i++)r=t[i].flags,s[i+4]=r.dependsOn<<4|r.isDependedOn<<2|r.hasRedundancy;return k.box(k.types.sdtp,s)}static stbl(e){return k.box(k.types.stbl,k.stsd(e),k.box(k.types.stts,k.STTS),k.box(k.types.stsc,k.STSC),k.box(k.types.stsz,k.STSZ),k.box(k.types.stco,k.STCO))}static avc1(e){let t=[],s=[],i,r,a;for(i=0;i<e.sps.length;i++)r=e.sps[i],a=r.byteLength,t.push(a>>>8&255),t.push(a&255),t=t.concat(Array.prototype.slice.call(r));for(i=0;i<e.pps.length;i++)r=e.pps[i],a=r.byteLength,s.push(a>>>8&255),s.push(a&255),s=s.concat(Array.prototype.slice.call(r));const o=k.box(k.types.avcC,new Uint8Array([1,t[3],t[4],t[5],255,224|e.sps.length].concat(t).concat([e.pps.length]).concat(s))),l=e.width,u=e.height,c=e.pixelRatio[0],d=e.pixelRatio[1];return k.box(k.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,l>>8&255,l&255,u>>8&255,u&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),o,k.box(k.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),k.box(k.types.pasp,new Uint8Array([c>>24,c>>16&255,c>>8&255,c&255,d>>24,d>>16&255,d>>8&255,d&255])))}static esds(e){const t=e.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2,...t,6,1,2])}static audioStsd(e){const t=e.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount||0,0,16,0,0,0,0,t>>8&255,t&255,0,0])}static mp4a(e){return k.box(k.types.mp4a,k.audioStsd(e),k.box(k.types.esds,k.esds(e)))}static mp3(e){return k.box(k.types[".mp3"],k.audioStsd(e))}static ac3(e){return k.box(k.types["ac-3"],k.audioStsd(e),k.box(k.types.dac3,e.config))}static stsd(e){const{segmentCodec:t}=e;if(e.type==="audio"){if(t==="aac")return k.box(k.types.stsd,k.STSD,k.mp4a(e));if(t==="ac3"&&e.config)return k.box(k.types.stsd,k.STSD,k.ac3(e));if(t==="mp3"&&e.codec==="mp3")return k.box(k.types.stsd,k.STSD,k.mp3(e))}else if(e.pps&&e.sps){if(t==="avc")return k.box(k.types.stsd,k.STSD,k.avc1(e));if(t==="hevc"&&e.vps)return k.box(k.types.stsd,k.STSD,k.hvc1(e))}else throw new Error("video track missing pps or sps");throw new Error(`unsupported ${e.type} segment codec (${t}/${e.codec})`)}static tkhd(e){const t=e.id,s=(e.duration||0)*(e.timescale||0),i=e.width||0,r=e.height||0,a=Math.floor(s/(gn+1)),o=Math.floor(s%(gn+1));return k.box(k.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,0,0,0,0,a>>24,a>>16&255,a>>8&255,a&255,o>>24,o>>16&255,o>>8&255,o&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,i>>8&255,i&255,0,0,r>>8&255,r&255,0,0]))}static traf(e,t){const s=k.sdtp(e),i=e.id,r=Math.floor(t/(gn+1)),a=Math.floor(t%(gn+1));return k.box(k.types.traf,k.box(k.types.tfhd,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,i&255])),k.box(k.types.tfdt,new Uint8Array([1,0,0,0,r>>24,r>>16&255,r>>8&255,r&255,a>>24,a>>16&255,a>>8&255,a&255])),k.trun(e,s.length+16+20+8+16+8+8),s)}static trak(e){return e.duration=e.duration||4294967295,k.box(k.types.trak,k.tkhd(e),k.mdia(e))}static trex(e){const t=e.id;return k.box(k.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){const s=e.samples||[],i=s.length,r=12+16*i,a=new Uint8Array(r);let o,l,u,c,d,h;for(t+=8+r,a.set([e.type==="video"?1:0,0,15,1,i>>>24&255,i>>>16&255,i>>>8&255,i&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255],0),o=0;o<i;o++)l=s[o],u=l.duration,c=l.size,d=l.flags,h=l.cts,a.set([u>>>24&255,u>>>16&255,u>>>8&255,u&255,c>>>24&255,c>>>16&255,c>>>8&255,c&255,d.isLeading<<2|d.dependsOn,d.isDependedOn<<6|d.hasRedundancy<<4|d.paddingValue<<1|d.isNonSync,d.degradPrio&61440,d.degradPrio&15,h>>>24&255,h>>>16&255,h>>>8&255,h&255],12+16*o);return k.box(k.types.trun,a)}static initSegment(e){k.types||k.init();const t=k.moov(e);return Lt(k.FTYP,t)}static hvc1(e){const t=e.params,s=[e.vps,e.sps,e.pps],i=4,r=new Uint8Array([1,t.general_profile_space<<6|(t.general_tier_flag?32:0)|t.general_profile_idc,t.general_profile_compatibility_flags[0],t.general_profile_compatibility_flags[1],t.general_profile_compatibility_flags[2],t.general_profile_compatibility_flags[3],t.general_constraint_indicator_flags[0],t.general_constraint_indicator_flags[1],t.general_constraint_indicator_flags[2],t.general_constraint_indicator_flags[3],t.general_constraint_indicator_flags[4],t.general_constraint_indicator_flags[5],t.general_level_idc,240|t.min_spatial_segmentation_idc>>8,255&t.min_spatial_segmentation_idc,252|t.parallelismType,252|t.chroma_format_idc,248|t.bit_depth_luma_minus8,248|t.bit_depth_chroma_minus8,0,parseInt(t.frame_rate.fps),i-1|t.temporal_id_nested<<2|t.num_temporal_layers<<3|(t.frame_rate.fixed?64:0),s.length]);let a=r.length;for(let g=0;g<s.length;g+=1){a+=3;for(let p=0;p<s[g].length;p+=1)a+=2+s[g][p].length}const o=new Uint8Array(a);o.set(r,0),a=r.length;const l=s.length-1;for(let g=0;g<s.length;g+=1){o.set(new Uint8Array([32+g|(g===l?128:0),0,s[g].length]),a),a+=3;for(let p=0;p<s[g].length;p+=1)o.set(new Uint8Array([s[g][p].length>>8,s[g][p].length&255]),a),a+=2,o.set(s[g][p],a),a+=s[g][p].length}const u=k.box(k.types.hvcC,o),c=e.width,d=e.height,h=e.pixelRatio[0],f=e.pixelRatio[1];return k.box(k.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,c>>8&255,c&255,d>>8&255,d&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),u,k.box(k.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),k.box(k.types.pasp,new Uint8Array([h>>24,h>>16&255,h>>8&255,h&255,f>>24,f>>16&255,f>>8&255,f&255])))}}k.types=void 0;k.HDLR_TYPES=void 0;k.STTS=void 0;k.STSC=void 0;k.STCO=void 0;k.STSZ=void 0;k.VMHD=void 0;k.SMHD=void 0;k.STSD=void 0;k.FTYP=void 0;k.DINF=void 0;const Am=9e4;function Ac(n,e,t=1,s=!1){const i=n*e*t;return s?Math.round(i):i}function cS(n,e,t=1,s=!1){return Ac(n,e,1/t,s)}function li(n,e=!1){return Ac(n,1e3,1/Am,e)}function dS(n,e=1){return Ac(n,Am,1/e)}function bh(n){const{baseTime:e,timescale:t,trackId:s}=n;return`${e/t} (${e}/${t}) trackId: ${s}`}const hS=10*1e3,fS=1024,gS=1152,pS=1536;let ps=null,Uo=null;function Nh(n,e,t,s){return{duration:e,size:t,cts:s,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:n?2:1,isNonSync:n?0:1}}}class qr extends It{constructor(e,t,s,i){if(super("mp4-remuxer",i),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextVideoTs=null,this.nextAudioTs=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=s,this.ISGenerated=!1,ps===null){const a=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);ps=a?parseInt(a[1]):0}if(Uo===null){const r=navigator.userAgent.match(/Safari\/(\d+)/i);Uo=r?parseInt(r[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){const t=this._initPTS;(!t||!e||e.trackId!==t.trackId||e.baseTime!==t.baseTime||e.timescale!==t.timescale)&&this.log(`Reset initPTS: ${t&&bh(t)} > ${e&&bh(e)}`),this._initPTS=this._initDTS=e}resetNextTimestamp(){this.log("reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){this.log("ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let t=!1;const s=e[0].pts,i=e.reduce((r,a)=>{let o=a.pts,l=o-r;return l<-4294967296&&(t=!0,o=ot(o,s),l=o-r),l>0?r:o},s);return t&&this.debug("PTS rollover detected"),i}remux(e,t,s,i,r,a,o,l){let u,c,d,h,f,g,p=r,E=r;const y=e.pid>-1,m=t.pid>-1,S=t.samples.length,T=e.samples.length>0,A=o&&S>0||S>1;if((!y||T)&&(!m||A)||this.ISGenerated||o){if(this.ISGenerated){var L,R,C,I;const W=this.videoTrackConfig;(W&&(t.width!==W.width||t.height!==W.height||((L=t.pixelRatio)==null?void 0:L[0])!==((R=W.pixelRatio)==null?void 0:R[0])||((C=t.pixelRatio)==null?void 0:C[1])!==((I=W.pixelRatio)==null?void 0:I[1]))||!W&&A||this.nextAudioTs===null&&T)&&this.resetInitSegment()}this.ISGenerated||(d=this.generateIS(e,t,r,a));const P=this.isVideoContiguous;let $=-1,G;if(A&&($=mS(t.samples),!P&&this.config.forceKeyFrameOnDiscontinuity))if(g=!0,$>0){this.warn(`Dropped ${$} out of ${S} video samples due to a missing keyframe`);const W=this.getVideoStartPts(t.samples);t.samples=t.samples.slice($),t.dropped+=$,E+=(t.samples[0].pts-W)/t.inputTimeScale,G=E}else $===-1&&(this.warn(`No keyframe found out of ${S} video samples`),g=!1);if(this.ISGenerated){if(T&&A){const W=this.getVideoStartPts(t.samples),B=(ot(e.samples[0].pts,W)-W)/t.inputTimeScale;p+=Math.max(0,B),E+=Math.max(0,-B)}if(T){if(e.samplerate||(this.warn("regenerate InitSegment as audio detected"),d=this.generateIS(e,t,r,a)),c=this.remuxAudio(e,p,this.isAudioContiguous,a,m||A||l===H.AUDIO?E:void 0),A){const W=c?c.endPTS-c.startPTS:0;t.inputTimeScale||(this.warn("regenerate InitSegment as video detected"),d=this.generateIS(e,t,r,a)),u=this.remuxVideo(t,E,P,W)}}else A&&(u=this.remuxVideo(t,E,P,0));u&&(u.firstKeyFrame=$,u.independent=$!==-1,u.firstKeyFramePTS=G)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(s.samples.length&&(f=Lm(s,r,this._initPTS,this._initDTS)),i.samples.length&&(h=Im(i,r,this._initPTS))),{audio:c,video:u,initSegment:d,independent:g,text:h,id3:f}}computeInitPts(e,t,s,i){const r=Math.round(s*t);let a=ot(e,r);if(a<r+t)for(this.log(`Adjusting PTS for rollover in timeline near ${(r-a)/t} ${i}`);a<r+t;)a+=8589934592;return a-r}generateIS(e,t,s,i){const r=e.samples,a=t.samples,o=this.typeSupported,l={},u=this._initPTS;let c=!u||i,d="audio/mp4",h,f,g,p=-1;if(c&&(h=f=1/0),e.config&&r.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":o.mpeg?(d="audio/mpeg",e.codec=""):o.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3";break}l.audio={id:"audio",container:d,codec:e.codec,initSegment:e.segmentCodec==="mp3"&&o.mpeg?new Uint8Array(0):k.initSegment([e]),metadata:{channelCount:e.channelCount}},c&&(p=e.id,g=e.inputTimeScale,!u||g!==u.timescale?h=f=this.computeInitPts(r[0].pts,g,s,"audio"):c=!1)}if(t.sps&&t.pps&&a.length){if(t.timescale=t.inputTimeScale,l.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:k.initSegment([t]),metadata:{width:t.width,height:t.height}},c)if(p=t.id,g=t.inputTimeScale,!u||g!==u.timescale){const E=this.getVideoStartPts(a),y=ot(a[0].dts,E),m=this.computeInitPts(y,g,s,"video"),S=this.computeInitPts(E,g,s,"video");f=Math.min(f,m),h=Math.min(h,S)}else c=!1;this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(l).length)return this.ISGenerated=!0,c?(u&&this.warn(`Timestamps at playlist time: ${i?"":"~"}${s} ${h/g} != initPTS: ${u.baseTime/u.timescale} (${u.baseTime}/${u.timescale}) trackId: ${u.trackId}`),this.log(`Found initPTS at playlist time: ${s} offset: ${h/g} (${h}/${g}) trackId: ${p}`),this._initPTS={baseTime:h,timescale:g,trackId:p},this._initDTS={baseTime:f,timescale:g,trackId:p}):h=g=void 0,{tracks:l,initPTS:h,timescale:g,trackId:p}}remuxVideo(e,t,s,i){const r=e.inputTimeScale,a=e.samples,o=[],l=a.length,u=this._initPTS,c=u.baseTime*r/u.timescale;let d=this.nextVideoTs,h=8,f=this.videoSampleDuration,g,p,E=Number.POSITIVE_INFINITY,y=Number.NEGATIVE_INFINITY,m=!1;if(!s||d===null){const O=c+t*r,M=a[0].pts-ot(a[0].dts,a[0].pts);ps&&d!==null&&Math.abs(O-M-(d+c))<15e3?s=!0:d=O-M-c}const S=d+c;for(let O=0;O<l;O++){const M=a[O];M.pts=ot(M.pts,S),M.dts=ot(M.dts,S),M.dts<a[O>0?O-1:O].dts&&(m=!0)}m&&a.sort(function(O,M){const Q=O.dts-M.dts,te=O.pts-M.pts;return Q||te}),g=a[0].dts,p=a[a.length-1].dts;const T=p-g,A=T?Math.round(T/(l-1)):f||e.inputTimeScale/30;if(s){const O=g-S,M=O>A,Q=O<-1;if((M||Q)&&(M?this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${li(O,!0)} ms (${O}dts) hole between fragments detected at ${t.toFixed(3)}`):this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${li(-O,!0)} ms (${O}dts) overlapping between fragments detected at ${t.toFixed(3)}`),!Q||S>=a[0].pts||ps)){g=S;const te=a[0].pts-O;if(M)a[0].dts=g,a[0].pts=te;else{let Z=!0;for(let J=0;J<a.length&&!(a[J].dts>te&&Z);J++){const Ae=a[J].pts;if(a[J].dts-=O,a[J].pts-=O,J<a.length-1){const Oe=a[J+1].pts,mt=a[J].pts,Ft=Oe<=mt,$n=Oe<=Ae;Z=Ft==$n}}}this.log(`Video: Initial PTS/DTS adjusted: ${li(te,!0)}/${li(g,!0)}, delta: ${li(O,!0)} ms`)}}g=Math.max(0,g);let _=0,L=0,R=g;for(let O=0;O<l;O++){const M=a[O],Q=M.units,te=Q.length;let Z=0;for(let J=0;J<te;J++)Z+=Q[J].data.length;L+=Z,_+=te,M.length=Z,M.dts<R?(M.dts=R,R+=A/4|0||1):R=M.dts,E=Math.min(M.pts,E),y=Math.max(M.pts,y)}p=a[l-1].dts;const C=L+4*_+8;let I;try{I=new Uint8Array(C)}catch(O){this.observer.emit(v.ERROR,v.ERROR,{type:Y.MUX_ERROR,details:w.REMUX_ALLOC_ERROR,fatal:!1,error:O,bytes:C,reason:`fail allocating video mdat ${C}`});return}const P=new DataView(I.buffer);P.setUint32(0,C),I.set(k.types.mdat,4);let $=!1,G=Number.POSITIVE_INFINITY,W=Number.POSITIVE_INFINITY,K=Number.NEGATIVE_INFINITY,B=Number.NEGATIVE_INFINITY;for(let O=0;O<l;O++){const M=a[O],Q=M.units;let te=0;for(let Ae=0,Oe=Q.length;Ae<Oe;Ae++){const mt=Q[Ae],Ft=mt.data,$n=mt.data.byteLength;P.setUint32(h,$n),h+=4,I.set(Ft,h),h+=$n,te+=4+$n}let Z;if(O<l-1)f=a[O+1].dts-M.dts,Z=a[O+1].pts-M.pts;else{const Ae=this.config,Oe=O>0?M.dts-a[O-1].dts:A;if(Z=O>0?M.pts-a[O-1].pts:A,Ae.stretchShortVideoTrack&&this.nextAudioTs!==null){const mt=Math.floor(Ae.maxBufferHole*r),Ft=(i?E+i*r:this.nextAudioTs+c)-M.pts;Ft>mt?(f=Ft-Oe,f<0?f=Oe:$=!0,this.log(`It is approximately ${Ft/90} ms to the next segment; using duration ${f/90} ms for the last video frame.`)):f=Oe}else f=Oe}const J=Math.round(M.pts-M.dts);G=Math.min(G,f),K=Math.max(K,f),W=Math.min(W,Z),B=Math.max(B,Z),o.push(Nh(M.key,f,te,J))}if(o.length){if(ps){if(ps<70){const O=o[0].flags;O.dependsOn=2,O.isNonSync=0}}else if(Uo&&B-W<K-G&&A/K<.025&&o[0].cts===0){this.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let O=g;for(let M=0,Q=o.length;M<Q;M++){const te=O+o[M].duration,Z=O+o[M].cts;if(M<Q-1){const J=te+o[M+1].cts;o[M].duration=J-Z}else o[M].duration=M?o[M-1].duration:A;o[M].cts=0,O=te}}}f=$||!f?A:f;const V=p+f;this.nextVideoTs=d=V-c,this.videoSampleDuration=f,this.isVideoContiguous=!0;const U={data1:k.moof(e.sequenceNumber++,g,ue(e,{samples:o})),data2:I,startPTS:(E-c)/r,endPTS:(y+f-c)/r,startDTS:(g-c)/r,endDTS:d/r,type:"video",hasAudio:!1,hasVideo:!0,nb:o.length,dropped:e.dropped};return e.samples=[],e.dropped=0,U}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return gS;case"ac3":return pS;default:return fS}}remuxAudio(e,t,s,i,r){const a=e.inputTimeScale,o=e.samplerate?e.samplerate:a,l=a/o,u=this.getSamplesPerFrame(e),c=u*l,d=this._initPTS,h=e.segmentCodec==="mp3"&&this.typeSupported.mpeg,f=[],g=r!==void 0;let p=e.samples,E=h?0:8,y=this.nextAudioTs||-1;const m=d.baseTime*a/d.timescale,S=m+t*a;if(this.isAudioContiguous=s=s||p.length&&y>0&&(i&&Math.abs(S-(y+m))<9e3||Math.abs(ot(p[0].pts,S)-(y+m))<20*c),p.forEach(function(B){B.pts=ot(B.pts,S)}),!s||y<0){const B=p.length;if(p=p.filter(V=>V.pts>=0),B!==p.length&&this.warn(`Removed ${p.length-B} of ${B} samples (initPTS ${m} / ${a})`),!p.length)return;r===0?y=0:i&&!g?y=Math.max(0,S-m):y=p[0].pts-m}if(e.segmentCodec==="aac"){const B=this.config.maxAudioFramesDrift;for(let V=0,D=y+m;V<p.length;V++){const N=p[V],U=N.pts,O=U-D,M=Math.abs(1e3*O/a);if(O<=-B*c&&g)V===0&&(this.warn(`Audio frame @ ${(U/a).toFixed(3)}s overlaps marker by ${Math.round(1e3*O/a)} ms.`),this.nextAudioTs=y=U-m,D=U);else if(O>=B*c&&M<hS&&g){let Q=Math.round(O/c);for(D=U-Q*c;D<0&&Q&&c;)Q--,D+=c;V===0&&(this.nextAudioTs=y=D-m),this.warn(`Injecting ${Q} audio frames @ ${((D-m)/a).toFixed(3)}s due to ${Math.round(1e3*O/a)} ms gap.`);for(let te=0;te<Q;te++){let Z=uS.getSilentFrame(e.parsedCodec||e.manifestCodec||e.codec,e.channelCount);Z||(this.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),Z=N.unit.subarray()),p.splice(V,0,{unit:Z,pts:D}),D+=c,V++}}N.pts=D,D+=c}}let T=null,A=null,_,L=0,R=p.length;for(;R--;)L+=p[R].unit.byteLength;for(let B=0,V=p.length;B<V;B++){const D=p[B],N=D.unit;let U=D.pts;if(A!==null){const M=f[B-1];M.duration=Math.round((U-A)/l)}else if(s&&e.segmentCodec==="aac"&&(U=y+m),T=U,L>0){L+=E;try{_=new Uint8Array(L)}catch(M){this.observer.emit(v.ERROR,v.ERROR,{type:Y.MUX_ERROR,details:w.REMUX_ALLOC_ERROR,fatal:!1,error:M,bytes:L,reason:`fail allocating audio mdat ${L}`});return}h||(new DataView(_.buffer).setUint32(0,L),_.set(k.types.mdat,4))}else return;_.set(N,E);const O=N.byteLength;E+=O,f.push(Nh(!0,u,O,0)),A=U}const C=f.length;if(!C)return;const I=f[f.length-1];y=A-m,this.nextAudioTs=y+l*I.duration;const P=h?new Uint8Array(0):k.moof(e.sequenceNumber++,T/l,ue({},e,{samples:f}));e.samples=[];const $=(T-m)/a,G=this.nextAudioTs/a,K={data1:P,data2:_,startPTS:$,endPTS:G,startDTS:$,endDTS:G,type:"audio",hasAudio:!0,hasVideo:!1,nb:C};return this.isAudioContiguous=!0,K}}function ot(n,e){let t;if(e===null)return n;for(e<n?t=-8589934592:t=8589934592;Math.abs(n-e)>4294967296;)n+=t;return n}function mS(n){for(let e=0;e<n.length;e++)if(n[e].key)return e;return-1}function Lm(n,e,t,s){const i=n.samples.length;if(!i)return;const r=n.inputTimeScale;for(let o=0;o<i;o++){const l=n.samples[o];l.pts=ot(l.pts-t.baseTime*r/t.timescale,e*r)/r,l.dts=ot(l.dts-s.baseTime*r/s.timescale,e*r)/r}const a=n.samples;return n.samples=[],{samples:a}}function Im(n,e,t){const s=n.samples.length;if(!s)return;const i=n.inputTimeScale;for(let a=0;a<s;a++){const o=n.samples[a];o.pts=ot(o.pts-t.baseTime*i/t.timescale,e*i)/i}n.samples.sort((a,o)=>a.pts-o.pts);const r=n.samples;return n.samples=[],{samples:r}}class yS extends It{constructor(e,t,s,i){super("passthrough-remuxer",i),this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.isVideoContiguous=!1}destroy(){}resetTimeStamp(e){this.lastEndTime=null;const t=this.initPTS;t&&e&&t.baseTime===e.baseTime&&t.timescale===e.timescale||(this.initPTS=e)}resetNextTimestamp(){this.isVideoContiguous=!1,this.lastEndTime=null}resetInitSegment(e,t,s,i){this.audioCodec=t,this.videoCodec=s,this.generateInitSegment(e,i),this.emitInitSegment=!0}generateInitSegment(e,t){let{audioCodec:s,videoCodec:i}=this;if(!(e!=null&&e.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const{audio:r,video:a}=this.initData=Dp(e);if(t)iE(e,t);else{const l=r||a;l!=null&&l.encrypted&&this.warn(`Init segment with encrypted track with has no key ("${l.codec}")!`)}r&&(s=Oh(r,ce.AUDIO,this)),a&&(i=Oh(a,ce.VIDEO,this));const o={};r&&a?o.audiovideo={container:"video/mp4",codec:s+","+i,supplemental:a.supplemental,encrypted:a.encrypted,initSegment:e,id:"main"}:r?o.audio={container:"audio/mp4",codec:s,encrypted:r.encrypted,initSegment:e,id:"audio"}:a?o.video={container:"video/mp4",codec:i,supplemental:a.supplemental,encrypted:a.encrypted,initSegment:e,id:"main"}:this.warn("initSegment does not contain moov or trak boxes."),this.initTracks=o}remux(e,t,s,i,r,a){var o,l;let{initPTS:u,lastEndTime:c}=this;const d={audio:void 0,video:void 0,text:i,id3:s,initSegment:void 0};j(c)||(c=this.lastEndTime=r||0);const h=t.samples;if(!h.length)return d;const f={initPTS:void 0,timescale:void 0,trackId:void 0};let g=this.initData;if((o=g)!=null&&o.length||(this.generateInitSegment(h),g=this.initData),!((l=g)!=null&&l.length))return this.warn("Failed to generate initSegment."),d;this.emitInitSegment&&(f.tracks=this.initTracks,this.emitInitSegment=!1);const p=aE(h,g,this),E=g.audio?p[g.audio.id]:null,y=g.video?p[g.video.id]:null,m=Ir(y,1/0),S=Ir(E,1/0),T=Ir(y,0,!0),A=Ir(E,0,!0);let _=r,L=0;const R=E&&(!y||!u&&S<m||u&&u.trackId===g.audio.id),C=R?E:y;if(C){const D=C.timescale,N=C.start-r*D,U=R?g.audio.id:g.video.id;_=C.start/D,L=R?A-S:T-m,(a||!u)&&(vS(u,_,r,L)||D!==u.timescale)&&(u&&this.warn(`Timestamps at playlist time: ${a?"":"~"}${r} ${N/D} != initPTS: ${u.baseTime/u.timescale} (${u.baseTime}/${u.timescale}) trackId: ${u.trackId}`),this.log(`Found initPTS at playlist time: ${r} offset: ${_-r} (${N}/${D}) trackId: ${U}`),u=null,f.initPTS=N,f.timescale=D,f.trackId=U)}else this.warn(`No audio or video samples found for initPTS at playlist time: ${r}`);u?(f.initPTS=u.baseTime,f.timescale=u.timescale,f.trackId=u.trackId):((!f.timescale||f.trackId===void 0||f.initPTS===void 0)&&(this.warn("Could not set initPTS"),f.initPTS=_,f.timescale=1,f.trackId=-1),this.initPTS=u={baseTime:f.initPTS,timescale:f.timescale,trackId:f.trackId});const I=_-u.baseTime/u.timescale,P=I+L;L>0?this.lastEndTime=P:(this.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const $=!!g.audio,G=!!g.video;let W="";$&&(W+="audio"),G&&(W+="video");const K=(g.audio?g.audio.encrypted:!1)||(g.video?g.video.encrypted:!1),B={data1:h,startPTS:I,startDTS:I,endPTS:P,endDTS:P,type:W,hasAudio:$,hasVideo:G,nb:1,dropped:0,encrypted:K};d.audio=$&&!G?B:void 0,d.video=G?B:void 0;const V=y==null?void 0:y.sampleCount;if(V){const D=y.keyFrameIndex,N=D!==-1;B.nb=V,B.dropped=D===0||this.isVideoContiguous?0:N?D:V,B.independent=N,B.firstKeyFrame=D,N&&y.keyFrameStart&&(B.firstKeyFramePTS=(y.keyFrameStart-u.baseTime)/u.timescale),this.isVideoContiguous||(d.independent=N),this.isVideoContiguous||(this.isVideoContiguous=N),B.dropped&&this.warn(`fmp4 does not start with IDR: firstIDR ${D}/${V} dropped: ${B.dropped} start: ${B.firstKeyFramePTS||"NA"}`)}return d.initSegment=f,d.id3=Lm(s,r,u,u),i.samples.length&&(d.text=Im(i,r,u)),d}}function Ir(n,e,t=!1){return(n==null?void 0:n.start)!==void 0?(n.start+(t?n.duration:0))/n.timescale:e}function vS(n,e,t,s){if(n===null)return!0;const i=Math.max(s,1),r=e-n.baseTime/n.timescale;return Math.abs(r-t)>i}function Oh(n,e,t){const s=n.codec;return s&&s.length>4?s:e===ce.AUDIO?s==="ec-3"||s==="ac-3"||s==="alac"?s:s==="fLaC"||s==="Opus"?Ia(s,!1):(t.warn(`Unhandled audio codec "${s}" in mp4 MAP`),s||"mp4a"):(t.warn(`Unhandled video codec "${s}" in mp4 MAP`),s||"avc1")}let nn;try{nn=self.performance.now.bind(self.performance)}catch{nn=Date.now}const Qr=[{demux:sS,remux:yS},{demux:En,remux:qr},{demux:Jx,remux:qr},{demux:tS,remux:qr}];Qr.splice(2,0,{demux:eS,remux:qr});class Mh{constructor(e,t,s,i,r,a){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=s,this.id=r,this.logger=a}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,s,i){const r=s.transmuxing;r.executeStart=nn();let a=new Uint8Array(e);const{currentTransmuxState:o,transmuxConfig:l}=this;i&&(this.currentTransmuxState=i);const{contiguous:u,discontinuity:c,trackSwitch:d,accurateTimeOffset:h,timeOffset:f,initSegmentChange:g}=i||o,{audioCodec:p,videoCodec:E,defaultInitPts:y,duration:m,initSegmentData:S}=l,T=ES(a,t);if(T&&Fs(T.method)){const R=this.getDecrypter(),C=gc(T.method);if(R.isSync()){let I=R.softwareDecrypt(a,T.key.buffer,T.iv.buffer,C);if(s.part>-1){const $=R.flush();I=$&&$.buffer}if(!I)return r.executeEnd=nn(),$o(s);a=new Uint8Array(I)}else return this.asyncResult=!0,this.decryptionPromise=R.webCryptoDecrypt(a,T.key.buffer,T.iv.buffer,C).then(I=>{const P=this.push(I,null,s);return this.decryptionPromise=null,P}),this.decryptionPromise}const A=this.needsProbing(c,d);if(A){const R=this.configureTransmuxer(a);if(R)return this.logger.warn(`[transmuxer] ${R.message}`),this.observer.emit(v.ERROR,v.ERROR,{type:Y.MEDIA_ERROR,details:w.FRAG_PARSING_ERROR,fatal:!1,error:R,reason:R.message}),r.executeEnd=nn(),$o(s)}(c||d||g||A)&&this.resetInitSegment(S,p,E,m,t),(c||g||A)&&this.resetInitialTimestamp(y),u||this.resetContiguity();const _=this.transmux(a,T,f,h,s);this.asyncResult=Yi(_);const L=this.currentTransmuxState;return L.contiguous=!0,L.discontinuity=!1,L.trackSwitch=!1,r.executeEnd=nn(),_}flush(e){const t=e.transmuxing;t.executeStart=nn();const{decrypter:s,currentTransmuxState:i,decryptionPromise:r}=this;if(r)return this.asyncResult=!0,r.then(()=>this.flush(e));const a=[],{timeOffset:o}=i;if(s){const d=s.flush();d&&a.push(this.push(d.buffer,null,e))}const{demuxer:l,remuxer:u}=this;if(!l||!u){t.executeEnd=nn();const d=[$o(e)];return this.asyncResult?Promise.resolve(d):d}const c=l.flush(o);return Yi(c)?(this.asyncResult=!0,c.then(d=>(this.flushRemux(a,d,e),a))):(this.flushRemux(a,c,e),this.asyncResult?Promise.resolve(a):a)}flushRemux(e,t,s){const{audioTrack:i,videoTrack:r,id3Track:a,textTrack:o}=t,{accurateTimeOffset:l,timeOffset:u}=this.currentTransmuxState;this.logger.log(`[transmuxer.ts]: Flushed ${this.id} sn: ${s.sn}${s.part>-1?" part: "+s.part:""} of ${this.id===H.MAIN?"level":"track"} ${s.level}`);const c=this.remuxer.remux(i,r,a,o,u,l,!0,this.id);e.push({remuxResult:c,chunkMeta:s}),s.transmuxing.executeEnd=nn()}resetInitialTimestamp(e){const{demuxer:t,remuxer:s}=this;!t||!s||(t.resetTimeStamp(e),s.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;!e||!t||(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,s,i,r){const{demuxer:a,remuxer:o}=this;!a||!o||(a.resetInitSegment(e,t,s,i),o.resetInitSegment(e,t,s,r))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,s,i,r){let a;return t&&t.method==="SAMPLE-AES"?a=this.transmuxSampleAes(e,t,s,i,r):a=this.transmuxUnencrypted(e,s,i,r),a}transmuxUnencrypted(e,t,s,i){const{audioTrack:r,videoTrack:a,id3Track:o,textTrack:l}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(r,a,o,l,t,s,!1,this.id),chunkMeta:i}}transmuxSampleAes(e,t,s,i,r){return this.demuxer.demuxSampleAes(e,t,s).then(a=>({remuxResult:this.remuxer.remux(a.audioTrack,a.videoTrack,a.id3Track,a.textTrack,s,i,!1,this.id),chunkMeta:r}))}configureTransmuxer(e){const{config:t,observer:s,typeSupported:i}=this;let r;for(let d=0,h=Qr.length;d<h;d++){var a;if((a=Qr[d].demux)!=null&&a.probe(e,this.logger)){r=Qr[d];break}}if(!r)return new Error("Failed to find demuxer by probing fragment data");const o=this.demuxer,l=this.remuxer,u=r.remux,c=r.demux;(!l||!(l instanceof u))&&(this.remuxer=new u(s,t,i,this.logger)),(!o||!(o instanceof c))&&(this.demuxer=new c(s,t,i,this.logger),this.probe=c.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new hc(this.config)),e}}function ES(n,e){let t=null;return n.byteLength>0&&(e==null?void 0:e.key)!=null&&e.iv!==null&&e.method!=null&&(t=e),t}const $o=n=>({remuxResult:{},chunkMeta:n});function Yi(n){return"then"in n&&n.then instanceof Function}class xS{constructor(e,t,s,i,r){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=s,this.duration=i,this.defaultInitPts=r||null}}class SS{constructor(e,t,s,i,r,a){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=s,this.trackSwitch=i,this.timeOffset=r,this.initSegmentChange=a}}let Fh=0;class Rm{constructor(e,t,s,i){this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=Fh++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=l=>{const u=l.data,c=this.hls;if(!(!c||!(u!=null&&u.event)||u.instanceNo!==this.instanceNo))switch(u.event){case"init":{var d;const h=(d=this.workerContext)==null?void 0:d.objectURL;h&&self.URL.revokeObjectURL(h);break}case"transmuxComplete":{this.handleTransmuxComplete(u.data);break}case"flush":{this.onFlush(u.data);break}case"workerLog":{c.logger[u.data.logType]&&c.logger[u.data.logType](u.data.message);break}default:{u.data=u.data||{},u.data.frag=this.frag,u.data.part=this.part,u.data.id=this.id,c.trigger(u.event,u.data);break}}},this.onWorkerError=l=>{if(!this.hls)return;const u=new Error(`${l.message}  (${l.filename}:${l.lineno})`);this.hls.config.enableWorker=!1,this.hls.logger.warn(`Error in "${this.id}" Web Worker, fallback to inline`),this.hls.trigger(v.ERROR,{type:Y.OTHER_ERROR,details:w.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:u})};const r=e.config;this.hls=e,this.id=t,this.useWorker=!!r.enableWorker,this.onTransmuxComplete=s,this.onFlush=i;const a=(l,u)=>{u=u||{},u.frag=this.frag||void 0,l===v.ERROR&&(u=u,u.parent=this.id,u.part=this.part,this.error=u.error),this.hls.trigger(l,u)};this.observer=new yc,this.observer.on(v.FRAG_DECRYPTED,a),this.observer.on(v.ERROR,a);const o=Zd(r.preferManagedMediaSource);if(this.useWorker&&typeof Worker<"u"){const l=this.hls.logger;if(r.workerPath||Ix()){try{r.workerPath?(l.log(`loading Web Worker ${r.workerPath} for "${t}"`),this.workerContext=_x(r.workerPath)):(l.log(`injecting Web Worker for "${t}"`),this.workerContext=Rx());const{worker:c}=this.workerContext;c.addEventListener("message",this.onWorkerMessage),c.addEventListener("error",this.onWorkerError),c.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:o,id:t,config:de(r)})}catch(c){l.warn(`Error setting up "${t}" Web Worker, fallback to inline`,c),this.terminateWorker(),this.error=null,this.transmuxer=new Mh(this.observer,o,r,"",t,e.logger)}return}}this.transmuxer=new Mh(this.observer,o,r,"",t,e.logger)}reset(){if(this.frag=null,this.part=null,this.workerContext){const e=this.instanceNo;this.instanceNo=Fh++;const t=this.hls.config,s=Zd(t.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:e,typeSupported:s,id:this.id,config:de(t)})}}terminateWorker(){if(this.workerContext){const{worker:e}=this.workerContext;this.workerContext=null,e.removeEventListener("message",this.onWorkerMessage),e.removeEventListener("error",this.onWorkerError),Cx(this.hls.config.workerPath)}}destroy(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{const t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null}push(e,t,s,i,r,a,o,l,u,c){var d,h;u.transmuxing.start=self.performance.now();const{instanceNo:f,transmuxer:g}=this,p=a?a.start:r.start,E=r.decryptdata,y=this.frag,m=!(y&&r.cc===y.cc),S=!(y&&u.level===y.level),T=y?u.sn-y.sn:-1,A=this.part?u.part-this.part.index:-1,_=T===0&&u.id>1&&u.id===(y==null?void 0:y.stats.chunkCount),L=!S&&(T===1||T===0&&(A===1||_&&A<=0)),R=self.performance.now();(S||T||r.stats.parsing.start===0)&&(r.stats.parsing.start=R),a&&(A||!L)&&(a.stats.parsing.start=R);const C=!(y&&((d=r.initSegment)==null?void 0:d.url)===((h=y.initSegment)==null?void 0:h.url)),I=new SS(m,L,l,S,p,C);if(!L||m||C){this.hls.logger.log(`[transmuxer-interface]: Starting new transmux session for ${r.type} sn: ${u.sn}${u.part>-1?" part: "+u.part:""} ${this.id===H.MAIN?"level":"track"}: ${u.level} id: ${u.id}
        discontinuity: ${m}
        trackSwitch: ${S}
        contiguous: ${L}
        accurateTimeOffset: ${l}
        timeOffset: ${p}
        initSegmentChange: ${C}`);const P=new xS(s,i,t,o,c);this.configureTransmuxer(P)}if(this.frag=r,this.part=a,this.workerContext)this.workerContext.worker.postMessage({instanceNo:f,cmd:"demux",data:e,decryptdata:E,chunkMeta:u,state:I},e instanceof ArrayBuffer?[e]:[]);else if(g){const P=g.push(e,E,u,I);Yi(P)?P.then($=>{this.handleTransmuxComplete($)}).catch($=>{this.transmuxerError($,u,"transmuxer-interface push error")}):this.handleTransmuxComplete(P)}}flush(e){e.transmuxing.start=self.performance.now();const{instanceNo:t,transmuxer:s}=this;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:t,cmd:"flush",chunkMeta:e});else if(s){const i=s.flush(e);Yi(i)?i.then(r=>{this.handleFlushResult(r,e)}).catch(r=>{this.transmuxerError(r,e,"transmuxer-interface flush error")}):this.handleFlushResult(i,e)}}transmuxerError(e,t,s){this.hls&&(this.error=e,this.hls.trigger(v.ERROR,{type:Y.MEDIA_ERROR,details:w.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:e,err:e,reason:s}))}handleFlushResult(e,t){e.forEach(s=>{this.handleTransmuxComplete(s)}),this.onFlush(t)}configureTransmuxer(e){const{instanceNo:t,transmuxer:s}=this;this.workerContext?this.workerContext.worker.postMessage({instanceNo:t,cmd:"configure",config:e}):s&&s.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}const Bh=100;class TS extends mc{constructor(e,t,s){super(e,t,s,"audio-stream-controller",H.AUDIO),this.mainAnchor=null,this.mainFragLoading=null,this.audioOnly=!1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.resetItem()}resetItem(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(v.LEVEL_LOADED,this.onLevelLoaded,this),e.on(v.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(v.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(v.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(v.BUFFER_RESET,this.onBufferReset,this),e.on(v.BUFFER_CREATED,this.onBufferCreated,this),e.on(v.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(v.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(v.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(v.FRAG_LOADING,this.onFragLoading,this),e.on(v.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){const{hls:e}=this;e&&(super.unregisterListeners(),e.off(v.LEVEL_LOADED,this.onLevelLoaded,this),e.off(v.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(v.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(v.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(v.BUFFER_RESET,this.onBufferReset,this),e.off(v.BUFFER_CREATED,this.onBufferCreated,this),e.off(v.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(v.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(v.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(v.FRAG_LOADING,this.onFragLoading,this),e.off(v.FRAG_BUFFERED,this.onFragBuffered,this))}onInitPtsFound(e,{frag:t,id:s,initPTS:i,timescale:r,trackId:a}){if(s===H.MAIN){const o=t.cc,l=this.fragCurrent;if(this.initPTS[o]={baseTime:i,timescale:r,trackId:a},this.log(`InitPTS for cc: ${o} found from main: ${i/r} (${i}/${r}) trackId: ${a}`),this.mainAnchor=t,this.state===b.WAITING_INIT_PTS){const u=this.waitingData;(!u&&!this.loadingParts||u&&u.frag.cc!==o)&&this.syncWithAnchor(t,u==null?void 0:u.frag)}else!this.hls.hasEnoughToStart&&l&&l.cc!==o?(l.abortRequests(),this.syncWithAnchor(t,l)):this.state===b.IDLE&&this.tick()}}getLoadPosition(){return!this.startFragRequested&&this.nextLoadPosition>=0?this.nextLoadPosition:super.getLoadPosition()}syncWithAnchor(e,t){var s;const i=((s=this.mainFragLoading)==null?void 0:s.frag)||null;if(t&&(i==null?void 0:i.cc)===t.cc)return;const r=(i||e).cc,a=this.getLevelDetails(),o=this.getLoadPosition(),l=Gp(a,r,o);l&&(this.log(`Syncing with main frag at ${l.start} cc ${l.cc}`),this.startFragRequested=!1,this.nextLoadPosition=l.start,this.resetLoadingState(),this.state===b.IDLE&&this.doTickIdle())}startLoad(e,t){if(!this.levels){this.startPosition=e,this.state=b.STOPPED;return}const s=this.lastCurrentTime;this.stopLoad(),this.setInterval(Bh),s>0&&e===-1?(this.log(`Override startPosition with lastCurrentTime @${s.toFixed(3)}`),e=s,this.state=b.IDLE):this.state=b.WAITING_TRACK,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}doTick(){switch(this.state){case b.IDLE:this.doTickIdle();break;case b.WAITING_TRACK:{const{levels:e,trackId:t}=this,s=e==null?void 0:e[t],i=s==null?void 0:s.details;if(i&&!this.waitForLive(s)){if(this.waitForCdnTuneIn(i))break;this.state=b.WAITING_INIT_PTS}break}case b.FRAG_LOADING_WAITING_RETRY:{this.checkRetryDate();break}case b.WAITING_INIT_PTS:{const e=this.waitingData;if(e){const{frag:t,part:s,cache:i,complete:r}=e,a=this.mainAnchor;if(this.initPTS[t.cc]!==void 0){this.waitingData=null,this.state=b.FRAG_LOADING;const o=i.flush().buffer,l={frag:t,part:s,payload:o,networkDetails:null};this._handleFragmentLoadProgress(l),r&&super._handleFragmentLoadComplete(l)}else a&&a.cc!==e.frag.cc&&this.syncWithAnchor(a,e.frag)}else this.state=b.IDLE}}this.onTickEnd()}resetLoadingState(){const e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null),super.resetLoadingState()}onTickEnd(){const{media:e}=this;e!=null&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){var e;const{hls:t,levels:s,media:i,trackId:r}=this,a=t.config;if(!this.buffering||!i&&!this.primaryPrefetch&&(this.startFragRequested||!a.startFragPrefetch)||!(s!=null&&s[r]))return;const o=s[r],l=o.details;if(!l||this.waitForLive(o)||this.waitForCdnTuneIn(l)){this.state=b.WAITING_TRACK,this.startFragRequested=!1;return}const u=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&u&&(this.bufferFlushed=!1,this.afterBufferFlushed(u,ce.AUDIO,H.AUDIO));const c=this.getFwdBufferInfo(u,H.AUDIO);if(c===null)return;if(!this.switchingTrack&&this._streamEnded(c,l)){t.trigger(v.BUFFER_EOS,{type:"audio"}),this.state=b.ENDED;return}const d=c.len,h=t.maxBufferLength,f=l.fragments,g=f[0].start,p=this.getLoadPosition(),E=this.flushing?p:c.end;if(this.switchingTrack&&i){const S=p;l.PTSKnown&&S<g&&(c.end>g||c.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),i.currentTime=g+.05)}if(d>=h&&!this.switchingTrack&&E<f[f.length-1].start)return;let y=this.getNextFragment(E,l);if(y&&this.isLoopLoading(y,E)&&(y=this.getNextFragmentLoopLoading(y,l,c,H.MAIN,h)),!y){this.bufferFlushed=!0;return}let m=((e=this.mainFragLoading)==null?void 0:e.frag)||null;if(!this.audioOnly&&this.startFragRequested&&m&&Ie(y)&&!y.endList&&(!l.live||!this.loadingParts&&E<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(m)===we.OK&&(this.mainFragLoading=m=null),m&&Ie(m))){if(y.start>m.end){const T=this.fragmentTracker.getFragAtPos(E,H.MAIN);T&&T.end>m.end&&(m=T,this.mainFragLoading={frag:T,targetBufferTime:null})}if(y.start>m.end)return}this.loadFragment(y,o,E)}onMediaDetaching(e,t){this.bufferFlushed=this.flushing=!1,super.onMediaDetaching(e,t)}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map(s=>new Hi(s))}onAudioTrackSwitching(e,t){const s=!!t.url;this.trackId=t.id;const{fragCurrent:i}=this;i&&(i.abortRequests(),this.removeUnbufferedFrags(i.start)),this.resetLoadingState(),s?(this.switchingTrack=t,this.flushAudioIfNeeded(t),this.state!==b.STOPPED&&(this.setInterval(Bh),this.state=b.IDLE,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=t,this.clearInterval())}onManifestLoading(){super.onManifestLoading(),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1}onLevelLoaded(e,t){this.mainDetails=t.details;const s=this.cachedTrackLoadedData;s&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(v.AUDIO_TRACK_LOADED,s))}onAudioTrackLoaded(e,t){var s;const{levels:i}=this,{details:r,id:a,groupId:o,track:l}=t;if(!i){this.warn(`Audio tracks reset while loading track ${a} "${l.name}" of "${o}"`);return}const u=this.mainDetails;if(!u||r.endCC>u.endCC||u.expired){this.cachedTrackLoadedData=t,this.state!==b.STOPPED&&(this.state=b.WAITING_TRACK);return}this.cachedTrackLoadedData=null,this.log(`Audio track ${a} "${l.name}" of "${o}" loaded [${r.startSN},${r.endSN}]${r.lastPartSn?`[part-${r.lastPartSn}-${r.lastPartIndex}]`:""},duration:${r.totalduration}`);const c=i[a];let d=0;if(r.live||(s=c.details)!=null&&s.live){if(this.checkLiveUpdate(r),r.deltaUpdateFailed)return;if(c.details){var h;d=this.alignPlaylists(r,c.details,(h=this.levelLastLoaded)==null?void 0:h.details)}r.alignedSliding||(am(r,u),r.alignedSliding||Pa(r,u),d=r.fragmentStart)}c.details=r,this.levelLastLoaded=c,this.startFragRequested||this.setStartPosition(u,d),this.hls.trigger(v.AUDIO_TRACK_UPDATED,{details:r,id:a,groupId:t.groupId}),this.state===b.WAITING_TRACK&&!this.waitForCdnTuneIn(r)&&(this.state=b.IDLE),this.tick()}_handleFragmentLoadProgress(e){var t;const s=e.frag,{part:i,payload:r}=e,{config:a,trackId:o,levels:l}=this;if(!l){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${s.sn} of level ${s.level} will not be buffered`);return}const u=l[o];if(!u){this.warn("Audio track is undefined on fragment load progress");return}const c=u.details;if(!c){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(s.start);return}const d=a.defaultAudioCodec||u.audioCodec||"mp4a.40.2";let h=this.transmuxer;h||(h=this.transmuxer=new Rm(this.hls,H.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const f=this.initPTS[s.cc],g=(t=s.initSegment)==null?void 0:t.data;if(f!==void 0){const E=i?i.index:-1,y=E!==-1,m=new fc(s.level,s.sn,s.stats.chunkCount,r.byteLength,E,y);h.push(r,g,d,"",s,i,c.totalduration,!1,m,f)}else{this.log(`Unknown video PTS for cc ${s.cc}, waiting for video PTS before demuxing audio frag ${s.sn} of [${c.startSN} ,${c.endSN}],track ${o}`);const{cache:p}=this.waitingData=this.waitingData||{frag:s,part:i,cache:new om,complete:!1};p.push(new Uint8Array(r)),this.state!==b.STOPPED&&(this.state=b.WAITING_INIT_PTS)}}_handleFragmentLoadComplete(e){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=null}onBufferCreated(e,t){this.bufferFlushed=this.flushing=!1;const s=t.tracks.audio;s&&(this.mediaBuffer=s.buffer||null)}onFragLoading(e,t){!this.audioOnly&&t.frag.type===H.MAIN&&Ie(t.frag)&&(this.mainFragLoading=t,this.state===b.IDLE&&this.tick())}onFragBuffered(e,t){const{frag:s,part:i}=t;if(s.type!==H.AUDIO){!this.audioOnly&&s.type===H.MAIN&&!s.elementaryStreams.video&&!s.elementaryStreams.audiovideo&&(this.audioOnly=!0,this.mainFragLoading=null);return}if(this.fragContextChanged(s)){this.warn(`Fragment ${s.sn}${i?" p: "+i.index:""} of level ${s.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(Ie(s)){this.fragPrevious=s;const r=this.switchingTrack;r&&(this.bufferedTrack=r,this.switchingTrack=null,this.hls.trigger(v.AUDIO_TRACK_SWITCHED,ae({},r)))}this.fragBufferedComplete(s,i),this.media&&this.tick()}onError(e,t){var s;if(t.fatal){this.state=b.ERROR;return}switch(t.details){case w.FRAG_GAP:case w.FRAG_PARSING_ERROR:case w.FRAG_DECRYPT_ERROR:case w.FRAG_LOAD_ERROR:case w.FRAG_LOAD_TIMEOUT:case w.KEY_LOAD_ERROR:case w.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(H.AUDIO,t);break;case w.AUDIO_TRACK_LOAD_ERROR:case w.AUDIO_TRACK_LOAD_TIMEOUT:case w.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===b.WAITING_TRACK&&((s=t.context)==null?void 0:s.type)===ne.AUDIO_TRACK&&(this.state=b.IDLE);break;case w.BUFFER_ADD_CODEC_ERROR:case w.BUFFER_APPEND_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)||this.resetLoadingState();break;case w.BUFFER_FULL_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case w.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onBufferFlushing(e,{type:t}){t!==ce.VIDEO&&(this.flushing=!0)}onBufferFlushed(e,{type:t}){if(t!==ce.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===b.ENDED&&(this.state=b.IDLE);const s=this.mediaBuffer||this.media;s&&(this.afterBufferFlushed(s,t,H.AUDIO),this.tick())}}_handleTransmuxComplete(e){var t;const s="audio",{hls:i}=this,{remuxResult:r,chunkMeta:a}=e,o=this.getCurrentContext(a);if(!o){this.resetWhenMissingContext(a);return}const{frag:l,part:u,level:c}=o,{details:d}=c,{audio:h,text:f,id3:g,initSegment:p}=r;if(this.fragContextChanged(l)||!d){this.fragmentTracker.removeFragment(l);return}if(this.state=b.PARSING,this.switchingTrack&&h&&this.completeAudioSwitch(this.switchingTrack),p!=null&&p.tracks){const E=l.initSegment||l;if(this.unhandledEncryptionError(p,l))return;this._bufferInitSegment(c,p.tracks,E,a),i.trigger(v.FRAG_PARSING_INIT_SEGMENT,{frag:E,id:s,tracks:p.tracks})}if(h){const{startPTS:E,endPTS:y,startDTS:m,endDTS:S}=h;u&&(u.elementaryStreams[ce.AUDIO]={startPTS:E,endPTS:y,startDTS:m,endDTS:S}),l.setElementaryStreamInfo(ce.AUDIO,E,y,m,S),this.bufferFragmentData(h,l,u,a)}if(g!=null&&(t=g.samples)!=null&&t.length){const E=ue({id:s,frag:l,details:d},g);i.trigger(v.FRAG_PARSING_METADATA,E)}if(f){const E=ue({id:s,frag:l,details:d},f);i.trigger(v.FRAG_PARSING_USERDATA,E)}}_bufferInitSegment(e,t,s,i){if(this.state!==b.PARSING||(t.video&&delete t.video,t.audiovideo&&delete t.audiovideo,!t.audio))return;const r=t.audio;r.id=H.AUDIO;const a=e.audioCodec;this.log(`Init audio buffer, container:${r.container}, codecs[level/parsed]=[${a}/${r.codec}]`),a&&a.split(",").length===1&&(r.levelCodec=a),this.hls.trigger(v.BUFFER_CODECS,t);const o=r.initSegment;if(o!=null&&o.byteLength){const l={type:"audio",frag:s,part:null,chunkMeta:i,parent:s.type,data:o};this.hls.trigger(v.BUFFER_APPENDING,l)}this.tickImmediate()}loadFragment(e,t,s){const i=this.fragmentTracker.getState(e);if(this.switchingTrack||i===we.NOT_LOADED||i===we.PARTIAL){var r;if(!Ie(e))this._loadInitSegment(e,t);else if((r=t.details)!=null&&r.live&&!this.initPTS[e.cc]){this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=b.WAITING_INIT_PTS;const a=this.mainDetails;a&&a.fragmentStart!==t.details.fragmentStart&&Pa(t.details,a)}else super.loadFragment(e,t,s)}else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){if(this.media&&this.bufferedTrack){const{name:t,lang:s,assocLang:i,characteristics:r,audioCodec:a,channels:o}=this.bufferedTrack;Jn({name:t,lang:s,assocLang:i,characteristics:r,audioCodec:a,channels:o},e,Wn)||(_a(e.url,this.hls)?(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=e)}}completeAudioSwitch(e){const{hls:t}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(v.AUDIO_TRACK_SWITCHED,ae({},e))}}class Lc extends It{constructor(e,t){super(t,e.logger),this.hls=void 0,this.canLoad=!1,this.timer=-1,this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t,s){const i=t==null?void 0:t.renditionReports;if(i){let r=-1;for(let a=0;a<i.length;a++){const o=i[a];let l;try{l=new self.URL(o.URI,t.url).href}catch(u){this.warn(`Could not construct new URL for Rendition Report: ${u}`),l=o.URI||""}if(l===e){r=a;break}else l===e.substring(0,l.length)&&(r=a)}if(r!==-1){const a=i[r],o=parseInt(a["LAST-MSN"])||t.lastPartSn;let l=parseInt(a["LAST-PART"])||t.lastPartIndex;if(this.hls.config.lowLatencyMode){const c=Math.min(t.age-t.partTarget,t.targetduration);l>=0&&c>t.partTarget&&(l+=1)}const u=s&&Jd(s);return new eh(o,l>=0?l:void 0,u)}}}loadPlaylist(e){this.clearTimer()}loadingPlaylist(e,t){this.clearTimer()}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}getUrlWithDirectives(e,t){if(t)try{return t.addDirectives(e)}catch(s){this.warn(`Could not construct new URL with HLS Delivery Directives: ${s}`)}return e}playlistLoaded(e,t,s){const{details:i,stats:r}=t,a=self.performance.now(),o=r.loading.first?Math.max(0,a-r.loading.first):0;i.advancedDateTime=Date.now()-o;const l=this.hls.config.timelineOffset;if(l!==i.appliedTimelineOffset){const c=Math.max(l||0,0);i.appliedTimelineOffset=c,i.fragments.forEach(d=>{d.setStart(d.playlistOffset+c)})}if(i.live||s!=null&&s.live){const c="levelInfo"in t?t.levelInfo:t.track;if(i.reloaded(s),s&&i.fragments.length>0){gx(s,i,this);const m=i.playlistParsingError;if(m){this.warn(m);const S=this.hls;if(!S.config.ignorePlaylistParsingErrors){var u;const{networkDetails:T}=t;S.trigger(v.ERROR,{type:Y.NETWORK_ERROR,details:w.LEVEL_PARSING_ERROR,fatal:!1,url:i.url,error:m,reason:m.message,level:t.level||void 0,parent:(u=i.fragments[0])==null?void 0:u.type,networkDetails:T,stats:r});return}i.playlistParsingError=null}}i.requestScheduled===-1&&(i.requestScheduled=r.loading.start);const d=this.hls.mainForwardBufferInfo,h=d?d.end-d.len:0,f=(i.edge-h)*1e3,g=tm(i,f);if(i.requestScheduled+g<a?i.requestScheduled=a:i.requestScheduled+=g,this.log(`live playlist ${e} ${i.advanced?"REFRESHED "+i.lastPartSn+"-"+i.lastPartIndex:i.updated?"UPDATED":"MISSED"}`),!this.canLoad||!i.live)return;let p,E,y;if(i.canBlockReload&&i.endSN&&i.advanced){const m=this.hls.config.lowLatencyMode,S=i.lastPartSn,T=i.endSN,A=i.lastPartIndex,_=A!==-1,L=S===T;_?L?(E=T+1,y=m?0:A):(E=S,y=m?A+1:i.maxPartIndex):E=T+1;const R=i.age,C=R+i.ageHeader;let I=Math.min(C-i.partTarget,i.targetduration*1.5);if(I>0){if(C>i.targetduration*3)this.log(`Playlist last advanced ${R.toFixed(2)}s ago. Omitting segment and part directives.`),E=void 0,y=void 0;else if(s!=null&&s.tuneInGoal&&C-i.partTarget>s.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${s.tuneInGoal} to: ${I} with playlist age: ${i.age}`),I=0;else{const P=Math.floor(I/i.targetduration);if(E+=P,y!==void 0){const $=Math.round(I%i.targetduration/i.partTarget);y+=$}this.log(`CDN Tune-in age: ${i.ageHeader}s last advanced ${R.toFixed(2)}s goal: ${I} skip sn ${P} to part ${y}`)}i.tuneInGoal=I}if(p=this.getDeliveryDirectives(i,t.deliveryDirectives,E,y),m||!L){i.requestScheduled=a,this.loadingPlaylist(c,p);return}}else(i.canBlockReload||i.canSkipUntil)&&(p=this.getDeliveryDirectives(i,t.deliveryDirectives,E,y));p&&E!==void 0&&i.canBlockReload&&(i.requestScheduled=r.loading.first+Math.max(g-o*2,g/2)),this.scheduleLoading(c,p,i)}else this.clearTimer()}scheduleLoading(e,t,s){const i=s||e.details;if(!i){this.loadingPlaylist(e,t);return}const r=self.performance.now(),a=i.requestScheduled;if(r>=a){this.loadingPlaylist(e,t);return}const o=a-r;this.log(`reload live playlist ${e.name||e.bitrate+"bps"} in ${Math.round(o)} ms`),this.clearTimer(),this.timer=self.setTimeout(()=>this.loadingPlaylist(e,t),o)}getDeliveryDirectives(e,t,s,i){let r=Jd(e);return t!=null&&t.skip&&e.deltaUpdateFailed&&(s=t.msn,i=t.part,r=Wr.No),new eh(s,i,r)}checkRetry(e){const t=e.details,s=Ca(e),i=e.errorAction,{action:r,retryCount:a=0,retryConfig:o}=i||{},l=!!i&&!!o&&(r===Fe.RetryRequest||!i.resolved&&r===Fe.SendAlternateToPenaltyBox);if(l){var u;if(a>=o.maxNumRetry)return!1;if(s&&(u=e.context)!=null&&u.deliveryDirectives)this.warn(`Retrying playlist loading ${a+1}/${o.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{const c=dc(o,a);this.clearTimer(),this.timer=self.setTimeout(()=>this.loadPlaylist(),c),this.warn(`Retrying playlist loading ${a+1}/${o.maxNumRetry} after "${t}" in ${c}ms`)}e.levelRetry=!0,i.resolved=!0}return l}}function _m(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(!qi(n[t].attrs,e[t].attrs))return!1;return!0}function qi(n,e,t){const s=n["STABLE-RENDITION-ID"];return s&&!t?s===e["STABLE-RENDITION-ID"]:!(t||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(i=>n[i]!==e[i])}function nu(n,e){return e.label.toLowerCase()===n.name.toLowerCase()&&(!e.language||e.language.toLowerCase()===(n.lang||"").toLowerCase())}class AS extends Lc{constructor(e){super(e,"audio-track-controller"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(v.MANIFEST_LOADING,this.onManifestLoading,this),e.on(v.MANIFEST_PARSED,this.onManifestParsed,this),e.on(v.LEVEL_LOADING,this.onLevelLoading,this),e.on(v.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(v.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(v.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(v.MANIFEST_LOADING,this.onManifestLoading,this),e.off(v.MANIFEST_PARSED,this.onManifestParsed,this),e.off(v.LEVEL_LOADING,this.onLevelLoading,this),e.off(v.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(v.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(v.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:s,groupId:i,details:r}=t,a=this.tracksInGroup[s];if(!a||a.groupId!==i){this.warn(`Audio track with id:${s} and group:${i} not found in active group ${a==null?void 0:a.groupId}`);return}const o=a.details;a.details=t.details,this.log(`Audio track ${s} "${a.name}" lang:${a.lang} group:${i} loaded [${r.startSN}-${r.endSN}]`),s===this.trackId&&this.playlistLoaded(s,t,o)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const s=t.audioGroups||null,i=this.groupIds;let r=this.currentTrack;if(!s||(i==null?void 0:i.length)!==(s==null?void 0:s.length)||s!=null&&s.some(o=>(i==null?void 0:i.indexOf(o))===-1)){this.groupIds=s,this.trackId=-1,this.currentTrack=null;const o=this.tracks.filter(h=>!s||s.indexOf(h.groupId)!==-1);if(o.length)this.selectDefaultTrack&&!o.some(h=>h.default)&&(this.selectDefaultTrack=!1),o.forEach((h,f)=>{h.id=f});else if(!r&&!this.tracksInGroup.length)return;this.tracksInGroup=o;const l=this.hls.config.audioPreference;if(!r&&l){const h=zt(l,o,Wn);if(h>-1)r=o[h];else{const f=zt(l,this.tracks);r=this.tracks[f]}}let u=this.findTrackId(r);u===-1&&r&&(u=this.findTrackId(null));const c={audioTracks:o};this.log(`Updating audio tracks, ${o.length} track(s) found in group(s): ${s==null?void 0:s.join(",")}`),this.hls.trigger(v.AUDIO_TRACKS_UPDATED,c);const d=this.trackId;if(u!==-1&&d===-1)this.setAudioTrack(u);else if(o.length&&d===-1){var a;const h=new Error(`No audio track selected for current audio group-ID(s): ${(a=this.groupIds)==null?void 0:a.join(",")} track count: ${o.length}`);this.warn(h.message),this.hls.trigger(v.ERROR,{type:Y.MEDIA_ERROR,details:w.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:h})}}}onError(e,t){t.fatal||!t.context||t.context.type===ne.AUDIO_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){const t=this.hls;if(t.config.audioPreference=e,e){const s=this.allAudioTracks;if(this.selectDefaultTrack=!1,s.length){const i=this.currentTrack;if(i&&Jn(e,i,Wn))return i;const r=zt(e,this.tracksInGroup,Wn);if(r>-1){const a=this.tracksInGroup[r];return this.setAudioTrack(r),a}else if(i){let a=t.loadLevel;a===-1&&(a=t.firstAutoLevel);const o=OE(e,t.levels,s,a,Wn);if(o===-1)return null;t.nextLoadLevel=o}if(e.channels||e.audioCodec){const a=zt(e,s);if(a>-1)return s[a]}}}return null}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length){this.warn(`Invalid audio track id: ${e}`);return}this.selectDefaultTrack=!1;const s=this.currentTrack,i=t[e],r=i.details&&!i.details.live;if(e===this.trackId&&i===s&&r||(this.log(`Switching to audio-track ${e} "${i.name}" lang:${i.lang} group:${i.groupId} channels:${i.channels}`),this.trackId=e,this.currentTrack=i,this.hls.trigger(v.AUDIO_TRACK_SWITCHING,ae({},i)),r))return;const a=this.switchParams(i.url,s==null?void 0:s.details,i.details);this.loadPlaylist(a)}findTrackId(e){const t=this.tracksInGroup;for(let s=0;s<t.length;s++){const i=t[s];if(!(this.selectDefaultTrack&&!i.default)&&(!e||Jn(e,i,Wn)))return s}if(e){const{name:s,lang:i,assocLang:r,characteristics:a,audioCodec:o,channels:l}=e;for(let u=0;u<t.length;u++){const c=t[u];if(Jn({name:s,lang:i,assocLang:r,characteristics:a,audioCodec:o,channels:l},c,Wn))return u}for(let u=0;u<t.length;u++){const c=t[u];if(qi(e.attrs,c.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return u}for(let u=0;u<t.length;u++){const c=t[u];if(qi(e.attrs,c.attrs,["LANGUAGE"]))return u}}return-1}loadPlaylist(e){super.loadPlaylist();const t=this.currentTrack;this.shouldLoadPlaylist(t)&&_a(t.url,this.hls)&&this.scheduleLoading(t,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const s=e.id,i=e.groupId,r=this.getUrlWithDirectives(e.url,t),a=e.details,o=a==null?void 0:a.age;this.log(`Loading audio-track ${s} "${e.name}" lang:${e.lang} group:${i}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${o&&a.live?" age "+o.toFixed(1)+(a.type&&" "+a.type||""):""} ${r}`),this.hls.trigger(v.AUDIO_TRACK_LOADING,{url:r,id:s,groupId:i,deliveryDirectives:t||null,track:e})}}class LS{constructor(e){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=e}destroy(){this.tracks=this.queues=null}append(e,t,s){if(this.queues===null||this.tracks===null)return;const i=this.queues[t];i.push(e),i.length===1&&!s&&this.executeNext(t)}appendBlocker(e){return new Promise(t=>{const s={label:"async-blocker",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.append(s,e)})}prependBlocker(e){return new Promise(t=>{if(this.queues){const s={label:"async-blocker-prepend",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.queues[e].unshift(s)}})}removeBlockers(){this.queues!==null&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(e=>{var t;const s=(t=e[0])==null?void 0:t.label;(s==="async-blocker"||s==="async-blocker-prepend")&&(e[0].execute(),e.splice(0,1))})}unblockAudio(e){if(this.queues===null)return;this.queues.audio[0]===e&&this.shiftAndExecuteNext("audio")}executeNext(e){if(this.queues===null||this.tracks===null)return;const t=this.queues[e];if(t.length){const i=t[0];try{i.execute()}catch(r){var s;if(i.onError(r),this.queues===null||this.tracks===null)return;const a=(s=this.tracks[e])==null?void 0:s.buffer;a!=null&&a.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){this.queues!==null&&(this.queues[e].shift(),this.executeNext(e))}current(e){var t;return((t=this.queues)==null?void 0:t[e][0])||null}toString(){const{queues:e,tracks:t}=this;return e===null||t===null?"<destroyed>":`
${this.list("video")}
${this.list("audio")}
${this.list("audiovideo")}}`}list(e){var t,s;return(t=this.queues)!=null&&t[e]||(s=this.tracks)!=null&&s[e]?`${e}: (${this.listSbInfo(e)}) ${this.listOps(e)}`:""}listSbInfo(e){var t;const s=(t=this.tracks)==null?void 0:t[e],i=s==null?void 0:s.buffer;return i?`SourceBuffer${i.updating?" updating":""}${s.ended?" ended":""}${s.ending?" ending":""}`:"none"}listOps(e){var t;return((t=this.queues)==null?void 0:t[e].map(s=>s.label).join(", "))||""}}const Uh=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,Cm="HlsJsTrackRemovedError";class IS extends Error{constructor(e){super(e),this.name=Cm}}class RS extends It{constructor(e,t){super("buffer-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.details=null,this._objectUrl=null,this.operationQueue=null,this.bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.blockedAudioAppend=null,this.lastVideoAppendEnd=0,this.appendSource=void 0,this.transferData=void 0,this.overrides=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.sourceBuffers=[[null,null],[null,null]],this._onEndStreaming=s=>{var i;this.hls&&((i=this.mediaSource)==null?void 0:i.readyState)==="open"&&this.hls.pauseBuffering()},this._onStartStreaming=s=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=s=>{const{media:i,mediaSource:r}=this;s&&this.log("Media source opened"),!(!i||!r)&&(r.removeEventListener("sourceopen",this._onMediaSourceOpen),i.removeEventListener("emptied",this._onMediaEmptied),this.updateDuration(),this.hls.trigger(v.MEDIA_ATTACHED,{media:i,mediaSource:r}),this.mediaSource!==null&&this.checkPendingTracks())},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:s,_objectUrl:i}=this;s!==i&&this.error(`Media element src was set while attaching MediaSource (${i} > ${s})`)},this.hls=e,this.fragmentTracker=t,this.appendSource=Yv(On(e.config.preferManagedMediaSource)),this.initTracks(),this.registerListeners()}hasSourceTypes(){return Object.keys(this.tracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null}registerListeners(){const{hls:e}=this;e.on(v.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(v.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(v.MANIFEST_LOADING,this.onManifestLoading,this),e.on(v.MANIFEST_PARSED,this.onManifestParsed,this),e.on(v.BUFFER_RESET,this.onBufferReset,this),e.on(v.BUFFER_APPENDING,this.onBufferAppending,this),e.on(v.BUFFER_CODECS,this.onBufferCodecs,this),e.on(v.BUFFER_EOS,this.onBufferEos,this),e.on(v.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(v.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(v.FRAG_PARSED,this.onFragParsed,this),e.on(v.FRAG_CHANGED,this.onFragChanged,this),e.on(v.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(v.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(v.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(v.MANIFEST_LOADING,this.onManifestLoading,this),e.off(v.MANIFEST_PARSED,this.onManifestParsed,this),e.off(v.BUFFER_RESET,this.onBufferReset,this),e.off(v.BUFFER_APPENDING,this.onBufferAppending,this),e.off(v.BUFFER_CODECS,this.onBufferCodecs,this),e.off(v.BUFFER_EOS,this.onBufferEos,this),e.off(v.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(v.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(v.FRAG_PARSED,this.onFragParsed,this),e.off(v.FRAG_CHANGED,this.onFragChanged,this),e.off(v.ERROR,this.onError,this)}transferMedia(){const{media:e,mediaSource:t}=this;if(!e)return null;const s={};if(this.operationQueue){const r=this.isUpdating();r||this.operationQueue.removeBlockers();const a=this.isQueued();(r||a)&&this.warn(`Transfering MediaSource with${a?" operations in queue":""}${r?" updating SourceBuffer(s)":""} ${this.operationQueue}`),this.operationQueue.destroy()}const i=this.transferData;return!this.sourceBufferCount&&i&&i.mediaSource===t?ue(s,i.tracks):this.sourceBuffers.forEach(r=>{const[a]=r;a&&(s[a]=ue({},this.tracks[a]),this.removeBuffer(a)),r[0]=r[1]=null}),{media:e,mediaSource:t,tracks:s}}initTracks(){const e={};this.sourceBuffers=[[null,null],[null,null]],this.tracks=e,this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0}onManifestLoading(){this.bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){var s;let i=2;(t.audio&&!t.video||!t.altAudio)&&(i=1),this.bufferCodecEventsTotal=i,this.log(`${i} bufferCodec event(s) expected.`),(s=this.transferData)!=null&&s.mediaSource&&this.sourceBufferCount&&i&&this.bufferCreated()}onMediaAttaching(e,t){const s=this.media=t.media;this.transferData=this.overrides=void 0;const i=On(this.appendSource);if(i){const r=!!t.mediaSource;(r||t.overrides)&&(this.transferData=t,this.overrides=t.overrides);const a=this.mediaSource=t.mediaSource||new i;if(this.assignMediaSource(a),r)this._objectUrl=s.src,this.attachTransferred();else{const o=this._objectUrl=self.URL.createObjectURL(a);if(this.appendSource)try{s.removeAttribute("src");const l=self.ManagedMediaSource;s.disableRemotePlayback=s.disableRemotePlayback||l&&a instanceof l,$h(s),_S(s,o),s.load()}catch{s.src=o}else s.src=o}s.addEventListener("emptied",this._onMediaEmptied)}}assignMediaSource(e){var t,s;this.log(`${((t=this.transferData)==null?void 0:t.mediaSource)===e?"transferred":"created"} media source: ${(s=e.constructor)==null?void 0:s.name}`),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming))}attachTransferred(){const e=this.media,t=this.transferData;if(!t||!e)return;const s=this.tracks,i=t.tracks,r=i?Object.keys(i):null,a=r?r.length:0,o=()=>{Promise.resolve().then(()=>{this.media&&this.mediaSourceOpenOrEnded&&this._onMediaSourceOpen()})};if(i&&r&&a){if(!this.tracksReady){this.hls.config.startFragPrefetch=!0,this.log("attachTransferred: waiting for SourceBuffer track info");return}if(this.log(`attachTransferred: (bufferCodecEventsTotal ${this.bufferCodecEventsTotal})
required tracks: ${de(s,(l,u)=>l==="initSegment"?void 0:u)};
transfer tracks: ${de(i,(l,u)=>l==="initSegment"?void 0:u)}}`),!Lp(i,s)){t.mediaSource=null,t.tracks=void 0;const l=e.currentTime,u=this.details,c=Math.max(l,(u==null?void 0:u.fragments[0].start)||0);if(c-l>1){this.log(`attachTransferred: waiting for playback to reach new tracks start time ${l} -> ${c}`);return}this.warn(`attachTransferred: resetting MediaSource for incompatible tracks ("${Object.keys(i)}"->"${Object.keys(s)}") start time: ${c} currentTime: ${l}`),this.onMediaDetaching(v.MEDIA_DETACHING,{}),this.onMediaAttaching(v.MEDIA_ATTACHING,t),e.currentTime=c;return}this.transferData=void 0,r.forEach(l=>{const u=l,c=i[u];if(c){const d=c.buffer;if(d){const h=this.fragmentTracker,f=c.id;if(h.hasFragments(f)||h.hasParts(f)){const E=X.getBuffered(d);h.detectEvictedFragments(u,E,f,null,!0)}const g=jo(u),p=[u,d];this.sourceBuffers[g]=p,d.updating&&this.operationQueue&&this.operationQueue.prependBlocker(u),this.trackSourceBuffer(u,c)}}}),o(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),o()}get mediaSourceOpenOrEnded(){var e;const t=(e=this.mediaSource)==null?void 0:e.readyState;return t==="open"||t==="ended"}onMediaDetaching(e,t){const s=!!t.transferMedia;this.transferData=this.overrides=void 0;const{media:i,mediaSource:r,_objectUrl:a}=this;if(r){if(this.log(`media source ${s?"transferring":"detaching"}`),s)this.sourceBuffers.forEach(([o])=>{o&&this.removeBuffer(o)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){const o=r.readyState==="open";try{const l=r.sourceBuffers;for(let u=l.length;u--;)o&&l[u].abort(),r.removeSourceBuffer(l[u]);o&&r.endOfStream()}catch(l){this.warn(`onMediaDetaching: ${l.message} while calling endOfStream`)}}this.sourceBufferCount&&this.onBufferReset()}r.removeEventListener("sourceopen",this._onMediaSourceOpen),r.removeEventListener("sourceended",this._onMediaSourceEnded),r.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(r.removeEventListener("startstreaming",this._onStartStreaming),r.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}i&&(i.removeEventListener("emptied",this._onMediaEmptied),s||(a&&self.URL.revokeObjectURL(a),this.mediaSrc===a?(i.removeAttribute("src"),this.appendSource&&$h(i),i.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(v.MEDIA_DETACHED,t)}onBufferReset(){this.sourceBuffers.forEach(([e])=>{e&&this.resetBuffer(e)}),this.initTracks()}resetBuffer(e){var t;const s=(t=this.tracks[e])==null?void 0:t.buffer;if(this.removeBuffer(e),s)try{var i;(i=this.mediaSource)!=null&&i.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(s)}catch(r){this.warn(`onBufferReset ${e}`,r)}delete this.tracks[e]}removeBuffer(e){this.removeBufferListeners(e),this.sourceBuffers[jo(e)]=[null,null];const t=this.tracks[e];t&&(t.buffer=void 0)}resetQueue(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new LS(this.tracks)}onBufferCodecs(e,t){var s;const i=this.tracks,r=Object.keys(t);this.log(`BUFFER_CODECS: "${r}" (current SB count ${this.sourceBufferCount})`);const a="audiovideo"in t&&(i.audio||i.video)||i.audiovideo&&("audio"in t||"video"in t),o=!a&&this.sourceBufferCount&&this.media&&r.some(l=>!i[l]);if(a||o){this.warn(`Unsupported transition between "${Object.keys(i)}" and "${r}" SourceBuffers`);return}r.forEach(l=>{var u,c;const d=t[l],{id:h,codec:f,levelCodec:g,container:p,metadata:E,supplemental:y}=d;let m=i[l];const S=(u=this.transferData)==null||(u=u.tracks)==null?void 0:u[l],T=S!=null&&S.buffer?S:m,A=(T==null?void 0:T.pendingCodec)||(T==null?void 0:T.codec),_=T==null?void 0:T.levelCodec;m||(m=i[l]={buffer:void 0,listeners:[],codec:f,supplemental:y,container:p,levelCodec:g,metadata:E,id:h});const L=zr(A,_),R=L==null?void 0:L.replace(Uh,"$1");let C=zr(f,g);const I=(c=C)==null?void 0:c.replace(Uh,"$1");C&&L&&R!==I&&(l.slice(0,5)==="audio"&&(C=Ia(C,this.appendSource)),this.log(`switching codec ${A} to ${C}`),C!==(m.pendingCodec||m.codec)&&(m.pendingCodec=C),m.container=p,this.appendChangeType(l,p,C))}),(this.tracksReady||this.sourceBufferCount)&&(t.tracks=this.sourceBufferTracks),!this.sourceBufferCount&&(this.bufferCodecEventsTotal>1&&!this.tracks.video&&!t.video&&((s=t.audio)==null?void 0:s.id)==="main"&&(this.log("Main audio-only"),this.bufferCodecEventsTotal=1),this.mediaSourceOpenOrEnded&&this.checkPendingTracks())}get sourceBufferTracks(){return Object.keys(this.tracks).reduce((e,t)=>{const s=this.tracks[t];return e[t]={id:s.id,container:s.container,codec:s.codec,levelCodec:s.levelCodec},e},{})}appendChangeType(e,t,s){const i=`${t};codecs=${s}`,r={label:`change-type=${i}`,execute:()=>{const a=this.tracks[e];if(a){const o=a.buffer;o!=null&&o.changeType&&(this.log(`changing ${e} sourceBuffer type to ${i}`),o.changeType(i),a.codec=s,a.container=t)}this.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:a=>{this.warn(`Failed to change ${e} SourceBuffer type`,a)}};this.append(r,e,this.isPending(this.tracks[e]))}blockAudio(e){var t;const s=e.start,i=s+e.duration*.05;if(((t=this.fragmentTracker.getAppendedFrag(s,H.MAIN))==null?void 0:t.gap)===!0)return;const a={label:"block-audio",execute:()=>{var o;const l=this.tracks.video;(this.lastVideoAppendEnd>i||l!=null&&l.buffer&&X.isBuffered(l.buffer,i)||((o=this.fragmentTracker.getAppendedFrag(i,H.MAIN))==null?void 0:o.gap)===!0)&&(this.blockedAudioAppend=null,this.shiftAndExecuteNext("audio"))},onStart:()=>{},onComplete:()=>{},onError:o=>{this.warn("Error executing block-audio operation",o)}};this.blockedAudioAppend={op:a,frag:e},this.append(a,"audio",!0)}unblockAudio(){const{blockedAudioAppend:e,operationQueue:t}=this;e&&t&&(this.blockedAudioAppend=null,t.unblockAudio(e.op))}onBufferAppending(e,t){const{tracks:s}=this,{data:i,type:r,parent:a,frag:o,part:l,chunkMeta:u,offset:c}=t,d=u.buffering[r],{sn:h,cc:f}=o,g=self.performance.now();d.start=g;const p=o.stats.buffering,E=l?l.stats.buffering:null;p.start===0&&(p.start=g),E&&E.start===0&&(E.start=g);const y=s.audio;let m=!1;r==="audio"&&(y==null?void 0:y.container)==="audio/mpeg"&&(m=!this.lastMpegAudioChunk||u.id===1||this.lastMpegAudioChunk.sn!==u.sn,this.lastMpegAudioChunk=u);const S=s.video,T=S==null?void 0:S.buffer;if(T&&h!=="initSegment"){const L=l||o,R=this.blockedAudioAppend;if(r==="audio"&&a!=="main"&&!this.blockedAudioAppend&&!(S.ending||S.ended)){const I=L.start+L.duration*.05,P=T.buffered,$=this.currentOp("video");!P.length&&!$?this.blockAudio(L):!$&&!X.isBuffered(T,I)&&this.lastVideoAppendEnd<I&&this.blockAudio(L)}else if(r==="video"){const C=L.end;if(R){const I=R.frag.start;(C>I||C<this.lastVideoAppendEnd||X.isBuffered(T,I))&&this.unblockAudio()}this.lastVideoAppendEnd=C}}const A=(l||o).start,_={label:`append-${r}`,execute:()=>{var L;d.executeStart=self.performance.now();const R=(L=this.tracks[r])==null?void 0:L.buffer;R&&(m?this.updateTimestampOffset(R,A,.1,r,h,f):c!==void 0&&j(c)&&this.updateTimestampOffset(R,c,1e-6,r,h,f)),this.appendExecutor(i,r)},onStart:()=>{},onComplete:()=>{const L=self.performance.now();d.executeEnd=d.end=L,p.first===0&&(p.first=L),E&&E.first===0&&(E.first=L);const R={};this.sourceBuffers.forEach(([C,I])=>{C&&(R[C]=X.getBuffered(I))}),this.appendErrors[r]=0,r==="audio"||r==="video"?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(v.BUFFER_APPENDED,{type:r,frag:o,part:l,chunkMeta:u,parent:o.type,timeRanges:R})},onError:L=>{var R;const C={type:Y.MEDIA_ERROR,parent:o.type,details:w.BUFFER_APPEND_ERROR,sourceBufferName:r,frag:o,part:l,chunkMeta:u,error:L,err:L,fatal:!1},I=(R=this.media)==null?void 0:R.error;if(L.code===DOMException.QUOTA_EXCEEDED_ERR||L.name=="QuotaExceededError"||"quota"in L)C.details=w.BUFFER_FULL_ERROR;else if(L.code===DOMException.INVALID_STATE_ERR&&this.mediaSourceOpenOrEnded&&!I)C.errorAction=Ms(!0);else if(L.name===Cm&&this.sourceBufferCount===0)C.errorAction=Ms(!0);else{const P=++this.appendErrors[r];this.warn(`Failed ${P}/${this.hls.config.appendErrorMaxRetry} times to append segment in "${r}" sourceBuffer (${I||"no media error"})`),(P>=this.hls.config.appendErrorMaxRetry||I)&&(C.fatal=!0)}this.hls.trigger(v.ERROR,C)}};this.log(`queuing "${r}" append sn: ${h}${l?" p: "+l.index:""} of ${o.type===H.MAIN?"level":"track"} ${o.level} cc: ${f}`),this.append(_,r,this.isPending(this.tracks[r]))}getFlushOp(e,t,s){return this.log(`queuing "${e}" remove ${t}-${s}`),{label:"remove",execute:()=>{this.removeExecutor(e,t,s)},onStart:()=>{},onComplete:()=>{this.hls.trigger(v.BUFFER_FLUSHED,{type:e})},onError:i=>{this.warn(`Failed to remove ${t}-${s} from "${e}" SourceBuffer`,i)}}}onBufferFlushing(e,t){const{type:s,startOffset:i,endOffset:r}=t;s?this.append(this.getFlushOp(s,i,r),s):this.sourceBuffers.forEach(([a])=>{a&&this.append(this.getFlushOp(a,i,r),a)})}onFragParsed(e,t){const{frag:s,part:i}=t,r=[],a=i?i.elementaryStreams:s.elementaryStreams;a[ce.AUDIOVIDEO]?r.push("audiovideo"):(a[ce.AUDIO]&&r.push("audio"),a[ce.VIDEO]&&r.push("video"));const o=()=>{const l=self.performance.now();s.stats.buffering.end=l,i&&(i.stats.buffering.end=l);const u=i?i.stats:s.stats;this.hls.trigger(v.FRAG_BUFFERED,{frag:s,part:i,stats:u,id:s.type})};r.length===0&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${s.type} level: ${s.level} sn: ${s.sn}`),this.blockBuffers(o,r).catch(l=>{this.warn(`Fragment buffered callback ${l}`),this.stepOperationQueue(this.sourceBufferTypes)})}onFragChanged(e,t){this.trimBuffers()}get bufferedToEnd(){return this.sourceBufferCount>0&&!this.sourceBuffers.some(([e])=>{if(e){const t=this.tracks[e];if(t)return!t.ended||t.ending}return!1})}onBufferEos(e,t){var s;this.sourceBuffers.forEach(([a])=>{if(a){const o=this.tracks[a];(!t.type||t.type===a)&&(o.ending=!0,o.ended||(o.ended=!0,this.log(`${a} buffer reached EOS`)))}});const i=((s=this.overrides)==null?void 0:s.endOfStream)!==!1;this.sourceBufferCount>0&&!this.sourceBuffers.some(([a])=>{var o;return a&&!((o=this.tracks[a])!=null&&o.ended)})?i?(this.log("Queueing EOS"),this.blockUntilOpen(()=>{this.tracksEnded();const{mediaSource:a}=this;if(!a||a.readyState!=="open"){a&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${a.readyState}`);return}this.log("Calling mediaSource.endOfStream()"),a.endOfStream(),this.hls.trigger(v.BUFFERED_TO_END,void 0)})):(this.tracksEnded(),this.hls.trigger(v.BUFFERED_TO_END,void 0)):t.type==="video"&&this.unblockAudio()}tracksEnded(){this.sourceBuffers.forEach(([e])=>{if(e!==null){const t=this.tracks[e];t&&(t.ending=!1)}})}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.updateDuration())}updateDuration(){this.blockUntilOpen(()=>{const e=this.getDurationAndRange();e&&this.updateMediaSource(e)})}onError(e,t){if(t.details===w.BUFFER_APPEND_ERROR&&t.frag){var s;const i=(s=t.errorAction)==null?void 0:s.nextAutoLevel;j(i)&&i!==t.frag.level&&this.resetAppendErrors()}}resetAppendErrors(){this.appendErrors={audio:0,video:0,audiovideo:0}}trimBuffers(){const{hls:e,details:t,media:s}=this;if(!s||t===null||!this.sourceBufferCount)return;const i=e.config,r=s.currentTime,a=t.levelTargetDuration,o=t.live&&i.liveBackBufferLength!==null?i.liveBackBufferLength:i.backBufferLength;if(j(o)&&o>=0){const u=Math.max(o,a),c=Math.floor(r/a)*a-u;this.flushBackBuffer(r,a,c)}const l=i.frontBufferFlushThreshold;if(j(l)&&l>0){const u=Math.max(i.maxBufferLength,l),c=Math.max(u,a),d=Math.floor(r/a)*a+c;this.flushFrontBuffer(r,a,d)}}flushBackBuffer(e,t,s){this.sourceBuffers.forEach(([i,r])=>{if(r){const o=X.getBuffered(r);if(o.length>0&&s>o.start(0)){var a;this.hls.trigger(v.BACK_BUFFER_REACHED,{bufferEnd:s});const l=this.tracks[i];if((a=this.details)!=null&&a.live)this.hls.trigger(v.LIVE_BACK_BUFFER_REACHED,{bufferEnd:s});else if(l!=null&&l.ended){this.log(`Cannot flush ${i} back buffer while SourceBuffer is in ended state`);return}this.hls.trigger(v.BUFFER_FLUSHING,{startOffset:0,endOffset:s,type:i})}}})}flushFrontBuffer(e,t,s){this.sourceBuffers.forEach(([i,r])=>{if(r){const a=X.getBuffered(r),o=a.length;if(o<2)return;const l=a.start(o-1),u=a.end(o-1);if(s>l||e>=l&&e<=u)return;this.hls.trigger(v.BUFFER_FLUSHING,{startOffset:l,endOffset:1/0,type:i})}})}getDurationAndRange(){var e;const{details:t,mediaSource:s}=this;if(!t||!this.media||(s==null?void 0:s.readyState)!=="open")return null;const i=t.edge;if(t.live&&this.hls.config.liveDurationInfinity){if(t.fragments.length&&s.setLiveSeekableRange){const u=Math.max(0,t.fragmentStart),c=Math.max(u,i);return{duration:1/0,start:u,end:c}}return{duration:1/0}}const r=(e=this.overrides)==null?void 0:e.duration;if(r)return j(r)?{duration:r}:null;const a=this.media.duration,o=j(s.duration)?s.duration:0;return i>o&&i>a||!j(a)?{duration:i}:null}updateMediaSource({duration:e,start:t,end:s}){const i=this.mediaSource;!this.media||!i||i.readyState!=="open"||(i.duration!==e&&(j(e)&&this.log(`Updating MediaSource duration to ${e.toFixed(3)}`),i.duration=e),t!==void 0&&s!==void 0&&(this.log(`MediaSource duration is set to ${i.duration}. Setting seekable range to ${t}-${s}.`),i.setLiveSeekableRange(t,s)))}get tracksReady(){const e=this.pendingTrackCount;return e>0&&(e>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}checkPendingTracks(){const{bufferCodecEventsTotal:e,pendingTrackCount:t,tracks:s}=this;if(this.log(`checkPendingTracks (pending: ${t} codec events expected: ${e}) ${de(s)}`),this.tracksReady){var i;const r=(i=this.transferData)==null?void 0:i.tracks;r&&Object.keys(r).length?this.attachTransferred():this.createSourceBuffers()}}bufferCreated(){if(this.sourceBufferCount){const e={};this.sourceBuffers.forEach(([t,s])=>{if(t){const i=this.tracks[t];e[t]={buffer:s,container:i.container,codec:i.codec,supplemental:i.supplemental,levelCodec:i.levelCodec,id:i.id,metadata:i.metadata}}}),this.hls.trigger(v.BUFFER_CREATED,{tracks:e}),this.log(`SourceBuffers created. Running queue: ${this.operationQueue}`),this.sourceBuffers.forEach(([t])=>{this.executeNext(t)})}else{const e=new Error("could not create source buffer for media codec(s)");this.hls.trigger(v.ERROR,{type:Y.MEDIA_ERROR,details:w.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})}}createSourceBuffers(){const{tracks:e,sourceBuffers:t,mediaSource:s}=this;if(!s)throw new Error("createSourceBuffers called when mediaSource was null");for(const r in e){const a=r,o=e[a];if(this.isPending(o)){const l=this.getTrackCodec(o,a),u=`${o.container};codecs=${l}`;o.codec=l,this.log(`creating sourceBuffer(${u})${this.currentOp(a)?" Queued":""} ${de(o)}`);try{const c=s.addSourceBuffer(u),d=jo(a),h=[a,c];t[d]=h,o.buffer=c}catch(c){var i;this.error(`error while trying to add sourceBuffer: ${c.message}`),this.shiftAndExecuteNext(a),(i=this.operationQueue)==null||i.removeBlockers(),delete this.tracks[a],this.hls.trigger(v.ERROR,{type:Y.MEDIA_ERROR,details:w.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:c,sourceBufferName:a,mimeType:u,parent:o.id});return}this.trackSourceBuffer(a,o)}}this.bufferCreated()}getTrackCodec(e,t){const s=e.supplemental;let i=e.codec;s&&(t==="video"||t==="audiovideo")&&Ki(s,"video")&&(i=mE(i,s));const r=zr(i,e.levelCodec);return r?t.slice(0,5)==="audio"?Ia(r,this.appendSource):r:""}trackSourceBuffer(e,t){const s=t.buffer;if(!s)return;const i=this.getTrackCodec(t,e);this.tracks[e]={buffer:s,codec:i,container:t.container,levelCodec:t.levelCodec,supplemental:t.supplemental,metadata:t.metadata,id:t.id,listeners:[]},this.removeBufferListeners(e),this.addBufferListener(e,"updatestart",this.onSBUpdateStart),this.addBufferListener(e,"updateend",this.onSBUpdateEnd),this.addBufferListener(e,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(e,"bufferedchange",(r,a)=>{const o=a.removedRanges;o!=null&&o.length&&this.hls.trigger(v.BUFFER_FLUSHED,{type:r})})}get mediaSrc(){var e,t;const s=((e=this.media)==null||(t=e.querySelector)==null?void 0:t.call(e,"source"))||this.media;return s==null?void 0:s.src}onSBUpdateStart(e){const t=this.currentOp(e);t&&t.onStart()}onSBUpdateEnd(e){var t;if(((t=this.mediaSource)==null?void 0:t.readyState)==="closed"){this.resetBuffer(e);return}const s=this.currentOp(e);s&&(s.onComplete(),this.shiftAndExecuteNext(e))}onSBUpdateError(e,t){var s;const i=new Error(`${e} SourceBuffer error. MediaSource readyState: ${(s=this.mediaSource)==null?void 0:s.readyState}`);this.error(`${i}`,t),this.hls.trigger(v.ERROR,{type:Y.MEDIA_ERROR,details:w.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:i,fatal:!1});const r=this.currentOp(e);r&&r.onError(i)}updateTimestampOffset(e,t,s,i,r,a){const o=t-e.timestampOffset;Math.abs(o)>=s&&(this.log(`Updating ${i} SourceBuffer timestampOffset to ${t} (sn: ${r} cc: ${a})`),e.timestampOffset=t)}removeExecutor(e,t,s){const{media:i,mediaSource:r}=this,a=this.tracks[e],o=a==null?void 0:a.buffer;if(!i||!r||!o){this.warn(`Attempting to remove from the ${e} SourceBuffer, but it does not exist`),this.shiftAndExecuteNext(e);return}const l=j(i.duration)?i.duration:1/0,u=j(r.duration)?r.duration:1/0,c=Math.max(0,t),d=Math.min(s,l,u);d>c&&(!a.ending||a.ended)?(a.ended=!1,this.log(`Removing [${c},${d}] from the ${e} SourceBuffer`),o.remove(c,d)):this.shiftAndExecuteNext(e)}appendExecutor(e,t){const s=this.tracks[t],i=s==null?void 0:s.buffer;if(!i)throw new IS(`Attempting to append to the ${t} SourceBuffer, but it does not exist`);s.ending=!1,s.ended=!1,i.appendBuffer(e)}blockUntilOpen(e){if(this.isUpdating()||this.isQueued())this.blockBuffers(e).catch(t=>{this.warn(`SourceBuffer blocked callback ${t}`),this.stepOperationQueue(this.sourceBufferTypes)});else try{e()}catch(t){this.warn(`Callback run without blocking ${this.operationQueue} ${t}`)}}isUpdating(){return this.sourceBuffers.some(([e,t])=>e&&t.updating)}isQueued(){return this.sourceBuffers.some(([e])=>e&&!!this.currentOp(e))}isPending(e){return!!e&&!e.buffer}blockBuffers(e,t=this.sourceBufferTypes){if(!t.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);const{operationQueue:s}=this,i=t.map(a=>this.appendBlocker(a));return t.length>1&&!!this.blockedAudioAppend&&this.unblockAudio(),Promise.all(i).then(a=>{s===this.operationQueue&&(e(),this.stepOperationQueue(this.sourceBufferTypes))})}stepOperationQueue(e){e.forEach(t=>{var s;const i=(s=this.tracks[t])==null?void 0:s.buffer;!i||i.updating||this.shiftAndExecuteNext(t)})}append(e,t,s){this.operationQueue&&this.operationQueue.append(e,t,s)}appendBlocker(e){if(this.operationQueue)return this.operationQueue.appendBlocker(e)}currentOp(e){return this.operationQueue?this.operationQueue.current(e):null}executeNext(e){e&&this.operationQueue&&this.operationQueue.executeNext(e)}shiftAndExecuteNext(e){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(e)}get pendingTrackCount(){return Object.keys(this.tracks).reduce((e,t)=>e+(this.isPending(this.tracks[t])?1:0),0)}get sourceBufferCount(){return this.sourceBuffers.reduce((e,[t])=>e+(t?1:0),0)}get sourceBufferTypes(){return this.sourceBuffers.map(([e])=>e).filter(e=>!!e)}addBufferListener(e,t,s){const i=this.tracks[e];if(!i)return;const r=i.buffer;if(!r)return;const a=s.bind(this,e);i.listeners.push({event:t,listener:a}),r.addEventListener(t,a)}removeBufferListeners(e){const t=this.tracks[e];if(!t)return;const s=t.buffer;s&&(t.listeners.forEach(i=>{s.removeEventListener(i.event,i.listener)}),t.listeners.length=0)}}function $h(n){const e=n.querySelectorAll("source");[].slice.call(e).forEach(t=>{n.removeChild(t)})}function _S(n,e){const t=self.document.createElement("source");t.type="video/mp4",t.src=e,n.appendChild(t)}function jo(n){return n==="audio"?1:0}class Ic{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(v.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(v.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(v.MANIFEST_PARSED,this.onManifestParsed,this),e.on(v.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(v.BUFFER_CODECS,this.onBufferCodecs,this),e.on(v.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(v.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(v.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(v.MANIFEST_PARSED,this.onManifestParsed,this),e.off(v.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(v.BUFFER_CODECS,this.onBufferCodecs,this),e.off(v.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const s=this.hls.levels[t.droppedLevel];this.isLevelAllowed(s)&&this.restrictedLevels.push({bitrate:s.bitrate,height:s.height,width:s.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,t){const s=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,s.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onLevelsUpdated(e,t){this.timer&&j(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping(),this.media=null}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}const e=this.hls.levels;if(e.length){const t=this.hls,s=this.getMaxLevel(e.length-1);s!==this.autoLevelCapping&&t.logger.log(`Setting autoLevelCapping to ${s}: ${e[s].height}p@${e[s].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),t.autoLevelCapping=s,t.autoLevelEnabled&&t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const s=t.filter((i,r)=>this.isLevelAllowed(i)&&r<=e);return this.clientRect=null,Ic.getMaxLevelByMediaSize(s,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const s=e.getBoundingClientRect();t.width=s.width,t.height=s.height,!t.width&&!t.height&&(t.width=s.right-s.left||e.width||0,t.height=s.bottom-s.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch{}return Math.min(e,this.hls.config.maxDevicePixelRatio)}isLevelAllowed(e){return!this.restrictedLevels.some(s=>e.bitrate===s.bitrate&&e.width===s.width&&e.height===s.height)}static getMaxLevelByMediaSize(e,t,s){if(!(e!=null&&e.length))return-1;const i=(o,l)=>l?o.width!==l.width||o.height!==l.height:!0;let r=e.length-1;const a=Math.max(t,s);for(let o=0;o<e.length;o+=1){const l=e[o];if((l.width>=a||l.height>=a)&&i(l,e[o+1])){r=o;break}}return r}}const CS={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"},Ze=CS,kS={HLS:"h"},wS=kS;class Qt{constructor(e,t){Array.isArray(e)&&(e=e.map(s=>s instanceof Qt?s:new Qt(s))),this.value=e,this.params=t}}const DS="Dict";function PS(n){return Array.isArray(n)?JSON.stringify(n):n instanceof Map?"Map{}":n instanceof Set?"Set{}":typeof n=="object"?JSON.stringify(n):String(n)}function bS(n,e,t,s){return new Error(`failed to ${n} "${PS(e)}" as ${t}`,{cause:s})}function Xt(n,e,t){return bS("serialize",n,e,t)}class km{constructor(e){this.description=e}}const jh="Bare Item",NS="Boolean";function OS(n){if(typeof n!="boolean")throw Xt(n,NS);return n?"?1":"?0"}function MS(n){return btoa(String.fromCharCode(...n))}const FS="Byte Sequence";function BS(n){if(ArrayBuffer.isView(n)===!1)throw Xt(n,FS);return`:${MS(n)}:`}const US="Integer";function $S(n){return n<-999999999999999||999999999999999<n}function wm(n){if($S(n))throw Xt(n,US);return n.toString()}function jS(n){return`@${wm(n.getTime()/1e3)}`}function Dm(n,e){if(n<0)return-Dm(-n,e);const t=Math.pow(10,e);if(Math.abs(n*t%1-.5)<Number.EPSILON){const i=Math.floor(n*t);return(i%2===0?i:i+1)/t}else return Math.round(n*t)/t}const GS="Decimal";function KS(n){const e=Dm(n,3);if(Math.floor(Math.abs(e)).toString().length>12)throw Xt(n,GS);const t=e.toString();return t.includes(".")?t:`${t}.0`}const VS="String",HS=/[\x00-\x1f\x7f]+/;function zS(n){if(HS.test(n))throw Xt(n,VS);return`"${n.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}function WS(n){return n.description||n.toString().slice(7,-1)}const YS="Token";function Gh(n){const e=WS(n);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(e)===!1)throw Xt(e,YS);return e}function su(n){switch(typeof n){case"number":if(!j(n))throw Xt(n,jh);return Number.isInteger(n)?wm(n):KS(n);case"string":return zS(n);case"symbol":return Gh(n);case"boolean":return OS(n);case"object":if(n instanceof Date)return jS(n);if(n instanceof Uint8Array)return BS(n);if(n instanceof km)return Gh(n);default:throw Xt(n,jh)}}const qS="Key";function iu(n){if(/^[a-z*][a-z0-9\-_.*]*$/.test(n)===!1)throw Xt(n,qS);return n}function Rc(n){return n==null?"":Object.entries(n).map(([e,t])=>t===!0?`;${iu(e)}`:`;${iu(e)}=${su(t)}`).join("")}function Pm(n){return n instanceof Qt?`${su(n.value)}${Rc(n.params)}`:su(n)}function QS(n){return`(${n.value.map(Pm).join(" ")})${Rc(n.params)}`}function XS(n,e={whitespace:!0}){if(typeof n!="object"||n==null)throw Xt(n,DS);const t=n instanceof Map?n.entries():Object.entries(n),s=e!=null&&e.whitespace?" ":"";return Array.from(t).map(([i,r])=>{r instanceof Qt||(r=new Qt(r));let a=iu(i);return r.value===!0?a+=Rc(r.params):(a+="=",Array.isArray(r.value)?a+=QS(r):a+=Pm(r)),a}).join(`,${s}`)}function bm(n,e){return XS(n,e)}const $t="CMCD-Object",Se="CMCD-Request",Kn="CMCD-Session",pn="CMCD-Status",ZS={br:$t,ab:$t,d:$t,ot:$t,tb:$t,tpb:$t,lb:$t,tab:$t,lab:$t,url:$t,pb:Se,bl:Se,tbl:Se,dl:Se,ltc:Se,mtp:Se,nor:Se,nrr:Se,rc:Se,sn:Se,sta:Se,su:Se,ttfb:Se,ttfbb:Se,ttlb:Se,cmsdd:Se,cmsds:Se,smrt:Se,df:Se,cs:Se,ts:Se,cid:Kn,pr:Kn,sf:Kn,sid:Kn,st:Kn,v:Kn,msd:Kn,bs:pn,bsd:pn,cdn:pn,rtp:pn,bg:pn,pt:pn,ec:pn,e:pn},JS={REQUEST:Se};function eT(n){return Object.keys(n).reduce((e,t)=>{var s;return(s=n[t])===null||s===void 0||s.forEach(i=>e[i]=t),e},{})}function tT(n,e){const t={};if(!n)return t;const s=Object.keys(n),i=e?eT(e):{};return s.reduce((r,a)=>{var o;const l=ZS[a]||i[a]||JS.REQUEST,u=(o=r[l])!==null&&o!==void 0?o:r[l]={};return u[a]=n[a],r},t)}function nT(n){return["ot","sf","st","e","sta"].includes(n)}function sT(n){return typeof n=="number"?j(n):n!=null&&n!==""&&n!==!1}const Nm="event";function iT(n,e){const t=new URL(n),s=new URL(e);if(t.origin!==s.origin)return n;const i=t.pathname.split("/").slice(1),r=s.pathname.split("/").slice(1,-1);for(;i[0]===r[0];)i.shift(),r.shift();for(;r.length;)r.shift(),i.unshift("..");return i.join("/")+t.search+t.hash}const Xr=n=>Math.round(n),ru=(n,e)=>Array.isArray(n)?n.map(t=>ru(t,e)):n instanceof Qt&&typeof n.value=="string"?new Qt(ru(n.value,e),n.params):(e.baseUrl&&(n=iT(n,e.baseUrl)),e.version===1?encodeURIComponent(n):n),Rr=n=>Xr(n/100)*100,rT=(n,e)=>{let t=n;return e.version>=2&&(n instanceof Qt&&typeof n.value=="string"?t=new Qt([n]):typeof n=="string"&&(t=[n])),ru(t,e)},aT={br:Xr,d:Xr,bl:Rr,dl:Rr,mtp:Rr,nor:rT,rtp:Rr,tb:Xr},Om="request",Mm="response",_c=["ab","bg","bl","br","bs","bsd","cdn","cid","cs","df","ec","lab","lb","ltc","msd","mtp","pb","pr","pt","sf","sid","sn","st","sta","tab","tb","tbl","tpb","ts","v"],oT=["e"],lT=/^[a-zA-Z0-9-.]+-[a-zA-Z0-9-.]+$/;function Ja(n){return lT.test(n)}function uT(n){return _c.includes(n)||oT.includes(n)||Ja(n)}const Fm=["d","dl","nor","ot","rtp","su"];function cT(n){return _c.includes(n)||Fm.includes(n)||Ja(n)}const dT=["cmsdd","cmsds","rc","smrt","ttfb","ttfbb","ttlb","url"];function hT(n){return _c.includes(n)||Fm.includes(n)||dT.includes(n)||Ja(n)}const fT=["bl","br","bs","cid","d","dl","mtp","nor","nrr","ot","pr","rtp","sf","sid","st","su","tb","v"];function gT(n){return fT.includes(n)||Ja(n)}const pT={[Mm]:hT,[Nm]:uT,[Om]:cT};function Bm(n,e={}){const t={};if(n==null||typeof n!="object")return t;const s=e.version||n.v||1,i=e.reportingMode||Om,r=s===1?gT:pT[i];let a=Object.keys(n).filter(r);const o=e.filter;typeof o=="function"&&(a=a.filter(o));const l=i===Mm||i===Nm;l&&!a.includes("ts")&&a.push("ts"),s>1&&!a.includes("v")&&a.push("v");const u=ue({},aT,e.formatters),c={version:s,reportingMode:i,baseUrl:e.baseUrl};return a.sort().forEach(d=>{let h=n[d];const f=u[d];if(typeof f=="function"&&(h=f(h,c)),d==="v"){if(s===1)return;h=s}d=="pr"&&h===1||(l&&d==="ts"&&!j(h)&&(h=Date.now()),sT(h)&&(nT(d)&&typeof h=="string"&&(h=new km(h)),t[d]=h))}),t}function mT(n,e={}){const t={};if(!n)return t;const s=Bm(n,e),i=tT(s,e==null?void 0:e.customHeaderMap);return Object.entries(i).reduce((r,[a,o])=>{const l=bm(o,{whitespace:!1});return l&&(r[a]=l),r},t)}function yT(n,e,t){return ue(n,mT(e,t))}const vT="CMCD";function ET(n,e={}){return n?bm(Bm(n,e),{whitespace:!1}):""}function xT(n,e={}){if(!n)return"";const t=ET(n,e);return encodeURIComponent(t)}function ST(n,e={}){if(!n)return"";const t=xT(n,e);return`${vT}=${t}`}const Kh=/CMCD=[^&#]+/;function TT(n,e,t){const s=ST(e,t);if(!s)return n;if(Kh.test(n))return n.replace(Kh,s);const i=n.includes("?")?"&":"?";return`${n}${i}${s}`}class AT{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=i=>{try{this.apply(i,{ot:Ze.MANIFEST,su:!this.initialized})}catch(r){this.hls.logger.warn("Could not generate manifest CMCD data.",r)}},this.applyFragmentData=i=>{try{const{frag:r,part:a}=i,o=this.hls.levels[r.level],l=this.getObjectType(r),u={d:(a||r).duration*1e3,ot:l};(l===Ze.VIDEO||l===Ze.AUDIO||l==Ze.MUXED)&&(u.br=o.bitrate/1e3,u.tb=this.getTopBandwidth(l)/1e3,u.bl=this.getBufferLength(l));const c=a?this.getNextPart(a):this.getNextFrag(r);c!=null&&c.url&&c.url!==r.url&&(u.nor=c.url),this.apply(i,u)}catch(r){this.hls.logger.warn("Could not generate segment CMCD data.",r)}},this.hls=e;const t=this.config=e.config,{cmcd:s}=t;s!=null&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=s.sessionId||e.sessionId,this.cid=s.contentId,this.useHeaders=s.useHeaders===!0,this.includeKeys=s.includeKeys,this.registerListeners())}registerListeners(){const e=this.hls;e.on(v.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(v.MEDIA_DETACHED,this.onMediaDetached,this),e.on(v.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(v.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(v.MEDIA_DETACHED,this.onMediaDetached,this),e.off(v.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var s,i;this.audioBuffer=(s=t.tracks.audio)==null?void 0:s.buffer,this.videoBuffer=(i=t.tracks.video)==null?void 0:i.buffer}createData(){var e;return{v:1,sf:wS.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)==null?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){ue(t,this.createData());const s=t.ot===Ze.INIT||t.ot===Ze.VIDEO||t.ot===Ze.MUXED;this.starved&&s&&(t.bs=!0,t.su=!0,this.starved=!1),t.su==null&&(t.su=this.buffering);const{includeKeys:i}=this;i&&(t=Object.keys(t).reduce((a,o)=>(i.includes(o)&&(a[o]=t[o]),a),{}));const r={baseUrl:e.url};this.useHeaders?(e.headers||(e.headers={}),yT(e.headers,t,r)):e.url=TT(e.url,t,r)}getNextFrag(e){var t;const s=(t=this.hls.levels[e.level])==null?void 0:t.details;if(s){const i=e.sn-s.startSN;return s.fragments[i+1]}}getNextPart(e){var t;const{index:s,fragment:i}=e,r=(t=this.hls.levels[i.level])==null||(t=t.details)==null?void 0:t.partList;if(r){const{sn:a}=i;for(let o=r.length-1;o>=0;o--){const l=r[o];if(l.index===s&&l.fragment.sn===a)return r[o+1]}}}getObjectType(e){const{type:t}=e;if(t==="subtitle")return Ze.TIMED_TEXT;if(e.sn==="initSegment")return Ze.INIT;if(t==="audio")return Ze.AUDIO;if(t==="main")return this.hls.audioTracks.length?Ze.VIDEO:Ze.MUXED}getTopBandwidth(e){let t=0,s;const i=this.hls;if(e===Ze.AUDIO)s=i.audioTracks;else{const r=i.maxAutoLevel,a=r>-1?r+1:i.levels.length;s=i.levels.slice(0,a)}return s.forEach(r=>{r.bitrate>t&&(t=r.bitrate)}),t>0?t:NaN}getBufferLength(e){const t=this.media,s=e===Ze.AUDIO?this.audioBuffer:this.videoBuffer;return!s||!t?NaN:X.bufferInfo(s,t.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,s=e||this.config.loader;return class{constructor(r){this.loader=void 0,this.loader=new s(r)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(r,a,o){t(r),this.loader.load(r,a,o)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,s=e||this.config.loader;return class{constructor(r){this.loader=void 0,this.loader=new s(r)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(r,a,o){t(r),this.loader.load(r,a,o)}}}}const LT=3e5;class IT extends It{constructor(e){super("content-steering",e.logger),this.hls=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this._pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(v.MANIFEST_LOADING,this.onManifestLoading,this),e.on(v.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(v.MANIFEST_PARSED,this.onManifestParsed,this),e.on(v.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(v.MANIFEST_LOADING,this.onManifestLoading,this),e.off(v.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(v.MANIFEST_PARSED,this.onManifestParsed,this),e.off(v.ERROR,this.onError,this))}pathways(){return(this.levels||[]).reduce((e,t)=>(e.indexOf(t.pathwayId)===-1&&e.push(t.pathwayId),e),[])}get pathwayPriority(){return this._pathwayPriority}set pathwayPriority(e){this.updatePathwayPriority(e)}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const e=this.timeToLoad*1e3-(performance.now()-this.updated);if(e>0){this.scheduleRefresh(this.uri,e);return}}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter(s=>s!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:s}=t;s!==null&&(this.pathwayId=s.pathwayId,this.uri=s.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:s}=t;if((s==null?void 0:s.action)===Fe.SendAlternateToPenaltyBox&&s.flags===at.MoveAllAlternatesMatchingHost){const i=this.levels;let r=this._pathwayPriority,a=this.pathwayId;if(t.context){const{groupId:o,pathwayId:l,type:u}=t.context;o&&i?a=this.getPathwayForGroupId(o,u,a):l&&(a=l)}a in this.penalizedPathways||(this.penalizedPathways[a]=performance.now()),!r&&i&&(r=this.pathways()),r&&r.length>1&&(this.updatePathwayPriority(r),s.resolved=this.pathwayId!==a),t.details===w.BUFFER_APPEND_ERROR&&!t.fatal?s.resolved=!0:s.resolved||this.warn(`Could not resolve ${t.details} ("${t.error.message}") with content-steering for Pathway: ${a} levels: ${i&&i.length} priorities: ${de(r)} penalized: ${de(this.penalizedPathways)}`)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(t.length===0){const s=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${s}"`),t=this.getLevelsForPathway(s),this.pathwayId=s}return t.length!==e.length&&this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t}getLevelsForPathway(e){return this.levels===null?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){this._pathwayPriority=e;let t;const s=this.penalizedPathways,i=performance.now();Object.keys(s).forEach(r=>{i-s[r]>LT&&delete s[r]});for(let r=0;r<e.length;r++){const a=e[r];if(a in s)continue;if(a===this.pathwayId)return;const o=this.hls.nextLoadLevel,l=this.hls.levels[o];if(t=this.getLevelsForPathway(a),t.length>0){this.log(`Setting Pathway to "${a}"`),this.pathwayId=a,im(t),this.hls.trigger(v.LEVELS_UPDATED,{levels:t});const u=this.hls.levels[o];l&&u&&this.levels&&(u.attrs["STABLE-VARIANT-ID"]!==l.attrs["STABLE-VARIANT-ID"]&&u.bitrate!==l.bitrate&&this.log(`Unstable Pathways change from bitrate ${l.bitrate} to ${u.bitrate}`),this.hls.nextLoadLevel=o);break}}}getPathwayForGroupId(e,t,s){const i=this.getLevelsForPathway(s).concat(this.levels||[]);for(let r=0;r<i.length;r++)if(t===ne.AUDIO_TRACK&&i[r].hasAudioGroup(e)||t===ne.SUBTITLE_TRACK&&i[r].hasSubtitleGroup(e))return i[r].pathwayId;return s}clonePathways(e){const t=this.levels;if(!t)return;const s={},i={};e.forEach(r=>{const{ID:a,"BASE-ID":o,"URI-REPLACEMENT":l}=r;if(t.some(c=>c.pathwayId===a))return;const u=this.getLevelsForPathway(o).map(c=>{const d=new me(c.attrs);d["PATHWAY-ID"]=a;const h=d.AUDIO&&`${d.AUDIO}_clone_${a}`,f=d.SUBTITLES&&`${d.SUBTITLES}_clone_${a}`;h&&(s[d.AUDIO]=h,d.AUDIO=h),f&&(i[d.SUBTITLES]=f,d.SUBTITLES=f);const g=Um(c.uri,d["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",l),p=new Hi({attrs:d,audioCodec:c.audioCodec,bitrate:c.bitrate,height:c.height,name:c.name,url:g,videoCodec:c.videoCodec,width:c.width});if(c.audioGroups)for(let E=1;E<c.audioGroups.length;E++)p.addGroupId("audio",`${c.audioGroups[E]}_clone_${a}`);if(c.subtitleGroups)for(let E=1;E<c.subtitleGroups.length;E++)p.addGroupId("text",`${c.subtitleGroups[E]}_clone_${a}`);return p});t.push(...u),Vh(this.audioTracks,s,l,a),Vh(this.subtitleTracks,i,l,a)})}loadSteeringManifest(e){const t=this.hls.config,s=t.loader;this.loader&&this.loader.destroy(),this.loader=new s(t);let i;try{i=new self.URL(e)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${e}`);return}if(i.protocol!=="data:"){const c=(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate)|0;i.searchParams.set("_HLS_pathway",this.pathwayId),i.searchParams.set("_HLS_throughput",""+c)}const r={responseType:"json",url:i.href},a=t.steeringManifestLoadPolicy.default,o=a.errorRetry||a.timeoutRetry||{},l={loadPolicy:a,timeout:a.maxLoadTimeMs,maxRetry:o.maxNumRetry||0,retryDelay:o.retryDelayMs||0,maxRetryDelay:o.maxRetryDelayMs||0},u={onSuccess:(c,d,h,f)=>{this.log(`Loaded steering manifest: "${i}"`);const g=c.data;if((g==null?void 0:g.VERSION)!==1){this.log(`Steering VERSION ${g.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=g.TTL;const{"RELOAD-URI":p,"PATHWAY-CLONES":E,"PATHWAY-PRIORITY":y}=g;if(p)try{this.uri=new self.URL(p,i).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${p}`);return}this.scheduleRefresh(this.uri||h.url),E&&this.clonePathways(E);const m={steeringManifest:g,url:i.toString()};this.hls.trigger(v.STEERING_MANIFEST_LOADED,m),y&&this.updatePathwayPriority(y)},onError:(c,d,h,f)=>{if(this.log(`Error loading steering manifest: ${c.code} ${c.text} (${d.url})`),this.stopLoad(),c.code===410){this.enabled=!1,this.log(`Steering manifest ${d.url} no longer available`);return}let g=this.timeToLoad*1e3;if(c.code===429){const p=this.loader;if(typeof(p==null?void 0:p.getResponseHeader)=="function"){const E=p.getResponseHeader("Retry-After");E&&(g=parseFloat(E)*1e3)}this.log(`Steering manifest ${d.url} rate limited`);return}this.scheduleRefresh(this.uri||d.url,g)},onTimeout:(c,d,h)=>{this.log(`Timeout loading steering manifest (${d.url})`),this.scheduleRefresh(this.uri||d.url)}};this.log(`Requesting steering manifest: ${i}`),this.loader.load(r,l,u)}scheduleRefresh(e,t=this.timeToLoad*1e3){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var s;const i=(s=this.hls)==null?void 0:s.media;if(i&&!i.ended){this.loadSteeringManifest(e);return}this.scheduleRefresh(e,this.timeToLoad*1e3)},t)}}function Vh(n,e,t,s){n&&Object.keys(e).forEach(i=>{const r=n.filter(a=>a.groupId===i).map(a=>{const o=ue({},a);return o.details=void 0,o.attrs=new me(o.attrs),o.url=o.attrs.URI=Um(a.url,a.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",t),o.groupId=o.attrs["GROUP-ID"]=e[i],o.attrs["PATHWAY-ID"]=s,o});n.push(...r)})}function Um(n,e,t,s){const{HOST:i,PARAMS:r,[t]:a}=s;let o;e&&(o=a==null?void 0:a[e],o&&(n=o));const l=new self.URL(n);return i&&!o&&(l.host=i),r&&Object.keys(r).sort().forEach(u=>{u&&l.searchParams.set(u,r[u])}),l.href}class Bs extends It{constructor(e){super("eme",e.logger),this.hls=void 0,this.config=void 0,this.media=null,this.mediaResolved=void 0,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.mediaKeys=null,this.setMediaKeysQueue=Bs.CDMCleanupPromise?[Bs.CDMCleanupPromise]:[],this.bannedKeyIds={},this.onMediaEncrypted=t=>{const{initDataType:s,initData:i}=t,r=`"${t.type}" event: init data type: "${s}"`;if(this.debug(r),i!==null){if(!this.keyFormatPromise){let a=Object.keys(this.keySystemAccessPromises);a.length||(a=fi(this.config));const o=a.map(bo).filter(l=>!!l);this.keyFormatPromise=this.getKeyFormatPromise(o)}this.keyFormatPromise.then(a=>{const o=Yr(a);if(s!=="sinf"||o!==ve.FAIRPLAY){this.log(`Ignoring "${t.type}" event with init data type: "${s}" for selected key-system ${o}`);return}let l;try{const f=_e(new Uint8Array(i)),g=pc(JSON.parse(f).sinf),p=bp(g);if(!p)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");l=new Uint8Array(p.subarray(8,24))}catch(f){this.warn(`${r} Failed to parse sinf: ${f}`);return}const u=Be(l),{keyIdToKeySessionPromise:c,mediaKeySessions:d}=this;let h=c[u];for(let f=0;f<d.length;f++){const g=d[f],p=g.decryptdata;if(!p.keyId)continue;const E=Be(p.keyId);if(wa(l,p.keyId)||p.uri.replace(/-/g,"").indexOf(u)!==-1){if(h=c[E],!h)continue;if(p.pssh)break;delete c[E],p.pssh=new Uint8Array(i),p.keyId=l,h=c[u]=h.then(()=>this.generateRequestWithPreferredKeySession(g,s,i,"encrypted-event-key-match")),h.catch(y=>this.handleError(y));break}}h||this.handleError(new Error(`Key ID ${u} not encountered in playlist. Key-system sessions ${d.length}.`))}).catch(a=>this.handleError(a))}},this.onWaitingForKey=t=>{this.log(`"${t.type}" event`)},this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.onDestroying(),this.onMediaDetached();const e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null}registerListeners(){this.hls.on(v.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(v.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(v.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(v.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.on(v.DESTROYING,this.onDestroying,this)}unregisterListeners(){this.hls.off(v.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(v.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(v.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(v.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.off(v.DESTROYING,this.onDestroying,this)}getLicenseServerUrl(e){const{drmSystems:t,widevineLicenseUrl:s}=this.config,i=t==null?void 0:t[e];if(i)return i.licenseUrl;if(e===ve.WIDEVINE&&s)return s}getLicenseServerUrlOrThrow(e){const t=this.getLicenseServerUrl(e);if(t===void 0)throw new Error(`no license server URL configured for key-system "${e}"`);return t}getServerCertificateUrl(e){const{drmSystems:t}=this.config,s=t==null?void 0:t[e];if(s)return s.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){const t=this.hls.levels,s=(a,o,l)=>!!a&&l.indexOf(a)===o,i=t.map(a=>a.audioCodec).filter(s),r=t.map(a=>a.videoCodec).filter(s);return i.length+r.length===0&&r.push("avc1.42e01e"),new Promise((a,o)=>{const l=u=>{const c=u.shift();this.getMediaKeysPromise(c,i,r).then(d=>a({keySystem:c,mediaKeys:d})).catch(d=>{u.length?l(u):d instanceof rt?o(d):o(new rt({type:Y.KEY_SYSTEM_ERROR,details:w.KEY_SYSTEM_NO_ACCESS,error:d,fatal:!0},d.message))})};l(e)})}requestMediaKeySystemAccess(e,t){const{requestMediaKeySystemAccessFunc:s}=this.config;if(typeof s!="function"){let i=`Configured requestMediaKeySystemAccess is not a function ${s}`;return Qp===null&&self.location.protocol==="http:"&&(i=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(i))}return s(e,t)}getMediaKeysPromise(e,t,s){var i;const r=rx(e,t,s,this.config.drmSystemOptions||{});let a=this.keySystemAccessPromises[e],o=(i=a)==null?void 0:i.keySystemAccess;if(!o){this.log(`Requesting encrypted media "${e}" key-system access with config: ${de(r)}`),o=this.requestMediaKeySystemAccess(e,r);const l=a=this.keySystemAccessPromises[e]={keySystemAccess:o};return o.catch(u=>{this.log(`Failed to obtain access to key-system "${e}": ${u}`)}),o.then(u=>{this.log(`Access for key-system "${u.keySystem}" obtained`);const c=this.fetchServerCertificate(e);this.log(`Create media-keys for "${e}"`);const d=l.mediaKeys=u.createMediaKeys().then(h=>(this.log(`Media-keys created for "${e}"`),l.hasMediaKeys=!0,c.then(f=>f?this.setMediaKeysServerCertificate(h,e,f):h)));return d.catch(h=>{this.error(`Failed to create media-keys for "${e}"}: ${h}`)}),d})}return o.then(()=>a.mediaKeys)}createMediaKeySessionContext({decryptdata:e,keySystem:t,mediaKeys:s}){this.log(`Creating key-system session "${t}" keyId: ${Be(e.keyId||[])} keyUri: ${e.uri}`);const i=s.createSession(),r={decryptdata:e,keySystem:t,mediaKeys:s,mediaKeysSession:i,keyStatus:"status-pending"};return this.mediaKeySessions.push(r),r}renewKeySession(e){const t=e.decryptdata;if(t.pssh){const s=this.createMediaKeySessionContext(e),i=_r(t),r="cenc";this.keyIdToKeySessionPromise[i]=this.generateRequestWithPreferredKeySession(s,r,t.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}updateKeySession(e,t){const s=e.mediaKeysSession;return this.log(`Updating key-session "${s.sessionId}" for keyId ${Be(e.decryptdata.keyId||[])}
      } (data length: ${t.byteLength})`),s.update(t)}getSelectedKeySystemFormats(){return Object.keys(this.keySystemAccessPromises).map(e=>({keySystem:e,hasMediaKeys:this.keySystemAccessPromises[e].hasMediaKeys})).filter(({hasMediaKeys:e})=>!!e).map(({keySystem:e})=>bo(e)).filter(e=>!!e)}getKeySystemAccess(e){return this.getKeySystemSelectionPromise(e).then(({keySystem:t,mediaKeys:s})=>this.attemptSetMediaKeys(t,s))}selectKeySystem(e){return new Promise((t,s)=>{this.getKeySystemSelectionPromise(e).then(({keySystem:i})=>{const r=bo(i);r?t(r):s(new Error(`Unable to find format for key-system "${i}"`))}).catch(s)})}selectKeySystemFormat(e){const t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){const t=fi(this.config),s=e.map(Yr).filter(i=>!!i&&t.indexOf(i)!==-1);return this.selectKeySystem(s)}getKeyStatus(e){const{mediaKeySessions:t}=this;for(let s=0;s<t.length;s++){const i=RT(e,t[s]);if(i)return i}}loadKey(e){const t=e.keyInfo.decryptdata,s=_r(t),i=this.bannedKeyIds[s];if(i||this.getKeyStatus(t)==="internal-error"){const o=Hh(i||"internal-error",t);return this.handleError(o,e.frag),Promise.reject(o)}const r=`(keyId: ${s} format: "${t.keyFormat}" method: ${t.method} uri: ${t.uri})`;this.log(`Starting session for key ${r}`);const a=this.keyIdToKeySessionPromise[s];if(!a){const o=this.getKeySystemForKeyPromise(t).then(({keySystem:l,mediaKeys:u})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${r}`),this.attemptSetMediaKeys(l,u).then(()=>(this.throwIfDestroyed(),this.createMediaKeySessionContext({keySystem:l,mediaKeys:u,decryptdata:t}))))).then(l=>{const u="cenc",c=t.pssh?t.pssh.buffer:null;return this.generateRequestWithPreferredKeySession(l,u,c,"playlist-key")});return o.catch(l=>this.handleError(l,e.frag)),this.keyIdToKeySessionPromise[s]=o,o}return a.catch(o=>{if(o instanceof rt){const l=ae({},o.data);this.getKeyStatus(t)==="internal-error"&&(l.decryptdata=t);const u=new rt(l,o.message);this.handleError(u,e.frag)}}),a}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e,t){if(this.hls)if(e instanceof rt){t&&(e.data.frag=t);const s=e.data.decryptdata;this.error(`${e.message}${s?` (${Be(s.keyId||[])})`:""}`),this.hls.trigger(v.ERROR,e.data)}else this.error(e.message),this.hls.trigger(v.ERROR,{type:Y.KEY_SYSTEM_ERROR,details:w.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0})}getKeySystemForKeyPromise(e){const t=_r(e),s=this.keyIdToKeySessionPromise[t];if(!s){const i=Yr(e.keyFormat),r=i?[i]:fi(this.config);return this.attemptKeySystemAccess(r)}return s}getKeySystemSelectionPromise(e){if(e.length||(e=fi(this.config)),e.length===0)throw new rt({type:Y.KEY_SYSTEM_ERROR,details:w.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${de({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}attemptSetMediaKeys(e,t){if(this.mediaResolved=void 0,this.mediaKeys===t)return Promise.resolve();const s=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const i=Promise.all(s).then(()=>this.media?this.media.setMediaKeys(t):new Promise((r,a)=>{this.mediaResolved=()=>{if(this.mediaResolved=void 0,!this.media)return a(new Error("Attempted to set mediaKeys without media element attached"));this.mediaKeys=t,this.media.setMediaKeys(t).then(r).catch(a)}}));return this.mediaKeys=t,this.setMediaKeysQueue.push(i),i.then(()=>{this.log(`Media-keys set for "${e}"`),s.push(i),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(r=>s.indexOf(r)===-1)})}generateRequestWithPreferredKeySession(e,t,s,i){var r;const a=(r=this.config.drmSystems)==null||(r=r[e.keySystem])==null?void 0:r.generateRequest;if(a)try{const g=a.call(this.hls,t,s,e);if(!g)throw new Error("Invalid response from configured generateRequest filter");t=g.initDataType,s=g.initData?g.initData:null,e.decryptdata.pssh=s?new Uint8Array(s):null}catch(g){if(this.warn(g.message),this.hls&&this.hls.config.debug)throw g}if(s===null)return this.log(`Skipping key-session request for "${i}" (no initData)`),Promise.resolve(e);const o=_r(e.decryptdata),l=e.decryptdata.uri;this.log(`Generating key-session request for "${i}" keyId: ${o} URI: ${l} (init data type: ${t} length: ${s.byteLength})`);const u=new yc,c=e._onmessage=g=>{const p=e.mediaKeysSession;if(!p){u.emit("error",new Error("invalid state"));return}const{messageType:E,message:y}=g;this.log(`"${E}" message event for session "${p.sessionId}" message size: ${y.byteLength}`),E==="license-request"||E==="license-renewal"?this.renewLicense(e,y).catch(m=>{u.eventNames().length?u.emit("error",m):this.handleError(m)}):E==="license-release"?e.keySystem===ve.FAIRPLAY&&this.updateKeySession(e,Xl("acknowledged")).then(()=>this.removeSession(e)).catch(m=>this.handleError(m)):this.warn(`unhandled media key message type "${E}"`)},d=(g,p)=>{p.keyStatus=g;let E;g.startsWith("usable")?u.emit("resolved"):g==="internal-error"||g==="output-restricted"||g==="output-downscaled"?E=Hh(g,p.decryptdata):g==="expired"?E=new Error(`key expired (keyId: ${o})`):g==="released"?E=new Error("key released"):g==="status-pending"||this.warn(`unhandled key status change "${g}" (keyId: ${o})`),E&&(u.eventNames().length?u.emit("error",E):this.handleError(E))},h=e._onkeystatuseschange=g=>{if(!e.mediaKeysSession){u.emit("error",new Error("invalid state"));return}const E=this.getKeyStatuses(e);if(!Object.keys(E).some(T=>E[T]!=="status-pending"))return;if(E[o]==="expired"){this.log(`Expired key ${de(E)} in key-session "${e.mediaKeysSession.sessionId}"`),this.renewKeySession(e);return}let m=E[o];if(m)d(m,e);else{var S;e.keyStatusTimeouts||(e.keyStatusTimeouts={}),(S=e.keyStatusTimeouts)[o]||(S[o]=self.setTimeout(()=>{if(!e.mediaKeysSession||!this.mediaKeys)return;const A=this.getKeyStatus(e.decryptdata);if(A&&A!=="status-pending")return this.log(`No status for keyId ${o} in key-session "${e.mediaKeysSession.sessionId}". Using session key-status ${A} from other session.`),d(A,e);this.log(`key status for ${o} in key-session "${e.mediaKeysSession.sessionId}" timed out after 1000ms`),m="internal-error",d(m,e)},1e3)),this.log(`No status for keyId ${o} (${de(E)}).`)}};Ye(e.mediaKeysSession,"message",c),Ye(e.mediaKeysSession,"keystatuseschange",h);const f=new Promise((g,p)=>{u.on("error",p),u.on("resolved",g)});return e.mediaKeysSession.generateRequest(t,s).then(()=>{this.log(`Request generated for key-session "${e.mediaKeysSession.sessionId}" keyId: ${o} URI: ${l}`)}).catch(g=>{throw new rt({type:Y.KEY_SYSTEM_ERROR,details:w.KEY_SYSTEM_NO_SESSION,error:g,decryptdata:e.decryptdata,fatal:!1},`Error generating key-session request: ${g}`)}).then(()=>f).catch(g=>(u.removeAllListeners(),this.removeSession(e).then(()=>{throw g}))).then(()=>(u.removeAllListeners(),e))}getKeyStatuses(e){const t={};return e.mediaKeysSession.keyStatuses.forEach((s,i)=>{if(typeof i=="string"&&typeof s=="object"){const o=i;i=s,s=o}const r="buffer"in i?new Uint8Array(i.buffer,i.byteOffset,i.byteLength):new Uint8Array(i);if(e.keySystem===ve.PLAYREADY&&r.length===16){const o=Be(r);t[o]=s,Yp(r)}const a=Be(r);s==="internal-error"&&(this.bannedKeyIds[a]=s),this.log(`key status change "${s}" for keyStatuses keyId: ${a} key-session "${e.mediaKeysSession.sessionId}"`),t[a]=s}),t}fetchServerCertificate(e){const t=this.config,s=t.loader,i=new s(t),r=this.getServerCertificateUrl(e);return r?(this.log(`Fetching server certificate for "${e}"`),new Promise((a,o)=>{const l={responseType:"arraybuffer",url:r},u=t.certLoadPolicy.default,c={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},d={onSuccess:(h,f,g,p)=>{a(h.data)},onError:(h,f,g,p)=>{o(new rt({type:Y.KEY_SYSTEM_ERROR,details:w.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:g,response:ae({url:l.url,data:void 0},h)},`"${e}" certificate request failed (${r}). Status: ${h.code} (${h.text})`))},onTimeout:(h,f,g)=>{o(new rt({type:Y.KEY_SYSTEM_ERROR,details:w.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:g,response:{url:l.url,data:void 0}},`"${e}" certificate request timed out (${r})`))},onAbort:(h,f,g)=>{o(new Error("aborted"))}};i.load(l,c,d)})):Promise.resolve()}setMediaKeysServerCertificate(e,t,s){return new Promise((i,r)=>{e.setServerCertificate(s).then(a=>{this.log(`setServerCertificate ${a?"success":"not supported by CDM"} (${s.byteLength}) on "${t}"`),i(e)}).catch(a=>{r(new rt({type:Y.KEY_SYSTEM_ERROR,details:w.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:a,fatal:!0},a.message))})})}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then(s=>this.updateKeySession(e,new Uint8Array(s)).catch(i=>{throw new rt({type:Y.KEY_SYSTEM_ERROR,details:w.KEY_SYSTEM_SESSION_UPDATE_FAILED,decryptdata:e.decryptdata,error:i,fatal:!1},i.message)}))}unpackPlayReadyKeyMessage(e,t){const s=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!s.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;const i=new DOMParser().parseFromString(s,"application/xml"),r=i.querySelectorAll("HttpHeader");if(r.length>0){let c;for(let d=0,h=r.length;d<h;d++){var a,o;c=r[d];const f=(a=c.querySelector("name"))==null?void 0:a.textContent,g=(o=c.querySelector("value"))==null?void 0:o.textContent;f&&g&&e.setRequestHeader(f,g)}}const l=i.querySelector("Challenge"),u=l==null?void 0:l.textContent;if(!u)throw new Error("Cannot find <Challenge> in key message");return Xl(atob(u))}setupLicenseXHR(e,t,s,i){const r=this.config.licenseXhrSetup;return r?Promise.resolve().then(()=>{if(!s.decryptdata)throw new Error("Key removed");return r.call(this.hls,e,t,s,i)}).catch(a=>{if(!s.decryptdata)throw a;return e.open("POST",t,!0),r.call(this.hls,e,t,s,i)}).then(a=>(e.readyState||e.open("POST",t,!0),{xhr:e,licenseChallenge:a||i})):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:i}))}requestLicense(e,t){const s=this.config.keyLoadPolicy.default;return new Promise((i,r)=>{const a=this.getLicenseServerUrlOrThrow(e.keySystem);this.log(`Sending license request to URL: ${a}`);const o=new XMLHttpRequest;o.responseType="arraybuffer",o.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return r(new Error("invalid state"));if(o.readyState===4)if(o.status===200){this._requestLicenseFailureCount=0;let l=o.response;this.log(`License received ${l instanceof ArrayBuffer?l.byteLength:l}`);const u=this.config.licenseResponseCallback;if(u)try{l=u.call(this.hls,o,a,e)}catch(c){this.error(c)}i(l)}else{const l=s.errorRetry,u=l?l.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>u||o.status>=400&&o.status<500)r(new rt({type:Y.KEY_SYSTEM_ERROR,details:w.KEY_SYSTEM_LICENSE_REQUEST_FAILED,decryptdata:e.decryptdata,fatal:!0,networkDetails:o,response:{url:a,data:void 0,code:o.status,text:o.statusText}},`License Request XHR failed (${a}). Status: ${o.status} (${o.statusText})`));else{const c=u-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${c} attempts left`),this.requestLicense(e,t).then(i,r)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=o,this.setupLicenseXHR(o,a,e,t).then(({xhr:l,licenseChallenge:u})=>{e.keySystem==ve.PLAYREADY&&(u=this.unpackPlayReadyKeyMessage(l,u)),l.send(u)}).catch(r)})}onDestroying(){this.unregisterListeners(),this._clear()}onMediaAttached(e,t){if(!this.config.emeEnabled)return;const s=t.media;this.media=s,Ye(s,"encrypted",this.onMediaEncrypted),Ye(s,"waitingforkey",this.onWaitingForKey);const i=this.mediaResolved;i?i():this.mediaKeys=s.mediaKeys}onMediaDetached(){const e=this.media;e&&(tt(e,"encrypted",this.onMediaEncrypted),tt(e,"waitingforkey",this.onWaitingForKey),this.media=null,this.mediaKeys=null)}_clear(){var e;this._requestLicenseFailureCount=0,this.keyIdToKeySessionPromise={},this.bannedKeyIds={};const t=this.mediaResolved;if(t&&t(),!this.mediaKeys&&!this.mediaKeySessions.length)return;const s=this.media,i=this.mediaKeySessions.slice();this.mediaKeySessions=[],this.mediaKeys=null,Pn.clearKeyUriToKeyIdMap();const r=i.length;Bs.CDMCleanupPromise=Promise.all(i.map(a=>this.removeSession(a)).concat((s==null||(e=s.setMediaKeys(null))==null?void 0:e.catch(a=>{this.log(`Could not clear media keys: ${a}`),this.hls&&this.hls.trigger(v.ERROR,{type:Y.OTHER_ERROR,details:w.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:new Error(`Could not clear media keys: ${a}`)})}))||Promise.resolve())).catch(a=>{this.log(`Could not close sessions and clear media keys: ${a}`),this.hls&&this.hls.trigger(v.ERROR,{type:Y.OTHER_ERROR,details:w.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close sessions and clear media keys: ${a}`)})}).then(()=>{r&&this.log("finished closing key sessions and clearing media keys")})}onManifestLoading(){this._clear()}onManifestLoaded(e,{sessionKeys:t}){if(!(!t||!this.config.emeEnabled)&&!this.keyFormatPromise){const s=t.reduce((i,r)=>(i.indexOf(r.keyFormat)===-1&&i.push(r.keyFormat),i),[]);this.log(`Selecting key-system from session-keys ${s.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(s)}}removeSession(e){const{mediaKeysSession:t,licenseXhr:s,decryptdata:i}=e;if(t){this.log(`Remove licenses and keys and close session "${t.sessionId}" keyId: ${Be((i==null?void 0:i.keyId)||[])}`),e._onmessage&&(t.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(t.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),s&&s.readyState!==XMLHttpRequest.DONE&&s.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const r=this.mediaKeySessions.indexOf(e);r>-1&&this.mediaKeySessions.splice(r,1);const{keyStatusTimeouts:a}=e;a&&Object.keys(a).forEach(u=>self.clearTimeout(a[u]));const{drmSystemOptions:o}=this.config;return(ox(o)?new Promise((u,c)=>{self.setTimeout(()=>c(new Error("MediaKeySession.remove() timeout")),8e3),t.remove().then(u).catch(c)}):Promise.resolve()).catch(u=>{this.log(`Could not remove session: ${u}`),this.hls&&this.hls.trigger(v.ERROR,{type:Y.OTHER_ERROR,details:w.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:new Error(`Could not remove session: ${u}`)})}).then(()=>t.close()).catch(u=>{this.log(`Could not close session: ${u}`),this.hls&&this.hls.trigger(v.ERROR,{type:Y.OTHER_ERROR,details:w.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close session: ${u}`)})})}return Promise.resolve()}}Bs.CDMCleanupPromise=void 0;function _r(n){if(!n)throw new Error("Could not read keyId of undefined decryptdata");if(n.keyId===null)throw new Error("keyId is null");return Be(n.keyId)}function RT(n,e){if(n.keyId&&e.mediaKeysSession.keyStatuses.has(n.keyId))return e.mediaKeysSession.keyStatuses.get(n.keyId);if(n.matches(e.decryptdata))return e.keyStatus}class rt extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}function Hh(n,e){const t=n==="output-restricted",s=t?w.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:w.KEY_SYSTEM_STATUS_INTERNAL_ERROR;return new rt({type:Y.KEY_SYSTEM_ERROR,details:s,fatal:!1,decryptdata:e},t?"HDCP level output restricted":`key status changed to "${n}"`)}class _T{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(v.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(v.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListeners(){this.hls.off(v.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(v.MEDIA_DETACHING,this.onMediaDetaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const s=this.hls.config;if(s.capLevelOnFPSDrop){const i=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=i,i&&typeof i.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),s.fpsDroppedMonitoringPeriod)}}onMediaDetaching(){this.media=null}checkFPS(e,t,s){const i=performance.now();if(t){if(this.lastTime){const r=i-this.lastTime,a=s-this.lastDroppedFrames,o=t-this.lastDecodedFrames,l=1e3*a/r,u=this.hls;if(u.trigger(v.FPS_DROP,{currentDropped:a,currentDecoded:o,totalDroppedFrames:s}),l>0&&a>u.config.fpsDroppedMonitoringThreshold*o){let c=u.currentLevel;u.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+c),c>0&&(u.autoLevelCapping===-1||u.autoLevelCapping>=c)&&(c=c-1,u.trigger(v.FPS_DROP_LEVEL_CAPPING,{level:c,droppedLevel:u.currentLevel}),u.autoLevelCapping=c,this.streamController.nextLevelSwitch())}}this.lastTime=i,this.lastDroppedFrames=s,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}function $m(n,e){let t;try{t=new Event("addtrack")}catch{t=document.createEvent("Event"),t.initEvent("addtrack",!1,!1)}t.track=n,e.dispatchEvent(t)}function jm(n,e){const t=n.mode;if(t==="disabled"&&(n.mode="hidden"),n.cues&&!n.cues.getCueById(e.id))try{if(n.addCue(e),!n.cues.getCueById(e.id))throw new Error(`addCue is failed for: ${e}`)}catch(s){oe.debug(`[texttrack-utils]: ${s}`);try{const i=new self.TextTrackCue(e.startTime,e.endTime,e.text);i.id=e.id,n.addCue(i)}catch(i){oe.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${i}`)}}t==="disabled"&&(n.mode=t)}function ks(n,e){const t=n.mode;if(t==="disabled"&&(n.mode="hidden"),n.cues)for(let s=n.cues.length;s--;)e&&n.cues[s].removeEventListener("enter",e),n.removeCue(n.cues[s]);t==="disabled"&&(n.mode=t)}function au(n,e,t,s){const i=n.mode;if(i==="disabled"&&(n.mode="hidden"),n.cues&&n.cues.length>0){const r=kT(n.cues,e,t);for(let a=0;a<r.length;a++)(!s||s(r[a]))&&n.removeCue(r[a])}i==="disabled"&&(n.mode=i)}function CT(n,e){if(e<=n[0].startTime)return 0;const t=n.length-1;if(e>n[t].endTime)return-1;let s=0,i=t,r;for(;s<=i;)if(r=Math.floor((i+s)/2),e<n[r].startTime)i=r-1;else if(e>n[r].startTime&&s<t)s=r+1;else return r;return n[s].startTime-e<e-n[i].startTime?s:i}function kT(n,e,t){const s=[],i=CT(n,e);if(i>-1)for(let r=i,a=n.length;r<a;r++){const o=n[r];if(o.startTime>=e&&o.endTime<=t)s.push(o);else if(o.startTime>t)return s}return s}function Zr(n){const e=[];for(let t=0;t<n.length;t++){const s=n[t];(s.kind==="subtitles"||s.kind==="captions")&&s.label&&e.push(n[t])}return e}class wT extends Lc{constructor(e){super(e,"subtitle-track-controller"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let t=null;const s=Zr(this.media.textTracks);for(let r=0;r<s.length;r++)if(s[r].mode==="hidden")t=s[r];else if(s[r].mode==="showing"){t=s[r];break}const i=this.findTrackForTextTrack(t);this.subtitleTrack!==i&&this.setSubtitleTrack(i)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:e}=this;e.on(v.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(v.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(v.MANIFEST_LOADING,this.onManifestLoading,this),e.on(v.MANIFEST_PARSED,this.onManifestParsed,this),e.on(v.LEVEL_LOADING,this.onLevelLoading,this),e.on(v.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(v.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(v.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(v.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(v.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(v.MANIFEST_LOADING,this.onManifestLoading,this),e.off(v.MANIFEST_PARSED,this.onManifestParsed,this),e.off(v.LEVEL_LOADING,this.onLevelLoading,this),e.off(v.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(v.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(v.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(e,t){const s=this.media;if(!s)return;const i=!!t.transferMedia;if(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||s.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,i)return;Zr(s.textTracks).forEach(a=>{ks(a)})}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:s,groupId:i,details:r}=t,a=this.tracksInGroup[s];if(!a||a.groupId!==i){this.warn(`Subtitle track with id:${s} and group:${i} not found in active group ${a==null?void 0:a.groupId}`);return}const o=a.details;a.details=t.details,this.log(`Subtitle track ${s} "${a.name}" lang:${a.lang} group:${i} loaded [${r.startSN}-${r.endSN}]`),s===this.trackId&&this.playlistLoaded(s,t,o)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const s=t.subtitleGroups||null,i=this.groupIds;let r=this.currentTrack;if(!s||(i==null?void 0:i.length)!==(s==null?void 0:s.length)||s!=null&&s.some(a=>(i==null?void 0:i.indexOf(a))===-1)){this.groupIds=s,this.trackId=-1,this.currentTrack=null;const a=this.tracks.filter(c=>!s||s.indexOf(c.groupId)!==-1);if(a.length)this.selectDefaultTrack&&!a.some(c=>c.default)&&(this.selectDefaultTrack=!1),a.forEach((c,d)=>{c.id=d});else if(!r&&!this.tracksInGroup.length)return;this.tracksInGroup=a;const o=this.hls.config.subtitlePreference;if(!r&&o){this.selectDefaultTrack=!1;const c=zt(o,a);if(c>-1)r=a[c];else{const d=zt(o,this.tracks);r=this.tracks[d]}}let l=this.findTrackId(r);l===-1&&r&&(l=this.findTrackId(null));const u={subtitleTracks:a};this.log(`Updating subtitle tracks, ${a.length} track(s) found in "${s==null?void 0:s.join(",")}" group-id`),this.hls.trigger(v.SUBTITLE_TRACKS_UPDATED,u),l!==-1&&this.trackId===-1&&this.setSubtitleTrack(l)}}findTrackId(e){const t=this.tracksInGroup,s=this.selectDefaultTrack;for(let i=0;i<t.length;i++){const r=t[i];if(!(s&&!r.default||!s&&!e)&&(!e||Jn(r,e)))return i}if(e){for(let i=0;i<t.length;i++){const r=t[i];if(qi(e.attrs,r.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return i}for(let i=0;i<t.length;i++){const r=t[i];if(qi(e.attrs,r.attrs,["LANGUAGE"]))return i}}return-1}findTrackForTextTrack(e){if(e){const t=this.tracksInGroup;for(let s=0;s<t.length;s++){const i=t[s];if(nu(i,e))return s}}return-1}onError(e,t){t.fatal||!t.context||t.context.type===ne.SUBTITLE_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){if(e.id===-1)return this.setSubtitleTrack(-1),null;const t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){const s=this.currentTrack;if(s&&Jn(e,s))return s;const i=zt(e,this.tracksInGroup);if(i>-1){const r=this.tracksInGroup[i];return this.setSubtitleTrack(i),r}else{if(s)return null;{const r=zt(e,t);if(r>-1)return t[r]}}}}return null}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const s=e.id,i=e.groupId,r=this.getUrlWithDirectives(e.url,t),a=e.details,o=a==null?void 0:a.age;this.log(`Loading subtitle ${s} "${e.name}" lang:${e.lang} group:${i}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${o&&a.live?" age "+o.toFixed(1)+(a.type&&" "+a.type||""):""} ${r}`),this.hls.trigger(v.SUBTITLE_TRACK_LOADING,{url:r,id:s,groupId:i,deliveryDirectives:t||null,track:e})}toggleTrackModes(){const{media:e}=this;if(!e)return;const t=Zr(e.textTracks),s=this.currentTrack;let i;if(s&&(i=t.filter(r=>nu(s,r))[0],i||this.warn(`Unable to find subtitle TextTrack with name "${s.name}" and language "${s.lang}"`)),[].slice.call(t).forEach(r=>{r.mode!=="disabled"&&r!==i&&(r.mode="disabled")}),i){const r=this.subtitleDisplay?"showing":"hidden";i.mode!==r&&(i.mode=r)}}setSubtitleTrack(e){const t=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(e<-1||e>=t.length||!j(e)){this.warn(`Invalid subtitle track id: ${e}`);return}this.selectDefaultTrack=!1;const s=this.currentTrack,i=t[e]||null;if(this.trackId=e,this.currentTrack=i,this.toggleTrackModes(),!i){this.hls.trigger(v.SUBTITLE_TRACK_SWITCH,{id:e});return}const r=!!i.details&&!i.details.live;if(e===this.trackId&&i===s&&r)return;this.log(`Switching to subtitle-track ${e}`+(i?` "${i.name}" lang:${i.lang} group:${i.groupId}`:""));const{id:a,groupId:o="",name:l,type:u,url:c}=i;this.hls.trigger(v.SUBTITLE_TRACK_SWITCH,{id:a,groupId:o,name:l,type:u,url:c});const d=this.switchParams(i.url,s==null?void 0:s.details,i.details);this.loadPlaylist(d)}}function DT(){try{return crypto.randomUUID()}catch{try{const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch{let t=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,i=>{const r=(t+Math.random()*16)%16|0;return t=Math.floor(t/16),(i=="x"?r:r&3|8).toString(16)})}}}function Ii(n){let e=5381,t=n.length;for(;t;)e=e*33^n.charCodeAt(--t);return(e>>>0).toString()}const Us=.025;let Na=function(n){return n[n.Point=0]="Point",n[n.Range=1]="Range",n}({});function PT(n,e,t){return`${n.identifier}-${t+1}-${Ii(e)}`}class bT{constructor(e,t){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=t,this.dateRange=e,this.setDateRange(e)}setDateRange(e){this.dateRange=e,this.resumeOffset=e.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=e.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=e.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=e.attr.enumeratedStringList("X-SNAP",this.snapOptions)}reset(){var e;this.appendInPlaceStarted=!1,(e=this.assetListLoader)==null||e.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)}isAssetPastPlayoutLimit(e){var t;if(e>0&&e>=this.assetList.length)return!0;const s=this.playoutLimit;return e<=0||isNaN(s)?!1:s===0?!0:(((t=this.assetList[e])==null?void 0:t.startOffset)||0)>s}findAssetIndex(e){return this.assetList.indexOf(e)}get identifier(){return this.dateRange.id}get startDate(){return this.dateRange.startDate}get startTime(){const e=this.dateRange.startTime;if(this.snapOptions.out){const t=this.dateRange.tagAnchor;if(t)return Go(e,t)}return e}get startOffset(){return this.cue.pre?0:this.startTime}get startIsAligned(){if(this.startTime===0||this.snapOptions.out)return!0;const e=this.dateRange.tagAnchor;if(e){const t=this.dateRange.startTime,s=Go(t,e);return t-s<.1}return!1}get resumptionOffset(){const e=this.resumeOffset,t=j(e)?e:this.duration;return this.cumulativeDuration+t}get resumeTime(){const e=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){const t=this.resumeAnchor;if(t)return Go(e,t)}return e}get appendInPlace(){return this.appendInPlaceStarted?!0:this.appendInPlaceDisabled?!1:!!(!this.cue.once&&!this.cue.pre&&this.startIsAligned&&(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<Us))}set appendInPlace(e){if(this.appendInPlaceStarted){this.resetOnResume=!e;return}this.appendInPlaceDisabled=!e}get timelineStart(){return this._timelineStart!==null?this._timelineStart:this.startTime}set timelineStart(e){this._timelineStart=e}get duration(){const e=this.playoutLimit;let t;return this._duration!==null?t=this._duration:this.dateRange.duration?t=this.dateRange.duration:t=this.dateRange.plannedDuration||0,!isNaN(e)&&e<t&&(t=e),t}set duration(e){this._duration=e}get cue(){return this.dateRange.cue}get timelineOccupancy(){return this.dateRange.attr["X-TIMELINE-OCCUPIES"]==="RANGE"?Na.Range:Na.Point}get supplementsPrimary(){return this.dateRange.attr["X-TIMELINE-STYLE"]==="PRIMARY"}get contentMayVary(){return this.dateRange.attr["X-CONTENT-MAY-VARY"]!=="NO"}get assetUrl(){return this.dateRange.attr["X-ASSET-URI"]}get assetListUrl(){return this.dateRange.attr["X-ASSET-LIST"]}get baseUrl(){return this.base.url}get assetListLoaded(){return this.assetList.length>0||this.assetListResponse!==null}toString(){return NT(this)}}function Go(n,e){return n-e.start<e.duration/2&&!(Math.abs(n-(e.start+e.duration))<Us)?e.start:e.start+e.duration}function Gm(n,e,t){const s=new self.URL(n,t);return s.protocol!=="data:"&&s.searchParams.set("_HLS_primary_id",e),s}function Ko(n,e){for(;(t=n.assetList[++e])!=null&&t.error;)var t;return e}function NT(n){return`["${n.identifier}" ${n.cue.pre?"<pre>":n.cue.post?"<post>":""}${n.timelineStart.toFixed(2)}-${n.resumeTime.toFixed(2)}]`}function ms(n){const e=n.timelineStart,t=n.duration||0;return`["${n.identifier}" ${e.toFixed(2)}-${(e+t).toFixed(2)}]`}class OT{constructor(e,t,s,i){this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=()=>{this.reachedPlayout(this.currentTime)&&this.hls&&this.hls.trigger(v.PLAYOUT_LIMIT_REACHED,{})};const r=this.hls=new e(t);this.interstitial=s,this.assetItem=i;const a=()=>{this.hasDetails=!0};r.once(v.LEVEL_LOADED,a),r.once(v.AUDIO_TRACK_LOADED,a),r.once(v.SUBTITLE_TRACK_LOADED,a),r.on(v.MEDIA_ATTACHING,(o,{media:l})=>{this.removeMediaListeners(),this.mediaAttached=l,this.interstitial.playoutLimit&&(l.addEventListener("timeupdate",this.checkPlayout),this.appendInPlace&&r.on(v.BUFFER_APPENDED,()=>{const c=this.bufferedEnd;this.reachedPlayout(c)&&(this._bufferedEosTime=c,r.trigger(v.BUFFERED_TO_END,void 0))}))})}get appendInPlace(){return this.interstitial.appendInPlace}loadSource(){const e=this.hls;if(e)if(e.url)e.levels.length&&!e.started&&e.startLoad(-1,!0);else{let t=this.assetItem.uri;try{t=Gm(t,e.config.primarySessionId||"").href}catch{}e.loadSource(t)}}bufferedInPlaceToEnd(e){var t;if(!this.appendInPlace)return!1;if((t=this.hls)!=null&&t.bufferedToEnd)return!0;if(!e)return!1;const s=Math.min(this._bufferedEosTime||1/0,this.duration),i=this.timelineOffset,r=X.bufferInfo(e,i,0);return this.getAssetTime(r.end)>=s-.02}reachedPlayout(e){const s=this.interstitial.playoutLimit;return this.startOffset+e>=s}get destroyed(){var e;return!((e=this.hls)!=null&&e.userConfig)}get assetId(){return this.assetItem.identifier}get interstitialId(){return this.assetItem.parentIdentifier}get media(){var e;return((e=this.hls)==null?void 0:e.media)||null}get bufferedEnd(){const e=this.media||this.mediaAttached;if(!e)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;const t=X.bufferInfo(e,e.currentTime,.001);return this.getAssetTime(t.end)}get currentTime(){const e=this.media||this.mediaAttached;return e?this.getAssetTime(e.currentTime):this._currentTime||0}get duration(){const e=this.assetItem.duration;if(!e)return 0;const t=this.interstitial.playoutLimit;if(t){const s=t-this.startOffset;if(s>0&&s<e)return s}return e}get remaining(){const e=this.duration;return e?Math.max(0,e-this.currentTime):0}get startOffset(){return this.assetItem.startOffset}get timelineOffset(){var e;return((e=this.hls)==null?void 0:e.config.timelineOffset)||0}set timelineOffset(e){const t=this.timelineOffset;if(e!==t){const s=e-t;if(Math.abs(s)>1/9e4&&this.hls){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=e}}}getAssetTime(e){const t=this.timelineOffset,s=this.duration;return Math.min(Math.max(0,e-t),s)}removeMediaListeners(){const e=this.mediaAttached;e&&(this._currentTime=e.currentTime,this.bufferSnapShot(),e.removeEventListener("timeupdate",this.checkPlayout))}bufferSnapShot(){if(this.mediaAttached){var e;(e=this.hls)!=null&&e.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd)}}destroy(){this.removeMediaListeners(),this.hls&&this.hls.destroy(),this.hls=null,this.tracks=this.mediaAttached=this.checkPlayout=null}attachMedia(e){var t;this.loadSource(),(t=this.hls)==null||t.attachMedia(e)}detachMedia(){var e;this.removeMediaListeners(),this.mediaAttached=null,(e=this.hls)==null||e.detachMedia()}resumeBuffering(){var e;(e=this.hls)==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.hls)==null||e.pauseBuffering()}transferMedia(){var e;return this.bufferSnapShot(),((e=this.hls)==null?void 0:e.transferMedia())||null}resetDetails(){const e=this.hls;if(e&&this.hasDetails){e.stopLoad();const t=s=>delete s.details;e.levels.forEach(t),e.allAudioTracks.forEach(t),e.allSubtitleTracks.forEach(t),this.hasDetails=!1}}on(e,t,s){var i;(i=this.hls)==null||i.on(e,t)}once(e,t,s){var i;(i=this.hls)==null||i.once(e,t)}off(e,t,s){var i;(i=this.hls)==null||i.off(e,t)}toString(){var e;return`HlsAssetPlayer: ${ms(this.assetItem)} ${(e=this.hls)==null?void 0:e.sessionId} ${this.appendInPlace?"append-in-place":""}`}}const zh=.033;class MT extends It{constructor(e,t){super("interstitials-sched",t),this.onScheduleUpdate=void 0,this.eventMap={},this.events=null,this.items=null,this.durations={primary:0,playout:0,integrated:0},this.onScheduleUpdate=e}destroy(){this.reset(),this.onScheduleUpdate=null}reset(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach(e=>e.reset()),this.events=this.items=null}resetErrorsInRange(e,t){return this.events?this.events.reduce((s,i)=>e<=i.startOffset&&t>i.startOffset?(delete i.error,s+1):s,0):0}get duration(){const e=this.items;return e?e[e.length-1].end:0}get length(){return this.items?this.items.length:0}getEvent(e){return e&&this.eventMap[e]||null}hasEvent(e){return e in this.eventMap}findItemIndex(e,t){if(e.event)return this.findEventIndex(e.event.identifier);let s=-1;e.nextEvent?s=this.findEventIndex(e.nextEvent.identifier)-1:e.previousEvent&&(s=this.findEventIndex(e.previousEvent.identifier)+1);const i=this.items;if(i)for(i[s]||(t===void 0&&(t=e.start),s=this.findItemIndexAtTime(t));s>=0&&(r=i[s])!=null&&r.event;){var r;s--}return s}findItemIndexAtTime(e,t){const s=this.items;if(s)for(let i=0;i<s.length;i++){let r=s[i];if(t&&t!=="primary"&&(r=r[t]),e===r.start||e>r.start&&e<r.end)return i}return-1}findJumpRestrictedIndex(e,t){const s=this.items;if(s)for(let i=e;i<=t&&s[i];i++){const r=s[i].event;if(r!=null&&r.restrictions.jump&&!r.appendInPlace)return i}return-1}findEventIndex(e){const t=this.items;if(t)for(let i=t.length;i--;){var s;if(((s=t[i].event)==null?void 0:s.identifier)===e)return i}return-1}findAssetIndex(e,t){const s=e.assetList,i=s.length;if(i>1)for(let r=0;r<i;r++){const a=s[r];if(!a.error){const o=a.timelineStart;if(t===o||t>o&&(t<o+(a.duration||0)||r===i-1))return r}}return 0}get assetIdAtEnd(){var e;const t=(e=this.items)==null||(e=e[this.length-1])==null?void 0:e.event;if(t){const s=t.assetList,i=s[s.length-1];if(i)return i.identifier}return null}parseInterstitialDateRanges(e,t){const s=e.main.details,{dateRanges:i}=s,r=this.events,a=this.parseDateRanges(i,{url:s.url},t),o=Object.keys(i),l=r?r.filter(u=>!o.includes(u.identifier)):[];a.length&&a.sort((u,c)=>{const d=u.cue.pre,h=u.cue.post,f=c.cue.pre,g=c.cue.post;if(d&&!f)return-1;if(f&&!d||h&&!g)return 1;if(g&&!h)return-1;if(!d&&!f&&!h&&!g){const p=u.startTime,E=c.startTime;if(p!==E)return p-E}return u.dateRange.tagOrder-c.dateRange.tagOrder}),this.events=a,l.forEach(u=>{this.removeEvent(u)}),this.updateSchedule(e,l)}updateSchedule(e,t=[],s=!1){const i=this.events||[];if(i.length||t.length||this.length<2){const r=this.items,a=this.parseSchedule(i,e);(s||t.length||(r==null?void 0:r.length)!==a.length||a.some((l,u)=>Math.abs(l.playout.start-r[u].playout.start)>.005||Math.abs(l.playout.end-r[u].playout.end)>.005))&&(this.items=a,this.onScheduleUpdate(t,r))}}parseDateRanges(e,t,s){const i=[],r=Object.keys(e);for(let a=0;a<r.length;a++){const o=r[a],l=e[o];if(l.isInterstitial){let u=this.eventMap[o];u?u.setDateRange(l):(u=new bT(l,t),this.eventMap[o]=u,s===!1&&(u.appendInPlace=s)),i.push(u)}}return i}parseSchedule(e,t){const s=[],i=t.main.details,r=i.live?1/0:i.edge;let a=0;if(e=e.filter(l=>!l.error&&!(l.cue.once&&l.hasPlayed)),e.length){this.resolveOffsets(e,t);let l=0,u=0;if(e.forEach((c,d)=>{const h=c.cue.pre,f=c.cue.post,g=e[d-1]||null,p=c.appendInPlace,E=f?r:c.startOffset,y=c.duration,m=c.timelineOccupancy===Na.Range?y:0,S=c.resumptionOffset,T=(g==null?void 0:g.startTime)===E,A=E+c.cumulativeDuration;let _=p?A+y:E+S;if(h||!f&&E<=0){const R=u;u+=m,c.timelineStart=A;const C=a;a+=y,s.push({event:c,start:A,end:_,playout:{start:C,end:a},integrated:{start:R,end:u}})}else if(E<=r){if(!T){const I=E-l;if(I>zh){const P=l,$=u;u+=I;const G=a;a+=I;const W={previousEvent:e[d-1]||null,nextEvent:c,start:P,end:P+I,playout:{start:G,end:a},integrated:{start:$,end:u}};s.push(W)}else I>0&&g&&(g.cumulativeDuration+=I,s[s.length-1].end=E)}f&&(_=A),c.timelineStart=A;const R=u;u+=m;const C=a;a+=y,s.push({event:c,start:A,end:_,playout:{start:C,end:a},integrated:{start:R,end:u}})}else return;const L=c.resumeTime;f||L>r?l=r:l=L}),l<r){var o;const c=l,d=u,h=r-l;u+=h;const f=a;a+=h,s.push({previousEvent:((o=s[s.length-1])==null?void 0:o.event)||null,nextEvent:null,start:l,end:c+h,playout:{start:f,end:a},integrated:{start:d,end:u}})}this.setDurations(r,a,u)}else s.push({previousEvent:null,nextEvent:null,start:0,end:r,playout:{start:0,end:r},integrated:{start:0,end:r}}),this.setDurations(r,r,r);return s}setDurations(e,t,s){this.durations={primary:e,playout:t,integrated:s}}resolveOffsets(e,t){const s=t.main.details,i=s.live?1/0:s.edge;let r=0,a=-1;e.forEach((o,l)=>{const u=o.cue.pre,c=o.cue.post,d=u?0:c?i:o.startTime;this.updateAssetDurations(o),a===d?o.cumulativeDuration=r:(r=0,a=d),!c&&o.snapOptions.in&&(o.resumeAnchor=rs(null,s.fragments,o.startOffset+o.resumptionOffset,0,0)||void 0),o.appendInPlace&&!o.appendInPlaceStarted&&(this.primaryCanResumeInPlaceAt(o,t)||(o.appendInPlace=!1)),!o.appendInPlace&&l+1<e.length&&e[l+1].startTime-e[l].resumeTime<zh&&(e[l+1].appendInPlace=!1,e[l+1].appendInPlace&&this.warn(`Could not change append strategy for abutting event ${o}`));const f=j(o.resumeOffset)?o.resumeOffset:o.duration;r+=f})}primaryCanResumeInPlaceAt(e,t){const s=e.resumeTime,i=e.startTime+e.resumptionOffset;return Math.abs(s-i)>Us?(this.log(`"${e.identifier}" resumption ${s} not aligned with estimated timeline end ${i}`),!1):!Object.keys(t).some(a=>{const o=t[a].details,l=o.edge;if(s>=l)return this.log(`"${e.identifier}" resumption ${s} past ${a} playlist end ${l}`),!1;const u=rs(null,o.fragments,s);if(!u)return this.log(`"${e.identifier}" resumption ${s} does not align with any fragments in ${a} playlist (${o.fragStart}-${o.fragmentEnd})`),!0;const c=a==="audio"?.175:0;return Math.abs(u.start-s)<Us+c||Math.abs(u.end-s)<Us+c?!1:(this.log(`"${e.identifier}" resumption ${s} not aligned with ${a} fragment bounds (${u.start}-${u.end} sn: ${u.sn} cc: ${u.cc})`),!0)})}updateAssetDurations(e){if(!e.assetListLoaded)return;const t=e.timelineStart;let s=0,i=!1,r=!1;for(let a=0;a<e.assetList.length;a++){const o=e.assetList[a],l=t+s;o.startOffset=s,o.timelineStart=l,i||(i=o.duration===null),r||(r=!!o.error);const u=o.error?0:o.duration||0;s+=u}i&&!r?e.duration=Math.max(s,e.duration):e.duration=s}removeEvent(e){e.reset(),delete this.eventMap[e.identifier]}}function Ct(n){return`[${n.event?'"'+n.event.identifier+'"':"primary"}: ${n.start.toFixed(2)}-${n.end.toFixed(2)}]`}class FT{constructor(e){this.hls=void 0,this.hls=e}destroy(){this.hls=null}loadAssetList(e,t){const s=e.assetListUrl;let i;try{i=Gm(s,this.hls.sessionId,e.baseUrl)}catch(h){const f=this.assignAssetListError(e,w.ASSET_LIST_LOAD_ERROR,h,s);this.hls.trigger(v.ERROR,f);return}t&&i.protocol!=="data:"&&i.searchParams.set("_HLS_start_offset",""+t);const r=this.hls.config,a=r.loader,o=new a(r),l={responseType:"json",url:i.href},u=r.interstitialAssetListLoadPolicy.default,c={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},d={onSuccess:(h,f,g,p)=>{const E=h.data,y=E==null?void 0:E.ASSETS;if(!Array.isArray(y)){const m=this.assignAssetListError(e,w.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),g.url,f,p);this.hls.trigger(v.ERROR,m);return}e.assetListResponse=E,this.hls.trigger(v.ASSET_LIST_LOADED,{event:e,assetListResponse:E,networkDetails:p})},onError:(h,f,g,p)=>{const E=this.assignAssetListError(e,w.ASSET_LIST_LOAD_ERROR,new Error(`Error loading X-ASSET-LIST: HTTP status ${h.code} ${h.text} (${f.url})`),f.url,p,g);this.hls.trigger(v.ERROR,E)},onTimeout:(h,f,g)=>{const p=this.assignAssetListError(e,w.ASSET_LIST_LOAD_TIMEOUT,new Error(`Timeout loading X-ASSET-LIST (${f.url})`),f.url,h,g);this.hls.trigger(v.ERROR,p)}};return o.load(l,c,d),this.hls.trigger(v.ASSET_LIST_LOADING,{event:e}),o}assignAssetListError(e,t,s,i,r,a){return e.error=s,{type:Y.NETWORK_ERROR,details:t,fatal:!1,interstitial:e,url:i,error:s,networkDetails:a,stats:r}}}function Wh(n){var e;n==null||(e=n.play())==null||e.catch(()=>{})}function Cr(n,e){return`[${n}] Advancing timeline position to ${e}`}class BT extends It{constructor(e,t){super("interstitials",e.logger),this.HlsPlayerClass=void 0,this.hls=void 0,this.assetListLoader=void 0,this.mediaSelection=null,this.altSelection=null,this.media=null,this.detachedData=null,this.requiredTracks=null,this.manager=null,this.playerQueue=[],this.bufferedPos=-1,this.timelinePos=-1,this.schedule=void 0,this.playingItem=null,this.bufferingItem=null,this.waitingItem=null,this.endedItem=null,this.playingAsset=null,this.endedAsset=null,this.bufferingAsset=null,this.shouldPlay=!1,this.onPlay=()=>{this.shouldPlay=!0},this.onPause=()=>{this.shouldPlay=!1},this.onSeeking=()=>{const s=this.currentTime;if(s===void 0||this.playbackDisabled||!this.schedule)return;const i=s-this.timelinePos;if(Math.abs(i)<1/7056e5)return;const a=i<=-.01;this.timelinePos=s,this.bufferedPos=s;const o=this.playingItem;if(!o){this.checkBuffer();return}if(a&&this.schedule.resetErrorsInRange(s,s-i)&&this.updateSchedule(!0),this.checkBuffer(),a&&s<o.start||s>=o.end){var l;const f=this.findItemIndex(o);let g=this.schedule.findItemIndexAtTime(s);if(g===-1&&(g=f+(a?-1:1),this.log(`seeked ${a?"back ":""}to position not covered by schedule ${s} (resolving from ${f} to ${g})`)),!this.isInterstitial(o)&&(l=this.media)!=null&&l.paused&&(this.shouldPlay=!1),!a&&g>f){const p=this.schedule.findJumpRestrictedIndex(f+1,g);if(p>f){this.setSchedulePosition(p);return}}this.setSchedulePosition(g);return}const u=this.playingAsset;if(!u){if(this.playingLastItem&&this.isInterstitial(o)){const f=o.event.assetList[0];f&&(this.endedItem=this.playingItem,this.playingItem=null,this.setScheduleToAssetAtTime(s,f))}return}const c=u.timelineStart,d=u.duration||0;if(a&&s<c||s>=c+d){var h;(h=o.event)!=null&&h.appendInPlace&&(this.clearAssetPlayers(o.event,o),this.flushFrontBuffer(s)),this.setScheduleToAssetAtTime(s,u)}},this.onTimeupdate=()=>{const s=this.currentTime;if(s===void 0||this.playbackDisabled)return;if(s>this.timelinePos)this.timelinePos=s,s>this.bufferedPos&&this.checkBuffer();else return;const i=this.playingItem;if(!i||this.playingLastItem)return;if(s>=i.end){this.timelinePos=i.end;const o=this.findItemIndex(i);this.setSchedulePosition(o+1)}const r=this.playingAsset;if(!r)return;const a=r.timelineStart+(r.duration||0);s>=a&&this.setScheduleToAssetAtTime(s,r)},this.onScheduleUpdate=(s,i)=>{const r=this.schedule;if(!r)return;const a=this.playingItem,o=r.events||[],l=r.items||[],u=r.durations,c=s.map(p=>p.identifier),d=!!(o.length||c.length);(d||i)&&this.log(`INTERSTITIALS_UPDATED (${o.length}): ${o}
Schedule: ${l.map(p=>Ct(p))} pos: ${this.timelinePos}`),c.length&&this.log(`Removed events ${c}`);let h=null,f=null;a&&(h=this.updateItem(a,this.timelinePos),this.itemsMatch(a,h)?this.playingItem=h:this.waitingItem=this.endedItem=null),this.waitingItem=this.updateItem(this.waitingItem),this.endedItem=this.updateItem(this.endedItem);const g=this.bufferingItem;if(g&&(f=this.updateItem(g,this.bufferedPos),this.itemsMatch(g,f)?this.bufferingItem=f:g.event&&(this.bufferingItem=this.playingItem,this.clearInterstitial(g.event,null))),s.forEach(p=>{p.assetList.forEach(E=>{this.clearAssetPlayer(E.identifier,null)})}),this.playerQueue.forEach(p=>{if(p.interstitial.appendInPlace){const E=p.assetItem.timelineStart,y=p.timelineOffset-E;if(y)try{p.timelineOffset=E}catch(m){Math.abs(y)>Us&&this.warn(`${m} ("${p.assetId}" ${p.timelineOffset}->${E})`)}}}),d||i){if(this.hls.trigger(v.INTERSTITIALS_UPDATED,{events:o.slice(0),schedule:l.slice(0),durations:u,removedIds:c}),this.isInterstitial(a)&&c.includes(a.event.identifier)){this.warn(`Interstitial "${a.event.identifier}" removed while playing`),this.primaryFallback(a.event);return}a&&this.trimInPlace(h,a),g&&f!==h&&this.trimInPlace(f,g),this.checkBuffer()}},this.hls=e,this.HlsPlayerClass=t,this.assetListLoader=new FT(e),this.schedule=new MT(this.onScheduleUpdate,e.logger),this.registerListeners()}registerListeners(){const e=this.hls;e&&(e.on(v.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(v.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(v.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(v.MANIFEST_LOADING,this.onManifestLoading,this),e.on(v.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(v.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(v.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.on(v.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(v.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.on(v.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.on(v.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.on(v.BUFFER_APPENDED,this.onBufferAppended,this),e.on(v.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(v.BUFFERED_TO_END,this.onBufferedToEnd,this),e.on(v.MEDIA_ENDED,this.onMediaEnded,this),e.on(v.ERROR,this.onError,this),e.on(v.DESTROYING,this.onDestroying,this))}unregisterListeners(){const e=this.hls;e&&(e.off(v.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(v.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(v.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(v.MANIFEST_LOADING,this.onManifestLoading,this),e.off(v.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(v.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(v.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.off(v.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(v.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.off(v.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.off(v.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.off(v.BUFFER_CODECS,this.onBufferCodecs,this),e.off(v.BUFFER_APPENDED,this.onBufferAppended,this),e.off(v.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(v.BUFFERED_TO_END,this.onBufferedToEnd,this),e.off(v.MEDIA_ENDED,this.onMediaEnded,this),e.off(v.ERROR,this.onError,this),e.off(v.DESTROYING,this.onDestroying,this))}startLoad(){this.resumeBuffering()}stopLoad(){this.pauseBuffering()}resumeBuffering(){var e;(e=this.getBufferingPlayer())==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.getBufferingPlayer())==null||e.pauseBuffering()}destroy(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.schedule=this.manager=null,this.hls=this.HlsPlayerClass=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null}onDestroying(){const e=this.primaryMedia||this.media;e&&this.removeMediaListeners(e)}removeMediaListeners(e){tt(e,"play",this.onPlay),tt(e,"pause",this.onPause),tt(e,"seeking",this.onSeeking),tt(e,"timeupdate",this.onTimeupdate)}onMediaAttaching(e,t){const s=this.media=t.media;Ye(s,"seeking",this.onSeeking),Ye(s,"timeupdate",this.onTimeupdate),Ye(s,"play",this.onPlay),Ye(s,"pause",this.onPause)}onMediaAttached(e,t){const s=this.effectivePlayingItem,i=this.detachedData;if(this.detachedData=null,s===null)this.checkStart();else if(!i){this.clearScheduleState();const r=this.findItemIndex(s);this.setSchedulePosition(r)}}clearScheduleState(){this.log("clear schedule state"),this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null}onMediaDetaching(e,t){const s=!!t.transferMedia,i=this.media;if(this.media=null,!s&&(i&&this.removeMediaListeners(i),this.detachedData)){const r=this.getBufferingPlayer();r&&(this.log(`Removing schedule state for detachedData and ${r}`),this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,r.detachMedia()),this.shouldPlay=!1}}get interstitialsManager(){if(!this.hls)return null;if(this.manager)return this.manager;const e=this,t=()=>e.bufferingItem||e.waitingItem,s=d=>d&&e.getAssetPlayer(d.identifier),i=(d,h,f,g,p)=>{if(d){let E=d[h].start;const y=d.event;if(y){if(h==="playout"||y.timelineOccupancy!==Na.Point){const m=s(f);(m==null?void 0:m.interstitial)===y&&(E+=m.assetItem.startOffset+m[p])}}else{const m=g==="bufferedPos"?a():e[g];E+=m-d.start}return E}return 0},r=(d,h)=>{var f;if(d!==0&&h!=="primary"&&(f=e.schedule)!=null&&f.length){var g;const p=e.schedule.findItemIndexAtTime(d),E=(g=e.schedule.items)==null?void 0:g[p];if(E){const y=E[h].start-E.start;return d+y}}return d},a=()=>{const d=e.bufferedPos;return d===Number.MAX_VALUE?o("primary"):Math.max(d,0)},o=d=>{var h,f;return(h=e.primaryDetails)!=null&&h.live?e.primaryDetails.edge:((f=e.schedule)==null?void 0:f.durations[d])||0},l=(d,h)=>{var f,g;const p=e.effectivePlayingItem;if(p!=null&&(f=p.event)!=null&&f.restrictions.skip||!e.schedule)return;e.log(`seek to ${d} "${h}"`);const E=e.effectivePlayingItem,y=e.schedule.findItemIndexAtTime(d,h),m=(g=e.schedule.items)==null?void 0:g[y],S=e.getBufferingPlayer(),T=S==null?void 0:S.interstitial,A=T==null?void 0:T.appendInPlace,_=E&&e.itemsMatch(E,m);if(E&&(A||_)){const L=s(e.playingAsset),R=(L==null?void 0:L.media)||e.primaryMedia;if(R){const C=h==="primary"?R.currentTime:i(E,h,e.playingAsset,"timelinePos","currentTime"),I=d-C,P=(A?C:R.currentTime)+I;if(P>=0&&(!L||A||P<=L.duration)){R.currentTime=P;return}}}if(m){let L=d;if(h!=="primary"){const C=m[h].start,I=d-C;L=m.start+I}const R=!e.isInterstitial(m);if((!e.isInterstitial(E)||E.event.appendInPlace)&&(R||m.event.appendInPlace)){const C=e.media||(A?S==null?void 0:S.media:null);C&&(C.currentTime=L)}else if(E){const C=e.findItemIndex(E);if(y>C){const P=e.schedule.findJumpRestrictedIndex(C+1,y);if(P>C){e.setSchedulePosition(P);return}}let I=0;if(R)e.timelinePos=L,e.checkBuffer();else{const P=m.event.assetList,$=d-(m[h]||m).start;for(let G=P.length;G--;){const W=P[G];if(W.duration&&$>=W.startOffset&&$<W.startOffset+W.duration){I=G;break}}}e.setSchedulePosition(y,I)}}},u=()=>{const d=e.effectivePlayingItem;if(e.isInterstitial(d))return d;const h=t();return e.isInterstitial(h)?h:null},c={get bufferedEnd(){const d=t(),h=e.bufferingItem;if(h&&h===d){var f;return i(h,"playout",e.bufferingAsset,"bufferedPos","bufferedEnd")-h.playout.start||((f=e.bufferingAsset)==null?void 0:f.startOffset)||0}return 0},get currentTime(){const d=u(),h=e.effectivePlayingItem;return h&&h===d?i(h,"playout",e.effectivePlayingAsset,"timelinePos","currentTime")-h.playout.start:0},set currentTime(d){const h=u(),f=e.effectivePlayingItem;f&&f===h&&l(d+f.playout.start,"playout")},get duration(){const d=u();return d?d.playout.end-d.playout.start:0},get assetPlayers(){var d;const h=(d=u())==null?void 0:d.event.assetList;return h?h.map(f=>e.getAssetPlayer(f.identifier)):[]},get playingIndex(){var d;const h=(d=u())==null?void 0:d.event;return h&&e.effectivePlayingAsset?h.findAssetIndex(e.effectivePlayingAsset):-1},get scheduleItem(){return u()}};return this.manager={get events(){var d;return((d=e.schedule)==null||(d=d.events)==null?void 0:d.slice(0))||[]},get schedule(){var d;return((d=e.schedule)==null||(d=d.items)==null?void 0:d.slice(0))||[]},get interstitialPlayer(){return u()?c:null},get playerQueue(){return e.playerQueue.slice(0)},get bufferingAsset(){return e.bufferingAsset},get bufferingItem(){return t()},get bufferingIndex(){const d=t();return e.findItemIndex(d)},get playingAsset(){return e.effectivePlayingAsset},get playingItem(){return e.effectivePlayingItem},get playingIndex(){const d=e.effectivePlayingItem;return e.findItemIndex(d)},primary:{get bufferedEnd(){return a()},get currentTime(){const d=e.timelinePos;return d>0?d:0},set currentTime(d){l(d,"primary")},get duration(){return o("primary")},get seekableStart(){var d;return((d=e.primaryDetails)==null?void 0:d.fragmentStart)||0}},integrated:{get bufferedEnd(){return i(t(),"integrated",e.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return i(e.effectivePlayingItem,"integrated",e.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(d){l(d,"integrated")},get duration(){return o("integrated")},get seekableStart(){var d;return r(((d=e.primaryDetails)==null?void 0:d.fragmentStart)||0,"integrated")}},skip:()=>{const d=e.effectivePlayingItem,h=d==null?void 0:d.event;if(h&&!h.restrictions.skip){const f=e.findItemIndex(d);if(h.appendInPlace){const g=d.playout.start+d.event.duration;l(g+.001,"playout")}else e.advanceAfterAssetEnded(h,f,1/0)}}}}get effectivePlayingItem(){return this.waitingItem||this.playingItem||this.endedItem}get effectivePlayingAsset(){return this.playingAsset||this.endedAsset}get playingLastItem(){var e;const t=this.playingItem,s=(e=this.schedule)==null?void 0:e.items;return!this.playbackStarted||!t||!s?!1:this.findItemIndex(t)===s.length-1}get playbackStarted(){return this.effectivePlayingItem!==null}get currentTime(){var e,t;if(this.mediaSelection===null)return;const s=this.waitingItem||this.playingItem;if(this.isInterstitial(s)&&!s.event.appendInPlace)return;let i=this.media;!i&&(e=this.bufferingItem)!=null&&(e=e.event)!=null&&e.appendInPlace&&(i=this.primaryMedia);const r=(t=i)==null?void 0:t.currentTime;if(!(r===void 0||!j(r)))return r}get primaryMedia(){var e;return this.media||((e=this.detachedData)==null?void 0:e.media)||null}isInterstitial(e){return!!(e!=null&&e.event)}retreiveMediaSource(e,t){const s=this.getAssetPlayer(e);s&&this.transferMediaFromPlayer(s,t)}transferMediaFromPlayer(e,t){const s=e.interstitial.appendInPlace,i=e.media;if(s&&i===this.primaryMedia){if(this.bufferingAsset=null,(!t||this.isInterstitial(t)&&!t.event.appendInPlace)&&t&&i){this.detachedData={media:i};return}const r=e.transferMedia();this.log(`transfer MediaSource from ${e} ${de(r)}`),this.detachedData=r}else t&&i&&(this.shouldPlay||(this.shouldPlay=!i.paused))}transferMediaTo(e,t){var s,i;if(e.media===t)return;let r=null;const a=this.hls,o=e!==a,l=o&&e.interstitial.appendInPlace,u=(s=this.detachedData)==null?void 0:s.mediaSource;let c;if(a.media)l&&(r=a.transferMedia(),this.detachedData=r),c="Primary";else if(u){const g=this.getBufferingPlayer();g?(r=g.transferMedia(),c=`${g}`):c="detached MediaSource"}else c="detached media";if(!r){if(u)r=this.detachedData,this.log(`using detachedData: MediaSource ${de(r)}`);else if(!this.detachedData||a.media===t){const g=this.playerQueue;g.length>1&&g.forEach(p=>{if(o&&p.interstitial.appendInPlace!==l){const E=p.interstitial;this.clearInterstitial(p.interstitial,null),E.appendInPlace=!1,E.appendInPlace&&this.warn(`Could not change append strategy for queued assets ${E}`)}}),this.hls.detachMedia(),this.detachedData={media:t}}}const d=r&&"mediaSource"in r&&((i=r.mediaSource)==null?void 0:i.readyState)!=="closed",h=d&&r?r:t;this.log(`${d?"transfering MediaSource":"attaching media"} to ${o?e:"Primary"} from ${c} (media.currentTime: ${t.currentTime})`);const f=this.schedule;if(h===r&&f){const g=o&&e.assetId===f.assetIdAtEnd;h.overrides={duration:f.duration,endOfStream:!o||g,cueRemoval:!o}}e.attachMedia(h)}onInterstitialCueEnter(){this.onTimeupdate()}checkStart(){const e=this.schedule,t=e==null?void 0:e.events;if(!t||this.playbackDisabled||!this.media)return;this.bufferedPos===-1&&(this.bufferedPos=0);const s=this.timelinePos,i=this.effectivePlayingItem;if(s===-1){const r=this.hls.startPosition;if(this.log(Cr("checkStart",r)),this.timelinePos=r,t.length&&t[0].cue.pre){const a=e.findEventIndex(t[0].identifier);this.setSchedulePosition(a)}else if(r>=0||!this.primaryLive){const a=this.timelinePos=r>0?r:0,o=e.findItemIndexAtTime(a);this.setSchedulePosition(o)}}else if(i&&!this.playingItem){const r=e.findItemIndex(i);this.setSchedulePosition(r)}}advanceAssetBuffering(e,t){const s=e.event,i=s.findAssetIndex(t),r=Ko(s,i);if(!s.isAssetPastPlayoutLimit(r))this.bufferedToEvent(e,r);else if(this.schedule){var a;const o=(a=this.schedule.items)==null?void 0:a[this.findItemIndex(e)+1];o&&this.bufferedToItem(o)}}advanceAfterAssetEnded(e,t,s){const i=Ko(e,s);if(e.isAssetPastPlayoutLimit(i)){if(this.schedule){const r=this.schedule.items;if(r){const a=t+1,o=r.length;if(a>=o){this.setSchedulePosition(-1);return}const l=e.resumeTime;this.timelinePos<l&&(this.log(Cr("advanceAfterAssetEnded",l)),this.timelinePos=l,e.appendInPlace&&this.advanceInPlace(l),this.checkBuffer(this.bufferedPos<l)),this.setSchedulePosition(a)}}}else{if(e.appendInPlace){const r=e.assetList[i];r&&this.advanceInPlace(r.timelineStart)}this.setSchedulePosition(t,i)}}setScheduleToAssetAtTime(e,t){const s=this.schedule;if(!s)return;const i=t.parentIdentifier,r=s.getEvent(i);if(r){const a=s.findEventIndex(i),o=s.findAssetIndex(r,e);this.advanceAfterAssetEnded(r,a,o-1)}}setSchedulePosition(e,t){var s;const i=(s=this.schedule)==null?void 0:s.items;if(!i||this.playbackDisabled)return;const r=e>=0?i[e]:null;this.log(`setSchedulePosition ${e}, ${t} (${r&&Ct(r)}) pos: ${this.timelinePos}`);const a=this.waitingItem||this.playingItem,o=this.playingLastItem;if(this.isInterstitial(a)){const c=a.event,d=this.playingAsset,h=d==null?void 0:d.identifier,f=h?this.getAssetPlayer(h):null;if(f&&h&&(!this.eventItemsMatch(a,r)||t!==void 0&&h!==c.assetList[t].identifier)){var l;const g=c.findAssetIndex(d);if(this.log(`INTERSTITIAL_ASSET_ENDED ${g+1}/${c.assetList.length} ${ms(d)}`),this.endedAsset=d,this.playingAsset=null,this.hls.trigger(v.INTERSTITIAL_ASSET_ENDED,{asset:d,assetListIndex:g,event:c,schedule:i.slice(0),scheduleIndex:e,player:f}),a!==this.playingItem){this.itemsMatch(a,this.playingItem)&&!this.playingAsset&&this.advanceAfterAssetEnded(c,this.findItemIndex(this.playingItem),g);return}this.retreiveMediaSource(h,r),f.media&&!((l=this.detachedData)!=null&&l.mediaSource)&&f.detachMedia()}if(!this.eventItemsMatch(a,r)&&(this.endedItem=a,this.playingItem=null,this.log(`INTERSTITIAL_ENDED ${c} ${Ct(a)}`),c.hasPlayed=!0,this.hls.trigger(v.INTERSTITIAL_ENDED,{event:c,schedule:i.slice(0),scheduleIndex:e}),c.cue.once)){var u;this.updateSchedule();const g=(u=this.schedule)==null?void 0:u.items;if(r&&g){const p=this.findItemIndex(r);this.advanceSchedule(p,g,t,a,o)}return}}this.advanceSchedule(e,i,t,a,o)}advanceSchedule(e,t,s,i,r){const a=this.schedule;if(!a)return;const o=t[e]||null,l=this.primaryMedia,u=this.playerQueue;if(u.length&&u.forEach(c=>{const d=c.interstitial,h=a.findEventIndex(d.identifier);(h<e||h>e+1)&&this.clearInterstitial(d,o)}),this.isInterstitial(o)){this.timelinePos=Math.min(Math.max(this.timelinePos,o.start),o.end);const c=o.event;if(s===void 0){s=a.findAssetIndex(c,this.timelinePos);const g=Ko(c,s-1);if(c.isAssetPastPlayoutLimit(g)||c.appendInPlace&&this.timelinePos===o.end){this.advanceAfterAssetEnded(c,e,s);return}s=g}const d=this.waitingItem;this.assetsBuffered(o,l)||this.setBufferingItem(o);let h=this.preloadAssets(c,s);if(this.eventItemsMatch(o,d||i)||(this.waitingItem=o,this.log(`INTERSTITIAL_STARTED ${Ct(o)} ${c.appendInPlace?"append in place":""}`),this.hls.trigger(v.INTERSTITIAL_STARTED,{event:c,schedule:t.slice(0),scheduleIndex:e})),!c.assetListLoaded){this.log(`Waiting for ASSET-LIST to complete loading ${c}`);return}if(c.assetListLoader&&(c.assetListLoader.destroy(),c.assetListLoader=void 0),!l){this.log(`Waiting for attachMedia to start Interstitial ${c}`);return}this.waitingItem=this.endedItem=null,this.playingItem=o;const f=c.assetList[s];if(!f){this.advanceAfterAssetEnded(c,e,s||0);return}if(h||(h=this.getAssetPlayer(f.identifier)),h===null||h.destroyed){const g=c.assetList.length;this.warn(`asset ${s+1}/${g} player destroyed ${c}`),h=this.createAssetPlayer(c,f,s),h.loadSource()}if(!this.eventItemsMatch(o,this.bufferingItem)&&c.appendInPlace&&this.isAssetBuffered(f))return;this.startAssetPlayer(h,s,t,e,l),this.shouldPlay&&Wh(h.media)}else o?(this.resumePrimary(o,e,i),this.shouldPlay&&Wh(this.hls.media)):r&&this.isInterstitial(i)&&(this.endedItem=null,this.playingItem=i,i.event.appendInPlace||this.attachPrimary(a.durations.primary,null))}get playbackDisabled(){return this.hls.config.enableInterstitialPlayback===!1}get primaryDetails(){var e;return(e=this.mediaSelection)==null?void 0:e.main.details}get primaryLive(){var e;return!!((e=this.primaryDetails)!=null&&e.live)}resumePrimary(e,t,s){var i,r;if(this.playingItem=e,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(e),this.log(`resuming ${Ct(e)}`),!((i=this.detachedData)!=null&&i.mediaSource)){let o=this.timelinePos;(o<e.start||o>=e.end)&&(o=this.getPrimaryResumption(e,t),this.log(Cr("resumePrimary",o)),this.timelinePos=o),this.attachPrimary(o,e)}if(!s)return;const a=(r=this.schedule)==null?void 0:r.items;a&&(this.log(`INTERSTITIALS_PRIMARY_RESUMED ${Ct(e)}`),this.hls.trigger(v.INTERSTITIALS_PRIMARY_RESUMED,{schedule:a.slice(0),scheduleIndex:t}),this.checkBuffer())}getPrimaryResumption(e,t){const s=e.start;if(this.primaryLive){const i=this.primaryDetails;if(t===0)return this.hls.startPosition;if(i&&(s<i.fragmentStart||s>i.edge))return this.hls.liveSyncPosition||-1}return s}isAssetBuffered(e){const t=this.getAssetPlayer(e.identifier);return t!=null&&t.hls?t.hls.bufferedToEnd:X.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=e.timelineStart+(e.duration||0)}attachPrimary(e,t,s){t?this.setBufferingItem(t):this.bufferingItem=this.playingItem,this.bufferingAsset=null;const i=this.primaryMedia;if(!i)return;const r=this.hls;r.media?this.checkBuffer():(this.transferMediaTo(r,i),s&&this.startLoadingPrimaryAt(e,s)),s||(this.log(Cr("attachPrimary",e)),this.timelinePos=e,this.startLoadingPrimaryAt(e,s))}startLoadingPrimaryAt(e,t){var s;const i=this.hls;!i.loadingEnabled||!i.media||Math.abs((((s=i.mainForwardBufferInfo)==null?void 0:s.start)||i.media.currentTime)-e)>.5?i.startLoad(e,t):i.bufferingEnabled||i.resumeBuffering()}onManifestLoading(){var e;this.stopLoad(),(e=this.schedule)==null||e.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(v.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(v.BUFFER_CODECS,this.onBufferCodecs,this)}onLevelUpdated(e,t){if(t.level===-1||!this.schedule)return;const s=this.hls.levels[t.level];if(!s.details)return;const i=ae(ae({},this.mediaSelection||this.altSelection),{},{main:s});this.mediaSelection=i,this.schedule.parseInterstitialDateRanges(i,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}onAudioTrackUpdated(e,t){const s=this.hls.audioTracks[t.id],i=this.mediaSelection;if(!i){this.altSelection=ae(ae({},this.altSelection),{},{audio:s});return}const r=ae(ae({},i),{},{audio:s});this.mediaSelection=r}onSubtitleTrackUpdated(e,t){const s=this.hls.subtitleTracks[t.id],i=this.mediaSelection;if(!i){this.altSelection=ae(ae({},this.altSelection),{},{subtitles:s});return}const r=ae(ae({},i),{},{subtitles:s});this.mediaSelection=r}onAudioTrackSwitching(e,t){const s=nh(t);this.playerQueue.forEach(({hls:i})=>i&&(i.setAudioOption(t)||i.setAudioOption(s)))}onSubtitleTrackSwitch(e,t){const s=nh(t);this.playerQueue.forEach(({hls:i})=>i&&(i.setSubtitleOption(t)||t.id!==-1&&i.setSubtitleOption(s)))}onBufferCodecs(e,t){const s=t.tracks;s&&(this.requiredTracks=s)}onBufferAppended(e,t){this.checkBuffer()}onBufferFlushed(e,t){const s=this.playingItem;if(s&&!this.itemsMatch(s,this.bufferingItem)&&!this.isInterstitial(s)){const i=this.timelinePos;this.bufferedPos=i,this.checkBuffer()}}onBufferedToEnd(e){if(!this.schedule)return;const t=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&t){for(let i=0;i<t.length;i++){const r=t[i];if(r.cue.post){var s;const a=this.schedule.findEventIndex(r.identifier),o=(s=this.schedule.items)==null?void 0:s[a];this.isInterstitial(o)&&this.eventItemsMatch(o,this.bufferingItem)&&this.bufferedToItem(o,0);break}}this.bufferedPos=Number.MAX_VALUE}}onMediaEnded(e){const t=this.playingItem;if(!this.playingLastItem&&t){const s=this.findItemIndex(t);this.setSchedulePosition(s+1)}else this.shouldPlay=!1}updateItem(e,t){var s;const i=(s=this.schedule)==null?void 0:s.items;if(e&&i){const r=this.findItemIndex(e,t);return i[r]||null}return null}trimInPlace(e,t){if(this.isInterstitial(e)&&e.event.appendInPlace&&t.end-e.end>.25){e.event.assetList.forEach((r,a)=>{e.event.isAssetPastPlayoutLimit(a)&&this.clearAssetPlayer(r.identifier,null)});const s=e.end+.25,i=X.bufferInfo(this.primaryMedia,s,0);(i.end>s||(i.nextStart||0)>s)&&(this.log(`trim buffered interstitial ${Ct(e)} (was ${Ct(t)})`),this.attachPrimary(s,null,!0),this.flushFrontBuffer(s))}}itemsMatch(e,t){return!!t&&(e===t||e.event&&t.event&&this.eventItemsMatch(e,t)||!e.event&&!t.event&&this.findItemIndex(e)===this.findItemIndex(t))}eventItemsMatch(e,t){var s;return!!t&&(e===t||e.event.identifier===((s=t.event)==null?void 0:s.identifier))}findItemIndex(e,t){return e&&this.schedule?this.schedule.findItemIndex(e,t):-1}updateSchedule(e=!1){var t;const s=this.mediaSelection;s&&((t=this.schedule)==null||t.updateSchedule(s,[],e))}checkBuffer(e){var t;const s=(t=this.schedule)==null?void 0:t.items;if(!s)return;const i=X.bufferInfo(this.primaryMedia,this.timelinePos,0);e&&(this.bufferedPos=this.timelinePos),e||(e=i.len<1),this.updateBufferedPos(i.end,s,e)}updateBufferedPos(e,t,s){const i=this.schedule,r=this.bufferingItem;if(this.bufferedPos>e||!i)return;if(t.length===1&&this.itemsMatch(t[0],r)){this.bufferedPos=e;return}const a=this.playingItem,o=this.findItemIndex(a);let l=i.findItemIndexAtTime(e);if(this.bufferedPos<e){var u;const c=this.findItemIndex(r),d=Math.min(c+1,t.length-1),h=t[d];if((l===-1&&r&&e>=r.end||(u=h.event)!=null&&u.appendInPlace&&e+.01>=h.start)&&(l=d),this.isInterstitial(r)){const f=r.event;if(d-o>1&&f.appendInPlace===!1||f.assetList.length===0&&f.assetListLoader)return}if(this.bufferedPos=e,l>c&&l>o)this.bufferedToItem(h);else{const f=this.primaryDetails;this.primaryLive&&f&&e>f.edge-f.targetduration&&h.start<f.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(h)&&this.preloadAssets(h.event,0)}}else s&&a&&!this.itemsMatch(a,r)&&(l===o?this.bufferedToItem(a):l===o+1&&this.bufferedToItem(t[l]))}assetsBuffered(e,t){return e.event.assetList.length===0?!1:!e.event.assetList.some(i=>{const r=this.getAssetPlayer(i.identifier);return!(r!=null&&r.bufferedInPlaceToEnd(t))})}setBufferingItem(e){const t=this.bufferingItem,s=this.schedule;if(!this.itemsMatch(e,t)&&s){const{items:i,events:r}=s;if(!i||!r)return t;const a=this.isInterstitial(e),o=this.getBufferingPlayer();this.bufferingItem=e,this.bufferedPos=Math.max(e.start,Math.min(e.end,this.timelinePos));const l=o?o.remaining:t?t.end-this.timelinePos:0;if(this.log(`INTERSTITIALS_BUFFERED_TO_BOUNDARY ${Ct(e)}`+(t?` (${l.toFixed(2)} remaining)`:"")),!this.playbackDisabled)if(a){const u=s.findAssetIndex(e.event,this.bufferedPos);e.event.assetList.forEach((c,d)=>{const h=this.getAssetPlayer(c.identifier);h&&(d===u&&h.loadSource(),h.resumeBuffering())})}else this.hls.resumeBuffering(),this.playerQueue.forEach(u=>u.pauseBuffering());this.hls.trigger(v.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:r.slice(0),schedule:i.slice(0),bufferingIndex:this.findItemIndex(e),playingIndex:this.findItemIndex(this.playingItem)})}else this.bufferingItem!==e&&(this.bufferingItem=e);return t}bufferedToItem(e,t=0){const s=this.setBufferingItem(e);if(!this.playbackDisabled){if(this.isInterstitial(e))this.bufferedToEvent(e,t);else if(s!==null){this.bufferingAsset=null;const i=this.detachedData;i?i.mediaSource?this.attachPrimary(e.start,e,!0):this.preloadPrimary(e):this.preloadPrimary(e)}}}preloadPrimary(e){const t=this.findItemIndex(e),s=this.getPrimaryResumption(e,t);this.startLoadingPrimaryAt(s)}bufferedToEvent(e,t){const s=e.event,i=s.assetList.length===0&&!s.assetListLoader,r=s.cue.once;if(i||!r){const a=this.preloadAssets(s,t);if(a!=null&&a.interstitial.appendInPlace){const o=this.primaryMedia;o&&this.bufferAssetPlayer(a,o)}}}preloadAssets(e,t){const s=e.assetUrl,i=e.assetList.length,r=i===0&&!e.assetListLoader,a=e.cue.once;if(r){const l=e.timelineStart;if(e.appendInPlace){var o;const h=this.playingItem;!this.isInterstitial(h)&&(h==null||(o=h.nextEvent)==null?void 0:o.identifier)===e.identifier&&this.flushFrontBuffer(l+.25)}let u,c=0;if(!this.playingItem&&this.primaryLive&&(c=this.hls.startPosition,c===-1&&(c=this.hls.liveSyncPosition||0)),c&&!(e.cue.pre||e.cue.post)){const h=c-l;h>0&&(u=Math.round(h*1e3)/1e3)}if(this.log(`Load interstitial asset ${t+1}/${s?1:i} ${e}${u?` live-start: ${c} start-offset: ${u}`:""}`),s)return this.createAsset(e,0,0,l,e.duration,s);const d=this.assetListLoader.loadAssetList(e,u);d&&(e.assetListLoader=d)}else if(!a&&i){for(let u=t;u<i;u++){const c=e.assetList[u],d=this.getAssetPlayerQueueIndex(c.identifier);(d===-1||this.playerQueue[d].destroyed)&&!c.error&&this.createAssetPlayer(e,c,u)}const l=e.assetList[t];if(l){const u=this.getAssetPlayer(l.identifier);return u&&u.loadSource(),u}}return null}flushFrontBuffer(e){const t=this.requiredTracks;if(!t)return;this.log(`Removing front buffer starting at ${e}`),Object.keys(t).forEach(i=>{this.hls.trigger(v.BUFFER_FLUSHING,{startOffset:e,endOffset:1/0,type:i})})}getAssetPlayerQueueIndex(e){const t=this.playerQueue;for(let s=0;s<t.length;s++)if(e===t[s].assetId)return s;return-1}getAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);return this.playerQueue[t]||null}getBufferingPlayer(){const{playerQueue:e,primaryMedia:t}=this;if(t){for(let s=0;s<e.length;s++)if(e[s].media===t)return e[s]}return null}createAsset(e,t,s,i,r,a){const o={parentIdentifier:e.identifier,identifier:PT(e,a,t),duration:r,startOffset:s,timelineStart:i,uri:a};return this.createAssetPlayer(e,o,t)}createAssetPlayer(e,t,s){const i=this.hls,r=i.userConfig;let a=r.videoPreference;const o=i.loadLevelObj||i.levels[i.currentLevel];(a||o)&&(a=ue({},a),o.videoCodec&&(a.videoCodec=o.videoCodec),o.videoRange&&(a.allowedVideoRanges=[o.videoRange]));const l=i.audioTracks[i.audioTrack],u=i.subtitleTracks[i.subtitleTrack];let c=0;if(this.primaryLive||e.appendInPlace){const T=this.timelinePos-t.timelineStart;if(T>1){const A=t.duration;A&&T<A&&(c=T)}}const d=t.identifier,h=ae(ae({},r),{},{maxMaxBufferLength:Math.min(180,i.config.maxMaxBufferLength),autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:i.sessionId,assetPlayerId:d,abrEwmaDefaultEstimate:i.bandwidthEstimate,interstitialsController:void 0,startPosition:c,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:a,audioPreference:l||r.audioPreference,subtitlePreference:u||r.subtitlePreference});e.appendInPlace&&(e.appendInPlaceStarted=!0,t.timelineStart&&(h.timelineOffset=t.timelineStart));const f=h.cmcd;f!=null&&f.sessionId&&f.contentId&&(h.cmcd=ue({},f,{contentId:Ii(t.uri)})),this.getAssetPlayer(d)&&this.warn(`Duplicate date range identifier ${e} and asset ${d}`);const g=new OT(this.HlsPlayerClass,h,e,t);this.playerQueue.push(g),e.assetList[s]=t;let p=!0;const E=T=>{if(T.live){var A;const R=new Error(`Interstitials MUST be VOD assets ${e}`),C={fatal:!0,type:Y.OTHER_ERROR,details:w.INTERSTITIAL_ASSET_ITEM_ERROR,error:R},I=((A=this.schedule)==null?void 0:A.findEventIndex(e.identifier))||-1;this.handleAssetItemError(C,e,I,s,R.message);return}const _=T.edge-T.fragmentStart,L=t.duration;(p||L===null||_>L)&&(p=!1,this.log(`Interstitial asset "${d}" duration change ${L} > ${_}`),t.duration=_,this.updateSchedule())};g.on(v.LEVEL_UPDATED,(T,{details:A})=>E(A)),g.on(v.LEVEL_PTS_UPDATED,(T,{details:A})=>E(A)),g.on(v.EVENT_CUE_ENTER,()=>this.onInterstitialCueEnter());const y=(T,A)=>{const _=this.getAssetPlayer(d);if(_&&A.tracks){_.off(v.BUFFER_CODECS,y),_.tracks=A.tracks;const L=this.primaryMedia;this.bufferingAsset===_.assetItem&&L&&!_.media&&this.bufferAssetPlayer(_,L)}};g.on(v.BUFFER_CODECS,y);const m=()=>{var T;const A=this.getAssetPlayer(d);if(this.log(`buffered to end of asset ${A}`),!A||!this.schedule)return;const _=this.schedule.findEventIndex(e.identifier),L=(T=this.schedule.items)==null?void 0:T[_];this.isInterstitial(L)&&this.advanceAssetBuffering(L,t)};g.on(v.BUFFERED_TO_END,m);const S=T=>()=>{if(!this.getAssetPlayer(d)||!this.schedule)return;this.shouldPlay=!0;const _=this.schedule.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,_,T)};return g.once(v.MEDIA_ENDED,S(s)),g.once(v.PLAYOUT_LIMIT_REACHED,S(1/0)),g.on(v.ERROR,(T,A)=>{if(!this.schedule)return;const _=this.getAssetPlayer(d);if(A.details===w.BUFFER_STALLED_ERROR){if(_!=null&&_.appendInPlace){this.handleInPlaceStall(e);return}this.onTimeupdate(),this.checkBuffer(!0);return}this.handleAssetItemError(A,e,this.schedule.findEventIndex(e.identifier),s,`Asset player error ${A.error} ${e}`)}),g.on(v.DESTROYING,()=>{if(!this.getAssetPlayer(d)||!this.schedule)return;const A=new Error(`Asset player destroyed unexpectedly ${d}`),_={fatal:!0,type:Y.OTHER_ERROR,details:w.INTERSTITIAL_ASSET_ITEM_ERROR,error:A};this.handleAssetItemError(_,e,this.schedule.findEventIndex(e.identifier),s,A.message)}),this.log(`INTERSTITIAL_ASSET_PLAYER_CREATED ${ms(t)}`),this.hls.trigger(v.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:t,assetListIndex:s,event:e,player:g}),g}clearInterstitial(e,t){this.clearAssetPlayers(e,t),e.reset()}clearAssetPlayers(e,t){e.assetList.forEach(s=>{this.clearAssetPlayer(s.identifier,t)})}resetAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);if(t!==-1){this.log(`reset asset player "${e}" after error`);const s=this.playerQueue[t];this.transferMediaFromPlayer(s,null),s.resetDetails()}}clearAssetPlayer(e,t){const s=this.getAssetPlayerQueueIndex(e);if(s!==-1){const i=this.playerQueue[s];this.log(`clear ${i} toSegment: ${t&&Ct(t)}`),this.transferMediaFromPlayer(i,t),this.playerQueue.splice(s,1),i.destroy()}}emptyPlayerQueue(){let e;for(;e=this.playerQueue.pop();)e.destroy();this.playerQueue=[]}startAssetPlayer(e,t,s,i,r){const{interstitial:a,assetItem:o,assetId:l}=e,u=a.assetList.length,c=this.playingAsset;this.endedAsset=null,this.playingAsset=o,(!c||c.identifier!==l)&&(c&&(this.clearAssetPlayer(c.identifier,s[i]),delete c.error),this.log(`INTERSTITIAL_ASSET_STARTED ${t+1}/${u} ${ms(o)}`),this.hls.trigger(v.INTERSTITIAL_ASSET_STARTED,{asset:o,assetListIndex:t,event:a,schedule:s.slice(0),scheduleIndex:i,player:e})),this.bufferAssetPlayer(e,r)}bufferAssetPlayer(e,t){var s,i;if(!this.schedule)return;const{interstitial:r,assetItem:a}=e,o=this.schedule.findEventIndex(r.identifier),l=(s=this.schedule.items)==null?void 0:s[o];if(!l)return;e.loadSource(),this.setBufferingItem(l),this.bufferingAsset=a;const u=this.getBufferingPlayer();if(u===e)return;const c=r.appendInPlace;if(c&&(u==null?void 0:u.interstitial.appendInPlace)===!1)return;const d=(u==null?void 0:u.tracks)||((i=this.detachedData)==null?void 0:i.tracks)||this.requiredTracks;if(c&&a!==this.playingAsset){if(!e.tracks){this.log(`Waiting for track info before buffering ${e}`);return}if(d&&!Lp(d,e.tracks)){const h=new Error(`Asset ${ms(a)} SourceBuffer tracks ('${Object.keys(e.tracks)}') are not compatible with primary content tracks ('${Object.keys(d)}')`),f={fatal:!0,type:Y.OTHER_ERROR,details:w.INTERSTITIAL_ASSET_ITEM_ERROR,error:h},g=r.findAssetIndex(a);this.handleAssetItemError(f,r,o,g,h.message);return}}this.transferMediaTo(e,t)}handleInPlaceStall(e){const t=this.schedule,s=this.primaryMedia;if(!t||!s)return;const i=s.currentTime,r=t.findAssetIndex(e,i),a=e.assetList[r];if(a){const o=this.getAssetPlayer(a.identifier);if(o){const l=o.currentTime||i-a.timelineStart,u=o.duration-l;if(this.warn(`Stalled at ${l} of ${l+u} in ${o} ${e} (media.currentTime: ${i})`),l&&(u/s.playbackRate<.5||o.bufferedInPlaceToEnd(s))&&o.hls){const c=t.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,c,r)}}}}advanceInPlace(e){const t=this.primaryMedia;t&&t.currentTime<e&&(t.currentTime=e)}handleAssetItemError(e,t,s,i,r){if(e.details===w.BUFFER_STALLED_ERROR)return;const a=t.assetList[i]||null;if(this.warn(`INTERSTITIAL_ASSET_ERROR ${a&&ms(a)} ${e.error}`),!this.schedule)return;const o=(a==null?void 0:a.identifier)||"",l=this.getAssetPlayerQueueIndex(o),u=this.playerQueue[l]||null,c=this.schedule.items,d=ue({},e,{fatal:!1,errorAction:Ms(!0),asset:a,assetListIndex:i,event:t,schedule:c,scheduleIndex:s,player:u});if(this.hls.trigger(v.INTERSTITIAL_ASSET_ERROR,d),!e.fatal)return;const h=this.playingAsset,f=this.bufferingAsset,g=new Error(r);if(a&&(this.clearAssetPlayer(o,null),a.error=g),!t.assetList.some(p=>!p.error))t.error=g;else for(let p=i;p<t.assetList.length;p++)this.resetAssetPlayer(t.assetList[p].identifier);this.updateSchedule(!0),t.error?this.primaryFallback(t):h&&h.identifier===o?this.advanceAfterAssetEnded(t,s,i):f&&f.identifier===o&&this.isInterstitial(this.bufferingItem)&&this.advanceAssetBuffering(this.bufferingItem,f)}primaryFallback(e){const t=e.timelineStart,s=this.effectivePlayingItem;let i=this.timelinePos;if(s){this.log(`Fallback to primary from event "${e.identifier}" start: ${t} pos: ${i} playing: ${Ct(s)} error: ${e.error}`),i===-1&&(i=this.hls.startPosition);const a=this.updateItem(s,i);this.itemsMatch(s,a)&&this.clearInterstitial(e,null),e.appendInPlace&&(this.attachPrimary(t,null),this.flushFrontBuffer(t))}else if(i===-1){this.checkStart();return}if(!this.schedule)return;const r=this.schedule.findItemIndexAtTime(i);this.setSchedulePosition(r)}onAssetListLoaded(e,t){var s,i;const r=t.event,a=r.identifier,o=t.assetListResponse.ASSETS;if(!((s=this.schedule)!=null&&s.hasEvent(a)))return;const l=r.timelineStart,u=r.duration;let c=0;o.forEach((p,E)=>{const y=parseFloat(p.DURATION);this.createAsset(r,E,c,l+c,y,p.URI),c+=y}),r.duration=c,this.log(`Loaded asset-list with duration: ${c} (was: ${u}) ${r}`);const d=this.waitingItem,h=(d==null?void 0:d.event.identifier)===a;this.updateSchedule();const f=(i=this.bufferingItem)==null?void 0:i.event;if(h){var g;const p=this.schedule.findEventIndex(a),E=(g=this.schedule.items)==null?void 0:g[p];if(E){if(!this.playingItem&&this.timelinePos>E.end&&this.schedule.findItemIndexAtTime(this.timelinePos)!==p){r.error=new Error(`Interstitial ${o.length?"no longer within playback range":"asset-list is empty"} ${this.timelinePos} ${r}`),this.log(r.error.message),this.updateSchedule(!0),this.primaryFallback(r);return}this.setBufferingItem(E)}this.setSchedulePosition(p)}else if((f==null?void 0:f.identifier)===a){const p=r.assetList[0];if(p){const E=this.getAssetPlayer(p.identifier);if(f.appendInPlace){const y=this.primaryMedia;E&&y&&this.bufferAssetPlayer(E,y)}else E&&E.loadSource()}}}onError(e,t){if(this.schedule)switch(t.details){case w.ASSET_LIST_PARSING_ERROR:case w.ASSET_LIST_LOAD_ERROR:case w.ASSET_LIST_LOAD_TIMEOUT:{const s=t.interstitial;s&&(this.updateSchedule(!0),this.primaryFallback(s));break}case w.BUFFER_STALLED_ERROR:{const s=this.endedItem||this.waitingItem||this.playingItem;if(this.isInterstitial(s)&&s.event.appendInPlace){this.handleInPlaceStall(s.event);return}this.log(`Primary player stall @${this.timelinePos} bufferedPos: ${this.bufferedPos}`),this.onTimeupdate(),this.checkBuffer(!0);break}}}}const Yh=500;class UT extends mc{constructor(e,t,s){super(e,t,s,"subtitle-stream-controller",H.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(v.LEVEL_LOADED,this.onLevelLoaded,this),e.on(v.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(v.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(v.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(v.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(v.BUFFER_FLUSHING,this.onBufferFlushing,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(v.LEVEL_LOADED,this.onLevelLoaded,this),e.off(v.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(v.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(v.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(v.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(v.BUFFER_FLUSHING,this.onBufferFlushing,this)}startLoad(e,t){this.stopLoad(),this.state=b.IDLE,this.setInterval(Yh),this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}onManifestLoading(){super.onManifestLoading(),this.mainDetails=null}onMediaDetaching(e,t){this.tracksBuffered=[],super.onMediaDetaching(e,t)}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:s,success:i}=t;if(this.fragContextChanged(s)||(Ie(s)&&(this.fragPrevious=s),this.state=b.IDLE),!i)return;const r=this.tracksBuffered[this.currentTrackId];if(!r)return;let a;const o=s.start;for(let u=0;u<r.length;u++)if(o>=r[u].start&&o<=r[u].end){a=r[u];break}const l=s.start+s.duration;a?a.end=l:(a={start:o,end:l},r.push(a)),this.fragmentTracker.fragBuffered(s),this.fragBufferedComplete(s,null),this.media&&this.tick()}onBufferFlushing(e,t){const{startOffset:s,endOffset:i}=t;if(s===0&&i!==Number.POSITIVE_INFINITY){const r=i-1;if(r<=0)return;t.endOffsetSubtitles=Math.max(0,r),this.tracksBuffered.forEach(a=>{for(let o=0;o<a.length;){if(a[o].end<=r){a.shift();continue}else if(a[o].start<r)a[o].start=r;else break;o++}}),this.fragmentTracker.removeFragmentsInRange(s,r,H.SUBTITLE)}}onError(e,t){const s=t.frag;(s==null?void 0:s.type)===H.SUBTITLE&&(t.details===w.FRAG_GAP&&this.fragmentTracker.fragBuffered(s,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==b.STOPPED&&(this.state=b.IDLE))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){if(this.levels&&_m(this.levels,t)){this.levels=t.map(s=>new Hi(s));return}this.tracksBuffered=[],this.levels=t.map(s=>{const i=new Hi(s);return this.tracksBuffered[i.id]=[],i}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,H.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(e,t){var s;if(this.currentTrackId=t.id,!((s=this.levels)!=null&&s.length)||this.currentTrackId===-1){this.clearInterval();return}const i=this.levels[this.currentTrackId];i!=null&&i.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,i&&this.state!==b.STOPPED&&this.setInterval(Yh)}onSubtitleTrackLoaded(e,t){var s;const{currentTrackId:i,levels:r}=this,{details:a,id:o}=t;if(!r){this.warn(`Subtitle tracks were reset while loading level ${o}`);return}const l=r[o];if(o>=r.length||!l)return;this.log(`Subtitle track ${o} loaded [${a.startSN},${a.endSN}]${a.lastPartSn?`[part-${a.lastPartSn}-${a.lastPartIndex}]`:""},duration:${a.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let u=0;if(a.live||(s=l.details)!=null&&s.live){if(a.deltaUpdateFailed)return;const d=this.mainDetails;if(!d){this.startFragRequested=!1;return}const h=d.fragments[0];if(!l.details)a.hasProgramDateTime&&d.hasProgramDateTime?(Pa(a,d),u=a.fragmentStart):h&&(u=h.start,Jl(a,u));else{var c;u=this.alignPlaylists(a,l.details,(c=this.levelLastLoaded)==null?void 0:c.details),u===0&&h&&(u=h.start,Jl(a,u))}d&&!this.startFragRequested&&this.setStartPosition(d,u)}l.details=a,this.levelLastLoaded=l,o===i&&(this.hls.trigger(v.SUBTITLE_TRACK_UPDATED,{details:a,id:o,groupId:t.groupId}),this.tick(),a.live&&!this.fragCurrent&&this.media&&this.state===b.IDLE&&(rs(null,a.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),l.details=void 0)))}_handleFragmentLoadComplete(e){const{frag:t,payload:s}=e,i=t.decryptdata,r=this.hls;if(!this.fragContextChanged(t)&&s&&s.byteLength>0&&i!=null&&i.key&&i.iv&&Fs(i.method)){const a=performance.now();this.decrypter.decrypt(new Uint8Array(s),i.key.buffer,i.iv.buffer,gc(i.method)).catch(o=>{throw r.trigger(v.ERROR,{type:Y.MEDIA_ERROR,details:w.FRAG_DECRYPT_ERROR,fatal:!1,error:o,reason:o.message,frag:t}),o}).then(o=>{const l=performance.now();r.trigger(v.FRAG_DECRYPTED,{frag:t,payload:o,stats:{tstart:a,tdecrypt:l}})}).catch(o=>{this.warn(`${o.name}: ${o.message}`),this.state=b.IDLE})}}doTick(){if(!this.media){this.state=b.IDLE;return}if(this.state===b.IDLE){const{currentTrackId:e,levels:t}=this,s=t==null?void 0:t[e];if(!s||!t.length||!s.details||this.waitForLive(s))return;const{config:i}=this,r=this.getLoadPosition(),a=X.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],r,i.maxBufferHole),{end:o,len:l}=a,u=s.details,c=this.hls.maxBufferLength+u.levelTargetDuration;if(l>c)return;const d=u.fragments,h=d.length,f=u.edge;let g=null;const p=this.fragPrevious;if(o<f){const m=i.maxFragLookUpTolerance,S=o>f-m?0:m;g=rs(p,d,Math.max(d[0].start,o),S),!g&&p&&p.start<d[0].start&&(g=d[0])}else g=d[h-1];if(g=this.filterReplacedPrimary(g,s.details),!g)return;const E=g.sn-u.startSN,y=d[E-1];if(y&&y.cc===g.cc&&this.fragmentTracker.getState(y)===we.NOT_LOADED&&(g=y),this.fragmentTracker.getState(g)===we.NOT_LOADED){const m=this.mapToInitFragWhenRequired(g);m&&this.loadFragment(m,s,o)}}}loadFragment(e,t,s){Ie(e)?super.loadFragment(e,t,s):this._loadInitSegment(e,t)}get mediaBufferTimeRanges(){return new $T(this.tracksBuffered[this.currentTrackId]||[])}}class $T{constructor(e){this.buffered=void 0;const t=(s,i,r)=>{if(i=i>>>0,i>r-1)throw new DOMException(`Failed to execute '${s}' on 'TimeRanges': The index provided (${i}) is greater than the maximum bound (${r})`);return e[i][s]};this.buffered={get length(){return e.length},end(s){return t("end",s,e.length)},start(s){return t("start",s,e.length)}}}}const jT={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},Km=n=>String.fromCharCode(jT[n]||n),kt=15,Jt=100,GT={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},KT={17:2,18:4,21:6,22:8,23:10,19:13,20:15},VT={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},HT={25:2,26:4,29:6,30:8,31:10,27:13,28:15},zT=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class WT{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const s=typeof t=="function"?t():t;oe.log(`${this.time} [${e}] ${s}`)}}}const Vn=function(e){const t=[];for(let s=0;s<e.length;s++)t.push(e[s].toString(16));return t};class Vm{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let s=0;s<t.length;s++){const i=t[s];e.hasOwnProperty(i)&&(this[i]=e[i])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class YT{constructor(){this.uchar=" ",this.penState=new Vm}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class qT{constructor(e){this.chars=[],this.pos=0,this.currPenState=new Vm,this.cueStartTime=null,this.logger=void 0;for(let t=0;t<Jt;t++)this.chars.push(new YT);this.logger=e}equals(e){for(let t=0;t<Jt;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}copy(e){for(let t=0;t<Jt;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<Jt;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>Jt&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=Jt)}moveCursor(e){const t=this.pos+e;if(e>1)for(let s=this.pos+1;s<t+1;s++)this.chars[s].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=Km(e);if(this.pos>=Jt){this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1)}clearFromPos(e){let t;for(t=e;t<Jt;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let s=0;s<Jt;s++){const i=this.chars[s].uchar;i!==" "&&(t=!1),e.push(i)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}class Vo{constructor(e){this.rows=[],this.currRow=kt-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let t=0;t<kt;t++)this.rows.push(new qT(e));this.logger=e}reset(){for(let e=0;e<kt;e++)this.rows[e].clear();this.currRow=kt-1}equals(e){let t=!0;for(let s=0;s<kt;s++)if(!this.rows[s].equals(e.rows[s])){t=!1;break}return t}copy(e){for(let t=0;t<kt;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<kt;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+de(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let o=0;o<kt;o++)this.rows[o].clear();const r=this.currRow+1-this.nrRollUpRows,a=this.lastOutputScreen;if(a){const o=a.rows[r].cueStartTime,l=this.logger.time;if(o!==null&&l!==null&&o<l)for(let u=0;u<this.nrRollUpRows;u++)this.rows[t-this.nrRollUpRows+u+1].copy(a.rows[r+u])}}this.currRow=t;const s=this.rows[this.currRow];if(e.indent!==null){const r=e.indent,a=Math.max(r-1,0);s.setCursor(e.indent),e.color=s.chars[a].penState.foreground}const i={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(i)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+de(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let s="",i=-1;for(let r=0;r<kt;r++){const a=this.rows[r].getTextString();a&&(i=r+1,e?t.push("Row "+i+": '"+a+"'"):t.push(a.trim()))}return t.length>0&&(e?s="["+t.join(" | ")+"]":s=t.join(`
`)),s}getTextAndFormat(){return this.rows}}class qh{constructor(e,t,s){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new Vo(s),this.nonDisplayedMemory=new Vo(s),this.lastOutputScreen=new Vo(s),this.currRollUpRow=this.displayedMemory.rows[kt-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=s}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[kt-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let s=0;s<e.length;s++)this.writeScreen.insertChar(e[s]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2===1,t.italics=e>=46,t.italics)t.foreground="white";else{const s=Math.floor(e/2)-16,i=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=i[s]}this.logger.log(2,"MIDROW: "+de(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){const t=this.logger.time;t!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=t:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class Qh{constructor(e,t,s){this.channels=void 0,this.currentChannel=0,this.cmdHistory=XT(),this.logger=void 0;const i=this.logger=new WT;this.channels=[null,new qh(e,t,i),new qh(e+1,s,i)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){this.logger.time=e;for(let s=0;s<t.length;s+=2){const i=t[s]&127,r=t[s+1]&127;let a=!1,o=null;if(i===0&&r===0)continue;this.logger.log(3,()=>"["+Vn([t[s],t[s+1]])+"] -> ("+Vn([i,r])+")");const l=this.cmdHistory;if(i>=16&&i<=31){if(QT(i,r,l)){kr(null,null,l),this.logger.log(3,()=>"Repeated command ("+Vn([i,r])+") is dropped");continue}kr(i,r,this.cmdHistory),a=this.parseCmd(i,r),a||(a=this.parseMidrow(i,r)),a||(a=this.parsePAC(i,r)),a||(a=this.parseBackgroundAttributes(i,r))}else kr(null,null,l);if(!a&&(o=this.parseChars(i,r),o)){const c=this.currentChannel;c&&c>0?this.channels[c].insertChars(o):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!a&&!o&&this.logger.log(2,()=>"Couldn't parse cleaned data "+Vn([i,r])+" orig: "+Vn([t[s],t[s+1]]))}}parseCmd(e,t){const s=(e===20||e===28||e===21||e===29)&&t>=32&&t<=47,i=(e===23||e===31)&&t>=33&&t<=35;if(!(s||i))return!1;const r=e===20||e===21||e===23?1:2,a=this.channels[r];return e===20||e===21||e===28||e===29?t===32?a.ccRCL():t===33?a.ccBS():t===34?a.ccAOF():t===35?a.ccAON():t===36?a.ccDER():t===37?a.ccRU(2):t===38?a.ccRU(3):t===39?a.ccRU(4):t===40?a.ccFON():t===41?a.ccRDC():t===42?a.ccTR():t===43?a.ccRTD():t===44?a.ccEDM():t===45?a.ccCR():t===46?a.ccENM():t===47&&a.ccEOC():a.ccTO(t-32),this.currentChannel=r,!0}parseMidrow(e,t){let s=0;if((e===17||e===25)&&t>=32&&t<=47){if(e===17?s=1:s=2,s!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const i=this.channels[s];return i?(i.ccMIDROW(t),this.logger.log(3,()=>"MIDROW ("+Vn([e,t])+")"),!0):!1}return!1}parsePAC(e,t){let s;const i=(e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127,r=(e===16||e===24)&&t>=64&&t<=95;if(!(i||r))return!1;const a=e<=23?1:2;t>=64&&t<=95?s=a===1?GT[e]:VT[e]:s=a===1?KT[e]:HT[e];const o=this.channels[a];return o?(o.setPAC(this.interpretPAC(s,t)),this.currentChannel=a,!0):!1}interpretPAC(e,t){let s;const i={color:null,italics:!1,indent:null,underline:!1,row:e};return t>95?s=t-96:s=t-64,i.underline=(s&1)===1,s<=13?i.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(s/2)]:s<=15?(i.italics=!0,i.color="white"):i.indent=Math.floor((s-16)/2)*4,i}parseChars(e,t){let s,i=null,r=null;if(e>=25?(s=2,r=e-8):(s=1,r=e),r>=17&&r<=19){let a;r===17?a=t+80:r===18?a=t+112:a=t+144,this.logger.log(2,()=>"Special char '"+Km(a)+"' in channel "+s),i=[a]}else e>=32&&e<=127&&(i=t===0?[e]:[e,t]);return i&&this.logger.log(3,()=>"Char codes =  "+Vn(i).join(",")),i}parseBackgroundAttributes(e,t){const s=(e===16||e===24)&&t>=32&&t<=47,i=(e===23||e===31)&&t>=45&&t<=47;if(!(s||i))return!1;let r;const a={};e===16||e===24?(r=Math.floor((t-32)/2),a.background=zT[r],t%2===1&&(a.background=a.background+"_semi")):t===45?a.background="transparent":(a.foreground="black",t===47&&(a.underline=!0));const o=e<=23?1:2;return this.channels[o].setBkgData(a),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}kr(null,null,this.cmdHistory)}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const s=this.channels[t];s&&s.cueSplitAtTime(e)}}}function kr(n,e,t){t.a=n,t.b=e}function QT(n,e,t){return t.a===n&&t.b===e}function XT(){return{a:null,b:null}}var Cc=function(){if(Da!=null&&Da.VTTCue)return self.VTTCue;const n=["","lr","rl"],e=["start","middle","end","left","right"];function t(o,l){if(typeof l!="string"||!Array.isArray(o))return!1;const u=l.toLowerCase();return~o.indexOf(u)?u:!1}function s(o){return t(n,o)}function i(o){return t(e,o)}function r(o,...l){let u=1;for(;u<arguments.length;u++){const c=arguments[u];for(const d in c)o[d]=c[d]}return o}function a(o,l,u){const c=this,d={enumerable:!0};c.hasBeenReset=!1;let h="",f=!1,g=o,p=l,E=u,y=null,m="",S=!0,T="auto",A="start",_=50,L="middle",R=50,C="middle";Object.defineProperty(c,"id",r({},d,{get:function(){return h},set:function(I){h=""+I}})),Object.defineProperty(c,"pauseOnExit",r({},d,{get:function(){return f},set:function(I){f=!!I}})),Object.defineProperty(c,"startTime",r({},d,{get:function(){return g},set:function(I){if(typeof I!="number")throw new TypeError("Start time must be set to a number.");g=I,this.hasBeenReset=!0}})),Object.defineProperty(c,"endTime",r({},d,{get:function(){return p},set:function(I){if(typeof I!="number")throw new TypeError("End time must be set to a number.");p=I,this.hasBeenReset=!0}})),Object.defineProperty(c,"text",r({},d,{get:function(){return E},set:function(I){E=""+I,this.hasBeenReset=!0}})),Object.defineProperty(c,"region",r({},d,{get:function(){return y},set:function(I){y=I,this.hasBeenReset=!0}})),Object.defineProperty(c,"vertical",r({},d,{get:function(){return m},set:function(I){const P=s(I);if(P===!1)throw new SyntaxError("An invalid or illegal string was specified.");m=P,this.hasBeenReset=!0}})),Object.defineProperty(c,"snapToLines",r({},d,{get:function(){return S},set:function(I){S=!!I,this.hasBeenReset=!0}})),Object.defineProperty(c,"line",r({},d,{get:function(){return T},set:function(I){if(typeof I!="number"&&I!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");T=I,this.hasBeenReset=!0}})),Object.defineProperty(c,"lineAlign",r({},d,{get:function(){return A},set:function(I){const P=i(I);if(!P)throw new SyntaxError("An invalid or illegal string was specified.");A=P,this.hasBeenReset=!0}})),Object.defineProperty(c,"position",r({},d,{get:function(){return _},set:function(I){if(I<0||I>100)throw new Error("Position must be between 0 and 100.");_=I,this.hasBeenReset=!0}})),Object.defineProperty(c,"positionAlign",r({},d,{get:function(){return L},set:function(I){const P=i(I);if(!P)throw new SyntaxError("An invalid or illegal string was specified.");L=P,this.hasBeenReset=!0}})),Object.defineProperty(c,"size",r({},d,{get:function(){return R},set:function(I){if(I<0||I>100)throw new Error("Size must be between 0 and 100.");R=I,this.hasBeenReset=!0}})),Object.defineProperty(c,"align",r({},d,{get:function(){return C},set:function(I){const P=i(I);if(!P)throw new SyntaxError("An invalid or illegal string was specified.");C=P,this.hasBeenReset=!0}})),c.displayState=void 0}return a.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},a}();class ZT{decode(e,t){if(!e)return"";if(typeof e!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function Hm(n){function e(s,i,r,a){return(s|0)*3600+(i|0)*60+(r|0)+parseFloat(a||0)}const t=n.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return t?parseFloat(t[2])>59?e(t[2],t[3],0,t[4]):e(t[1],t[2],t[3],t[4]):null}class JT{constructor(){this.values=Object.create(null)}set(e,t){!this.get(e)&&t!==""&&(this.values[e]=t)}get(e,t,s){return s?this.has(e)?this.values[e]:t[s]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,s){for(let i=0;i<s.length;++i)if(t===s[i]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const s=parseFloat(t);if(s>=0&&s<=100)return this.set(e,s),!0}return!1}}function zm(n,e,t,s){const i=s?n.split(s):[n];for(const r in i){if(typeof i[r]!="string")continue;const a=i[r].split(t);if(a.length!==2)continue;const o=a[0],l=a[1];e(o,l)}}const ou=new Cc(0,0,""),wr=ou.align==="middle"?"middle":"center";function eA(n,e,t){const s=n;function i(){const o=Hm(n);if(o===null)throw new Error("Malformed timestamp: "+s);return n=n.replace(/^[^\sa-zA-Z-]+/,""),o}function r(o,l){const u=new JT;zm(o,function(h,f){let g;switch(h){case"region":for(let p=t.length-1;p>=0;p--)if(t[p].id===f){u.set(h,t[p].region);break}break;case"vertical":u.alt(h,f,["rl","lr"]);break;case"line":g=f.split(","),u.integer(h,g[0]),u.percent(h,g[0])&&u.set("snapToLines",!1),u.alt(h,g[0],["auto"]),g.length===2&&u.alt("lineAlign",g[1],["start",wr,"end"]);break;case"position":g=f.split(","),u.percent(h,g[0]),g.length===2&&u.alt("positionAlign",g[1],["start",wr,"end","line-left","line-right","auto"]);break;case"size":u.percent(h,f);break;case"align":u.alt(h,f,["start",wr,"end","left","right"]);break}},/:/,/\s/),l.region=u.get("region",null),l.vertical=u.get("vertical","");let c=u.get("line","auto");c==="auto"&&ou.line===-1&&(c=-1),l.line=c,l.lineAlign=u.get("lineAlign","start"),l.snapToLines=u.get("snapToLines",!0),l.size=u.get("size",100),l.align=u.get("align",wr);let d=u.get("position","auto");d==="auto"&&ou.position===50&&(d=l.align==="start"||l.align==="left"?0:l.align==="end"||l.align==="right"?100:50),l.position=d}function a(){n=n.replace(/^\s+/,"")}if(a(),e.startTime=i(),a(),n.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+s);n=n.slice(3),a(),e.endTime=i(),a(),r(n,e)}function Wm(n){return n.replace(/<br(?: \/)?>/gi,`
`)}class tA{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new ZT,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));function s(){let r=t.buffer,a=0;for(r=Wm(r);a<r.length&&r[a]!=="\r"&&r[a]!==`
`;)++a;const o=r.slice(0,a);return r[a]==="\r"&&++a,r[a]===`
`&&++a,t.buffer=r.slice(a),o}function i(r){zm(r,function(a,o){},/:/)}try{let r="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;r=s();const o=r.match(/^()?WEBVTT([ \t].*)?$/);if(!(o!=null&&o[0]))throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let a=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(a?a=!1:r=s(),t.state){case"HEADER":/:/.test(r)?i(r):r||(t.state="ID");continue;case"NOTE":r||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(r)){t.state="NOTE";break}if(!r)continue;if(t.cue=new Cc(0,0,""),t.state="CUE",r.indexOf("-->")===-1){t.cue.id=r;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{eA(r,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const o=r.indexOf("-->")!==-1;if(!r||o&&(a=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=r}continue;case"BADCUE":r||(t.state="ID")}}}catch{t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||e.state==="HEADER")&&(e.buffer+=`

`,e.parse()),e.state==="INITIAL"||e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}const nA=/\r\n|\n\r|\n|\r/g,Ho=function(e,t,s=0){return e.slice(s,s+t.length)===t},sA=function(e){let t=parseInt(e.slice(-3));const s=parseInt(e.slice(-6,-4)),i=parseInt(e.slice(-9,-7)),r=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!j(t)||!j(s)||!j(i)||!j(r))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*s,t+=60*1e3*i,t+=60*60*1e3*r,t};function kc(n,e,t){return Ii(n.toString())+Ii(e.toString())+Ii(t)}const iA=function(e,t,s){let i=e[t],r=e[i.prevCC];if(!r||!r.new&&i.new){e.ccOffset=e.presentationOffset=i.start,i.new=!1;return}for(;(a=r)!=null&&a.new;){var a;e.ccOffset+=i.start-r.start,i.new=!1,i=r,r=e[i.prevCC]}e.presentationOffset=s};function rA(n,e,t,s,i,r,a){const o=new tA,l=ht(new Uint8Array(n)).trim().replace(nA,`
`).split(`
`),u=[],c=e?dS(e.baseTime,e.timescale):0;let d="00:00.000",h=0,f=0,g,p=!0;o.oncue=function(E){const y=t[s];let m=t.ccOffset;const S=(h-c)/9e4;if(y!=null&&y.new&&(f!==void 0?m=t.ccOffset=y.start:iA(t,s,S)),S){if(!e){g=new Error("Missing initPTS for VTT MPEGTS");return}m=S-t.presentationOffset}const T=E.endTime-E.startTime,A=ot((E.startTime+m-f)*9e4,i*9e4)/9e4;E.startTime=Math.max(A,0),E.endTime=Math.max(A+T,0);const _=E.text.trim();E.text=decodeURIComponent(encodeURIComponent(_)),E.id||(E.id=kc(E.startTime,E.endTime,_)),E.endTime>0&&u.push(E)},o.onparsingerror=function(E){g=E},o.onflush=function(){if(g){a(g);return}r(u)},l.forEach(E=>{if(p)if(Ho(E,"X-TIMESTAMP-MAP=")){p=!1,E.slice(16).split(",").forEach(y=>{Ho(y,"LOCAL:")?d=y.slice(6):Ho(y,"MPEGTS:")&&(h=parseInt(y.slice(7)))});try{f=sA(d)/1e3}catch(y){g=y}return}else E===""&&(p=!1);o.parse(E+`
`)}),o.flush()}const zo="stpp.ttml.im1t",Ym=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,qm=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,aA={left:"start",center:"center",right:"end",start:"start",end:"end"};function Xh(n,e,t,s){const i=ee(new Uint8Array(n),["mdat"]);if(i.length===0){s(new Error("Could not parse IMSC1 mdat"));return}const r=i.map(o=>ht(o)),a=cS(e.baseTime,1,e.timescale);try{r.forEach(o=>t(oA(o,a)))}catch(o){s(o)}}function oA(n,e){const i=new DOMParser().parseFromString(n,"text/xml").getElementsByTagName("tt")[0];if(!i)throw new Error("Invalid ttml");const r={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},a=Object.keys(r).reduce((d,h)=>(d[h]=i.getAttribute(`ttp:${h}`)||r[h],d),{}),o=i.getAttribute("xml:space")!=="preserve",l=Zh(Wo(i,"styling","style")),u=Zh(Wo(i,"layout","region")),c=Wo(i,"body","[begin]");return[].map.call(c,d=>{const h=Qm(d,o);if(!h||!d.hasAttribute("begin"))return null;const f=qo(d.getAttribute("begin"),a),g=qo(d.getAttribute("dur"),a);let p=qo(d.getAttribute("end"),a);if(f===null)throw Jh(d);if(p===null){if(g===null)throw Jh(d);p=f+g}const E=new Cc(f-e,p-e,h);E.id=kc(E.startTime,E.endTime,E.text);const y=u[d.getAttribute("region")],m=l[d.getAttribute("style")],S=lA(y,m,l),{textAlign:T}=S;if(T){const A=aA[T];A&&(E.lineAlign=A),E.align=T}return ue(E,S),E}).filter(d=>d!==null)}function Wo(n,e,t){const s=n.getElementsByTagName(e)[0];return s?[].slice.call(s.querySelectorAll(t)):[]}function Zh(n){return n.reduce((e,t)=>{const s=t.getAttribute("xml:id");return s&&(e[s]=t),e},{})}function Qm(n,e){return[].slice.call(n.childNodes).reduce((t,s,i)=>{var r;return s.nodeName==="br"&&i?t+`
`:(r=s.childNodes)!=null&&r.length?Qm(s,e):e?t+s.textContent.trim().replace(/\s+/g," "):t+s.textContent},"")}function lA(n,e,t){const s="http://www.w3.org/ns/ttml#styling";let i=null;const r=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],a=n!=null&&n.hasAttribute("style")?n.getAttribute("style"):null;return a&&t.hasOwnProperty(a)&&(i=t[a]),r.reduce((o,l)=>{const u=Yo(e,s,l)||Yo(n,s,l)||Yo(i,s,l);return u&&(o[l]=u),o},{})}function Yo(n,e,t){return n&&n.hasAttributeNS(e,t)?n.getAttributeNS(e,t):null}function Jh(n){return new Error(`Could not parse ttml timestamp ${n}`)}function qo(n,e){if(!n)return null;let t=Hm(n);return t===null&&(Ym.test(n)?t=uA(n,e):qm.test(n)&&(t=cA(n,e))),t}function uA(n,e){const t=Ym.exec(n),s=(t[4]|0)+(t[5]|0)/e.subFrameRate;return(t[1]|0)*3600+(t[2]|0)*60+(t[3]|0)+s/e.frameRate}function cA(n,e){const t=qm.exec(n),s=Number(t[1]);switch(t[2]){case"h":return s*3600;case"m":return s*60;case"ms":return s*1e3;case"f":return s/e.frameRate;case"t":return s/e.tickRate}return s}class Dr{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,s){(this.startTime===null||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=s,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}class dA{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=tf(),this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(v.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(v.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(v.MANIFEST_LOADING,this.onManifestLoading,this),e.on(v.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(v.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(v.FRAG_LOADING,this.onFragLoading,this),e.on(v.FRAG_LOADED,this.onFragLoaded,this),e.on(v.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(v.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(v.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(v.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(v.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(v.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(v.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(v.MANIFEST_LOADING,this.onManifestLoading,this),e.off(v.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(v.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(v.FRAG_LOADING,this.onFragLoading,this),e.off(v.FRAG_LOADED,this.onFragLoaded,this),e.off(v.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(v.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(v.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(v.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(v.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){const e=new Dr(this,"textTrack1"),t=new Dr(this,"textTrack2"),s=new Dr(this,"textTrack3"),i=new Dr(this,"textTrack4");this.cea608Parser1=new Qh(1,e,t),this.cea608Parser2=new Qh(3,s,i)}addCues(e,t,s,i,r){let a=!1;for(let o=r.length;o--;){const l=r[o],u=hA(l[0],l[1],t,s);if(u>=0&&(l[0]=Math.min(l[0],t),l[1]=Math.max(l[1],s),a=!0,u/(s-t)>.5))return}if(a||r.push([t,s]),this.config.renderTextTracksNatively){const o=this.captionsTracks[e];this.Cues.newCue(o,t,s,i)}else{const o=this.Cues.newCue(null,t,s,i);this.hls.trigger(v.CUES_PARSED,{type:"captions",cues:o,track:e})}}onInitPtsFound(e,{frag:t,id:s,initPTS:i,timescale:r,trackId:a}){const{unparsedVttFrags:o}=this;s===H.MAIN&&(this.initPTS[t.cc]={baseTime:i,timescale:r,trackId:a}),o.length&&(this.unparsedVttFrags=[],o.forEach(l=>{this.initPTS[l.frag.cc]?this.onFragLoaded(v.FRAG_LOADED,l):this.hls.trigger(v.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:l.frag,error:new Error("Subtitle discontinuity domain does not match main")})}))}getExistingTrack(e,t){const{media:s}=this;if(s)for(let i=0;i<s.textTracks.length;i++){const r=s.textTracks[i];if(ef(r,{name:e,lang:t,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return r}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:s,media:i}=this,{label:r,languageCode:a}=t[e],o=this.getExistingTrack(r,a);if(o)s[e]=o,ks(s[e]),$m(s[e],i);else{const l=this.createTextTrack("captions",r,a);l&&(l[e]=!0,s[e]=l)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const s=t.label,i={_id:e,label:s,kind:"captions",default:t.media?!!t.media.default:!1,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=i,this.hls.trigger(v.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[i]})}createTextTrack(e,t,s){const i=this.media;if(i)return i.addTextTrack(e,t,s)}onMediaAttaching(e,t){this.media=t.media,t.mediaSource||this._cleanTracks()}onMediaDetaching(e,t){const s=!!t.transferMedia;if(this.media=null,s)return;const{captionsTracks:i}=this;Object.keys(i).forEach(r=>{ks(i[r]),delete i[r]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=tf(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let s=0;s<t.length;s++)ks(t[s])}onSubtitleTracksUpdated(e,t){const s=t.subtitleTracks||[],i=s.some(r=>r.textCodec===zo);if(this.config.enableWebVTT||i&&this.config.enableIMSC1){if(_m(this.tracks,s)){this.tracks=s;return}if(this.textTracks=[],this.tracks=s,this.config.renderTextTracksNatively){const a=this.media,o=a?Zr(a.textTracks):null;if(this.tracks.forEach((l,u)=>{let c;if(o){let d=null;for(let h=0;h<o.length;h++)if(o[h]&&ef(o[h],l)){d=o[h],o[h]=null;break}d&&(c=d)}if(c)ks(c);else{const d=Xm(l);c=this.createTextTrack(d,l.name,l.lang),c&&(c.mode="disabled")}c&&this.textTracks.push(c)}),o!=null&&o.length){const l=o.filter(u=>u!==null).map(u=>u.label);l.length&&this.hls.logger.warn(`Media element contains unused subtitle tracks: ${l.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const a=this.tracks.map(o=>({label:o.name,kind:o.type.toLowerCase(),default:o.default,subtitleTrack:o}));this.hls.trigger(v.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:a})}}}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(s=>{const i=/(?:CC|SERVICE)([1-4])/.exec(s.instreamId);if(!i)return;const r=`textTrack${i[1]}`,a=this.captionsProperties[r];a&&(a.label=s.name,s.lang&&(a.languageCode=s.lang),a.media=s)})}closedCaptionsForLevel(e){const t=this.hls.levels[e.level];return t==null?void 0:t.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){if(this.enabled&&t.frag.type===H.MAIN){var s,i;const{cea608Parser1:r,cea608Parser2:a,lastSn:o}=this,{cc:l,sn:u}=t.frag,c=(s=(i=t.part)==null?void 0:i.index)!=null?s:-1;r&&a&&(u!==o+1||u===o&&c!==this.lastPartIndex+1||l!==this.lastCc)&&(r.reset(),a.reset()),this.lastCc=l,this.lastSn=u,this.lastPartIndex=c}}onFragLoaded(e,t){const{frag:s,payload:i}=t;if(s.type===H.SUBTITLE)if(i.byteLength){const r=s.decryptdata,a="stats"in t;if(r==null||!r.encrypted||a){const o=this.tracks[s.level],l=this.vttCCs;l[s.cc]||(l[s.cc]={start:s.start,prevCC:this.prevCC,new:!0},this.prevCC=s.cc),o&&o.textCodec===zo?this._parseIMSC1(s,i):this._parseVTTs(t)}}else this.hls.trigger(v.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:s,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const s=this.hls;Xh(t,this.initPTS[e.cc],i=>{this._appendCues(i,e.level),s.trigger(v.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},i=>{s.logger.log(`Failed to parse IMSC1: ${i}`),s.trigger(v.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:i})})}_parseVTTs(e){var t;const{frag:s,payload:i}=e,{initPTS:r,unparsedVttFrags:a}=this,o=r.length-1;if(!r[s.cc]&&o===-1){a.push(e);return}const l=this.hls,u=(t=s.initSegment)!=null&&t.data?Lt(s.initSegment.data,new Uint8Array(i)).buffer:i;rA(u,this.initPTS[s.cc],this.vttCCs,s.cc,s.start,c=>{this._appendCues(c,s.level),l.trigger(v.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:s})},c=>{const d=c.message==="Missing initPTS for VTT MPEGTS";d?a.push(e):this._fallbackToIMSC1(s,i),l.logger.log(`Failed to parse VTT cue: ${c}`),!(d&&o>s.cc)&&l.trigger(v.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:s,error:c})})}_fallbackToIMSC1(e,t){const s=this.tracks[e.level];s.textCodec||Xh(t,this.initPTS[e.cc],()=>{s.textCodec=zo,this._parseIMSC1(e,t)},()=>{s.textCodec="wvtt"})}_appendCues(e,t){const s=this.hls;if(this.config.renderTextTracksNatively){const i=this.textTracks[t];if(!i||i.mode==="disabled")return;e.forEach(r=>jm(i,r))}else{const i=this.tracks[t];if(!i)return;const r=i.default?"default":"subtitles"+t;s.trigger(v.CUES_PARSED,{type:"subtitles",cues:e,track:r})}}onFragDecrypted(e,t){const{frag:s}=t;s.type===H.SUBTITLE&&this.onFragLoaded(v.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){if(!this.enabled||!this.config.enableCEA708Captions)return;const{frag:s,samples:i}=t;if(!(s.type===H.MAIN&&this.closedCaptionsForLevel(s)==="NONE"))for(let r=0;r<i.length;r++){const a=i[r].bytes;if(a){this.cea608Parser1||this.initCea608Parsers();const o=this.extractCea608Data(a);this.cea608Parser1.addData(i[r].pts,o[0]),this.cea608Parser2.addData(i[r].pts,o[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:s,endOffsetSubtitles:i,type:r}){const{media:a}=this;if(!(!a||a.currentTime<s)){if(!r||r==="video"){const{captionsTracks:o}=this;Object.keys(o).forEach(l=>au(o[l],t,s))}if(this.config.renderTextTracksNatively&&t===0&&i!==void 0){const{textTracks:o}=this;Object.keys(o).forEach(l=>au(o[l],t,i))}}}extractCea608Data(e){const t=[[],[]],s=e[0]&31;let i=2;for(let r=0;r<s;r++){const a=e[i++],o=127&e[i++],l=127&e[i++];if(o===0&&l===0)continue;if((4&a)!==0){const c=3&a;(c===0||c===1)&&(t[c].push(o),t[c].push(l))}}return t}}function Xm(n){return n.characteristics&&/transcribes-spoken-dialog/gi.test(n.characteristics)&&/describes-music-and-sound/gi.test(n.characteristics)?"captions":"subtitles"}function ef(n,e){return!!n&&n.kind===Xm(e)&&nu(e,n)}function hA(n,e,t,s){return Math.min(e,s)-Math.max(n,t)}function tf(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}const fA=/\s/,gA={newCue(n,e,t,s){const i=[];let r,a,o,l,u;const c=self.VTTCue||self.TextTrackCue;for(let h=0;h<s.rows.length;h++)if(r=s.rows[h],o=!0,l=0,u="",!r.isEmpty()){var d;for(let p=0;p<r.chars.length;p++)fA.test(r.chars[p].uchar)&&o?l++:(u+=r.chars[p].uchar,o=!1);r.cueStartTime=e,e===t&&(t+=1e-4),l>=16?l--:l++;const f=Wm(u.trim()),g=kc(e,t,f);n!=null&&(d=n.cues)!=null&&d.getCueById(g)||(a=new c(e,t,f),a.id=g,a.line=h+1,a.align="left",a.position=10+Math.min(80,Math.floor(l*8/32)*10),i.push(a))}return n&&i.length&&(i.sort((h,f)=>h.line==="auto"||f.line==="auto"?0:h.line>8&&f.line>8?f.line-h.line:h.line-f.line),i.forEach(h=>jm(n,h))),i}};function pA(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}const mA=/(\d+)-(\d+)\/(\d+)/;class nf{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||xA,this.controller=new self.AbortController,this.stats=new oc}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,s){const i=this.stats;if(i.loading.start)throw new Error("Loader can only be used once.");i.loading.start=self.performance.now();const r=yA(e,this.controller.signal),a=e.responseType==="arraybuffer",o=a?"byteLength":"length",{maxTimeToFirstByteMs:l,maxLoadTimeMs:u}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=s,this.request=this.fetchSetup(e,r),self.clearTimeout(this.requestTimeout),t.timeout=l&&j(l)?l:u,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(i,e,this.response))},t.timeout),(Yi(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then(d=>{var h;this.response=this.loader=d;const f=Math.max(self.performance.now(),i.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=u,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(i,e,this.response))},u-(f-i.loading.start)),!d.ok){const{status:p,statusText:E}=d;throw new SA(E||"fetch, bad network response",p,d)}i.loading.first=f,i.total=EA(d.headers)||i.total;const g=(h=this.callbacks)==null?void 0:h.onProgress;return g&&j(t.highWaterMark)?this.loadProgressively(d,i,e,t.highWaterMark,g):a?d.arrayBuffer():e.responseType==="json"?d.json():d.text()}).then(d=>{var h,f;const g=this.response;if(!g)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),i.loading.end=Math.max(self.performance.now(),i.loading.first);const p=d[o];p&&(i.loaded=i.total=p);const E={url:g.url,data:d,code:g.status},y=(h=this.callbacks)==null?void 0:h.onProgress;y&&!j(t.highWaterMark)&&y(i,e,d,g),(f=this.callbacks)==null||f.onSuccess(E,i,e,g)}).catch(d=>{var h;if(self.clearTimeout(this.requestTimeout),i.aborted)return;const f=d&&d.code||0,g=d?d.message:null;(h=this.callbacks)==null||h.onError({code:f,text:g},e,d?d.details:null,i)})}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,s,i=0,r){const a=new om,o=e.body.getReader(),l=()=>o.read().then(u=>{if(u.done)return a.dataLength&&r(t,s,a.flush().buffer,e),Promise.resolve(new ArrayBuffer(0));const c=u.value,d=c.length;return t.loaded+=d,d<i||a.dataLength?(a.push(c),a.dataLength>=i&&r(t,s,a.flush().buffer,e)):r(t,s,c.buffer,e),l()}).catch(()=>Promise.reject());return l()}}function yA(n,e){const t={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(ue({},n.headers))};return n.rangeEnd&&t.headers.set("Range","bytes="+n.rangeStart+"-"+String(n.rangeEnd-1)),t}function vA(n){const e=mA.exec(n);if(e)return parseInt(e[2])-parseInt(e[1])+1}function EA(n){const e=n.get("Content-Range");if(e){const s=vA(e);if(j(s))return s}const t=n.get("Content-Length");if(t)return parseInt(t)}function xA(n,e){return new self.Request(n.url,e)}class SA extends Error{constructor(e,t,s){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=s}}const TA=/^age:\s*[\d.]+\s*$/im;class Zm{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new oc,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,s){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=s,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e||!t)return;const s=this.loader=new self.XMLHttpRequest,i=this.stats;i.loading.first=0,i.loaded=0,i.aborted=!1;const r=this.xhrSetup;r?Promise.resolve().then(()=>{if(!(this.loader!==s||this.stats.aborted))return r(s,t.url)}).catch(a=>{if(!(this.loader!==s||this.stats.aborted))return s.open("GET",t.url,!0),r(s,t.url)}).then(()=>{this.loader!==s||this.stats.aborted||this.openAndSendXhr(s,t,e)}).catch(a=>{var o;(o=this.callbacks)==null||o.onError({code:s.status,text:a.message},t,s,i)}):this.openAndSendXhr(s,t,e)}openAndSendXhr(e,t,s){e.readyState||e.open("GET",t.url,!0);const i=t.headers,{maxTimeToFirstByteMs:r,maxLoadTimeMs:a}=s.loadPolicy;if(i)for(const o in i)e.setRequestHeader(o,i[o]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),s.timeout=r&&j(r)?r:a,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),s.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:s}=this;if(!e||!t)return;const i=t.readyState,r=this.config;if(!s.aborted&&i>=2&&(s.loading.first===0&&(s.loading.first=Math.max(self.performance.now(),s.loading.start),r.timeout!==r.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),r.timeout=r.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),r.loadPolicy.maxLoadTimeMs-(s.loading.first-s.loading.start)))),i===4)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const u=t.status,c=t.responseType==="text"?t.responseText:null;if(u>=200&&u<300){const g=c??t.response;if(g!=null){var a,o;s.loading.end=Math.max(self.performance.now(),s.loading.first);const p=t.responseType==="arraybuffer"?g.byteLength:g.length;s.loaded=s.total=p,s.bwEstimate=s.total*8e3/(s.loading.end-s.loading.first);const E=(a=this.callbacks)==null?void 0:a.onProgress;E&&E(s,e,g,t);const y={url:t.responseURL,data:g,code:u};(o=this.callbacks)==null||o.onSuccess(y,s,e,t);return}}const d=r.loadPolicy.errorRetry,h=s.retry,f={url:e.url,data:void 0,code:u};if(ka(d,h,!1,f))this.retry(d);else{var l;oe.error(`${u} while loading ${e.url}`),(l=this.callbacks)==null||l.onError({code:u,text:t.statusText},e,t,s)}}}loadtimeout(){if(!this.config)return;const e=this.config.loadPolicy.timeoutRetry,t=this.stats.retry;if(ka(e,t,!0))this.retry(e);else{var s;oe.warn(`timeout while loading ${(s=this.context)==null?void 0:s.url}`);const i=this.callbacks;i&&(this.abortInternal(),i.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:s}=this;this.retryDelay=dc(e,s.retry),s.retry++,oe.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${t==null?void 0:t.url}, retrying ${s.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&TA.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}const AA={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},LA=ae(ae({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,startOnSegmentBoundary:!1,maxBufferSize:60*1e3*1e3,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncMode:"edge",liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:Zm,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:ME,bufferController:RS,capLevelController:Ic,errorController:jE,fpsController:_T,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:Qp,requireKeySystemAccessOnStart:!1,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,preserveManualLevelOnError:!1,certLoadPolicy:{default:AA},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},IA()),{},{subtitleStreamController:UT,subtitleTrackController:wT,timelineController:dA,audioStreamController:TS,audioTrackController:AS,emeController:Bs,cmcdController:AT,contentSteeringController:IT,interstitialsController:BT});function IA(){return{cueHandler:gA,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function RA(n,e,t){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(e.liveMaxLatencyDurationCount!==void 0&&(e.liveSyncDurationCount===void 0||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(e.liveMaxLatencyDuration!==void 0&&(e.liveSyncDuration===void 0||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const s=lu(n),i=["manifest","level","frag"],r=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return i.forEach(a=>{const o=`${a==="level"?"playlist":a}LoadPolicy`,l=e[o]===void 0,u=[];r.forEach(c=>{const d=`${a}Loading${c}`,h=e[d];if(h!==void 0&&l){u.push(d);const f=s[o].default;switch(e[o]={default:f},c){case"TimeOut":f.maxLoadTimeMs=h,f.maxTimeToFirstByteMs=h;break;case"MaxRetry":f.errorRetry.maxNumRetry=h,f.timeoutRetry.maxNumRetry=h;break;case"RetryDelay":f.errorRetry.retryDelayMs=h,f.timeoutRetry.retryDelayMs=h;break;case"MaxRetryTimeout":f.errorRetry.maxRetryDelayMs=h,f.timeoutRetry.maxRetryDelayMs=h;break}}}),u.length&&t.warn(`hls.js config: "${u.join('", "')}" setting(s) are deprecated, use "${o}": ${de(e[o])}`)}),ae(ae({},s),e)}function lu(n){return n&&typeof n=="object"?Array.isArray(n)?n.map(lu):Object.keys(n).reduce((e,t)=>(e[t]=lu(n[t]),e),{}):n}function _A(n,e){const t=n.loader;t!==nf&&t!==Zm?(e.log("[config]: Custom loader detected, cannot enable progressive streaming"),n.progressive=!1):pA()&&(n.loader=nf,n.progressive=!0,n.enableSoftwareAES=!0,e.log("[config]: Progressive streaming enabled, using FetchLoader"))}const Jr=2,CA=.1,kA=.05,wA=100;class DA extends Hp{constructor(e,t){super("gap-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.media=null,this.mediaSource=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.buffered={},this.lastCurrentTime=0,this.ended=0,this.waiting=0,this.onMediaPlaying=()=>{this.ended=0,this.waiting=0},this.onMediaWaiting=()=>{var s;(s=this.media)!=null&&s.seeking||(this.waiting=self.performance.now(),this.tick())},this.onMediaEnded=()=>{if(this.hls){var s;this.ended=((s=this.media)==null?void 0:s.currentTime)||1,this.hls.trigger(v.MEDIA_ENDED,{stalled:!1})}},this.hls=e,this.fragmentTracker=t,this.registerListeners()}registerListeners(){const{hls:e}=this;e&&(e.on(v.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(v.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(v.BUFFER_APPENDED,this.onBufferAppended,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(v.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(v.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(v.BUFFER_APPENDED,this.onBufferAppended,this))}destroy(){super.destroy(),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0}onMediaAttached(e,t){this.setInterval(wA),this.mediaSource=t.mediaSource;const s=this.media=t.media;Ye(s,"playing",this.onMediaPlaying),Ye(s,"waiting",this.onMediaWaiting),Ye(s,"ended",this.onMediaEnded)}onMediaDetaching(e,t){this.clearInterval();const{media:s}=this;s&&(tt(s,"playing",this.onMediaPlaying),tt(s,"waiting",this.onMediaWaiting),tt(s,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0}onBufferAppended(e,t){this.buffered=t.timeRanges}get hasBuffered(){return Object.keys(this.buffered).length>0}tick(){var e;if(!((e=this.media)!=null&&e.readyState)||!this.hasBuffered)return;const t=this.media.currentTime;this.poll(t,this.lastCurrentTime),this.lastCurrentTime=t}poll(e,t){var s,i;const r=(s=this.hls)==null?void 0:s.config;if(!r)return;const a=this.media;if(!a)return;const{seeking:o}=a,l=this.seeking&&!o,u=!this.seeking&&o,c=a.paused&&!o||a.ended||a.playbackRate===0;if(this.seeking=o,e!==t){t&&(this.ended=0),this.moved=!0,o||(this.nudgeRetry=0,r.nudgeOnVideoHole&&!c&&e>t&&this.nudgeOnVideoHole(e,t)),this.waiting===0&&this.stallResolved(e);return}if(u||l){l&&this.stallResolved(e);return}if(c){this.nudgeRetry=0,this.stallResolved(e),!this.ended&&a.ended&&this.hls&&(this.ended=e||1,this.hls.trigger(v.MEDIA_ENDED,{stalled:!1}));return}if(!X.getBuffered(a).length){this.nudgeRetry=0;return}const d=X.bufferInfo(a,e,0),h=d.nextStart||0,f=this.fragmentTracker;if(o&&f&&this.hls){const _=sf(this.hls.inFlightFragments,e),L=d.len>Jr,R=!h||_||h-e>Jr&&!f.getPartialFragment(e);if(L||R)return;this.moved=!1}const g=(i=this.hls)==null?void 0:i.latestLevelDetails;if(!this.moved&&this.stalled!==null&&f){if(!(d.len>0)&&!h)return;const L=Math.max(h,d.start||0)-e,C=!!(g!=null&&g.live)?g.targetduration*2:Jr,I=Pr(e,f);if(L>0&&(L<=C||I)){a.paused||this._trySkipBufferHole(I);return}}const p=r.detectStallWithCurrentTimeMs,E=self.performance.now(),y=this.waiting;let m=this.stalled;if(m===null)if(y>0&&E-y<p)m=this.stalled=y;else{this.stalled=E;return}const S=E-m;if(!o&&(S>=p||y)&&this.hls){var T;if(((T=this.mediaSource)==null?void 0:T.readyState)==="ended"&&!(g!=null&&g.live)&&Math.abs(e-((g==null?void 0:g.edge)||0))<1){if(this.ended)return;this.ended=e||1,this.hls.trigger(v.MEDIA_ENDED,{stalled:!0});return}if(this._reportStall(d),!this.media||!this.hls)return}const A=X.bufferInfo(a,e,r.maxBufferHole);this._tryFixBufferStall(A,S,e)}stallResolved(e){const t=this.stalled;if(t&&this.hls&&(this.stalled=null,this.stallReported)){const s=self.performance.now()-t;this.log(`playback not stuck anymore @${e}, after ${Math.round(s)}ms`),this.stallReported=!1,this.waiting=0,this.hls.trigger(v.STALL_RESOLVED,{})}}nudgeOnVideoHole(e,t){var s;const i=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&(s=this.buffered.audio)!=null&&s.length&&i&&i.length>1&&e>i.end(0)){const r=X.bufferedInfo(X.timeRangesToArray(this.buffered.audio),e,0);if(r.len>1&&t>=r.start){const a=X.timeRangesToArray(i),o=X.bufferedInfo(a,t,0).bufferedIndex;if(o>-1&&o<a.length-1){const l=X.bufferedInfo(a,e,0).bufferedIndex,u=a[o].end,c=a[o+1].start;if((l===-1||l>o)&&c-u<1&&e-u<2){const d=new Error(`nudging playhead to flush pipeline after video hole. currentTime: ${e} hole: ${u} -> ${c} buffered index: ${l}`);this.warn(d.message),this.media.currentTime+=1e-6;let h=Pr(e,this.fragmentTracker);h&&"fragment"in h?h=h.fragment:h||(h=void 0);const f=X.bufferInfo(this.media,e,0);this.hls.trigger(v.ERROR,{type:Y.MEDIA_ERROR,details:w.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:d,reason:d.message,frag:h,buffer:f.len,bufferInfo:f})}}}}}_tryFixBufferStall(e,t,s){var i,r;const{fragmentTracker:a,media:o}=this,l=(i=this.hls)==null?void 0:i.config;if(!o||!a||!l)return;const u=(r=this.hls)==null?void 0:r.latestLevelDetails,c=Pr(s,a);if((c||u!=null&&u.live&&s<u.fragmentStart)&&(this._trySkipBufferHole(c)||!this.media))return;const d=e.buffered,h=this.adjacentTraversal(e,s);(d&&d.length>1&&e.len>l.maxBufferHole||e.nextStart&&(e.nextStart-s<l.maxBufferHole||h))&&(t>l.highBufferWatchdogPeriod*1e3||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(e))}adjacentTraversal(e,t){const s=this.fragmentTracker,i=e.nextStart;if(s&&i){const r=s.getFragAtPos(t,H.MAIN),a=s.getFragAtPos(i,H.MAIN);if(r&&a)return a.sn-r.sn<2}return!1}_reportStall(e){const{hls:t,media:s,stallReported:i,stalled:r}=this;if(!i&&r!==null&&s&&t){this.stallReported=!0;const a=new Error(`Playback stalling at @${s.currentTime} due to low buffer (${de(e)})`);this.warn(a.message),t.trigger(v.ERROR,{type:Y.MEDIA_ERROR,details:w.BUFFER_STALLED_ERROR,fatal:!1,error:a,buffer:e.len,bufferInfo:e,stalled:{start:r}})}}_trySkipBufferHole(e){var t;const{fragmentTracker:s,media:i}=this,r=(t=this.hls)==null?void 0:t.config;if(!i||!s||!r)return 0;const a=i.currentTime,o=X.bufferInfo(i,a,0),l=a<o.start?o.start:o.nextStart;if(l&&this.hls){const c=o.len<=r.maxBufferHole,d=o.len>0&&o.len<1&&i.readyState<3,h=l-a;if(h>0&&(c||d)){if(h>r.maxBufferHole){let g=!1;if(a===0){const p=s.getAppendedFrag(0,H.MAIN);p&&l<p.end&&(g=!0)}if(!g&&e){var u;if(!((u=this.hls.loadLevelObj)!=null&&u.details)||sf(this.hls.inFlightFragments,l))return 0;let E=!1,y=e.end;for(;y<l;){const m=Pr(y,s);if(m)y+=m.duration;else{E=!0;break}}if(E)return 0}}const f=Math.max(l+kA,a+CA);if(this.warn(`skipping hole, adjusting currentTime from ${a} to ${f}`),this.moved=!0,i.currentTime=f,!(e!=null&&e.gap)){const g=new Error(`fragment loaded with buffer holes, seeking from ${a} to ${f}`),p={type:Y.MEDIA_ERROR,details:w.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:g,reason:g.message,buffer:o.len,bufferInfo:o};e&&("fragment"in e?p.part=e:p.frag=e),this.hls.trigger(v.ERROR,p)}return f}}return 0}_tryNudgeBuffer(e){const{hls:t,media:s,nudgeRetry:i}=this,r=t==null?void 0:t.config;if(!s||!r)return 0;const a=s.currentTime;if(this.nudgeRetry++,i<r.nudgeMaxRetry){const o=a+(i+1)*r.nudgeOffset,l=new Error(`Nudging 'currentTime' from ${a} to ${o}`);this.warn(l.message),s.currentTime=o,t.trigger(v.ERROR,{type:Y.MEDIA_ERROR,details:w.BUFFER_NUDGE_ON_STALL,error:l,fatal:!1,buffer:e.len,bufferInfo:e})}else{const o=new Error(`Playhead still not moving while enough data buffered @${a} after ${r.nudgeMaxRetry} nudges`);this.error(o.message),t.trigger(v.ERROR,{type:Y.MEDIA_ERROR,details:w.BUFFER_STALLED_ERROR,error:o,fatal:!0,buffer:e.len,bufferInfo:e})}}}function sf(n,e){const t=rf(n.main);if(t&&t.start<=e)return t;const s=rf(n.audio);return s&&s.start<=e?s:null}function rf(n){if(!n)return null;switch(n.state){case b.IDLE:case b.STOPPED:case b.ENDED:case b.ERROR:return null}return n.frag}function Pr(n,e){return e.getAppendedFrag(n,H.MAIN)||e.getPartialFragment(n)}const PA=.25;function uu(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function Qo(n,e,t,s,i){let r=new n(e,t,"");try{r.value=s,i&&(r.type=i)}catch{r=new n(e,t,de(i?ae({type:i},s):s))}return r}const br=(()=>{const n=uu();try{n&&new n(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();class bA{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.assetCue=void 0,this.onEventCueEnter=()=>{this.hls&&this.hls.trigger(v.EVENT_CUE_ENTER,{})},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null}_registerListeners(){const{hls:e}=this;e&&(e.on(v.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(v.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(v.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(v.MANIFEST_LOADING,this.onManifestLoading,this),e.on(v.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(v.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(v.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(v.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(v.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(v.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(v.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(v.MANIFEST_LOADING,this.onManifestLoading,this),e.off(v.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(v.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(v.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(v.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}onMediaAttaching(e,t){var s;this.media=t.media,((s=t.overrides)==null?void 0:s.cueRemoval)===!1&&(this.removeCues=!1)}onMediaAttached(){var e;const t=(e=this.hls)==null?void 0:e.latestLevelDetails;t&&this.updateDateRangeCues(t)}onMediaDetaching(e,t){this.media=null,!t.transferMedia&&(this.id3Track&&(this.removeCues&&ks(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){const s=e[t];if(s.kind==="metadata"&&s.label==="id3")return $m(s,this.media),s}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media||!this.hls)return;const{enableEmsgMetadataCues:s,enableID3MetadataCues:i}=this.hls.config;if(!s&&!i)return;const{samples:r}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const a=uu();if(a)for(let o=0;o<r.length;o++){const l=r[o].type;if(l===ut.emsg&&!s||!i)continue;const u=gm(r[o].data),c=r[o].pts;let d=c+r[o].duration;d>br&&(d=br),d-c<=0&&(d=c+PA);for(let f=0;f<u.length;f++){const g=u[f];if(!pm(g)){this.updateId3CueEnds(c,l);const p=Qo(a,c,d,g,l);p&&this.id3Track.addCue(p)}}}}updateId3CueEnds(e,t){var s;const i=(s=this.id3Track)==null?void 0:s.cues;if(i)for(let r=i.length;r--;){const a=i[r];a.type===t&&a.startTime<e&&a.endTime===br&&(a.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:s,type:i}){const{id3Track:r,hls:a}=this;if(!a)return;const{config:{enableEmsgMetadataCues:o,enableID3MetadataCues:l}}=a;if(r&&(o||l)){let u;i==="audio"?u=c=>c.type===ut.audioId3&&l:i==="video"?u=c=>c.type===ut.emsg&&o:u=c=>c.type===ut.audioId3&&l||c.type===ut.emsg&&o,au(r,t,s,u)}}onLevelUpdated(e,{details:t}){this.updateDateRangeCues(t,!0)}onLevelPtsUpdated(e,t){Math.abs(t.drift)>.01&&this.updateDateRangeCues(t.details)}updateDateRangeCues(e,t){if(!this.hls||!this.media)return;const{assetPlayerId:s,timelineOffset:i,enableDateRangeMetadataCues:r,interstitialsController:a}=this.hls.config;if(!r)return;const o=uu();if(s&&i&&!a){const{fragmentStart:p,fragmentEnd:E}=e;let y=this.assetCue;y?(y.startTime=p,y.endTime=E):o&&(y=this.assetCue=Qo(o,p,E,{assetPlayerId:this.hls.config.assetPlayerId},"hlsjs.interstitial.asset"),y&&(y.id=s,this.id3Track||(this.id3Track=this.createTrack(this.media)),this.id3Track.addCue(y),y.addEventListener("enter",this.onEventCueEnter)))}if(!e.hasProgramDateTime)return;const{id3Track:l}=this,{dateRanges:u}=e,c=Object.keys(u);let d=this.dateRangeCuesAppended;if(l&&t){var h;if((h=l.cues)!=null&&h.length){const p=Object.keys(d).filter(E=>!c.includes(E));for(let E=p.length;E--;){var f;const y=p[E],m=(f=d[y])==null?void 0:f.cues;delete d[y],m&&Object.keys(m).forEach(S=>{const T=m[S];if(T){T.removeEventListener("enter",this.onEventCueEnter);try{l.removeCue(T)}catch{}}})}}else d=this.dateRangeCuesAppended={}}const g=e.fragments[e.fragments.length-1];if(!(c.length===0||!j(g==null?void 0:g.programDateTime))){this.id3Track||(this.id3Track=this.createTrack(this.media));for(let p=0;p<c.length;p++){const E=c[p],y=u[E],m=y.startTime,S=d[E],T=(S==null?void 0:S.cues)||{};let A=(S==null?void 0:S.durationKnown)||!1,_=br;const{duration:L,endDate:R}=y;if(R&&L!==null)_=m+L,A=!0;else if(y.endOnNext&&!A){const I=c.reduce((P,$)=>{if($!==y.id){const G=u[$];if(G.class===y.class&&G.startDate>y.startDate&&(!P||y.startDate<P.startDate))return G}return P},null);I&&(_=I.startTime,A=!0)}const C=Object.keys(y.attr);for(let I=0;I<C.length;I++){const P=C[I];if(!ex(P))continue;const $=T[P];if($)A&&!(S!=null&&S.durationKnown)?$.endTime=_:Math.abs($.startTime-m)>.01&&($.startTime=m,$.endTime=_);else if(o){let G=y.attr[P];tx(P)&&(G=Ip(G));const K=Qo(o,m,_,{key:P,data:G},ut.dateRange);K&&(K.id=E,this.id3Track.addCue(K),T[P]=K,a&&(P==="X-ASSET-LIST"||P==="X-ASSET-URL")&&K.addEventListener("enter",this.onEventCueEnter))}}d[E]={cues:T,dateRange:y,durationKnown:A}}}}}class NA{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=()=>{const{media:t}=this,s=this.levelDetails;if(!t||!s)return;this.currentTime=t.currentTime;const i=this.computeLatency();if(i===null)return;this._latency=i;const{lowLatencyMode:r,maxLiveSyncPlaybackRate:a}=this.config;if(!r||a===1||!s.live)return;const o=this.targetLatency;if(o===null)return;const l=i-o,u=Math.min(this.maxLatency,o+s.targetduration);if(l<u&&l>.05&&this.forwardBufferLength>1){const d=Math.min(2,Math.max(1,a)),h=Math.round(2/(1+Math.exp(-.75*l-this.edgeStalled))*20)/20,f=Math.min(d,Math.max(1,h));this.changeMediaPlaybackRate(t,f)}else t.playbackRate!==1&&t.playbackRate!==0&&this.changeMediaPlaybackRate(t,1)},this.hls=e,this.config=e.config,this.registerListeners()}get levelDetails(){var e;return((e=this.hls)==null?void 0:e.latestLevelDetails)||null}get latency(){return this._latency||0}get maxLatency(){const{config:e}=this;if(e.liveMaxLatencyDuration!==void 0)return e.liveMaxLatencyDuration;const t=this.levelDetails;return t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const e=this.levelDetails;if(e===null||this.hls===null)return null;const{holdBack:t,partHoldBack:s,targetduration:i}=e,{liveSyncDuration:r,liveSyncDurationCount:a,lowLatencyMode:o}=this.config,l=this.hls.userConfig;let u=o&&s||t;(this._targetLatencyUpdated||l.liveSyncDuration||l.liveSyncDurationCount||u===0)&&(u=r!==void 0?r:a*i);const c=i;return u+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,c)}set targetLatency(e){this.stallCount=0,this.config.liveSyncDuration=e,this._targetLatencyUpdated=!0}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency;if(e===null||t===null)return null;const s=this.levelDetails;if(s===null)return null;const i=s.edge,r=e-t-this.edgeStalled,a=i-s.totalduration,o=i-(this.config.lowLatencyMode&&s.partTarget||s.targetduration);return Math.min(Math.max(a,r),o)}get drift(){const e=this.levelDetails;return e===null?1:e.drift}get edgeStalled(){const e=this.levelDetails;if(e===null)return 0;const t=(this.config.lowLatencyMode&&e.partTarget||e.targetduration)*3;return Math.max(e.age-t,0)}get forwardBufferLength(){const{media:e}=this,t=this.levelDetails;if(!e||!t)return 0;const s=e.buffered.length;return(s?e.buffered.end(s-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null}registerListeners(){const{hls:e}=this;e&&(e.on(v.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(v.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(v.MANIFEST_LOADING,this.onManifestLoading,this),e.on(v.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(v.ERROR,this.onError,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(v.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(v.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(v.MANIFEST_LOADING,this.onManifestLoading,this),e.off(v.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(v.ERROR,this.onError,this))}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.onTimeupdate)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)}onManifestLoading(){this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){t.advanced&&this.onTimeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)}onError(e,t){var s;t.details===w.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&(s=this.levelDetails)!=null&&s.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))}changeMediaPlaybackRate(e,t){var s,i;e.playbackRate!==t&&((s=this.hls)==null||s.logger.debug(`[latency-controller]: latency=${this.latency.toFixed(3)}, targetLatency=${(i=this.targetLatency)==null?void 0:i.toFixed(3)}, forwardBufferLength=${this.forwardBufferLength.toFixed(3)}: adjusting playback rate from ${e.playbackRate} to ${t}`),e.playbackRate=t)}estimateLiveEdge(){const e=this.levelDetails;return e===null?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return e===null?null:e-this.currentTime}}class OA extends Lc{constructor(e,t){super(e,"level-controller"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(v.MANIFEST_LOADING,this.onManifestLoading,this),e.on(v.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(v.LEVEL_LOADED,this.onLevelLoaded,this),e.on(v.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(v.FRAG_BUFFERED,this.onFragBuffered,this),e.on(v.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(v.MANIFEST_LOADING,this.onManifestLoading,this),e.off(v.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(v.LEVEL_LOADED,this.onLevelLoaded,this),e.off(v.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(v.FRAG_BUFFERED,this.onFragBuffered,this),e.off(v.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(t=>{t.loadError=0,t.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const s=this.hls.config.preferManagedMediaSource,i=[],r={},a={};let o=!1,l=!1,u=!1;t.levels.forEach(c=>{const d=c.attrs;let{audioCodec:h,videoCodec:f}=c;h&&(c.audioCodec=h=Ia(h,s)||void 0),f&&(f=c.videoCodec=yE(f));const{width:g,height:p,unknownCodecs:E}=c,y=(E==null?void 0:E.length)||0;if(o||(o=!!(g&&p)),l||(l=!!f),u||(u=!!h),y||h&&!this.isAudioSupported(h)||f&&!this.isVideoSupported(f)){this.log(`Some or all CODECS not supported "${d.CODECS}"`);return}const{CODECS:m,"FRAME-RATE":S,"HDCP-LEVEL":T,"PATHWAY-ID":A,RESOLUTION:_,"VIDEO-RANGE":L}=d,C=`${`${A||"."}-`}${c.bitrate}-${_}-${S}-${m}-${L}-${T}`;if(r[C])if(r[C].uri!==c.url&&!c.attrs["PATHWAY-ID"]){const I=a[C]+=1;c.attrs["PATHWAY-ID"]=new Array(I+1).join(".");const P=this.createLevel(c);r[C]=P,i.push(P)}else r[C].addGroupId("audio",d.AUDIO),r[C].addGroupId("text",d.SUBTITLES);else{const I=this.createLevel(c);r[C]=I,a[C]=1,i.push(I)}}),this.filterAndSortMediaOptions(i,t,o,l,u)}createLevel(e){const t=new Hi(e),s=e.supplemental;if(s!=null&&s.videoCodec&&!this.isVideoSupported(s.videoCodec)){const i=new Error(`SUPPLEMENTAL-CODECS not supported "${s.videoCodec}"`);this.log(i.message),t.supportedResult=Fp(i,[])}return t}isAudioSupported(e){return Ki(e,"audio",this.hls.config.preferManagedMediaSource)}isVideoSupported(e){return Ki(e,"video",this.hls.config.preferManagedMediaSource)}filterAndSortMediaOptions(e,t,s,i,r){var a;let o=[],l=[],u=e;const c=((a=t.stats)==null?void 0:a.parsing)||{};if((s||i)&&r&&(u=u.filter(({videoCodec:m,videoRange:S,width:T,height:A})=>(!!m||!!(T&&A))&&_E(S))),u.length===0){Promise.resolve().then(()=>{if(this.hls){let m="no level with compatible codecs found in manifest",S=m;t.levels.length&&(S=`one or more CODECS in variant not supported: ${de(t.levels.map(A=>A.attrs.CODECS).filter((A,_,L)=>L.indexOf(A)===_))}`,this.warn(S),m+=` (${S})`);const T=new Error(m);this.hls.trigger(v.ERROR,{type:Y.MEDIA_ERROR,details:w.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:T,reason:S})}}),c.end=performance.now();return}t.audioTracks&&(o=t.audioTracks.filter(m=>!m.audioCodec||this.isAudioSupported(m.audioCodec)),af(o)),t.subtitles&&(l=t.subtitles,af(l));const d=u.slice(0);u.sort((m,S)=>{if(m.attrs["HDCP-LEVEL"]!==S.attrs["HDCP-LEVEL"])return(m.attrs["HDCP-LEVEL"]||"")>(S.attrs["HDCP-LEVEL"]||"")?1:-1;if(s&&m.height!==S.height)return m.height-S.height;if(m.frameRate!==S.frameRate)return m.frameRate-S.frameRate;if(m.videoRange!==S.videoRange)return Ra.indexOf(m.videoRange)-Ra.indexOf(S.videoRange);if(m.videoCodec!==S.videoCodec){const T=Qd(m.videoCodec),A=Qd(S.videoCodec);if(T!==A)return A-T}if(m.uri===S.uri&&m.codecSet!==S.codecSet){const T=La(m.codecSet),A=La(S.codecSet);if(T!==A)return A-T}return m.averageBitrate!==S.averageBitrate?m.averageBitrate-S.averageBitrate:0});let h=d[0];if(this.steering&&(u=this.steering.filterParsedLevels(u),u.length!==d.length)){for(let m=0;m<d.length;m++)if(d[m].pathwayId===u[0].pathwayId){h=d[m];break}}this._levels=u;for(let m=0;m<u.length;m++)if(u[m]===h){var f;this._firstLevel=m;const S=h.bitrate,T=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${u.length} level(s) found, first bitrate: ${S}`),((f=this.hls.userConfig)==null?void 0:f.abrEwmaDefaultEstimate)===void 0){const A=Math.min(S,this.hls.config.abrEwmaDefaultEstimateMax);A>T&&T===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=A)}break}const g=r&&!i,p=this.hls.config,E=!!(p.audioStreamController&&p.audioTrackController),y={levels:u,audioTracks:o,subtitleTracks:l,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:r,video:i,altAudio:E&&!g&&o.some(m=>!!m.url)};c.end=performance.now(),this.hls.trigger(v.MANIFEST_PARSED,y)}get levels(){return this._levels.length===0?null:this._levels}get loadLevelObj(){return this.currentLevel}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(t.length===0)return;if(e<0||e>=t.length){const c=new Error("invalid level idx"),d=e<0;if(this.hls.trigger(v.ERROR,{type:Y.OTHER_ERROR,details:w.LEVEL_SWITCH_ERROR,level:e,fatal:d,error:c,reason:c.message}),d)return;e=Math.min(e,t.length-1)}const s=this.currentLevelIndex,i=this.currentLevel,r=i?i.attrs["PATHWAY-ID"]:void 0,a=t[e],o=a.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=a,s===e&&i&&r===o)return;this.log(`Switching to level ${e} (${a.height?a.height+"p ":""}${a.videoRange?a.videoRange+" ":""}${a.codecSet?a.codecSet+" ":""}@${a.bitrate})${o?" with Pathway "+o:""} from level ${s}${r?" with Pathway "+r:""}`);const l={level:e,attrs:a.attrs,details:a.details,bitrate:a.bitrate,averageBitrate:a.averageBitrate,maxBitrate:a.maxBitrate,realBitrate:a.realBitrate,width:a.width,height:a.height,codecSet:a.codecSet,audioCodec:a.audioCodec,videoCodec:a.videoCodec,audioGroups:a.audioGroups,subtitleGroups:a.subtitleGroups,loaded:a.loaded,loadError:a.loadError,fragmentError:a.fragmentError,name:a.name,id:a.id,uri:a.uri,url:a.url,urlId:0,audioGroupIds:a.audioGroupIds,textGroupIds:a.textGroupIds};this.hls.trigger(v.LEVEL_SWITCHING,l);const u=a.details;if(!u||u.live){const c=this.switchParams(a.uri,i==null?void 0:i.details,u);this.loadPlaylist(c)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(this._startLevel===void 0){const e=this.hls.config.startLevel;return e!==void 0?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}get pathways(){return this.steering?this.steering.pathways():[]}get pathwayPriority(){return this.steering?this.steering.pathwayPriority:null}set pathwayPriority(e){if(this.steering){const t=this.steering.pathways(),s=e.filter(i=>t.indexOf(i)!==-1);if(e.length<1){this.warn(`pathwayPriority ${e} should contain at least one pathway from list: ${t}`);return}this.steering.pathwayPriority=s}}onError(e,t){t.fatal||!t.context||t.context.type===ne.LEVEL&&t.context.level===this.level&&this.checkRetry(t)}onFragBuffered(e,{frag:t}){if(t!==void 0&&t.type===H.MAIN){const s=t.elementaryStreams;if(!Object.keys(s).some(r=>!!s[r]))return;const i=this._levels[t.level];i!=null&&i.loadError&&(this.log(`Resetting level error count of ${i.loadError} on frag buffered`),i.loadError=0)}}onLevelLoaded(e,t){var s;const{level:i,details:r}=t,a=t.levelInfo;if(!a){var o;this.warn(`Invalid level index ${i}`),(o=t.deliveryDirectives)!=null&&o.skip&&(r.deltaUpdateFailed=!0);return}if(a===this.currentLevel||t.withoutMultiVariant){a.fragmentError===0&&(a.loadError=0);let l=a.details;l===t.details&&l.advanced&&(l=void 0),this.playlistLoaded(i,t,l)}else(s=t.deliveryDirectives)!=null&&s.skip&&(r.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const s=this.getUrlWithDirectives(e.uri,t),i=this.currentLevelIndex,r=e.attrs["PATHWAY-ID"],a=e.details,o=a==null?void 0:a.age;this.log(`Loading level index ${i}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${r?" Pathway "+r:""}${o&&a.live?" age "+o.toFixed(1)+(a.type&&" "+a.type||""):""} ${s}`),this.hls.trigger(v.LEVEL_LOADING,{url:s,level:i,levelInfo:e,pathwayId:e.attrs["PATHWAY-ID"],id:0,deliveryDirectives:t||null})}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}removeLevel(e){var t;if(this._levels.length===1)return;const s=this._levels.filter((r,a)=>a!==e?!0:(this.steering&&this.steering.removeLevel(r),r===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,r.details&&r.details.fragments.forEach(o=>o.level=-1)),!1));im(s),this._levels=s,this.currentLevelIndex>-1&&(t=this.currentLevel)!=null&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);const i=s.length-1;this._firstLevel=Math.min(this._firstLevel,i),this._startLevel&&(this._startLevel=Math.min(this._startLevel,i)),this.hls.trigger(v.LEVELS_UPDATED,{levels:s})}onLevelsUpdated(e,{levels:t}){this._levels=t}checkMaxAutoUpdated(){const{autoLevelCapping:e,maxAutoLevel:t,maxHdcpLevel:s}=this.hls;this._maxAutoLevel!==t&&(this._maxAutoLevel=t,this.hls.trigger(v.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:t,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:s}))}}function af(n){const e={};n.forEach(t=>{const s=t.groupId||"";t.id=e[s]=e[s]||0,e[s]++})}function Jm(){return self.SourceBuffer||self.WebKitSourceBuffer}function e0(){if(!On())return!1;const e=Jm();return!e||e.prototype&&typeof e.prototype.appendBuffer=="function"&&typeof e.prototype.remove=="function"}function MA(){if(!e0())return!1;const n=On();return typeof(n==null?void 0:n.isTypeSupported)=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(e=>n.isTypeSupported(Vi(e,"video")))||["mp4a.40.2","fLaC"].some(e=>n.isTypeSupported(Vi(e,"audio"))))}function FA(){var n;const e=Jm();return typeof(e==null||(n=e.prototype)==null?void 0:n.changeType)=="function"}const BA=100;class UA extends mc{constructor(e,t,s){super(e,t,s,"stream-controller",H.MAIN),this.audioCodecSwap=!1,this.level=-1,this._forceStartLoad=!1,this._hasEnoughToStart=!1,this.altAudio=0,this.audioOnly=!1,this.fragPlaying=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this.onMediaPlaying=()=>{this.tick()},this.onMediaSeeked=()=>{const i=this.media,r=i?i.currentTime:null;if(r===null||!j(r)||(this.log(`Media seeked to ${r.toFixed(3)}`),!this.getBufferedFrag(r)))return;const a=this.getFwdBufferInfoAtPos(i,r,H.MAIN,0);if(a===null||a.len===0){this.warn(`Main forward buffer length at ${r} on "seeked" event ${a?a.len:"empty"})`);return}this.tick()},this.registerListeners()}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(v.MANIFEST_PARSED,this.onManifestParsed,this),e.on(v.LEVEL_LOADING,this.onLevelLoading,this),e.on(v.LEVEL_LOADED,this.onLevelLoaded,this),e.on(v.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(v.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(v.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(v.BUFFER_CREATED,this.onBufferCreated,this),e.on(v.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(v.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(v.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(v.MANIFEST_PARSED,this.onManifestParsed,this),e.off(v.LEVEL_LOADED,this.onLevelLoaded,this),e.off(v.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(v.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(v.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(v.BUFFER_CREATED,this.onBufferCreated,this),e.off(v.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(v.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(v.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),super.onHandlerDestroying()}startLoad(e,t){if(this.levels){const{lastCurrentTime:s,hls:i}=this;if(this.stopLoad(),this.setInterval(BA),this.level=-1,!this.startFragRequested){let r=i.startLevel;r===-1&&(i.config.testBandwidth&&this.levels.length>1?(r=0,this.bitrateTest=!0):r=i.firstAutoLevel),i.nextLoadLevel=r,this.level=i.loadLevel,this._hasEnoughToStart=!!t}s>0&&e===-1&&!t&&(this.log(`Override startPosition with lastCurrentTime @${s.toFixed(3)}`),e=s),this.state=b.IDLE,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}else this._forceStartLoad=!0,this.state=b.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case b.WAITING_LEVEL:{const{levels:e,level:t}=this,s=e==null?void 0:e[t],i=s==null?void 0:s.details;if(i&&(!i.live||this.levelLastLoaded===s&&!this.waitForLive(s))){if(this.waitForCdnTuneIn(i))break;this.state=b.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=b.IDLE;break}break}case b.FRAG_LOADING_WAITING_RETRY:this.checkRetryDate();break}this.state===b.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){var e;super.onTickEnd(),(e=this.media)!=null&&e.readyState&&this.media.seeking===!1&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:s,media:i}=this;if(t===null||!i&&!this.primaryPrefetch&&(this.startFragRequested||!e.config.startFragPrefetch)||this.altAudio&&this.audioOnly)return;const r=this.buffering?e.nextLoadLevel:e.loadLevel;if(!(s!=null&&s[r]))return;const a=s[r],o=this.getMainFwdBufferInfo();if(o===null)return;const l=this.getLevelDetails();if(l&&this._streamEnded(o,l)){const p={};this.altAudio===2&&(p.type="video"),this.hls.trigger(v.BUFFER_EOS,p),this.state=b.ENDED;return}if(!this.buffering)return;e.loadLevel!==r&&e.manualLevel===-1&&this.log(`Adapting to level ${r} from level ${this.level}`),this.level=e.nextLoadLevel=r;const u=a.details;if(!u||this.state===b.WAITING_LEVEL||this.waitForLive(a)){this.level=r,this.state=b.WAITING_LEVEL,this.startFragRequested=!1;return}const c=o.len,d=this.getMaxBufferLength(a.maxBitrate);if(c>=d)return;this.backtrackFragment&&this.backtrackFragment.start>o.end&&(this.backtrackFragment=null);const h=this.backtrackFragment?this.backtrackFragment.start:o.end;let f=this.getNextFragment(h,u);if(this.couldBacktrack&&!this.fragPrevious&&f&&Ie(f)&&this.fragmentTracker.getState(f)!==we.OK){var g;const E=((g=this.backtrackFragment)!=null?g:f).sn-u.startSN,y=u.fragments[E-1];y&&f.cc===y.cc&&(f=y,this.fragmentTracker.removeFragment(y))}else this.backtrackFragment&&o.len&&(this.backtrackFragment=null);if(f&&this.isLoopLoading(f,h)){if(!f.gap){const E=this.audioOnly&&!this.altAudio?ce.AUDIO:ce.VIDEO,y=(E===ce.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;y&&this.afterBufferFlushed(y,E,H.MAIN)}f=this.getNextFragmentLoopLoading(f,u,o,H.MAIN,d)}f&&(f.initSegment&&!f.initSegment.data&&!this.bitrateTest&&(f=f.initSegment),this.loadFragment(f,a,h))}loadFragment(e,t,s){const i=this.fragmentTracker.getState(e);i===we.NOT_LOADED||i===we.PARTIAL?Ie(e)?this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):super.loadFragment(e,t,s):this._loadInitSegment(e,t):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,H.MAIN)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(t!=null&&t.readyState){let s;const i=this.getAppendedFrag(t.currentTime);i&&i.start>1&&this.flushMainBuffer(0,i.start-1);const r=this.getLevelDetails();if(r!=null&&r.live){const o=this.getMainFwdBufferInfo();if(!o||o.len<r.targetduration*2)return}if(!t.paused&&e){const o=this.hls.nextLoadLevel,l=e[o],u=this.fragLastKbps;u&&this.fragCurrent?s=this.fragCurrent.duration*l.maxBitrate/(1e3*u)+1:s=0}else s=0;const a=this.getBufferedFrag(t.currentTime+s);if(a){const o=this.followingBufferedFrag(a);if(o){this.abortCurrentFrag();const l=o.maxStartPTS?o.maxStartPTS:o.start,u=o.duration,c=Math.max(a.end,l+Math.min(Math.max(u-this.config.maxFragLookUpTolerance,u*(this.couldBacktrack?.5:.125)),u*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(c,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case b.KEY_LOADING:case b.FRAG_LOADING:case b.FRAG_LOADING_WAITING_RETRY:case b.PARSING:case b.PARSED:this.state=b.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,this.altAudio===2?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const s=t.media;Ye(s,"playing",this.onMediaPlaying),Ye(s,"seeked",this.onMediaSeeked)}onMediaDetaching(e,t){const{media:s}=this;s&&(tt(s,"playing",this.onMediaPlaying),tt(s,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,super.onMediaDetaching(e,t),!t.transferMedia&&(this._hasEnoughToStart=!1)}onManifestLoading(){super.onManifestLoading(),this.log("Trigger BUFFER_RESET"),this.hls.trigger(v.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1}onManifestParsed(e,t){let s=!1,i=!1;for(let r=0;r<t.levels.length;r++){const a=t.levels[r].audioCodec;a&&(s=s||a.indexOf("mp4a.40.2")!==-1,i=i||a.indexOf("mp4a.40.5")!==-1)}this.audioCodecSwitch=s&&i&&!FA(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:s}=this;if(!s||this.state!==b.IDLE)return;const i=t.levelInfo;(!i.details||i.details.live&&(this.levelLastLoaded!==i||i.details.expired)||this.waitForCdnTuneIn(i.details))&&(this.state=b.WAITING_LEVEL)}onLevelLoaded(e,t){var s;const{levels:i,startFragRequested:r}=this,a=t.level,o=t.details,l=o.totalduration;if(!i){this.warn(`Levels were reset while loading level ${a}`);return}this.log(`Level ${a} loaded [${o.startSN},${o.endSN}]${o.lastPartSn?`[part-${o.lastPartSn}-${o.lastPartIndex}]`:""}, cc [${o.startCC}, ${o.endCC}] duration:${l}`);const u=t.levelInfo,c=this.fragCurrent;c&&(this.state===b.FRAG_LOADING||this.state===b.FRAG_LOADING_WAITING_RETRY)&&c.level!==t.level&&c.loader&&this.abortCurrentFrag();let d=0;if(o.live||(s=u.details)!=null&&s.live){var h;if(this.checkLiveUpdate(o),o.deltaUpdateFailed)return;d=this.alignPlaylists(o,u.details,(h=this.levelLastLoaded)==null?void 0:h.details)}if(u.details=o,this.levelLastLoaded=u,r||this.setStartPosition(o,d),this.hls.trigger(v.LEVEL_UPDATED,{details:o,level:a}),this.state===b.WAITING_LEVEL){if(this.waitForCdnTuneIn(o))return;this.state=b.IDLE}r&&o.live&&this.synchronizeToLiveEdge(o),this.tick()}synchronizeToLiveEdge(e){const{config:t,media:s}=this;if(!s)return;const i=this.hls.liveSyncPosition,r=this.getLoadPosition(),a=e.fragmentStart,o=e.edge,l=r>=a-t.maxFragLookUpTolerance&&r<=o;if(i!==null&&s.duration>i&&(r<i||!l)){const c=t.liveMaxLatencyDuration!==void 0?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;if((!l&&s.readyState<4||r<o-c)&&(this._hasEnoughToStart||(this.nextLoadPosition=i),s.readyState))if(this.warn(`Playback: ${r.toFixed(3)} is located too far from the end of live sliding playlist: ${o}, reset currentTime to : ${i.toFixed(3)}`),this.config.liveSyncMode==="buffered"){var u;const d=X.bufferInfo(s,i,0);if(!((u=d.buffered)!=null&&u.length)){s.currentTime=i;return}if(d.start<=r){s.currentTime=i;return}const{nextStart:f}=X.bufferedInfo(d.buffered,r,0);f&&(s.currentTime=f)}else s.currentTime=i}}_handleFragmentLoadProgress(e){var t;const s=e.frag,{part:i,payload:r}=e,{levels:a}=this;if(!a){this.warn(`Levels were reset while fragment load was in progress. Fragment ${s.sn} of level ${s.level} will not be buffered`);return}const o=a[s.level];if(!o){this.warn(`Level ${s.level} not found on progress`);return}const l=o.details;if(!l){this.warn(`Dropping fragment ${s.sn} of level ${s.level} after level details were reset`),this.fragmentTracker.removeFragment(s);return}const u=o.videoCodec,c=l.PTSKnown||!l.live,d=(t=s.initSegment)==null?void 0:t.data,h=this._getAudioCodec(o),f=this.transmuxer=this.transmuxer||new Rm(this.hls,H.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),g=i?i.index:-1,p=g!==-1,E=new fc(s.level,s.sn,s.stats.chunkCount,r.byteLength,g,p),y=this.initPTS[s.cc];f.push(r,d,h,u,s,i,l.totalduration,c,E,y)}onAudioTrackSwitching(e,t){const s=this.hls,i=this.altAudio!==0;if(_a(t.url,s))this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const a=this.fragCurrent;a&&(this.log("Switching to main audio track, cancel main fragment load"),a.abortRequests(),this.fragmentTracker.removeFragment(a)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(i){this.altAudio=0,this.fragmentTracker.removeAllFragments(),s.once(v.BUFFER_FLUSHED,()=>{this.hls&&this.hls.trigger(v.AUDIO_TRACK_SWITCHED,t)}),s.trigger(v.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});return}s.trigger(v.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const s=_a(t.url,this.hls);if(s){const i=this.videoBuffer;i&&this.mediaBuffer!==i&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=i)}this.altAudio=s?2:0,this.tick()}onBufferCreated(e,t){const s=t.tracks;let i,r,a=!1;for(const o in s){const l=s[o];if(l.id==="main"){if(r=o,i=l,o==="video"){const u=s[o];u&&(this.videoBuffer=u.buffer)}}else a=!0}a&&i?(this.log(`Alternate track found, use ${r}.buffered to schedule main fragment loading`),this.mediaBuffer=i.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:s,part:i}=t,r=s.type===H.MAIN;if(r){if(this.fragContextChanged(s)){this.warn(`Fragment ${s.sn}${i?" p: "+i.index:""} of level ${s.level} finished buffering, but was aborted. state: ${this.state}`),this.state===b.PARSED&&(this.state=b.IDLE);return}const o=i?i.stats:s.stats;this.fragLastKbps=Math.round(8*o.total/(o.buffering.end-o.loading.first)),Ie(s)&&(this.fragPrevious=s),this.fragBufferedComplete(s,i)}const a=this.media;a&&(!this._hasEnoughToStart&&X.getBuffered(a).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),r&&this.tick())}get hasEnoughToStart(){return this._hasEnoughToStart}onError(e,t){var s;if(t.fatal){this.state=b.ERROR;return}switch(t.details){case w.FRAG_GAP:case w.FRAG_PARSING_ERROR:case w.FRAG_DECRYPT_ERROR:case w.FRAG_LOAD_ERROR:case w.FRAG_LOAD_TIMEOUT:case w.KEY_LOAD_ERROR:case w.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(H.MAIN,t);break;case w.LEVEL_LOAD_ERROR:case w.LEVEL_LOAD_TIMEOUT:case w.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===b.WAITING_LEVEL&&((s=t.context)==null?void 0:s.type)===ne.LEVEL&&(this.state=b.IDLE);break;case w.BUFFER_ADD_CODEC_ERROR:case w.BUFFER_APPEND_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&this.resetLoadingState();break;case w.BUFFER_FULL_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&(!this.config.interstitialsController&&this.config.assetPlayerId?this._hasEnoughToStart=!0:this.flushMainBuffer(0,Number.POSITIVE_INFINITY));break;case w.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onFragLoadEmergencyAborted(){this.state=b.IDLE,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==ce.AUDIO||!this.altAudio){const s=(t===ce.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;s&&(this.afterBufferFlushed(s,t,H.MAIN),this.tick())}}onLevelsUpdated(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,this.level===-1&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let s=this.startPosition;if(s>=0&&t<s){if(e.seeking){this.log(`could not seek to ${s}, already seeking at ${t}`);return}const i=this.timelineOffset;i&&s&&(s+=i);const r=this.getLevelDetails(),a=X.getBuffered(e),o=a.length?a.start(0):0,l=o-s,u=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);(this.config.startOnSegmentBoundary||l>0&&(l<u||this.loadingParts&&l<2*((r==null?void 0:r.partTarget)||0)))&&(this.log(`adjusting start position by ${l} to match buffer start`),s+=l,this.startPosition=s),t<s&&(this.log(`seek to target start position ${s} from current time ${t} buffer start ${o}`),e.currentTime=s)}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t.indexOf("mp4a.40.5")!==-1?t="mp4a.40.2":t="mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(s=>{const{hls:i}=this,r=s==null?void 0:s.frag;if(!r||this.fragContextChanged(r))return;t.fragmentError=0,this.state=b.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const a=r.stats;a.parsing.start=a.parsing.end=a.buffering.start=a.buffering.end=self.performance.now(),i.trigger(v.FRAG_LOADED,s),r.bitrateTest=!1}).catch(s=>{this.state===b.STOPPED||this.state===b.ERROR||(this.warn(s),this.resetFragmentLoading(e))})}_handleTransmuxComplete(e){const t=this.playlistType,{hls:s}=this,{remuxResult:i,chunkMeta:r}=e,a=this.getCurrentContext(r);if(!a){this.resetWhenMissingContext(r);return}const{frag:o,part:l,level:u}=a,{video:c,text:d,id3:h,initSegment:f}=i,{details:g}=u,p=this.altAudio?void 0:i.audio;if(this.fragContextChanged(o)){this.fragmentTracker.removeFragment(o);return}if(this.state=b.PARSING,f){const E=f.tracks;if(E){const T=o.initSegment||o;if(this.unhandledEncryptionError(f,o))return;this._bufferInitSegment(u,E,T,r),s.trigger(v.FRAG_PARSING_INIT_SEGMENT,{frag:T,id:t,tracks:E})}const y=f.initPTS,m=f.timescale,S=this.initPTS[o.cc];if(j(y)&&(!S||S.baseTime!==y||S.timescale!==m)){const T=f.trackId;this.initPTS[o.cc]={baseTime:y,timescale:m,trackId:T},s.trigger(v.INIT_PTS_FOUND,{frag:o,id:t,initPTS:y,timescale:m,trackId:T})}}if(c&&g){p&&c.type==="audiovideo"&&this.logMuxedErr(o);const E=g.fragments[o.sn-1-g.startSN],y=o.sn===g.startSN,m=!E||o.cc>E.cc;if(i.independent!==!1){const{startPTS:S,endPTS:T,startDTS:A,endDTS:_}=c;if(l)l.elementaryStreams[c.type]={startPTS:S,endPTS:T,startDTS:A,endDTS:_};else if(c.firstKeyFrame&&c.independent&&r.id===1&&!m&&(this.couldBacktrack=!0),c.dropped&&c.independent){const L=this.getMainFwdBufferInfo(),R=(L?L.end:this.getLoadPosition())+this.config.maxBufferHole,C=c.firstKeyFramePTS?c.firstKeyFramePTS:S;if(!y&&R<C-this.config.maxBufferHole&&!m){this.backtrack(o);return}else m&&(o.gap=!0);o.setElementaryStreamInfo(c.type,o.start,T,o.start,_,!0)}else y&&S-(g.appliedTimelineOffset||0)>Jr&&(o.gap=!0);o.setElementaryStreamInfo(c.type,S,T,A,_),this.backtrackFragment&&(this.backtrackFragment=o),this.bufferFragmentData(c,o,l,r,y||m)}else if(y||m)o.gap=!0;else{this.backtrack(o);return}}if(p){const{startPTS:E,endPTS:y,startDTS:m,endDTS:S}=p;l&&(l.elementaryStreams[ce.AUDIO]={startPTS:E,endPTS:y,startDTS:m,endDTS:S}),o.setElementaryStreamInfo(ce.AUDIO,E,y,m,S),this.bufferFragmentData(p,o,l,r)}if(g&&h!=null&&h.samples.length){const E={id:t,frag:o,details:g,samples:h.samples};s.trigger(v.FRAG_PARSING_METADATA,E)}if(g&&d){const E={id:t,frag:o,details:g,samples:d.samples};s.trigger(v.FRAG_PARSING_USERDATA,E)}}logMuxedErr(e){this.warn(`${Ie(e)?"Media":"Init"} segment with muxed audiovideo where only video expected: ${e.url}`)}_bufferInitSegment(e,t,s,i){if(this.state!==b.PARSING)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&(delete t.audio,t.audiovideo&&this.logMuxedErr(s));const{audio:r,video:a,audiovideo:o}=t;if(r){const u=e.audioCodec;let c=zr(r.codec,u);c==="mp4a"&&(c="mp4a.40.5");const d=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){c&&(c.indexOf("mp4a.40.5")!==-1?c="mp4a.40.2":c="mp4a.40.5");const h=r.metadata;h&&"channelCount"in h&&(h.channelCount||1)!==1&&d.indexOf("firefox")===-1&&(c="mp4a.40.5")}c&&c.indexOf("mp4a.40.5")!==-1&&d.indexOf("android")!==-1&&r.container!=="audio/mpeg"&&(c="mp4a.40.2",this.log(`Android: force audio codec to ${c}`)),u&&u!==c&&this.log(`Swapping manifest audio codec "${u}" for "${c}"`),r.levelCodec=c,r.id=H.MAIN,this.log(`Init audio buffer, container:${r.container}, codecs[selected/level/parsed]=[${c||""}/${u||""}/${r.codec}]`),delete t.audiovideo}if(a){a.levelCodec=e.videoCodec,a.id=H.MAIN;const u=a.codec;if((u==null?void 0:u.length)===4)switch(u){case"hvc1":case"hev1":a.codec="hvc1.1.6.L120.90";break;case"av01":a.codec="av01.0.04M.08";break;case"avc1":a.codec="avc1.42e01e";break}this.log(`Init video buffer, container:${a.container}, codecs[level/parsed]=[${e.videoCodec||""}/${u}]${a.codec!==u?" parsed-corrected="+a.codec:""}${a.supplemental?" supplemental="+a.supplemental:""}`),delete t.audiovideo}o&&(this.log(`Init audiovideo buffer, container:${o.container}, codecs[level/parsed]=[${e.codecs}/${o.codec}]`),delete t.video,delete t.audio);const l=Object.keys(t);if(l.length){if(this.hls.trigger(v.BUFFER_CODECS,t),!this.hls)return;l.forEach(u=>{const d=t[u].initSegment;d!=null&&d.byteLength&&this.hls.trigger(v.BUFFER_APPENDING,{type:u,data:d,frag:s,part:null,chunkMeta:i,parent:s.type})})}this.tickImmediate()}getMainFwdBufferInfo(){const e=this.mediaBuffer&&this.altAudio===2?this.mediaBuffer:this.media;return this.getFwdBufferInfo(e,H.MAIN)}get maxBufferLength(){const{levels:e,level:t}=this,s=e==null?void 0:e[t];return s?this.getMaxBufferLength(s.maxBitrate):this.config.maxBufferLength}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=b.IDLE}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&e.seeking===!1){const s=e.currentTime;if(X.isBuffered(e,s)?t=this.getAppendedFrag(s):X.isBuffered(e,s+.1)&&(t=this.getAppendedFrag(s+.1)),t){this.backtrackFragment=null;const i=this.fragPlaying,r=t.level;(!i||t.sn!==i.sn||i.level!==r)&&(this.fragPlaying=t,this.hls.trigger(v.FRAG_CHANGED,{frag:t}),(!i||i.level!==r)&&this.hls.trigger(v.LEVEL_SWITCHED,{level:r}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){var e;if(this.fragPlaying)return this.fragPlaying;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;return j(t)?this.getAppendedFrag(t):null}get currentProgramDateTime(){var e;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;if(j(t)){const s=this.getLevelDetails(),i=this.currentFrag||(s?rs(null,s.fragments,t):null);if(i){const r=i.programDateTime;if(r!==null){const a=r+(t-i.start)*1e3;return new Date(a)}}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class $A extends It{constructor(e,t){super("key-loader",t),this.config=void 0,this.keyIdToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const s in this.keyIdToKeyInfo){const i=this.keyIdToKeyInfo[s].loader;if(i){var t;if(e&&e!==((t=i.context)==null?void 0:t.frag.type))return;i.abort()}}}detach(){for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyIdToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e].loader;t&&t.destroy()}this.keyIdToKeyInfo={}}createKeyLoadError(e,t=w.KEY_LOAD_ERROR,s,i,r){return new tn({type:Y.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:r,error:s,networkDetails:i})}loadClear(e,t,s){if(this.emeController&&this.config.emeEnabled&&!this.emeController.getSelectedKeySystemFormats().length){if(t.length)for(let i=0,r=t.length;i<r;i++){const a=t[i];if(e.cc<=a.cc&&(!Ie(e)||!Ie(a)||e.sn<a.sn)||!s&&i==r-1)return this.emeController.selectKeySystemFormat(a).then(o=>{if(!this.emeController)return;a.setKeyFormat(o);const l=Yr(o);if(l)return this.emeController.getKeySystemAccess([l])})}if(this.config.requireKeySystemAccessOnStart){const i=fi(this.config);if(i.length)return this.emeController.getKeySystemAccess(i)}}return null}load(e){return!e.decryptdata&&e.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(e).then(t=>this.loadInternal(e,t)):this.loadInternal(e)}loadInternal(e,t){var s,i;t&&e.setKeyFormat(t);const r=e.decryptdata;if(!r){const u=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:`Missing decryption data on fragment in onKeyLoading (emeEnabled with controller: ${this.emeController&&this.config.emeEnabled})`);return Promise.reject(this.createKeyLoadError(e,w.KEY_LOAD_ERROR,u))}const a=r.uri;if(!a)return Promise.reject(this.createKeyLoadError(e,w.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${a}"`)));const o=Xo(r);let l=this.keyIdToKeyInfo[o];if((s=l)!=null&&s.decryptdata.key)return r.key=l.decryptdata.key,Promise.resolve({frag:e,keyInfo:l});if(this.emeController&&(i=l)!=null&&i.keyLoadPromise)switch(this.emeController.getKeyStatus(l.decryptdata)){case"usable":case"usable-in-future":return l.keyLoadPromise.then(c=>{const{keyInfo:d}=c;return r.key=d.decryptdata.key,{frag:e,keyInfo:d}})}switch(this.log(`${this.keyIdToKeyInfo[o]?"Rel":"L"}oading${r.keyId?" keyId: "+Be(r.keyId):""} URI: ${r.uri} from ${e.type} ${e.level}`),l=this.keyIdToKeyInfo[o]={decryptdata:r,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},r.method){case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return r.keyFormat==="identity"?this.loadKeyHTTP(l,e):this.loadKeyEME(l,e);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(l,e);default:return Promise.reject(this.createKeyLoadError(e,w.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${r.method}"`)))}}loadKeyEME(e,t){const s={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){var i;if(!e.decryptdata.keyId&&(i=t.initSegment)!=null&&i.data){const a=rE(t.initSegment.data);if(a.length){let o=a[0];o.some(l=>l!==0)?(this.log(`Using keyId found in init segment ${Be(o)}`),Pn.setKeyIdForUri(e.decryptdata.uri,o)):(o=Pn.addKeyIdForUri(e.decryptdata.uri),this.log(`Generating keyId to patch media ${Be(o)}`)),e.decryptdata.keyId=o}}if(!e.decryptdata.keyId&&!Ie(t))return Promise.resolve(s);const r=this.emeController.loadKey(s);return(e.keyLoadPromise=r.then(a=>(e.mediaKeySessionContext=a,s))).catch(a=>{throw e.keyLoadPromise=null,"data"in a&&(a.data.frag=t),a})}return Promise.resolve(s)}loadKeyHTTP(e,t){const s=this.config,i=s.loader,r=new i(s);return t.keyLoader=e.loader=r,e.keyLoadPromise=new Promise((a,o)=>{const l={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},u=s.keyLoadPolicy.default,c={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},d={onSuccess:(h,f,g,p)=>{const{frag:E,keyInfo:y}=g,m=Xo(y.decryptdata);if(!E.decryptdata||y!==this.keyIdToKeyInfo[m])return o(this.createKeyLoadError(E,w.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),p));y.decryptdata.key=E.decryptdata.key=new Uint8Array(h.data),E.keyLoader=null,y.loader=null,a({frag:E,keyInfo:y})},onError:(h,f,g,p)=>{this.resetLoader(f),o(this.createKeyLoadError(t,w.KEY_LOAD_ERROR,new Error(`HTTP Error ${h.code} loading key ${h.text}`),g,ae({url:l.url,data:void 0},h)))},onTimeout:(h,f,g)=>{this.resetLoader(f),o(this.createKeyLoadError(t,w.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),g))},onAbort:(h,f,g)=>{this.resetLoader(f),o(this.createKeyLoadError(t,w.INTERNAL_ABORTED,new Error("key loading aborted"),g))}};r.load(l,c,d)})}resetLoader(e){const{frag:t,keyInfo:s,url:i}=e,r=s.loader;t.keyLoader===r&&(t.keyLoader=null,s.loader=null);const a=Xo(s.decryptdata)||i;delete this.keyIdToKeyInfo[a],r&&r.destroy()}}function Xo(n){if(n.keyFormat!==Ue.FAIRPLAY){const e=n.keyId;if(e)return Be(e)}return n.uri}function of(n){const{type:e}=n;switch(e){case ne.AUDIO_TRACK:return H.AUDIO;case ne.SUBTITLE_TRACK:return H.SUBTITLE;default:return H.MAIN}}function Zo(n,e){let t=n.url;return(t===void 0||t.indexOf("data:")===0)&&(t=e.url),t}class jA{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(v.MANIFEST_LOADING,this.onManifestLoading,this),e.on(v.LEVEL_LOADING,this.onLevelLoading,this),e.on(v.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(v.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.on(v.LEVELS_UPDATED,this.onLevelsUpdated,this)}unregisterListeners(){const{hls:e}=this;e.off(v.MANIFEST_LOADING,this.onManifestLoading,this),e.off(v.LEVEL_LOADING,this.onLevelLoading,this),e.off(v.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(v.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.off(v.LEVELS_UPDATED,this.onLevelsUpdated,this)}createInternalLoader(e){const t=this.hls.config,s=t.pLoader,i=t.loader,r=s||i,a=new r(t);return this.loaders[e.type]=a,a}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:s}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:ne.MANIFEST,url:s,deliveryDirectives:null,levelOrTrack:null})}onLevelLoading(e,t){const{id:s,level:i,pathwayId:r,url:a,deliveryDirectives:o,levelInfo:l}=t;this.load({id:s,level:i,pathwayId:r,responseType:"text",type:ne.LEVEL,url:a,deliveryDirectives:o,levelOrTrack:l})}onAudioTrackLoading(e,t){const{id:s,groupId:i,url:r,deliveryDirectives:a,track:o}=t;this.load({id:s,groupId:i,level:null,responseType:"text",type:ne.AUDIO_TRACK,url:r,deliveryDirectives:a,levelOrTrack:o})}onSubtitleTrackLoading(e,t){const{id:s,groupId:i,url:r,deliveryDirectives:a,track:o}=t;this.load({id:s,groupId:i,level:null,responseType:"text",type:ne.SUBTITLE_TRACK,url:r,deliveryDirectives:a,levelOrTrack:o})}onLevelsUpdated(e,t){const s=this.loaders[ne.LEVEL];if(s){const i=s.context;i&&!t.levels.some(r=>r===i.levelOrTrack)&&(s.abort(),delete this.loaders[ne.LEVEL])}}load(e){var t;const s=this.hls.config;let i=this.getInternalLoader(e);if(i){const u=this.hls.logger,c=i.context;if(c&&c.levelOrTrack===e.levelOrTrack&&(c.url===e.url||c.deliveryDirectives&&!e.deliveryDirectives)){c.url===e.url?u.log(`[playlist-loader]: ignore ${e.url} ongoing request`):u.log(`[playlist-loader]: ignore ${e.url} in favor of ${c.url}`);return}u.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),i.abort()}let r;if(e.type===ne.MANIFEST?r=s.manifestLoadPolicy.default:r=ue({},s.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),i=this.createInternalLoader(e),j((t=e.deliveryDirectives)==null?void 0:t.part)){let u;if(e.type===ne.LEVEL&&e.level!==null?u=this.hls.levels[e.level].details:e.type===ne.AUDIO_TRACK&&e.id!==null?u=this.hls.audioTracks[e.id].details:e.type===ne.SUBTITLE_TRACK&&e.id!==null&&(u=this.hls.subtitleTracks[e.id].details),u){const c=u.partTarget,d=u.targetduration;if(c&&d){const h=Math.max(c*3,d*.8)*1e3;r=ue({},r,{maxTimeToFirstByteMs:Math.min(h,r.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(h,r.maxTimeToFirstByteMs)})}}}const a=r.errorRetry||r.timeoutRetry||{},o={loadPolicy:r,timeout:r.maxLoadTimeMs,maxRetry:a.maxNumRetry||0,retryDelay:a.retryDelayMs||0,maxRetryDelay:a.maxRetryDelayMs||0},l={onSuccess:(u,c,d,h)=>{const f=this.getInternalLoader(d);this.resetInternalLoader(d.type);const g=u.data;c.parsing.start=performance.now(),Wt.isMediaPlaylist(g)||d.type!==ne.MANIFEST?this.handleTrackOrLevelPlaylist(u,c,d,h||null,f):this.handleMasterPlaylist(u,c,d,h)},onError:(u,c,d,h)=>{this.handleNetworkError(c,d,!1,u,h)},onTimeout:(u,c,d)=>{this.handleNetworkError(c,d,!0,void 0,u)}};i.load(e,o,l)}checkAutostartLoad(){if(!this.hls)return;const{config:{autoStartLoad:e,startPosition:t},forceStartLoad:s}=this.hls;(e||s)&&(this.hls.logger.log(`${e?"auto":"force"} startLoad with configured startPosition ${t}`),this.hls.startLoad(t))}handleMasterPlaylist(e,t,s,i){const r=this.hls,a=e.data,o=Zo(e,s),l=Wt.parseMasterPlaylist(a,o);if(l.playlistParsingError){t.parsing.end=performance.now(),this.handleManifestParsingError(e,s,l.playlistParsingError,i,t);return}const{contentSteering:u,levels:c,sessionData:d,sessionKeys:h,startTimeOffset:f,variableList:g}=l;this.variableList=g,c.forEach(m=>{const{unknownCodecs:S}=m;if(S){const{preferManagedMediaSource:T}=this.hls.config;let{audioCodec:A,videoCodec:_}=m;for(let L=S.length;L--;){const R=S[L];Ki(R,"audio",T)?(m.audioCodec=A=A?`${A},${R}`:R,Ws.audio[A.substring(0,4)]=2,S.splice(L,1)):Ki(R,"video",T)&&(m.videoCodec=_=_?`${_},${R}`:R,Ws.video[_.substring(0,4)]=2,S.splice(L,1))}}});const{AUDIO:p=[],SUBTITLES:E,"CLOSED-CAPTIONS":y}=Wt.parseMasterPlaylistMedia(a,o,l);p.length&&!p.some(S=>!S.url)&&c[0].audioCodec&&!c[0].attrs.AUDIO&&(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),p.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new me({}),bitrate:0,url:""})),r.trigger(v.MANIFEST_LOADED,{levels:c,audioTracks:p,subtitles:E,captions:y,contentSteering:u,url:o,stats:t,networkDetails:i,sessionData:d,sessionKeys:h,startTimeOffset:f,variableList:g})}handleTrackOrLevelPlaylist(e,t,s,i,r){const a=this.hls,{id:o,level:l,type:u}=s,c=Zo(e,s),d=j(l)?l:j(o)?o:0,h=of(s),f=Wt.parseLevelPlaylist(e.data,c,d,h,0,this.variableList);if(u===ne.MANIFEST){const g={attrs:new me({}),bitrate:0,details:f,name:"",url:c};f.requestScheduled=t.loading.start+tm(f,0),a.trigger(v.MANIFEST_LOADED,{levels:[g],audioTracks:[],url:c,stats:t,networkDetails:i,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),s.levelDetails=f,this.handlePlaylistLoaded(f,e,t,s,i,r)}handleManifestParsingError(e,t,s,i,r){this.hls.trigger(v.ERROR,{type:Y.NETWORK_ERROR,details:w.MANIFEST_PARSING_ERROR,fatal:t.type===ne.MANIFEST,url:e.url,err:s,error:s,reason:s.message,response:e,context:t,networkDetails:i,stats:r})}handleNetworkError(e,t,s=!1,i,r){let a=`A network ${s?"timeout":"error"+(i?" (status "+i.code+")":"")} occurred while loading ${e.type}`;e.type===ne.LEVEL?a+=`: ${e.level} id: ${e.id}`:(e.type===ne.AUDIO_TRACK||e.type===ne.SUBTITLE_TRACK)&&(a+=` id: ${e.id} group-id: "${e.groupId}"`);const o=new Error(a);this.hls.logger.warn(`[playlist-loader]: ${a}`);let l=w.UNKNOWN,u=!1;const c=this.getInternalLoader(e);switch(e.type){case ne.MANIFEST:l=s?w.MANIFEST_LOAD_TIMEOUT:w.MANIFEST_LOAD_ERROR,u=!0;break;case ne.LEVEL:l=s?w.LEVEL_LOAD_TIMEOUT:w.LEVEL_LOAD_ERROR,u=!1;break;case ne.AUDIO_TRACK:l=s?w.AUDIO_TRACK_LOAD_TIMEOUT:w.AUDIO_TRACK_LOAD_ERROR,u=!1;break;case ne.SUBTITLE_TRACK:l=s?w.SUBTITLE_TRACK_LOAD_TIMEOUT:w.SUBTITLE_LOAD_ERROR,u=!1;break}c&&this.resetInternalLoader(e.type);const d={type:Y.NETWORK_ERROR,details:l,fatal:u,url:e.url,loader:c,context:e,error:o,networkDetails:t,stats:r};if(i){const h=(t==null?void 0:t.url)||e.url;d.response=ae({url:h,data:void 0},i)}this.hls.trigger(v.ERROR,d)}handlePlaylistLoaded(e,t,s,i,r,a){const o=this.hls,{type:l,level:u,levelOrTrack:c,id:d,groupId:h,deliveryDirectives:f}=i,g=Zo(t,i),p=of(i);let E=typeof i.level=="number"&&p===H.MAIN?u:void 0;const y=e.playlistParsingError;if(y){if(this.hls.logger.warn(`${y} ${e.url}`),!o.config.ignorePlaylistParsingErrors){o.trigger(v.ERROR,{type:Y.NETWORK_ERROR,details:w.LEVEL_PARSING_ERROR,fatal:!1,url:g,error:y,reason:y.message,response:t,context:i,level:E,parent:p,networkDetails:r,stats:s});return}e.playlistParsingError=null}if(!e.fragments.length){const m=e.playlistParsingError=new Error("No Segments found in Playlist");o.trigger(v.ERROR,{type:Y.NETWORK_ERROR,details:w.LEVEL_EMPTY_ERROR,fatal:!1,url:g,error:m,reason:m.message,response:t,context:i,level:E,parent:p,networkDetails:r,stats:s});return}switch(e.live&&a&&(a.getCacheAge&&(e.ageHeader=a.getCacheAge()||0),(!a.getCacheAge||isNaN(e.ageHeader))&&(e.ageHeader=0)),l){case ne.MANIFEST:case ne.LEVEL:if(E){if(!c)E=0;else if(c!==o.levels[E]){const m=o.levels.indexOf(c);m>-1&&(E=m)}}o.trigger(v.LEVEL_LOADED,{details:e,levelInfo:c||o.levels[0],level:E||0,id:d||0,stats:s,networkDetails:r,deliveryDirectives:f,withoutMultiVariant:l===ne.MANIFEST});break;case ne.AUDIO_TRACK:o.trigger(v.AUDIO_TRACK_LOADED,{details:e,track:c,id:d||0,groupId:h||"",stats:s,networkDetails:r,deliveryDirectives:f});break;case ne.SUBTITLE_TRACK:o.trigger(v.SUBTITLE_TRACK_LOADED,{details:e,track:c,id:d||0,groupId:h||"",stats:s,networkDetails:r,deliveryDirectives:f});break}}}class Ht{static get version(){return zi}static isMSESupported(){return e0()}static isSupported(){return MA()}static getMediaSource(){return On()}static get Events(){return v}static get MetadataSchema(){return ut}static get ErrorTypes(){return Y}static get ErrorDetails(){return w}static get DefaultConfig(){return Ht.defaultConfig?Ht.defaultConfig:LA}static set DefaultConfig(e){Ht.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new yc,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;const t=this.logger=Wv(e.debug||!1,"Hls instance",e.assetPlayerId),s=this.config=RA(Ht.DefaultConfig,e,t);this.userConfig=e,s.progressive&&_A(s,t);const{abrController:i,bufferController:r,capLevelController:a,errorController:o,fpsController:l}=s,u=new o(this),c=this.abrController=new i(this),d=new GE(this),h=s.interstitialsController,f=h?this.interstitialsController=new h(this,Ht):null,g=this.bufferController=new r(this,d),p=this.capLevelController=new a(this),E=new l(this),y=new jA(this),m=s.contentSteeringController,S=m?new m(this):null,T=this.levelController=new OA(this,S),A=new bA(this),_=new $A(this.config,this.logger),L=this.streamController=new UA(this,d,_),R=this.gapController=new DA(this,d);p.setStreamController(L),E.setStreamController(L);const C=[y,T,L];f&&C.splice(1,0,f),S&&C.splice(1,0,S),this.networkControllers=C;const I=[c,g,R,p,E,A,d];this.audioTrackController=this.createController(s.audioTrackController,C);const P=s.audioStreamController;P&&C.push(this.audioStreamController=new P(this,d,_)),this.subtitleTrackController=this.createController(s.subtitleTrackController,C);const $=s.subtitleStreamController;$&&C.push(this.subtititleStreamController=new $(this,d,_)),this.createController(s.timelineController,I),_.emeController=this.emeController=this.createController(s.emeController,I),this.cmcdController=this.createController(s.cmcdController,I),this.latencyController=this.createController(NA,I),this.coreComponents=I,C.push(u);const G=u.onErrorOut;typeof G=="function"&&this.on(v.ERROR,G,u),this.on(v.MANIFEST_LOADED,y.onManifestLoaded,y)}createController(e,t){if(e){const s=new e(this);return t&&t.push(s),s}return null}on(e,t,s=this){this._emitter.on(e,t,s)}once(e,t,s=this){this._emitter.once(e,t,s)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t,s=this,i){this._emitter.off(e,t,s,i)}listeners(e){return this._emitter.listeners(e)}emit(e,t,s){return this._emitter.emit(e,t,s)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(s){if(this.logger.error("An internal error happened while handling event "+e+'. Error message: "'+s.message+'". Here is a stacktrace:',s),!this.triggeringException){this.triggeringException=!0;const i=e===v.ERROR;this.trigger(v.ERROR,{type:Y.OTHER_ERROR,details:w.INTERNAL_EXCEPTION,fatal:i,event:e,error:s}),this.triggeringException=!1}}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){this.logger.log("destroy"),this.trigger(v.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(t=>t.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(t=>t.destroy()),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){if(!e||"media"in e&&!e.media){const r=new Error(`attachMedia failed: invalid argument (${e})`);this.trigger(v.ERROR,{type:Y.OTHER_ERROR,details:w.ATTACH_MEDIA_ERROR,fatal:!0,error:r});return}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());const t="media"in e,s=t?e.media:e,i=t?e:{media:s};this._media=s,this.trigger(v.MEDIA_ATTACHING,i)}detachMedia(){this.logger.log("detachMedia"),this.trigger(v.MEDIA_DETACHING,{}),this._media=null}transferMedia(){this._media=null;const e=this.bufferController.transferMedia();return this.trigger(v.MEDIA_DETACHING,{transferMedia:e}),e}loadSource(e){this.stopLoad();const t=this.media,s=this._url,i=this._url=ac.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log(`loadSource:${i}`),t&&s&&(s!==i||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(v.MANIFEST_LOADING,{url:e})}get url(){return this._url}get hasEnoughToStart(){return this.streamController.hasEnoughToStart}get startPosition(){return this.streamController.startPositionValue}startLoad(e=-1,t){this.logger.log(`startLoad(${e+(t?", <skip seek to start>":"")})`),this.started=!0,this.resumeBuffering();for(let s=0;s<this.networkControllers.length&&(this.networkControllers[s].startLoad(e,t),!(!this.started||!this.networkControllers));s++);}stopLoad(){this.logger.log("stopLoad"),this.started=!1;for(let e=0;e<this.networkControllers.length&&(this.networkControllers[e].stopLoad(),!(this.started||!this.networkControllers));e++);}get loadingEnabled(){return this.started}get bufferingEnabled(){return this.streamController.bufferingEnabled}resumeBuffering(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(e=>{e.resumeBuffering&&e.resumeBuffering()}))}pauseBuffering(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(e=>{e.pauseBuffering&&e.pauseBuffering()}))}get inFlightFragments(){const e={[H.MAIN]:this.streamController.inFlightFrag};return this.audioStreamController&&(e[H.AUDIO]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(e[H.SUBTITLE]=this.subtititleStreamController.inFlightFrag),e}swapAudioCodec(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){this.logger.log("recoverMediaError");const e=this._media,t=e==null?void 0:e.currentTime;this.detachMedia(),e&&(this.attachMedia(e),t&&this.startLoad(t))}removeLevel(e){this.levelController.removeLevel(e)}get sessionId(){let e=this._sessionId;return e||(e=this._sessionId=DT()),e}get levels(){const e=this.levelController.levels;return e||[]}get latestLevelDetails(){return this.streamController.getLevelDetails()||null}get loadLevelObj(){return this.levelController.loadLevelObj}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){this.logger.log(`set currentLevel:${e}`),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){this.logger.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){this.logger.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){this.logger.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){const e=this.levelController.startLevel;return e===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){this.logger.log(`set startLevel:${e}`),e!==-1&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get abrEwmaDefaultEstimate(){const{bwEstimator:e}=this.abrController;return e?e.defaultEstimate:NaN}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(this.logger.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){RE(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;const s=e.length;for(let i=0;i<s;i++)if(e[i].maxBitrate>=t)return i;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:t,maxHdcpLevel:s}=this;let i;if(t===-1&&e!=null&&e.length?i=e.length-1:i=t,s)for(let r=i;r--;){const a=e[r].attrs["HDCP-LEVEL"];if(a&&a<=s)return r}return i}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get maxBufferLength(){return this.streamController.maxBufferLength}setAudioOption(e){var t;return((t=this.audioTrackController)==null?void 0:t.setAudioOption(e))||null}setSubtitleOption(e){var t;return((t=this.subtitleTrackController)==null?void 0:t.setSubtitleOption(e))||null}get allAudioTracks(){const e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const t=this.audioTrackController;t&&(t.audioTrack=e)}get allSubtitleTracks(){const e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return e?e.subtitleDisplay:!1}set subtitleDisplay(e){const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}set targetLatency(e){this.latencyController.targetLatency=e}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}get pathways(){return this.levelController.pathways}get pathwayPriority(){return this.levelController.pathwayPriority}set pathwayPriority(e){this.levelController.pathwayPriority=e}get bufferedToEnd(){var e;return!!((e=this.bufferController)!=null&&e.bufferedToEnd)}get interstitialsManager(){var e;return((e=this.interstitialsController)==null?void 0:e.interstitialsManager)||null}getMediaDecodingInfo(e,t=this.allAudioTracks){const s=$p(t);return Bp(e,s,navigator.mediaCapabilities)}}Ht.defaultConfig=void 0;function GA({src:n}){const e=Ce.useRef(null);return Ce.useEffect(()=>{const t=e.current;if(t)if(Ht.isSupported()){const s=new Ht({enableWorker:!0});return s.loadSource(n),s.attachMedia(t),s.on(Ht.Events.MANIFEST_PARSED,()=>{t.play().catch(()=>{})}),()=>{s.destroy()}}else t.canPlayType("application/vnd.apple.mpegurl")&&(t.src=n,t.addEventListener("loadedmetadata",()=>t.play().catch(()=>{})))},[n]),x.jsx("video",{ref:e,className:"absolute inset-0 w-full h-full object-cover opacity-100",autoPlay:!0,loop:!0,muted:!0,playsInline:!0})}function KA(){return x.jsx("svg",{width:"129",height:"40",viewBox:"0 0 129 40",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"shrink-0",children:x.jsx("text",{x:"0",y:"28",fill:"white",fontFamily:"'Plus Jakarta Sans', sans-serif",fontWeight:"700",fontSize:"22",children:"ClawFriend"})})}const lf={fontSize:"clamp(12px, 1.05vw, 20px)"};function t0({left:n,center:e,right:t,compact:s=!1}){return x.jsxs("header",{className:`flex items-center justify-between shrink-0 px-[4%] ${s?"pt-[3%]":"pt-[3%] pb-[2%]"}`,children:[n??x.jsx(KA,{}),e!=null&&x.jsx("span",{className:"text-white/80",style:lf,children:e}),t!=null&&x.jsx("span",{className:"text-white/80 tabular-nums",style:lf,children:t})]})}const uf={fontSize:"clamp(12px, 1.05vw, 20px)"};function n0({left:n,right:e,single:t}){return t!=null?x.jsx("footer",{className:"shrink-0 px-[4%] pt-[2%] pb-[3%] text-right text-white/60",style:uf,children:t}):n==null&&e==null?null:x.jsxs("footer",{className:"flex items-center justify-between shrink-0 px-[4%] pt-[2%] pb-[3%] text-white/60",style:uf,children:[n!=null?x.jsx("span",{children:n}):x.jsx("span",{}),e!=null?x.jsx("span",{children:e}):x.jsx("span",{})]})}function s0({videoSrc:n,header:e,footer:t,children:s,mainClassName:i="",scrollable:r=!0}){return x.jsxs("div",{className:"relative w-full h-full",children:[x.jsx(GA,{src:n}),x.jsx("div",{className:"relative z-10 flex flex-col h-full px-[5.2%] pt-[4%] pb-[5%]",children:x.jsxs("div",{className:"glass-card flex flex-col h-full rounded-2xl overflow-hidden min-h-0",children:[e,x.jsx("main",{className:`flex-1 min-h-0 flex flex-col px-[4%] pb-[3%] ${r?"overflow-y-auto":""} ${i}`,style:{fontSize:"clamp(12px, 1.05vw, 20px)"},children:s}),t]})})]})}const cu=["https://stream.mux.com/JNJEOYI6B3EffB9f5ZhpGbuxzc6gSyJcXaCBbCgZKRg.m3u8","https://stream.mux.com/Kec29dVyJgiPdtWaQtPuEiiGHkJIYQAVUJcNiIHUYeo.m3u8","https://stream.mux.com/fHfa8VIbBdqZelLGg5thjsypZ101M01dbyIMLNDWQwlLA.m3u8","https://stream.mux.com/4IMYGcL01xjs7ek5ANO17JC4VQVUTsojZlnw4fXzwSxc.m3u8","https://stream.mux.com/00qQnfNo7sSpn3pB1hYKkyeSDvxs01NxiQ3sr29uL3e028.m3u8"];function VA(){return x.jsx(s0,{videoSrc:cu[0],header:x.jsx(t0,{right:"Pitch Deck",compact:!0}),footer:x.jsx(n0,{left:"BNB Smart Chain  Nn tng AI Agent  Thng 2/2026",right:"CLAWFRIEND"}),scrollable:!1,mainClassName:"justify-center",children:x.jsxs("div",{style:{marginTop:"-3%"},children:[x.jsx("h1",{className:"text-white font-bold tracking-[-0.02em] leading-[1.05]",style:{fontSize:"clamp(32px, 5vw, 96px)"},children:"ClawFriend"}),x.jsx("p",{className:"text-white/90 mt-[1.5%]",style:{fontSize:"clamp(20px, 2.5vw, 48px)"},children:"Sn Skill AI Agent trn BSC"}),x.jsx("p",{className:"text-white/75 mt-[2%]",style:{fontSize:"clamp(14px, 1.2vw, 24px)"},children:"Nguyn Vit Hong  Akira  FE Developer"}),x.jsx("p",{className:"text-white/90 mt-[1%]",style:{fontSize:"clamp(14px, 1.2vw, 20px)"},children:"Nghin cu th trng  Chin lc Skill  K hoch phn phi"})]})})}function Mt({videoIndex:n,pageLabel:e,title:t,footer:s,children:i,scrollable:r=!0}){const a=cu[n%cu.length];return x.jsxs(s0,{videoSrc:a,header:x.jsx(t0,{center:"Pitch Deck",right:e}),footer:s!=null?x.jsx(n0,{single:s}):void 0,scrollable:r,children:[t!=null&&x.jsx("h2",{className:"text-white font-bold tracking-[-0.02em] leading-tight shrink-0 mb-[2%]",style:{fontSize:"clamp(18px, 2vw, 36px)"},children:t}),x.jsx("div",{className:"text-white/90 leading-[1.5] space-y-1",children:i})]})}const as="list-disc list-inside pl-0 space-y-0.5 text-white/90";function HA(){return x.jsx(Mt,{videoIndex:1,pageLabel:"Trang 002",title:"Ti sao BSC? Ti sao by gi?",footer:"Bi cnh th trng",children:x.jsxs("div",{className:"grid grid-cols-2 gap-x-[4%] gap-y-[2%]",children:[x.jsxs("div",{className:"glass rounded-lg p-[3%]",children:[x.jsx("p",{className:"font-semibold text-white mb-2",style:{fontSize:"clamp(13px, 1.1vw, 18px)"},children:"S liu"}),x.jsxs("ul",{className:as,style:{fontSize:"clamp(11px, 1vw, 16px)"},children:[x.jsx("li",{children:"58 d n AI Agent trn BNB Chain (2/2026)"}),x.jsx("li",{children:"Hn 20.000 agent trn BSC (Q1/2026)"}),x.jsx("li",{children:"8 triu USD gi vn DIN (Series A, 2025)"})]})]}),x.jsxs("div",{className:"glass rounded-lg p-[3%]",children:[x.jsx("p",{className:"font-semibold text-white mb-2",style:{fontSize:"clamp(13px, 1.1vw, 18px)"},children:"H s retail BSC"}),x.jsxs("ul",{className:as,style:{fontSize:"clamp(11px, 1vw, 16px)"},children:[x.jsx("li",{children:"Hn 80% trader retail"}),x.jsx("li",{children:"Chu : VN, n , Th Nh K"}),x.jsx("li",{children:"Telegram-native, DeFi: PancakeSwap, Venus, Alpaca"}),x.jsx("li",{children:"412 gi/tun research DeFi"})]})]}),x.jsxs("div",{className:"col-span-2 glass rounded-lg px-[3%] py-[2%]",children:[x.jsx("p",{className:"font-semibold text-white mb-1",children:"Bi cnh then cht"}),x.jsx("p",{className:"text-white/90",children:"BNB Chain ra mt ERC-8004 (nh danh agent on-chain) v BAP-578 (agent dng NFT)  h tng ClawFriend tch hp trc tip."})]})]})})}function zA(){return x.jsxs(Mt,{videoIndex:2,pageLabel:"Trang 003",title:"Bn  cnh tranh",footer:"Phn tch theo module",children:[x.jsx("p",{className:"text-white/80 mb-2",style:{fontSize:"clamp(11px, 1vw, 14px)"},children:"Phn tch theo module  khng theo category sn phm"}),x.jsx("div",{className:"overflow-x-auto",children:x.jsxs("table",{className:"w-full border-collapse text-left",style:{fontSize:"clamp(10px, 0.95vw, 14px)"},children:[x.jsx("thead",{children:x.jsxs("tr",{className:"text-white border-b border-white/25",children:[x.jsx("th",{className:"py-1.5 pr-2",children:"Nn tng"}),x.jsx("th",{className:"py-1.5 pr-2 w-20",children:"Trng thi"}),x.jsx("th",{className:"py-1.5 pr-2",children:"M t"}),x.jsx("th",{className:"py-1.5",children:"im cht"})]})}),x.jsxs("tbody",{className:"text-white/90",children:[x.jsxs("tr",{className:"border-b border-white/10",children:[x.jsx("td",{className:"py-1.5 pr-2 font-medium",children:"Cooker.club"}),x.jsx("td",{children:"nh tr"}),x.jsx("td",{children:"BSC + Solana, bonding curve, auto-tweet; <100 agent, website DOWN 2/2026"}),x.jsx("td",{children:"Creator 0% ph"})]}),x.jsxs("tr",{className:"border-b border-white/10",children:[x.jsx("td",{className:"py-1.5 pr-2 font-medium",children:"Moltbook"}),x.jsx("td",{children:"1M+ agent"}),x.jsx("td",{children:"Web2, mng x hi AI, OpenClaw; 1M+ agent trong 5 ngy"}),x.jsx("td",{children:"Zero economic layer"})]}),x.jsxs("tr",{className:"border-b border-white/10",children:[x.jsx("td",{className:"py-1.5 pr-2 font-medium",children:"GPT Store"}),x.jsx("td",{children:"Benchmark"}),x.jsx("td",{children:"Web2, sn skill, 50K+ GPT; 99% creator 0$"}),x.jsx("td",{children:"Tp trung ha, khng on-chain"})]}),x.jsxs("tr",{className:"border-b border-white/10",children:[x.jsx("td",{className:"py-1.5 pr-2 font-medium",children:"Mint Club"}),x.jsx("td",{children:"H tng"}),x.jsx("td",{children:"a chain, bonding curve; 5.400+ token/NFT; 80% b hoang"}),x.jsx("td",{children:"Khng lp AI, thun speculation"})]}),x.jsxs("tr",{className:"border-b border-white/10",children:[x.jsx("td",{className:"py-1.5 pr-2 font-medium",children:"BNB / DIN"}),x.jsx("td",{children:"Thun gi"}),x.jsx("td",{children:"H tng, 30M+ user, 8M USD; agent registry"}),x.jsx("td",{children:"Khng phi marketplace"})]}),x.jsxs("tr",{children:[x.jsx("td",{className:"py-1.5 pr-2 font-semibold text-white",children:"ClawFriend"}),x.jsx("td",{children:"Ra mt"}),x.jsx("td",{children:"Bn a BSC, Skill Market + Bonding Curve + Social Stream"}),x.jsx("td",{children:"Duy nht creator economics BSC"})]})]})]})})]})}function WA(){return x.jsxs(Mt,{videoIndex:3,pageLabel:"Trang 004",title:"So snh m hnh kinh doanh",footer:"So snh i th",children:[x.jsx("div",{className:"overflow-x-auto",children:x.jsxs("table",{className:"w-full border-collapse text-left",style:{fontSize:"clamp(10px, 0.95vw, 15px)"},children:[x.jsx("thead",{children:x.jsxs("tr",{className:"text-white border-b border-white/25",children:[x.jsx("th",{className:"py-1.5 pr-2",children:"Nn tng"}),x.jsx("th",{className:"py-1.5 pr-2",children:"Ph Creator"}),x.jsx("th",{className:"py-1.5 pr-2",children:"M hnh mua"}),x.jsx("th",{className:"py-1.5 pr-2 w-14",children:"BSC"}),x.jsx("th",{className:"py-1.5 pr-2 w-14",children:"AI"}),x.jsx("th",{className:"py-1.5",children:"Trng thi"})]})}),x.jsxs("tbody",{className:"text-white/90",children:[x.jsxs("tr",{className:"border-b border-white/10",children:[x.jsx("td",{className:"py-1 pr-2",children:"Cooker.club"}),x.jsx("td",{children:"0% (DAO)"}),x.jsx("td",{children:"Bonding curve"}),x.jsx("td",{children:"C"}),x.jsx("td",{children:"C"}),x.jsx("td",{children:"nh tr"})]}),x.jsxs("tr",{className:"border-b border-white/10",children:[x.jsx("td",{className:"py-1 pr-2",children:"Moltbook"}),x.jsx("td",{children:"0$"}),x.jsx("td",{children:"Min ph"}),x.jsx("td",{children:"Khng"}),x.jsx("td",{children:"C"}),x.jsx("td",{children:"i ngang"})]}),x.jsxs("tr",{className:"border-b border-white/10",children:[x.jsx("td",{className:"py-1 pr-2",children:"GPT Store"}),x.jsx("td",{children:"Opaque"}),x.jsx("td",{children:"20$/thng"}),x.jsx("td",{children:"Khng"}),x.jsx("td",{children:"C"}),x.jsx("td",{children:"50K GPT"})]}),x.jsxs("tr",{className:"border-b border-white/10",children:[x.jsx("td",{className:"py-1 pr-2",children:"Mint Club"}),x.jsx("td",{children:"0%"}),x.jsx("td",{children:"Bonding curve"}),x.jsx("td",{children:"C"}),x.jsx("td",{children:"Khng"}),x.jsx("td",{children:"80% b hoang"})]}),x.jsxs("tr",{className:"border-b border-white/10",children:[x.jsx("td",{className:"py-1 pr-2",children:"BNB Ecosystem"}),x.jsx("td",{children:"N/A"}),x.jsx("td",{children:"N/A"}),x.jsx("td",{children:"C"}),x.jsx("td",{children:"ang xy"}),x.jsx("td",{children:"H tng"})]}),x.jsxs("tr",{className:"text-white font-semibold",children:[x.jsx("td",{className:"py-1 pr-2",children:"ClawFriend"}),x.jsx("td",{children:"5% vnh vin"}),x.jsx("td",{children:"Bonding + holder-gated"}),x.jsx("td",{children:"BSC-first"}),x.jsx("td",{children:"C"}),x.jsx("td",{children:"Ra mt"})]})]})]})}),x.jsxs("div",{className:"grid grid-cols-2 gap-x-[4%] mt-[3%]",children:[x.jsxs("div",{className:"glass rounded-lg p-[2.5%]",children:[x.jsx("p",{className:"font-semibold text-white mb-1.5",children:"ClawFriend thng  u"}),x.jsxs("ul",{className:as,style:{fontSize:"clamp(11px, 1vw, 15px)"},children:[x.jsx("li",{children:"Duy nht BSC c kinh t creator 5% vnh vin"}),x.jsx("li",{children:"Duy nht skill + bonding curve + social mt nn tng"}),x.jsx("li",{children:"Creator kim mi giao dch mi mi"})]})]}),x.jsxs("div",{className:"glass rounded-lg p-[2.5%]",children:[x.jsx("p",{className:"font-semibold text-white mb-1.5",children:"Ri ro"}),x.jsxs("ul",{className:as,style:{fontSize:"clamp(11px, 1vw, 15px)"},children:[x.jsx("li",{children:"Quy m: Moltbook 1M, ClawFriend t khng"}),x.jsx("li",{children:"Phn phi: cn chin lc ni dung mnh"}),x.jsx("li",{children:"Thc thi: 3 module = phc tp cao hn"})]})]})]})]})}function YA(){return x.jsxs(Mt,{videoIndex:4,pageLabel:"Trang 005",title:"Nghin cu Skill  Phng php",footer:"Skill Research",children:[x.jsxs("div",{className:"flex items-center gap-[2%] mb-[3%] text-white/80",style:{fontSize:"clamp(12px, 1.05vw, 16px)"},children:[x.jsx("span",{children:"Trader BSC: 412 gi/tun research"}),x.jsx("span",{children:""}),x.jsx("span",{children:"1015 pht/token  2050 token/tun"})]}),x.jsxs("div",{className:"flex gap-[3%] mb-[3%]",children:[x.jsxs("div",{className:"glass rounded-lg p-[2.5%] flex-1",children:[x.jsx("p",{className:"font-semibold text-white mb-2",children:"Phng php"}),x.jsx("p",{className:"text-white/90",children:"7 phin Perplexity  7 cm pain. Xc thc bng quy m cng ng + cng c tr ph hin c."})]}),x.jsxs("div",{className:"glass rounded-lg p-[2.5%] flex-1",children:[x.jsx("p",{className:"font-semibold text-white mb-2",children:"Tiu ch chn"}),x.jsxs("ul",{className:as,children:[x.jsx("li",{children:"C cng c tr ph = demand chng minh"}),x.jsx("li",{children:"C khe h BSC"}),x.jsx("li",{children:"Build c vi API c sn"})]})]})]}),x.jsx("p",{className:"font-semibold text-white mb-1.5",children:"7 cm pain"}),x.jsx("div",{className:"overflow-x-auto",children:x.jsxs("table",{className:"w-full border-collapse",style:{fontSize:"clamp(10px, 0.95vw, 14px)"},children:[x.jsx("thead",{children:x.jsxs("tr",{className:"text-white border-b border-white/25",children:[x.jsx("th",{className:"py-1 pr-2 text-left",children:"Pain"}),x.jsx("th",{className:"py-1 text-left",children:"Bng chng / Cng c hin ti"})]})}),x.jsxs("tbody",{className:"text-white/90",children:[x.jsxs("tr",{className:"border-b border-white/10",children:[x.jsx("td",{className:"py-1 pr-2",children:"Whale / smart money"}),x.jsx("td",{children:"Nansen 69999$/thng"})]}),x.jsxs("tr",{className:"border-b border-white/10",children:[x.jsx("td",{className:"py-1 pr-2",children:"Rug token"}),x.jsx("td",{children:"2.0005.000 rug/thng BSC"})]}),x.jsxs("tr",{className:"border-b border-white/10",children:[x.jsx("td",{className:"py-1 pr-2",children:"Yield farming"}),x.jsx("td",{children:"Beefy 300M+ TVL BSC"})]}),x.jsxs("tr",{className:"border-b border-white/10",children:[x.jsx("td",{className:"py-1 pr-2",children:"Airdrop"}),x.jsx("td",{children:"4,5 t USD 2025, 70% khng claim"})]}),x.jsxs("tr",{className:"border-b border-white/10",children:[x.jsx("td",{className:"py-1 pr-2",children:"Sentiment"}),x.jsx("td",{children:"LunarCrush 72$/thng, 0% BSC"})]}),x.jsxs("tr",{className:"border-b border-white/10",children:[x.jsx("td",{className:"py-1 pr-2",children:"Token launch"}),x.jsx("td",{children:"100200 cp BSC mi/ngy"})]}),x.jsxs("tr",{children:[x.jsx("td",{className:"py-1 pr-2",children:"Portfolio"}),x.jsx("td",{children:"4560 pht/ngy th cng"})]})]})]})})]})}function qA(){return x.jsx(Mt,{videoIndex:0,pageLabel:"Trang 006",title:"Top 3 Skill  Bng chng demand",footer:"Top 3 Skills",children:x.jsx("div",{className:"overflow-x-auto",children:x.jsxs("table",{className:"w-full border-collapse text-left",style:{fontSize:"clamp(10px, 0.9vw, 14px)"},children:[x.jsx("thead",{children:x.jsxs("tr",{className:"text-white border-b border-white/25",children:[x.jsx("th",{className:"py-1.5 pr-2 w-44",children:"Skill"}),x.jsx("th",{className:"py-1.5 pr-2",children:"Bng chng demand"}),x.jsx("th",{className:"py-1.5 pr-2",children:"Cng c hin ti"}),x.jsx("th",{className:"py-1.5",children:"M hnh ClawFriend"})]})}),x.jsxs("tbody",{className:"text-white/90",children:[x.jsxs("tr",{className:"border-b border-white/10",children:[x.jsx("td",{className:"py-1.5 pr-2 font-medium text-white align-top",children:"#1 Token Safety Scanner"}),x.jsx("td",{className:"py-1.5 pr-2 align-top",children:"2s AI vs 1015 pht th cng. Token Sniffer 1M+ qut/thng, r/CryptoMoonShots 1,2M sub, @RugCheckerBSC 120K, search 40K/thng"}),x.jsx("td",{className:"py-1.5 pr-2 align-top",children:"TokenSniffer + RugDoc + DexTools = 39$/thng"}),x.jsx("td",{className:"py-1.5 align-top",children:"Public 3 free/ngy  Holder full + Telegram"})]}),x.jsxs("tr",{className:"border-b border-white/10",children:[x.jsx("td",{className:"py-1.5 pr-2 font-medium text-white align-top",children:"#2 Smart Money Tracker"}),x.jsx("td",{className:"py-1.5 pr-2 align-top",children:"Whale alert <60s vs 3045 pht/ngy. @WhaleAlert 2,5M, @lookonchain 1,2M, BSCWhaleCalls 25K, search 80K/thng"}),x.jsx("td",{className:"py-1.5 pr-2 align-top",children:"Nansen 69999$/thng (ETH)"}),x.jsx("td",{className:"py-1.5 align-top",children:"Public top 10 delay 15 pht  Holder real-time, 50 v"})]}),x.jsxs("tr",{children:[x.jsx("td",{className:"py-1.5 pr-2 font-medium text-white align-top",children:"#3 Token Launch Intelligence"}),x.jsx("td",{className:"py-1.5 pr-2 align-top",children:"Cp mi + qut 60s vs 1h+. BSCSnipers 35K, 100200 cp BSC/ngy. Ti dng engine #1  23 ngy build"}),x.jsx("td",{className:"py-1.5 pr-2 align-top",children:"Maestro 30$ + TokenSniffer 9,99$ = 40$/thng"}),x.jsx("td",{className:"py-1.5 align-top",children:"Public feed + im c bn  Holder Telegram + full analysis"})]})]})]})})})}function QA(){return x.jsxs(Mt,{videoIndex:1,pageLabel:"Trang 007",title:"6 Skill  Ma trn + Vng quay Holder",footer:"Skills Matrix",children:[x.jsx("div",{className:"overflow-x-auto mb-[3%]",children:x.jsxs("table",{className:"w-full border-collapse text-left",style:{fontSize:"clamp(10px, 0.95vw, 14px)"},children:[x.jsx("thead",{children:x.jsxs("tr",{className:"text-white border-b border-white/25",children:[x.jsx("th",{className:"py-1.5 pr-2",children:"Skill"}),x.jsx("th",{className:"py-1.5 pr-2 w-24",children:"Mc "}),x.jsx("th",{className:"py-1.5 pr-2",children:"Th trng"}),x.jsx("th",{className:"py-1.5 pr-2 w-20",children:"BSC gap"}),x.jsx("th",{className:"py-1.5",children:"Effort"})]})}),x.jsxs("tbody",{className:"text-white/90",children:[x.jsxs("tr",{className:"border-b border-white/10",children:[x.jsx("td",{className:"py-1 pr-2",children:"Token Safety Scanner"}),x.jsx("td",{children:"Nghim trng"}),x.jsx("td",{children:"1M+ qut/thng"}),x.jsx("td",{children:"Mnh"}),x.jsx("td",{children:"D"})]}),x.jsxs("tr",{className:"border-b border-white/10",children:[x.jsx("td",{className:"py-1 pr-2",children:"Smart Money Tracker"}),x.jsx("td",{children:"Cao"}),x.jsx("td",{children:"200M+"}),x.jsx("td",{children:"Mnh"}),x.jsx("td",{children:"TB"})]}),x.jsxs("tr",{className:"border-b border-white/10",children:[x.jsx("td",{className:"py-1 pr-2",children:"Token Launch Intelligence"}),x.jsx("td",{children:"Nghim trng"}),x.jsx("td",{children:"1,2M cng ng"}),x.jsx("td",{children:"Mnh"}),x.jsx("td",{children:"D (ti #1)"})]}),x.jsxs("tr",{className:"border-b border-white/10",children:[x.jsx("td",{className:"py-1 pr-2",children:"Airdrop Intelligence"}),x.jsx("td",{children:"Cao"}),x.jsx("td",{children:"4,5 t USD/nm"}),x.jsx("td",{children:"Critical"}),x.jsx("td",{children:"TB"})]}),x.jsxs("tr",{className:"border-b border-white/10",children:[x.jsx("td",{className:"py-1 pr-2",children:"Yield Optimizer"}),x.jsx("td",{children:"TB"}),x.jsx("td",{children:"300M+ TVL BSC"}),x.jsx("td",{children:"TB"}),x.jsx("td",{children:"D"})]}),x.jsxs("tr",{children:[x.jsx("td",{className:"py-1 pr-2",children:"Social Alpha Scanner"}),x.jsx("td",{children:"TB"}),x.jsx("td",{children:"100M+"}),x.jsx("td",{children:"Critical"}),x.jsx("td",{children:"Kh"})]})]})]})}),x.jsxs("div",{className:"flex items-center justify-between gap-2 mb-[3%] px-[2%] py-[2%] glass rounded-lg",style:{fontSize:"clamp(11px, 1vw, 15px)"},children:[x.jsx("span",{className:"text-white/90",children:"Output public cht lng"}),x.jsx("span",{className:"text-white/60",children:""}),x.jsx("span",{className:"text-white/90",children:"User tm agent, mua share"}),x.jsx("span",{className:"text-white/60",children:""}),x.jsx("span",{className:"text-white/90",children:"Creator kim tin, u t data"}),x.jsx("span",{className:"text-white/60",children:""}),x.jsx("span",{className:"text-white/90",children:"Signal tt hn, cng c output"})]}),x.jsxs("div",{className:"grid grid-cols-2 gap-x-[4%]",children:[x.jsxs("div",{className:"glass rounded-lg p-[2.5%]",children:[x.jsx("p",{className:"font-semibold text-white mb-1",children:"Subscription (LunarCrush)"}),x.jsx("p",{className:"text-white/90",children:"72$/thng  hy  quan h 0$"})]}),x.jsxs("div",{className:"glass rounded-lg p-[2.5%]",children:[x.jsx("p",{className:"font-semibold text-white mb-1",children:"Holder-gated (ClawFriend)"}),x.jsx("p",{className:"text-white/90",children:"1 share  access mi mi  share gi gi tr  creator vnh vin"})]})]})]})}function XA(){return x.jsxs(Mt,{videoIndex:2,pageLabel:"Trang 008",title:"K hoch phn phi  10.000 USD  Thng 1  1.035 ng k",footer:"Distribution Plan",children:[x.jsx("div",{className:"overflow-x-auto mb-[3%]",children:x.jsxs("table",{className:"w-full border-collapse text-left",style:{fontSize:"clamp(11px, 1vw, 15px)"},children:[x.jsx("thead",{children:x.jsxs("tr",{className:"text-white border-b border-white/25",children:[x.jsx("th",{className:"py-1.5 pr-2",children:"Knh"}),x.jsx("th",{className:"py-1.5 pr-2 w-24",children:"Ngn sch"}),x.jsx("th",{className:"py-1.5 pr-2 w-20",children:"T l"}),x.jsx("th",{className:"py-1.5",children:"c ng k"})]})}),x.jsxs("tbody",{className:"text-white/90",children:[x.jsxs("tr",{className:"border-b border-white/10",children:[x.jsx("td",{className:"py-1 pr-2",children:"Twitter/X Paid Ads"}),x.jsx("td",{children:"4.000 USD"}),x.jsx("td",{children:"40%"}),x.jsx("td",{children:"160"})]}),x.jsxs("tr",{className:"border-b border-white/10",children:[x.jsx("td",{className:"py-1 pr-2",children:"Telegram KOL + Groups"}),x.jsx("td",{children:"3.500 USD"}),x.jsx("td",{children:"35%"}),x.jsx("td",{children:"325"})]}),x.jsxs("tr",{className:"border-b border-white/10",children:[x.jsx("td",{className:"py-1 pr-2",children:"Social Stream"}),x.jsx("td",{children:"0 USD"}),x.jsx("td",{children:""}),x.jsx("td",{children:"200"})]}),x.jsxs("tr",{className:"border-b border-white/10",children:[x.jsx("td",{className:"py-1 pr-2",children:"Content + Gieo cng ng"}),x.jsx("td",{children:"0 USD"}),x.jsx("td",{children:""}),x.jsx("td",{children:"200"})]}),x.jsxs("tr",{className:"border-b border-white/10",children:[x.jsx("td",{className:"py-1 pr-2",children:"i tc BSC"}),x.jsx("td",{children:"2.000 USD"}),x.jsx("td",{children:"20%"}),x.jsx("td",{children:"150"})]}),x.jsxs("tr",{children:[x.jsx("td",{className:"py-1 pr-2",children:"D phng / A-B test"}),x.jsx("td",{children:"500 USD"}),x.jsx("td",{children:"5%"}),x.jsx("td",{children:""})]})]})]})}),x.jsxs("div",{className:"flex gap-[4%] flex-wrap",children:[x.jsxs("div",{className:"glass rounded-lg px-[3%] py-[2%]",children:[x.jsx("p",{className:"text-white/70 text-sm",children:"CAC blended"}),x.jsx("p",{className:"text-white font-semibold",children:"9,66 USD"})]}),x.jsxs("div",{className:"glass rounded-lg px-[3%] py-[2%]",children:[x.jsx("p",{className:"text-white/70 text-sm",children:"CAC paid-only"}),x.jsx("p",{className:"text-white font-semibold",children:"15,46 USD"})]}),x.jsxs("div",{className:"glass rounded-lg px-[3%] py-[2%]",children:[x.jsx("p",{className:"text-white/70 text-sm",children:"Tng ng k (bo th)"}),x.jsx("p",{className:"text-white font-semibold",children:"1.035"})]})]}),x.jsx("p",{className:"text-white/70 mt-[2%]",style:{fontSize:"clamp(11px, 1vw, 14px)"},children:"Gi nh: 4K Twitter  CPC 1$  CVR 4%  160; 3,5K Telegram  430K reach  CTR 1,5%  CVR 5%  325; referral 2K (10$/ng k)  150+. Khng viral, khng grant."})]})}function ZA(){return x.jsx(Mt,{videoIndex:3,pageLabel:"Trang 009",title:"3 knh quan trng nht",footer:"Channels",children:x.jsx("div",{className:"overflow-x-auto",children:x.jsxs("table",{className:"w-full border-collapse text-left",style:{fontSize:"clamp(10px, 0.95vw, 14px)"},children:[x.jsx("thead",{children:x.jsxs("tr",{className:"text-white border-b border-white/25",children:[x.jsx("th",{className:"py-1.5 pr-2 w-48",children:"Knh"}),x.jsx("th",{className:"py-1.5 pr-2 w-28",children:"Ngn sch / Kt qu"}),x.jsx("th",{className:"py-1.5",children:"Chi tit"})]})}),x.jsxs("tbody",{className:"text-white/90",children:[x.jsxs("tr",{className:"border-b border-white/10",children:[x.jsx("td",{className:"py-1.5 pr-2 font-medium text-white align-top",children:"Telegram KOL + Groups"}),x.jsx("td",{className:"py-1.5 pr-2 align-top",children:"3.500 USD  CAC 10,77$"}),x.jsx("td",{className:"py-1.5 align-top",children:"BSCSignalsOfficial 120K, BSCArmyCalls 80K, BSCWhalePumps 60K, PancakeSwapHunters 50K. Ni dung phi c alpha thc."})]}),x.jsxs("tr",{className:"border-b border-white/10",children:[x.jsx("td",{className:"py-1.5 pr-2 font-medium text-white align-top",children:"Twitter/X Ads"}),x.jsx("td",{className:"py-1.5 pr-2 align-top",children:"4.000 USD  160  CAC 25$"}),x.jsx("td",{className:"py-1.5 align-top",children:"Audience: BSC DeFi (PancakeSwap 2M, BNBChain 1,8M), Smart Money (WhaleAlert 2,5M), AI Builders (ai16z 1M+). Ad A/B/C: demo, pain-point, creator. CPC >2$ sau 500 click  i creative."})]}),x.jsxs("tr",{children:[x.jsx("td",{className:"py-1.5 pr-2 font-medium text-white align-top",children:"Social Stream t phn phi"}),x.jsx("td",{className:"py-1.5 pr-2 align-top",children:"0 USD  200 ng k"}),x.jsx("td",{className:"py-1.5 align-top",children:"6 lung: whale digest, per-scan safety, farm APY, airdrop deadlines, BSC trending, token launch feed. @ClawFriendBot 3 free scan/ngy  viral  CTA."})]})]})]})})})}function JA(){return x.jsxs(Mt,{videoIndex:4,pageLabel:"Trang 010",title:"Anchor Creators + OpenClaw",footer:"Timeline",children:[x.jsx("p",{className:"text-white/90 mb-[2%]",children:"5 Creator  20K follower = 100K user tim nng, 0 USD acquisition"}),x.jsx("div",{className:"overflow-x-auto mb-[2%]",children:x.jsxs("table",{className:"w-full border-collapse text-left",style:{fontSize:"clamp(10px, 0.95vw, 14px)"},children:[x.jsx("thead",{children:x.jsxs("tr",{className:"text-white border-b border-white/25",children:[x.jsx("th",{className:"py-1.5 pr-2",children:"H s"}),x.jsx("th",{className:"py-1.5",children:"Pitch"})]})}),x.jsxs("tbody",{className:"text-white/90",children:[x.jsxs("tr",{className:"border-b border-white/10",children:[x.jsx("td",{className:"py-1.5 pr-2",children:"Operator group Telegram (BSCSignalsOfficial 120K, 0$ curation)"}),x.jsx("td",{className:"py-1.5",children:"5% ph vnh vin mi giao dch share"})]}),x.jsxs("tr",{className:"border-b border-white/10",children:[x.jsx("td",{className:"py-1.5 pr-2",children:"BSC whale tracker 50K200K follower"}),x.jsx("td",{className:"py-1.5",children:"Gate real-time sau holder access; ClawFriend lo h tng"})]}),x.jsxs("tr",{children:[x.jsx("td",{className:"py-1.5 pr-2",children:"Builder OpenClaw (135K stars), 200+ hackathon BNB"}),x.jsx("td",{className:"py-1.5",children:"Wrap skill, publish, kim mi giao dch share"})]})]})]})}),x.jsx("p",{className:"font-semibold text-white mb-1",children:"u i sng lp"}),x.jsx("p",{className:"text-white/90 mb-[2%]",children:"0% ph protocol 3 thng  Badge Founding Creator (on-chain)  Featured"}),x.jsxs("div",{className:"flex flex-wrap gap-x-[2%] gap-y-1 items-center",style:{fontSize:"clamp(11px, 1vw, 14px)"},children:[x.jsx("span",{className:"text-white font-medium",children:"Tun 1"}),x.jsx("span",{className:"text-white/60",children:""}),x.jsx("span",{className:"text-white/90",children:"Deploy Bot, Twitter Ads (A), slot BSCSignalsOfficial, MVB, OpenClaw"}),x.jsx("span",{className:"text-white/40",children:"|"}),x.jsx("span",{className:"text-white font-medium",children:"Tun 2"}),x.jsx("span",{className:"text-white/60",children:""}),x.jsx("span",{className:"text-white/90",children:"A/B test, Telegram T2, Mirror + Reddit, 2 anchor"}),x.jsx("span",{className:"text-white/40",children:"|"}),x.jsx("span",{className:"text-white font-medium",children:"Tun 3"}),x.jsx("span",{className:"text-white/60",children:""}),x.jsx("span",{className:"text-white/90",children:"Scale +50%, skill + PR, GoPlus"}),x.jsx("span",{className:"text-white/40",children:"|"}),x.jsx("span",{className:"text-white font-medium",children:"Tun 4"}),x.jsx("span",{className:"text-white/60",children:""}),x.jsx("span",{className:"text-white/90",children:"Review, wrap-up, referral, plan thng 2"})]})]})}function eL(){return x.jsxs(Mt,{videoIndex:0,pageLabel:"Trang 011",title:"AI Showcase  Pipeline nghin cu",footer:"AI Showcase",children:[x.jsxs("div",{className:"flex items-center justify-between gap-2 mb-[4%] px-[3%] py-[2.5%] glass rounded-lg",style:{fontSize:"clamp(12px, 1.1vw, 18px)"},children:[x.jsx("span",{className:"text-white font-medium",children:"CLAUDE"}),x.jsx("span",{className:"text-white/50",children:""}),x.jsx("span",{className:"text-white font-medium",children:"PERPLEXITY"}),x.jsx("span",{className:"text-white/50",children:""}),x.jsx("span",{className:"text-white font-medium",children:"CLAUDE"}),x.jsx("p",{className:"text-white/70 text-sm ml-2",children:"(thit k  thc thi  tng hp)"})]}),x.jsxs("div",{className:"grid grid-cols-2 gap-x-[4%] mb-[3%]",children:[x.jsxs("div",{className:"glass rounded-lg p-[2.5%]",children:[x.jsx("p",{className:"font-semibold text-white mb-2",children:"Pipeline"}),x.jsxs("ul",{className:as,children:[x.jsx("li",{children:"CLAUDE: Framework, CLAUDE.md, prompt"}),x.jsx("li",{children:"PERPLEXITY: Web real-time, data c ngun"}),x.jsx("li",{children:"CLAUDE: Tng hp, phn tch, deliverable"})]})]}),x.jsxs("div",{className:"glass rounded-lg p-[2.5%]",children:[x.jsx("p",{className:"font-semibold text-white mb-2",children:"Pht hin chnh"}),x.jsxs("ul",{className:as,children:[x.jsx("li",{children:"Cooker.club: prompt theo module  nh tr 2/2026"}),x.jsx("li",{children:"Moltbook 1M+: 4 ngun; OpenClaw trng builder"}),x.jsx("li",{children:"Khng tool sentiment BSC quy m; LunarCrush <10% BSC"})]})]})]}),x.jsxs("div",{className:"glass rounded-lg p-[2.5%]",children:[x.jsx("p",{className:"font-semibold text-white mb-1.5",children:"Cht lng prompt"}),x.jsx("p",{className:"text-white/90",children:"Prompt rng Find competitors ClawFriend  kt qu chung chung. Prompt tp trung Find platforms creators earn ongoing revenue from trading of assets they created  tm Cooker.club + Mint Club. 7 prompt tp trung > 1 prompt rng."})]})]})}function tL(){return x.jsxs(Mt,{videoIndex:1,pageLabel:"Trang 012",title:"Q&A  Cu hi BGK & Cu tr li",footer:"Q&A Ready",children:[x.jsxs("div",{className:"space-y-[2.5%]",children:[x.jsxs("div",{className:"glass rounded-lg p-[2.5%]",children:[x.jsx("p",{className:"font-semibold text-white mb-1",children:"i th X 50K user, ti sao mnh thng?"}),x.jsx("p",{className:"text-white/90",children:"Khng i th no BSC skill marketplace holder-gated. Cooker.club down 2/2026. Moltbook 1M nhng zero economic. Virtuals Base/Solana. ClawFriend: BSC-native + DeFi utility + creator economics."})]}),x.jsxs("div",{className:"glass rounded-lg p-[2.5%]",children:[x.jsx("p",{className:"font-semibold text-white mb-1",children:"10K  1.000 user?"}),x.jsx("p",{className:"text-white/90",children:"4K Twitter  160  3,5K Telegram  325  0 Stream+Bot  200  0 Content  200  2K referral  150+. Tng ~1.035 (bo th)."})]}),x.jsxs("div",{className:"glass rounded-lg p-[2.5%]",children:[x.jsx("p",{className:"font-semibold text-white mb-1",children:"Ti sao khng ChatGPT?"}),x.jsx("p",{className:"text-white/90",children:"Khng wallet, khng on-chain real-time, khng Telegram alert, khng holder-gated. ClawFriend Smart Money <60s."})]}),x.jsxs("div",{className:"glass rounded-lg p-[2.5%]",children:[x.jsx("p",{className:"font-semibold text-white mb-1",children:"Ti sao mua share thay v public tier?"}),x.jsx("p",{className:"text-white/90",children:"Public hu ch nhng c  khng . Delay 15 pht = mun copy trade. Basic score = bit risk cha . Holder tier = decision-making. Public = proof of value; Holder = monetizable value."})]})]}),x.jsxs("div",{className:"mt-[2%] pt-[2%] border-t border-white/20",children:[x.jsx("p",{className:"font-semibold text-white mb-1",children:"Kt lun"}),x.jsx("p",{className:"text-white/90",children:"ClawFriend = duy nht trn BSC c creator economics + skill marketplace + bonding curve + social stream trong mt h sinh thi."})]})]})}function nL(){return x.jsx(Bv,{slides:[x.jsx(VA,{},"1"),x.jsx(HA,{},"2"),x.jsx(zA,{},"3"),x.jsx(WA,{},"4"),x.jsx(YA,{},"5"),x.jsx(qA,{},"6"),x.jsx(QA,{},"7"),x.jsx(XA,{},"8"),x.jsx(ZA,{},"9"),x.jsx(JA,{},"10"),x.jsx(eL,{},"11"),x.jsx(tL,{},"12")]})}Tp(document.getElementById("root")).render(x.jsx(Ce.StrictMode,{children:x.jsx(nL,{})}));
